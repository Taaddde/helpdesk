function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var c=0;c<e.length;c++){var i=e[c];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,c){return e&&_defineProperties(t.prototype,e),c&&_defineProperties(t,c),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"99bU":function(t,e,c){"use strict";c.r(e);var i=c("ofXK"),n=c("tyNb"),a=c("3Pt+"),s=c("qFsG"),r=c("NFeN"),o=c("bTqV"),u=c("Wp6s"),l=c("f0Cb"),d=c("zkoq"),b=c("kmnG"),p=c("0IaG"),f=c("Qu3c"),g=c("PCNd"),m=c("3kSh"),h=c("3sEA"),k=c("wd/R"),v=c("gU78"),y=c("BlIn"),x=c("YFeJ"),C=c("1yaQ"),w=c("FKr1"),_=c("fXoL"),T=c("dNgK"),M=c("XiUz"),I=c("d3UM");function G(t,e){if(1&t){var c=_.cc();_.bc(0,"mat-option",10),_.jc("click",(function(t){_.Mc(c);var i=e.$implicit;return _.nc().set(i,"requester")})),_.Vc(1),_.ac()}if(2&t){var i=e.$implicit;_.uc("value",i.name+" "+i.surname),_.Gb(1),_.Yc("",i.name," ",i.surname,"")}}function S(t,e){if(1&t){var c=_.cc();_.bc(0,"mat-option",10),_.jc("click",(function(t){_.Mc(c);var i=e.$implicit;return _.nc().set(i,"agent")})),_.Vc(1),_.ac()}if(2&t){var i=e.$implicit;_.uc("value",i.name+" "+i.surname),_.Gb(1),_.Yc("",i.name," ",i.surname,"")}}var V,j=((V=function(){function t(e,c,i,n){_classCallCheck(this,t),this.data=e,this.dialogRef=c,this._userService=i,this.snackBar=n,this.token=i.getToken(),this.identity=i.getIdentity(),this.filter={}}return _createClass(t,[{key:"ngOnInit",value:function(){this.getRequesters(),this.getAgents()}},{key:"set",value:function(t,e){switch(e){case"requester":this.filter.requester=t._id;break;case"agent":this.filter.agent=t._id;break;case"status":this.filter.status=t}}},{key:"deleteFilter",value:function(t){switch(t){case"requester":this.filter.requester=null;break;case"agent":this.filter.agent=null;break;case"status":this.filter.status=null;break;case"sub":this.filter.sub="";break;case"numTicket":this.filter.numTicket=null}}},{key:"openSnackBar",value:function(t,e){this.snackBar.open(t,e,{duration:1e4})}},{key:"getRequesters",value:function(){var t=this;this._userService.getListReq(this.token,this.identity.company._id).subscribe((function(e){e.users&&(t.allRequesters=e.users,t.requesters=e.users)}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}},{key:"getAgents",value:function(){var t,e=this;t=this.identity.company?this.identity.company._id:"null",this._userService.getListAgents(this.token,t).subscribe((function(t){t.users&&(e.allAgents=t.users,e.agents=t.users)}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}},{key:"sendQuery",value:function(){""==this.filter.sub&&(this.filter.sub=null),"ROLE_REQUESTER"==this.identity.role&&(this.filter.requester=this.identity._id),this.dialogRef.close(this.filter)}}]),t}()).\u0275fac=function(t){return new(t||V)(_.Vb(p.a),_.Vb(p.g),_.Vb(v.a),_.Vb(T.a))},V.\u0275cmp=_.Pb({type:V,selectors:[["app-filter"]],features:[_.Fb([{provide:w.c,useClass:C.c,deps:[w.g]},{provide:w.f,useValue:C.a},v.a])],decls:42,vars:7,consts:[["matDialogTitle",""],[1,"p-0"],["fxLayout","row wrap","fxLayout.lt-sm","column"],["fxFlex","50",1,"pr-1"],["appearance","fill",1,"full-width"],["matInput","","type","number","name","numTicket",3,"ngModel","ngModelChange"],["matInput","","type","text","name","sub",3,"ngModel","ngModelChange"],[3,"click"],[3,"value","click",4,"ngFor","ngForOf"],["fxFlex","100",1,"pr-1"],[3,"value","click"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,e){1&t&&(_.bc(0,"h1",0),_.Vc(1),_.ac(),_.bc(2,"mat-card",1),_.bc(3,"mat-card-content"),_.bc(4,"form"),_.bc(5,"div",2),_.bc(6,"div",3),_.bc(7,"mat-form-field",4),_.bc(8,"mat-label"),_.Vc(9,"N\xfamero"),_.ac(),_.bc(10,"input",5),_.jc("ngModelChange",(function(t){return e.filter.numTicket=t})),_.ac(),_.ac(),_.ac(),_.bc(11,"div",3),_.bc(12,"mat-form-field",4),_.bc(13,"mat-label"),_.Vc(14,"Asunto"),_.ac(),_.bc(15,"input",6),_.jc("ngModelChange",(function(t){return e.filter.sub=t})),_.ac(),_.ac(),_.ac(),_.bc(16,"div",3),_.bc(17,"mat-form-field",4),_.bc(18,"mat-label"),_.Vc(19,"Solicitante"),_.ac(),_.bc(20,"mat-select"),_.bc(21,"mat-option",7),_.jc("click",(function(t){return e.deleteFilter("requester")})),_.ac(),_.Tc(22,G,2,3,"mat-option",8),_.ac(),_.ac(),_.ac(),_.bc(23,"div",3),_.bc(24,"mat-form-field",4),_.bc(25,"mat-label"),_.Vc(26,"Agente"),_.ac(),_.bc(27,"mat-select"),_.bc(28,"mat-option",7),_.jc("click",(function(t){return e.deleteFilter("agent")})),_.ac(),_.Tc(29,S,2,3,"mat-option",8),_.ac(),_.ac(),_.ac(),_.bc(30,"div",9),_.bc(31,"mat-form-field",4),_.bc(32,"mat-label"),_.Vc(33,"Estado"),_.ac(),_.bc(34,"mat-select"),_.bc(35,"mat-option",7),_.jc("click",(function(t){return e.deleteFilter("status")})),_.ac(),_.bc(36,"mat-option",10),_.jc("click",(function(t){return e.set("Pendiente","status")})),_.Vc(37,"Pendiente"),_.ac(),_.bc(38,"mat-option",10),_.jc("click",(function(t){return e.set("Finalizado","status")})),_.Vc(39,"Finalizado"),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.bc(40,"button",11),_.jc("click",(function(t){return e.sendQuery()})),_.Vc(41,"Filtrar"),_.ac(),_.ac(),_.ac()),2&t&&(_.Gb(1),_.Wc(e.data.title),_.Gb(9),_.uc("ngModel",e.filter.numTicket),_.Gb(5),_.uc("ngModel",e.filter.sub),_.Gb(7),_.uc("ngForOf",e.requesters),_.Gb(7),_.uc("ngForOf",e.agents),_.Gb(7),_.uc("value","Pendiente"),_.Gb(2),_.uc("value","Finalizado"))},directives:[p.h,u.a,u.b,a.x,a.o,a.p,M.d,M.b,b.b,b.e,s.b,a.s,a.c,a.n,a.q,I.a,w.p,i.l,o.b],encapsulation:2}),V);function E(t,e){if(1&t){var c=_.cc();_.bc(0,"button",32),_.jc("click",(function(t){return _.Mc(c),_.nc().unify()})),_.Vc(1,"Unificar"),_.ac()}}function O(t,e){if(1&t&&_.Wb(0,"img",44),2&t){var c=_.nc().$implicit,i=_.nc();_.vc("src",i.url+"user/image/"+c.requester.image,_.Oc)}}function P(t,e){1&t&&_.Wb(0,"img",45)}function q(t,e){if(1&t&&_.Wb(0,"img",44),2&t){var c=_.nc(2).$implicit,i=_.nc();_.vc("src",i.url+"user/image/"+c.agent.image,_.Oc)}}function W(t,e){1&t&&_.Wb(0,"img",45)}function F(t,e){if(1&t&&(_.bc(0,"td",46),_.Tc(1,q,1,1,"img",36),_.Tc(2,W,1,0,"img",37),_.Vc(3),_.Wb(4,"span"),_.Vc(5),_.ac()),2&t){var c=_.nc().$implicit;_.Gb(1),_.uc("ngIf","null"!=c.agent.image),_.Gb(1),_.uc("ngIf","null"==c.agent.image),_.Gb(1),_.Xc(" ",c.agent.name," "),_.Gb(2),_.Xc(" ",c.agent.surname," ")}}function R(t,e){1&t&&_.Wb(0,"td",46)}function L(t,e){if(1&t){var c=_.cc();_.bc(0,"tbody"),_.bc(1,"tr",33),_.jc("click",(function(t){_.Mc(c);var i=e.$implicit;return _.nc().selectTicket(t,i)})),_.bc(2,"td",34),_.Vc(3),_.ac(),_.bc(4,"td",35),_.Tc(5,O,1,1,"img",36),_.Tc(6,P,1,0,"img",37),_.Vc(7),_.Wb(8,"span"),_.Vc(9),_.ac(),_.bc(10,"td",38),_.bc(11,"p",39),_.Vc(12),_.ac(),_.ac(),_.Tc(13,F,6,4,"td",40),_.Tc(14,R,1,0,"td",40),_.bc(15,"td",41),_.Vc(16),_.ac(),_.bc(17,"td",42),_.Vc(18),_.ac(),_.bc(19,"td",43),_.Vc(20),_.ac(),_.ac(),_.ac()}if(2&t){var i=e.$implicit,n=_.nc();_.Ib("Cerrado"==i.status?"closed":""),_.Gb(1),_.Ib(n.isInGroup(i)&&"ROLE_REQUESTER"!=n.identity.role?"selected":"select"),_.Gb(2),_.Wc(i.numTicket),_.Gb(2),_.uc("ngIf",i.requester&&"null"!=i.requester.image),_.Gb(1),_.uc("ngIf",!i.requester||"null"==i.requester.image),_.Gb(1),_.Xc(" ",i.requester.name," "),_.Gb(2),_.Xc(" ",i.requester.surname," "),_.Gb(2),_.vc("title",i.sub),_.Gb(1),_.Wc(i.sub),_.Gb(1),_.uc("ngIf",i.agent),_.Gb(1),_.uc("ngIf",!i.agent),_.Gb(2),_.Wc(i.status),_.Gb(2),_.Wc(n.changeDate(i.createDate)),_.Gb(2),_.Wc(n.changeDate(i.lastActivity))}}var A=function(t){return["/ticket/list",1,t]};function B(t,e){if(1&t&&(_.bc(0,"a",47),_.bc(1,"span"),_.Vc(2,"\xab"),_.ac(),_.ac()),2&t){var c=_.nc();_.uc("routerLink",_.Ac(2,A,c.limit))("queryParams",c.query)}}var D=function(t,e){return["/ticket/list",t,e]};function Y(t,e){if(1&t&&(_.bc(0,"a",47),_.Vc(1),_.ac()),2&t){var c=_.nc();_.uc("routerLink",_.Bc(3,D,c.prevPage,c.limit))("queryParams",c.query),_.Gb(1),_.Wc(c.prevPage)}}function z(t,e){if(1&t&&(_.bc(0,"a",47),_.Vc(1),_.ac()),2&t){var c=_.nc();_.uc("routerLink",_.Bc(3,D,c.nextPage,c.limit))("queryParams",c.query),_.Gb(1),_.Wc(c.nextPage)}}function N(t,e){if(1&t&&(_.bc(0,"a",47),_.bc(1,"span"),_.Vc(2,"\xbb"),_.ac(),_.ac()),2&t){var c=_.nc();_.uc("routerLink",_.Bc(2,D,c.totalPages,c.limit))("queryParams",c.query)}}var U,H,Q=((U=function(){function t(e,c,i,n,a,s,r,o){_classCallCheck(this,t),this.dialog=e,this._route=c,this._router=i,this.confirmService=n,this.loader=a,this.snackBar=s,this._userService=r,this._ticketService=o,this.token=r.getToken(),this.identity=r.getIdentity(),this.url=x.a.url,this.groupTicket=new Array}return _createClass(t,[{key:"ngOnInit",value:function(){this.setQuery(),this.getTickets()}},{key:"setQuery",value:function(){this.query={}}},{key:"getTickets",value:function(){var t=this;this.loader.open("Cargando tickets"),this._route.params.forEach((function(e){t._route.queryParams.forEach((function(c){var i;t.query=c,t.page=e.page,t.limit=e.limit,"ROLE_REQUESTER"==t.identity.role&&(i=t.identity._id),t._ticketService.getList(t.token,t.page,t.limit,c,t.identity.company&&null!=t.identity.company?t.identity.company._id:null,i).subscribe((function(e){e.tickets&&(t.tickets=e.tickets.docs,t.limit=e.tickets.limit,t.nextPage=e.tickets.nextPage,t.prevPage=e.tickets.prevPage,t.totalDocs=e.tickets.totalDocs,t.totalPages=e.tickets.totalPages,t.pagingCounter=e.tickets.pagingCounter,t.loader.close())}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}))}))}},{key:"openSnackBar",value:function(t,e){this.snackBar.open(t,e,{duration:1e4})}},{key:"getSectorTickets",value:function(){var t=this;this.loader.open("Cargando tickets"),this._route.params.forEach((function(e){t._route.queryParams.forEach((function(c){t.query=c,t.page=e.page,t.limit=e.perPage,t._ticketService.getSectorPaginatedList(t.token,t.page,t.limit,c,t.identity.sector._id).subscribe((function(e){e.tickets&&(t.tickets=e.tickets.docs,t.limit=e.tickets.limit,t.nextPage=e.tickets.nextPage,t.prevPage=e.tickets.prevPage,t.totalDocs=e.tickets.totalDocs,t.totalPages=e.tickets.totalPages,t.pagingCounter=e.tickets.pagingCounter,t.loader.close())}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}))}))}},{key:"isLastPage",value:function(){return this.totalDocs<this.pagingCounter+this.limit?this.totalDocs:this.pagingCounter+this.limit-1}},{key:"changeLimit",value:function(t){this.limit=t,this._router.navigate(["/ticket/list",this.page,this.limit],{queryParams:this.query})}},{key:"changeDate",value:function(t){return k(t,"YYYY-MM-DD HH:mm").format("DD-MM-YYYY HH:mm")}},{key:"selectTicket",value:function(t,e){t.ctrlKey?"Cerrado"!=e.status?-1!=this.groupTicket.indexOf(e.numTicket)?this.groupTicket.splice(this.groupTicket.indexOf(e.numTicket),1):this.groupTicket.push(e.numTicket):this.openSnackBar("El ticket se encuentra cerrado","Cerrar"):this._router.navigate(["/ticket/gestion",e._id])}},{key:"isInGroup",value:function(t){return-1!=this.groupTicket.indexOf(t.numTicket)}},{key:"unify",value:function(){var t=this;this.confirmService.confirm({message:"\xbfEsta seguro que quiere unificar los tickets seleccionados? Prevalecer\xe1 el ticket mas antiguo y se pondr\xe1 en copia a los solicitantes que hayan generado las otras consultas."}).subscribe((function(e){e&&t._ticketService.unify(t.token,t.groupTicket).subscribe((function(e){e.tickets?(t.openSnackBar("Unificaci\xf3n realizada","Cerrar"),t.groupTicket=new Array,t.getTickets()):t._router.navigate(["/"])}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}))}},{key:"getQuery",value:function(){this._route.queryParams.forEach((function(t){return t}))}},{key:"refCheck",value:function(t){t.currentTarget.checked?this.getSectorTickets():this.getTickets()}},{key:"openPopUp",value:function(){var t=this;this.loader.open(),this.dialog.open(j,{width:"720px",disableClose:!1,data:{title:"Filtro de tickets"}}).afterClosed().subscribe((function(e){e&&t._router.navigate(["ticket/list",1,t.limit],{queryParams:e}),t.loader.close()}))}}]),t}()).\u0275fac=function(t){return new(t||U)(_.Vb(p.b),_.Vb(n.a),_.Vb(n.g),_.Vb(m.a),_.Vb(h.a),_.Vb(T.a),_.Vb(v.a),_.Vb(y.a))},U.\u0275cmp=_.Pb({type:U,selectors:[["app-ticket-list"]],features:[_.Fb([v.a,y.a])],decls:87,vars:11,consts:[[1,"card","shadow"],[1,"card-body"],[1,"row"],[1,"col-md-6","text-nowrap"],["id","dataTable_length",1,"dataTables_length"],[1,"form-control","form-control-sm","custom-select","custom-select-sm",3,"change"],["value","10","selected",""],["value","25"],["value","50"],["value","100"],[1,"col-md-6"],["id","dataTable_filter",1,"text-md-right","dataTables_filter"],[1,"form-check"],["type","checkbox","id","ref",1,"form-check-input",3,"disabled","change"],["for","ref",1,"form-check-label"],[1,"row",2,"margin-bottom","5px"],[1,"col","text-nowrap"],["type","button",1,"btn","btn-dark","dark'",3,"click"],[1,"fa","fa-filter"],["class","btn btn-dark dark","type","button","style","margin-left: 5px;",3,"click",4,"ngIf"],["id","dataTable",1,"table-responsive","table"],["id","dataTable",1,"table","table-hover","table-sm"],[2,"width","300px"],[3,"className",4,"ngFor","ngForOf"],[1,"col-md-6","align-self-center"],["id","dataTable_info",1,"dataTables_info"],[1,"d-lg-flex","justify-content-lg-end","dataTables_paginate","paging_simple_numbers"],[1,"pagination"],[1,"page-item"],["class","page-link",3,"routerLink","queryParams",4,"ngIf"],[1,"page-item","active"],[1,"page-link"],["type","button",1,"btn","btn-dark","dark",2,"margin-left","5px",3,"click"],[3,"click"],["data-title","Numero"],["data-title","Solicitante"],["class","rounded-circle mr-2","width","30","height","30",3,"src",4,"ngIf"],["class","rounded-circle mr-2","width","30","height","30","src","assets/images/system/user-placeholder.png",4,"ngIf"],["data-title","Asunto",1,"text-nowrap","text-truncate","text-break"],["ng-bind","ticket.sub",1,"body-cell",2,"font-size","14px",3,"title"],["data-title","Agente",4,"ngIf"],["data-title","Estado"],["data-title","Fecha"],["data-title","Novedad"],["width","30","height","30",1,"rounded-circle","mr-2",3,"src"],["width","30","height","30","src","assets/images/system/user-placeholder.png",1,"rounded-circle","mr-2"],["data-title","Agente"],[1,"page-link",3,"routerLink","queryParams"]],template:function(t,e){1&t&&(_.bc(0,"mat-card",0),_.bc(1,"div",1),_.bc(2,"div",2),_.bc(3,"div",3),_.bc(4,"div",4),_.bc(5,"label"),_.Vc(6,"Mostrar\xa0 "),_.bc(7,"select",5),_.jc("change",(function(t){return e.changeLimit(t.target.value)})),_.bc(8,"option",6),_.Vc(9,"10"),_.ac(),_.bc(10,"option",7),_.Vc(11,"25"),_.ac(),_.bc(12,"option",8),_.Vc(13,"50"),_.ac(),_.bc(14,"option",9),_.Vc(15,"100"),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.bc(16,"div",10),_.bc(17,"div",11),_.bc(18,"div",12),_.bc(19,"input",13),_.jc("change",(function(t){return e.refCheck(t)})),_.ac(),_.bc(20,"label",14),_.Vc(21,"TICKETS DEL SECTOR"),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.bc(22,"div",15),_.bc(23,"div",16),_.bc(24,"button",17),_.jc("click",(function(t){return e.openPopUp()})),_.Wb(25,"i",18),_.ac(),_.Tc(26,E,2,0,"button",19),_.ac(),_.ac(),_.bc(27,"div",20),_.bc(28,"table",21),_.bc(29,"thead"),_.bc(30,"tr"),_.bc(31,"th"),_.Vc(32,"N\xfamero"),_.ac(),_.bc(33,"th"),_.Vc(34,"Solicitante"),_.ac(),_.bc(35,"th",22),_.Vc(36,"Asunto"),_.ac(),_.bc(37,"th"),_.Vc(38,"Agente"),_.ac(),_.bc(39,"th"),_.Vc(40,"Estado"),_.ac(),_.bc(41,"th"),_.Vc(42,"Fecha"),_.ac(),_.bc(43,"th"),_.Vc(44,"Novedad"),_.ac(),_.ac(),_.ac(),_.Tc(45,L,21,16,"tbody",23),_.bc(46,"tfoot"),_.bc(47,"tr"),_.bc(48,"td"),_.bc(49,"strong"),_.Vc(50,"Numero"),_.ac(),_.ac(),_.bc(51,"td"),_.bc(52,"strong"),_.Vc(53,"Solicitante"),_.ac(),_.ac(),_.bc(54,"td"),_.bc(55,"strong"),_.Vc(56,"Asunto"),_.ac(),_.ac(),_.bc(57,"td"),_.bc(58,"strong"),_.Vc(59,"Agente"),_.ac(),_.ac(),_.bc(60,"td"),_.bc(61,"strong"),_.Vc(62,"Estado"),_.ac(),_.ac(),_.bc(63,"td"),_.bc(64,"strong"),_.Vc(65,"Fecha"),_.ac(),_.ac(),_.bc(66,"td"),_.bc(67,"strong"),_.Vc(68,"Novedad"),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.bc(69,"div",2),_.bc(70,"div",24),_.bc(71,"p",25),_.Vc(72),_.ac(),_.ac(),_.bc(73,"div",10),_.bc(74,"nav",26),_.bc(75,"ul",27),_.bc(76,"li",28),_.Tc(77,B,3,4,"a",29),_.ac(),_.bc(78,"li",28),_.Tc(79,Y,2,6,"a",29),_.ac(),_.bc(80,"li",30),_.bc(81,"a",31),_.Vc(82),_.ac(),_.ac(),_.bc(83,"li",28),_.Tc(84,z,2,6,"a",29),_.ac(),_.bc(85,"li",28),_.Tc(86,N,3,5,"a",29),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.ac()),2&t&&(_.Gb(19),_.uc("disabled",0==e.identity.sectorRef),_.Gb(7),_.uc("ngIf","ROLE_REQUESTER"!=e.identity.role&&e.groupTicket.length>1),_.Gb(19),_.uc("ngForOf",e.tickets),_.Gb(27),_.Zc("Mostrando ",e.pagingCounter," a ",e.isLastPage()," de ",e.totalDocs,""),_.Gb(5),_.uc("ngIf",null!=e.prevPage),_.Gb(2),_.uc("ngIf",null!=e.prevPage),_.Gb(3),_.Wc(e.page),_.Gb(2),_.uc("ngIf",null!=e.nextPage),_.Gb(2),_.uc("ngIf",null!=e.nextPage))},directives:[u.a,a.r,a.w,i.m,i.l,n.j],styles:[".body-cell[_ngcontent-%COMP%]{width:25em;margin:0 0 2em;text-overflow:ellipsis;overflow:hidden}.sesion-container[_ngcontent-%COMP%]{height:150px;overflow-y:auto}.selected[_ngcontent-%COMP%]{background-color:#018dda;color:#fff}.closed[_ngcontent-%COMP%]{background-color:#f1f1f1;font-style:italic}"]}),U),X=function t(e,c,i,n,a,s,r,o,u,l,d,b,p,f,g,m,h,k,v,y){_classCallCheck(this,t),this._id=e,this.sub=c,this.numTicket=i,this.requester=n,this.agent=a,this.team=s,this.status=r,this.lastActivity=o,this.createDate=u,this.resolveDate=l,this.rating=d,this.source=b,this.tags=p,this.priority=f,this.company=g,this.subTypeTicket=m,this.cc=h,this.workTime=k,this.realWorkTime=v,this.obsWorkTime=y},J=function t(e,c,i,n,a,s,r,o){_classCallCheck(this,t),this._id=e,this.text=c,this.user=i,this.createDate=n,this.ticket=a,this.type=s,this.files=r,this.read=o},K=c("3uMe"),Z=(c("AJX/"),c("tk/3")),tt=((H=function(){function t(e){_classCallCheck(this,t),this._httpClient=e,this.httpOptions={headers:new Z.e({"Content-Type":"application/json",Authorization:"null"})},this.url=x.a.url}return _createClass(t,[{key:"add",value:function(t,e){var c=JSON.stringify(e);return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.post(this.url+"textblock/add",c,this.httpOptions)}},{key:"edit",value:function(t,e,c){var i=JSON.stringify(c);return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.put(this.url+"textblock/update/"+e,i,this.httpOptions)}},{key:"delete",value:function(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.delete(this.url+"textblock/delete/"+e,this.httpOptions)}},{key:"readAgent",value:function(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.put(this.url+"textblock/read-agent/"+e,{read:!0},this.httpOptions)}},{key:"readRequester",value:function(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.put(this.url+"textblock/read-requester/"+e,{read:!0},this.httpOptions)}},{key:"getList",value:function(t){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"textblock/textblocks",this.httpOptions)}},{key:"getOne",value:function(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"textblock/textblock/"+e,this.httpOptions)}},{key:"getForText",value:function(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"textblock/for-text/"+e,this.httpOptions)}},{key:"getForTicket",value:function(t,e,c){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"textblock/for-ticket/"+e+"/"+c,this.httpOptions)}}]),t}()).\u0275fac=function(t){return new(t||H)(_.fc(Z.c))},H.\u0275prov=_.Rb({token:H,factory:H.\u0275fac}),H),et=c("Q2c7"),ct=c("jZsi"),it=c("wkIo"),nt=c("AV9v"),at=c("47Ty"),st=c("7EHt"),rt=c("znSr"),ot=c("CzEO"),ut=c("/1cH");function lt(t,e){if(1&t&&(_.bc(0,"label",10),_.Vc(1),_.ac()),2&t){var c=_.nc();_.Gb(1),_.Wc(c.user)}}function dt(t,e){1&t&&(_.bc(0,"label",10),_.Vc(1,"Informaci\xf3n"),_.ac())}function bt(t,e){if(1&t){var c=_.cc();_.bc(0,"div",11),_.bc(1,"button",12),_.Wb(2,"i",13),_.ac(),_.bc(3,"div",14),_.bc(4,"a",15),_.jc("click",(function(t){return _.Mc(c),_.nc().delete()})),_.Vc(5," Eliminar "),_.ac(),_.ac(),_.ac()}}function pt(t,e){1&t&&_.Wb(0,"hr")}function ft(t,e){if(1&t&&_.Wb(0,"p",6),2&t){var c=_.nc();_.uc("innerHTML",c.sign,_.Nc)}}function gt(t,e){1&t&&_.Wb(0,"i",26)}function mt(t,e){1&t&&_.Wb(0,"i",27)}function ht(t,e){1&t&&_.Wb(0,"i",28)}function kt(t,e){1&t&&_.Wb(0,"i",29)}function vt(t,e){1&t&&_.Wb(0,"i",30)}function yt(t,e){1&t&&_.Wb(0,"i",31)}function xt(t,e){1&t&&_.Wb(0,"i",32)}function Ct(t,e){if(1&t&&(_.bc(0,"span"),_.bc(1,"a",18),_.Tc(2,gt,1,0,"i",19),_.Tc(3,mt,1,0,"i",20),_.Tc(4,ht,1,0,"i",21),_.Tc(5,kt,1,0,"i",22),_.Tc(6,vt,1,0,"i",23),_.Tc(7,yt,1,0,"i",24),_.Tc(8,xt,1,0,"i",25),_.ac(),_.ac()),2&t){var c=e.$implicit,i=_.nc(2);_.Gb(1),_.vc("href",i.url+"textblock/file/"+c,_.Oc),_.Gb(1),_.uc("ngIf",i.checkExt(c)&&"docx"==i.checkExt(c)||"odt"==i.checkExt(c)),_.Gb(1),_.uc("ngIf",i.checkExt(c)&&("xlsx"==i.checkExt(c)||"xls"==i.checkExt(c))),_.Gb(1),_.uc("ngIf",i.checkExt(c)&&"pdf"==i.checkExt(c)),_.Gb(1),_.uc("ngIf",i.checkExt(c)&&("jpge"==i.checkExt(c)||"jpg"==i.checkExt(c)||"jpeg"==i.checkExt(c)||"png"==i.checkExt(c)||"tiff"==i.checkExt(c)||"tif"==i.checkExt(c))),_.Gb(1),_.uc("ngIf",i.checkExt(c)&&("zip"==i.checkExt(c)||"rar"==i.checkExt(c))),_.Gb(1),_.uc("ngIf",i.checkExt(c)&&"msg"==i.checkExt(c)),_.Gb(1),_.uc("ngIf",!i.checkExt(c))}}function wt(t,e){if(1&t&&(_.bc(0,"div",16),_.Tc(1,Ct,9,8,"span",17),_.ac()),2&t){var c=_.nc();_.Gb(1),_.uc("ngForOf",c.groupFiles)}}var _t,Tt=((_t=function(){function t(e,c){_classCallCheck(this,t),this._textblockService=e,this._userService=c,this.deleteMessage=new _.o,this.errorMessage=new _.o,this.refresh=new _.o,this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=x.a.url}return _createClass(t,[{key:"ngOnInit",value:function(){this.date=k(this.date,"YYYY-MM-DD HH:mm").format("DD-MM-YYYY HH:mm"),this.groupFiles=this.files.split(",")}},{key:"ngAfterViewInit",value:function(){this.scrollElement(),$("table").attr("border","1")}},{key:"scrollElement",value:function(){var t=document.getElementById("chatbox-scroll");t.scrollTop=t.scrollHeight}},{key:"checkExt",value:function(t){var e=t.split(".")[1];return("pdf"==e||"xlsx"==e||"xls"==e||"msg"==e||"docx"==e||"odt"==e||"rar"==e||"zip"==e||"png"==e||"jpge"==e||"jpeg"==e||"jpg"==e||"tif"==e||"tiff"==e)&&e}},{key:"getCardClass",value:function(){var t;switch(this.type){case"PUBLIC":case"PRIVATE":t={card:!0,chatbox:!0};break;case"INFO":t="true"==this.info?{card:!0,chatinfo:!0}:{diplaynone:!0};break;case"REQUEST":t={card:!0,chatbox:!0,"ml-auto":!0};break;default:alert("Hubo un problema con la conversaci\xf3n del ticket, por favor reportarlo al administrador")}return t}},{key:"getContainerClass",value:function(){var t;switch(this.type){case"PUBLIC":case"PRIVATE":t={container:!0,chatheader:!0};break;case"INFO":t={container:!0,infoheader:!0};break;case"REQUEST":t={container:!0,chatheaderreq:!0};break;default:alert("Hubo un problema con la conversaci\xf3n del ticket, por favor reportarlo al administrador")}return t}},{key:"getCardBodyClass",value:function(){return"PRIVATE"==this.type?{"card-body":!0,chatprivate:!0}:{"card-body":!0}}},{key:"delete",value:function(){var t=k().format("YYYY-MM-DD HH:ss"),e=k(this.date,"DD-MM-YYYY HH:ss").add(2,"hours").format("YYYY-MM-DD HH:ss");k(t).isSameOrBefore(e)?this.updateChatbox():this.errorMessage.next()}},{key:"updateChatbox",value:function(){var t=this;this._textblockService.delete(this.token,this._id).subscribe((function(e){e.textblock&&(t.deleteMessage.next(),t.refresh.next())}),(function(t){null!=t&&(JSON.parse(t._body),console.error(t))}))}}]),t}()).\u0275fac=function(t){return new(t||_t)(_.Vb(tt),_.Vb(v.a))},_t.\u0275cmp=_.Pb({type:_t,selectors:[["app-chatbox"]],inputs:{_id:"_id",text:"text",sign:"sign",user:"user",userId:"userId",date:"date",type:"type",files:"files",info:"info"},outputs:{deleteMessage:"deleteMessage",errorMessage:"errorMessage",refresh:"refresh"},features:[_.Fb([v.a,tt])],decls:13,vars:11,consts:[[3,"ngClass"],[2,"padding-right","0","padding-left","0",3,"ngClass"],[1,"user-date",2,"margin-top","4px"],["style","margin-left: 13px;",4,"ngIf"],["class","dropdown float-right","style","margin-top:-7px;",4,"ngIf"],[1,"float-right",2,"margin-right","15px"],[1,"card-text",3,"innerHTML"],[4,"ngIf"],["class","card-text",3,"innerHTML",4,"ngIf"],["class","text-right",4,"ngIf"],[2,"margin-left","13px"],[1,"dropdown","float-right",2,"margin-top","-7px"],["data-toggle","dropdown","aria-expanded","false","type","button",1,"btn","btn-sm"],[1,"fas","fa-ellipsis-v","option"],["role","menu",1,"dropdown-menu"],["role","presentation",1,"dropdown-item",3,"click"],[1,"text-right"],[4,"ngFor","ngForOf"],["target","blank",3,"href"],["class","fas fa-file-word adjunt adjunt-icon",4,"ngIf"],["class","fas fa-file-excel adjunt adjunt-icon",4,"ngIf"],["class","fas fa-file-pdf adjunt adjunt-icon",4,"ngIf"],["class","fas fa-file-image adjunt adjunt-icon",4,"ngIf"],["class","fas fa-file-archive adjunt adjunt-icon",4,"ngIf"],["class","fas fa-envelope adjunt adjunt-icon",4,"ngIf"],["class","fas fa-file adjunt adjunt-icon",4,"ngIf"],[1,"fas","fa-file-word","adjunt","adjunt-icon"],[1,"fas","fa-file-excel","adjunt","adjunt-icon"],[1,"fas","fa-file-pdf","adjunt","adjunt-icon"],[1,"fas","fa-file-image","adjunt","adjunt-icon"],[1,"fas","fa-file-archive","adjunt","adjunt-icon"],[1,"fas","fa-envelope","adjunt","adjunt-icon"],[1,"fas","fa-file","adjunt","adjunt-icon"]],template:function(t,e){1&t&&(_.bc(0,"div",0),_.bc(1,"div",1),_.bc(2,"div",2),_.Tc(3,lt,2,1,"label",3),_.Tc(4,dt,2,0,"label",3),_.Tc(5,bt,6,0,"div",4),_.bc(6,"label",5),_.Vc(7),_.ac(),_.ac(),_.ac(),_.bc(8,"div",0),_.Wb(9,"p",6),_.Tc(10,pt,1,0,"hr",7),_.Tc(11,ft,1,1,"p",8),_.Tc(12,wt,2,1,"div",9),_.ac(),_.ac()),2&t&&(_.uc("ngClass",e.getCardClass()),_.Gb(1),_.uc("ngClass",e.getContainerClass()),_.Gb(2),_.uc("ngIf","INFO"!=e.type),_.Gb(1),_.uc("ngIf","INFO"==e.type),_.Gb(1),_.uc("ngIf",e.userId==e.identity._id&&"INFO"!=e.type),_.Gb(2),_.Wc(e.date),_.Gb(1),_.uc("ngClass",e.getCardBodyClass()),_.Gb(1),_.uc("innerHTML",e.text,_.Nc),_.Gb(1),_.uc("ngIf",""!=e.sign&&"INFO"!=e.type),_.Gb(1),_.uc("ngIf",""!=e.sign&&"INFO"!=e.type),_.Gb(1),_.uc("ngIf",e.files))},directives:[i.k,rt.a,i.m,i.l],styles:[".card[_ngcontent-%COMP%]{box-shadow:2px 2px 10px #666}.option[_ngcontent-%COMP%]{color:#dcdcdc}.adjunt-icon[_ngcontent-%COMP%]{font-size:23px;padding-top:5px;margin-left:3px}.chatheader[_ngcontent-%COMP%]{height:30px;display:flex;background-color:#1e2833;color:#fff}.chatinfo[_ngcontent-%COMP%]{border:1px solid #1e2833;margin:10px}@media (min-width:300px){.user-date[_ngcontent-%COMP%]{font-size:12px}}.user-date[_ngcontent-%COMP%]{width:80%}.infoheader[_ngcontent-%COMP%]{background-color:#5ab3e6;color:#000}.card.chatbox[_ngcontent-%COMP%]{max-width:80%;min-height:30%;border:1px solid #1e2833;margin:10px}.user-date[_ngcontent-%COMP%]{width:100%}.chatheaderreq[_ngcontent-%COMP%]{height:30px;display:flex;background-color:#46a376;color:#fff}.chatprivate[_ngcontent-%COMP%]{background-color:#676767;color:#fff}.adjunt[_ngcontent-%COMP%]{cursor:pointer;font-size:20px;color:#7979ff}.card-text[_ngcontent-%COMP%]{overflow-x:auto}.diplaynone[_ngcontent-%COMP%]{display:none}"]}),_t),Mt=c("7ZcW");function It(t,e){if(1&t){var c=_.cc();_.bc(0,"a",51),_.jc("click",(function(t){return _.Mc(c),_.nc(3).setPriority("Urgente")})),_.Vc(1," Urgente "),_.ac()}}function Gt(t,e){if(1&t){var c=_.cc();_.bc(0,"a",51),_.jc("click",(function(t){return _.Mc(c),_.nc(3).setPriority("Normal")})),_.Vc(1," Normal "),_.ac()}}function St(t,e){if(1&t&&(_.bc(0,"div",47),_.bc(1,"button",48),_.Vc(2),_.ac(),_.bc(3,"div",49),_.Tc(4,It,2,0,"a",50),_.Tc(5,Gt,2,0,"a",50),_.ac(),_.ac()),2&t){var c=_.nc(2);_.Gb(2),_.Xc(" ",c.ticket.priority," "),_.Gb(2),_.uc("ngIf","Urgente"!=c.ticket.priority),_.Gb(1),_.uc("ngIf","Normal"!=c.ticket.priority)}}function Vt(t,e){if(1&t&&(_.bc(0,"span"),_.bc(1,"strong"),_.Vc(2),_.ac(),_.ac()),2&t){var c=_.nc(2);_.Gb(2),_.Wc(c.ticket.priority)}}function jt(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,St,6,3,"div",46),_.Tc(2,Vt,3,1,"span",7),_.ac()),2&t){var c=_.nc();_.Gb(1),_.uc("ngIf",c.identity.company._id==c.ticket.company._id&&"Cerrado"!=c.ticket.status),_.Gb(1),_.uc("ngIf",c.identity.company._id!=c.ticket.company._id||"Cerrado"==c.ticket.status)}}function Et(t,e){if(1&t&&(_.bc(0,"span"),_.bc(1,"strong"),_.Vc(2),_.ac(),_.ac()),2&t){var c=_.nc();_.Gb(2),_.Wc(c.ticket.priority)}}function Ot(t,e){if(1&t&&(_.bc(0,"strong"),_.Vc(1),_.ac()),2&t){var c=_.nc();_.Gb(1),_.Xc(" ",c.ticket.subTypeTicket.typeTicket.name," ")}}function Pt(t,e){if(1&t&&(_.bc(0,"strong"),_.Vc(1),_.ac()),2&t){var c=_.nc();_.Gb(1),_.Xc(" ",c.ticket.subTypeTicket.name," ")}}function qt(t,e){if(1&t&&(_.bc(0,"span"),_.bc(1,"strong"),_.Vc(2),_.bc(3,"span"),_.Vc(4,";"),_.ac(),_.ac(),_.ac()),2&t){var c=e.$implicit;_.Gb(2),_.Wc(c.name)}}function Wt(t,e){1&t&&_.Wb(0,"img",52)}function Ft(t,e){if(1&t&&_.Wb(0,"img",53),2&t){var c=_.nc();_.vc("src",c.url+"user/image/"+c.ticket.requester.image,_.Oc)}}function Rt(t,e){if(1&t&&(_.bc(0,"div",10),_.bc(1,"div",55),_.bc(2,"span"),_.bc(3,"em"),_.Vc(4),_.ac(),_.ac(),_.ac(),_.ac()),2&t){var c=_.nc(2);_.Gb(4),_.Wc(c.ticket.requester.sector.name)}}function Lt(t,e){if(1&t&&(_.bc(0,"div",10),_.bc(1,"div",55),_.bc(2,"span"),_.bc(3,"em"),_.Wb(4,"i",57),_.Vc(5),_.ac(),_.ac(),_.ac(),_.ac()),2&t){var c=_.nc(2);_.Gb(5),_.Xc(" ",c.ticket.requester.phone,"")}}function At(t,e){if(1&t&&(_.bc(0,"div",54),_.bc(1,"div",10),_.bc(2,"div",55),_.bc(3,"span"),_.bc(4,"strong"),_.Vc(5),_.ac(),_.ac(),_.ac(),_.ac(),_.Tc(6,Rt,5,1,"div",56),_.Tc(7,Lt,6,1,"div",56),_.ac()),2&t){var c=_.nc();_.Gb(5),_.Wc(c.ticket.requester.name+" "+c.ticket.requester.surname),_.Gb(1),_.uc("ngIf",c.ticket.requester.sector),_.Gb(1),_.uc("ngIf",null!=c.ticket.requester.phone)}}function Bt(t,e){if(1&t){var c=_.cc();_.bc(0,"a",51),_.jc("click",(function(t){_.Mc(c);var i=e.$implicit;return _.nc(3).selectCompany(i._id,i.name)})),_.Vc(1),_.ac()}if(2&t){var i=e.$implicit;_.Gb(1),_.Xc(" ",i.name," ")}}function Dt(t,e){if(1&t&&(_.bc(0,"div",59),_.bc(1,"button",60),_.Vc(2," Cambiar "),_.ac(),_.bc(3,"div",49),_.Tc(4,Bt,2,1,"a",61),_.ac(),_.ac()),2&t){var c=_.nc(2);_.Gb(4),_.uc("ngForOf",c.companies)}}function Yt(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,Dt,5,1,"div",58),_.ac()),2&t){var c=_.nc();_.Gb(1),_.uc("ngIf",c.identity.company._id==c.ticket.company._id&&"Cerrado"!=c.ticket.status)}}function zt(t,e){1&t&&_.Wb(0,"img",62)}function Nt(t,e){if(1&t&&_.Wb(0,"img",63),2&t){var c=_.nc();_.vc("src",c.url+"company/image/"+c.ticket.company.image,_.Oc)}}function Ut(t,e){1&t&&(_.bc(0,"p",64),_.bc(1,"strong"),_.Vc(2,"Sin departamento"),_.ac(),_.ac())}function $t(t,e){if(1&t&&(_.bc(0,"p",64),_.bc(1,"strong"),_.Vc(2),_.ac(),_.ac()),2&t){var c=_.nc();_.Gb(2),_.Wc(c.ticket.company.name)}}function Ht(t,e){if(1&t){var c=_.cc();_.bc(0,"a",51),_.jc("click",(function(t){_.Mc(c);var i=e.$implicit;return _.nc(3).selectTeam(i._id,i.name)})),_.Vc(1),_.ac()}if(2&t){var i=e.$implicit;_.Gb(1),_.Xc(" ",i.name," ")}}function Qt(t,e){if(1&t&&(_.bc(0,"div",59),_.bc(1,"button",60),_.Vc(2," Cambiar "),_.ac(),_.bc(3,"div",49),_.Tc(4,Ht,2,1,"a",61),_.ac(),_.ac()),2&t){var c=_.nc(2);_.Gb(4),_.uc("ngForOf",c.teams)}}function Xt(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,Qt,5,1,"div",58),_.ac()),2&t){var c=_.nc();_.Gb(1),_.uc("ngIf",c.identity.company._id==c.ticket.company._id&&"Cerrado"!=c.ticket.status)}}function Jt(t,e){1&t&&_.Wb(0,"img",65)}function Kt(t,e){if(1&t&&_.Wb(0,"img",63),2&t){var c=_.nc();_.vc("src",c.url+"team/image/"+c.ticket.team.image,_.Oc)}}function Zt(t,e){1&t&&(_.bc(0,"p",64),_.bc(1,"strong"),_.Vc(2,"Sin equipo"),_.ac(),_.ac())}function te(t,e){if(1&t&&(_.bc(0,"p",64),_.bc(1,"strong"),_.Vc(2),_.ac(),_.ac()),2&t){var c=_.nc();_.Gb(2),_.Wc(c.ticket.team.name)}}function ee(t,e){if(1&t){var c=_.cc();_.bc(0,"a",51),_.jc("click",(function(t){_.Mc(c);var i=e.$implicit;return _.nc(3).selectAgent(i._id,i.name,i.surname)})),_.Vc(1),_.ac()}if(2&t){var i=e.$implicit;_.Gb(1),_.Xc(" ",i.name+" "+i.surname," ")}}function ce(t,e){if(1&t&&(_.bc(0,"div",59),_.bc(1,"button",60),_.Vc(2," Cambiar "),_.ac(),_.bc(3,"div",49),_.Tc(4,ee,2,1,"a",61),_.ac(),_.ac()),2&t){var c=_.nc(2);_.Gb(4),_.uc("ngForOf",c.agents)}}function ie(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,ce,5,1,"div",58),_.ac()),2&t){var c=_.nc();_.Gb(1),_.uc("ngIf",c.identity.company._id==c.ticket.company._id&&"Cerrado"!=c.ticket.status)}}function ne(t,e){1&t&&_.Wb(0,"img",66)}function ae(t,e){if(1&t&&_.Wb(0,"img",63),2&t){var c=_.nc();_.vc("src",c.url+"user/image/"+c.ticket.agent.image,_.Oc)}}function se(t,e){if(1&t&&(_.bc(0,"p",64),_.bc(1,"strong"),_.Vc(2),_.ac(),_.ac()),2&t){var c=_.nc();_.Gb(2),_.Wc(c.ticket.agent.name+" "+c.ticket.agent.surname)}}function re(t,e){1&t&&(_.bc(0,"p",64),_.bc(1,"strong"),_.Vc(2,"Sin agente"),_.ac(),_.ac())}function oe(t,e){if(1&t){var c=_.cc();_.bc(0,"div",68),_.bc(1,"span"),_.Vc(2,"Fecha estimada de soluci\xf3n "),_.ac(),_.bc(3,"input",69,70),_.jc("ngModelChange",(function(t){return _.Mc(c),_.nc(2).ticket.resolveDate=t}))("change",(function(t){return _.Mc(c),_.nc(2).selectResolveDate()})),_.ac(),_.ac()}if(2&t){var i=_.nc(2);_.Gb(3),_.uc("ngModel",i.ticket.resolveDate)}}function ue(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,oe,5,1,"div",67),_.ac()),2&t){var c=_.nc();_.Gb(1),_.uc("ngIf",c.identity.company._id==c.ticket.company._id)}}function le(t,e){if(1&t&&_.Wb(0,"img",75),2&t){var c=_.nc().$implicit,i=_.nc(2);_.vc("src",i.url+"user/image/"+c.image,_.Oc)}}function de(t,e){1&t&&_.Wb(0,"img",76)}function be(t,e){if(1&t){var c=_.cc();_.bc(0,"button",77),_.jc("click",(function(t){_.Mc(c);var e=_.nc().$implicit;return _.nc(2).deleteCc(e)})),_.Wb(1,"i",78),_.ac()}}function pe(t,e){if(1&t&&(_.bc(0,"li",6),_.Tc(1,le,1,1,"img",72),_.Tc(2,de,1,0,"img",73),_.bc(3,"span"),_.Vc(4),_.ac(),_.Tc(5,be,2,0,"button",74),_.ac()),2&t){var c=e.$implicit,i=_.nc(2);_.Gb(1),_.uc("ngIf","null"!=c.image),_.Gb(1),_.uc("ngIf","null"==c.image),_.Gb(2),_.Yc("",c.name," ",c.surname,""),_.Gb(1),_.uc("ngIf","Cerrado"!=i.ticket.status)}}function fe(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,pe,6,5,"li",71),_.ac()),2&t){var c=_.nc();_.Gb(1),_.uc("ngForOf",c.ticket.cc)}}function ge(t,e){if(1&t){var c=_.cc();_.bc(0,"mat-option",84),_.jc("click",(function(t){_.Mc(c);var i=e.$implicit;return _.nc(2).setCc(i)})),_.Vc(1),_.ac()}if(2&t){var i=e.$implicit;_.Gb(1),_.Xc(" ",i.name+" "+i.surname," ")}}function me(t,e){if(1&t){var c=_.cc();_.bc(0,"li",79),_.bc(1,"mat-form-field",80),_.bc(2,"input",81),_.jc("input",(function(t){return _.Mc(c),_.nc().filterCc()}))("ngModelChange",(function(t){return _.Mc(c),_.nc().ccFilter=t})),_.ac(),_.bc(3,"mat-autocomplete",null,82),_.Tc(5,ge,2,1,"mat-option",83),_.ac(),_.ac(),_.ac()}if(2&t){var i=_.Jc(4),n=_.nc();_.Gb(2),_.uc("ngModel",n.ccFilter)("matAutocomplete",i),_.Gb(3),_.uc("ngForOf",n.ccList)}}function he(t,e){if(1&t){var c=_.cc();_.bc(0,"input",85),_.jc("ngModelChange",(function(t){return _.Mc(c),_.nc().subMod=t})),_.ac()}if(2&t){var i=_.nc();_.uc("ngModel",i.subMod)}}function ke(t,e){if(1&t){var c=_.cc();_.bc(0,"input",86),_.jc("click",(function(t){return _.Mc(c),_.nc().editTicketSub()})),_.ac()}}function ve(t,e){if(1&t){var c=_.cc();_.bc(0,"input",87),_.jc("click",(function(t){return _.Mc(c),_.nc().editSub=!1})),_.ac()}}function ye(t,e){if(1&t){var c=_.cc();_.bc(0,"h6",88),_.jc("click",(function(t){_.Mc(c);var e=_.nc();return e.subToEdit(e.ticket.sub)})),_.bc(1,"strong"),_.Vc(2),_.ac(),_.ac()}if(2&t){var i=_.nc();_.Gb(2),_.Wc(i.ticket.sub)}}var xe=function(t){return["/ticket/gestion",t]};function Ce(t,e){if(1&t&&(_.bc(0,"a",89),_.Wb(1,"i",90),_.ac()),2&t){var c=_.nc();_.uc("routerLink",_.Ac(1,xe,c.prev._id))}}function we(t,e){1&t&&_.Wb(0,"i",91)}function _e(t,e){1&t&&_.Wb(0,"i",92)}function Te(t,e){if(1&t&&(_.bc(0,"a",93),_.Wb(1,"i",94),_.ac()),2&t){var c=_.nc();_.uc("routerLink",_.Ac(1,xe,c.next._id))}}function Me(t,e){if(1&t){var c=_.cc();_.bc(0,"app-chatbox",95),_.jc("deleteMessage",(function(t){return _.Mc(c),_.nc().deleteMessage()}))("refresh",(function(t){return _.Mc(c),_.nc().getChat()}))("errorMessage",(function(t){return _.Mc(c),_.nc().errorMessage()})),_.ac()}if(2&t){var i=e.$implicit,n=_.nc();_.vc("_id",i._id),_.vc("text",i.text),_.vc("sign",i.user.sign),_.vc("type",i.type),_.vc("user",i.user.name+n.space+i.user.surname),_.vc("userId",i.user._id),_.vc("date",i.createDate),_.vc("files",i.files),_.vc("info",n.info)}}function Ie(t,e){if(1&t){var c=_.cc();_.bc(0,"div",38),_.bc(1,"div",96),_.bc(2,"div",97),_.bc(3,"div"),_.bc(4,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude03")})),_.Wb(5,"img",98),_.ac(),_.bc(6,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude04")})),_.Wb(7,"img",99),_.ac(),_.bc(8,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude01")})),_.Wb(9,"img",100),_.ac(),_.bc(10,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude06")})),_.Wb(11,"img",101),_.ac(),_.bc(12,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude05")})),_.Wb(13,"img",102),_.ac(),_.bc(14,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude02")})),_.Wb(15,"img",103),_.ac(),_.bc(16,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude09")})),_.Wb(17,"img",104),_.ac(),_.bc(18,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude0a")})),_.Wb(19,"img",105),_.ac(),_.bc(20,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude1c")})),_.Wb(21,"img",106),_.ac(),_.bc(22,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude1d")})),_.Wb(23,"img",107),_.ac(),_.bc(24,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude10")})),_.Wb(25,"img",108),_.ac(),_.bc(26,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude2a")})),_.Wb(27,"img",109),_.ac(),_.bc(28,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude0e")})),_.Wb(29,"img",110),_.ac(),_.bc(30,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude32")})),_.Wb(31,"img",111),_.ac(),_.bc(32,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude13")})),_.Wb(33,"img",112),_.ac(),_.bc(34,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude29")})),_.Wb(35,"img",113),_.ac(),_.bc(36,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude20")})),_.Wb(37,"img",114),_.ac(),_.bc(38,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\udc4c")})),_.Wb(39,"img",115),_.ac(),_.bc(40,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\udc4d")})),_.Wb(41,"img",116),_.ac(),_.bc(42,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\udc4e")})),_.Wb(43,"img",117),_.ac(),_.bc(44,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\udc4f")})),_.Wb(45,"img",118),_.ac(),_.bc(46,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude4c")})),_.Wb(47,"img",119),_.ac(),_.bc(48,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude4f")})),_.Wb(49,"img",120),_.ac(),_.bc(50,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\udc40")})),_.Wb(51,"img",121),_.ac(),_.bc(52,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\u2620\ufe0f")})),_.Wb(53,"img",122),_.ac(),_.bc(54,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude48")})),_.Wb(55,"img",123),_.ac(),_.bc(56,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude49")})),_.Wb(57,"img",124),_.ac(),_.bc(58,"a",84),_.jc("click",(function(t){return _.Mc(c),_.nc().addEmoji("\ud83d\ude4a")})),_.Wb(59,"img",125),_.ac(),_.ac(),_.ac(),_.ac(),_.ac()}}function Ge(t,e){if(1&t){var c=_.cc();_.bc(0,"a",51),_.jc("click",(function(t){_.Mc(c);var i=e.$implicit;return _.nc(5).selectHashtag(i.resp)})),_.Vc(1),_.ac()}if(2&t){var i=e.$implicit;_.Gb(1),_.Xc(" ",i.hashtag," ")}}function Se(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,Ge,2,1,"a",61),_.ac()),2&t){var c=_.nc(4);_.Gb(1),_.uc("ngForOf",c.responses)}}function Ve(t,e){1&t&&(_.bc(0,"span",139),_.Vc(1," No tenes ning\xfana respuesta r\xe1pida configurada "),_.ac())}function je(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,Se,2,1,"span",7),_.Tc(2,Ve,2,0,"span",138),_.ac()),2&t){var c=_.nc(3);_.Gb(1),_.uc("ngIf",0!=c.getLenght(c.responses)),_.Gb(1),_.uc("ngIf",0==c.getLenght(c.responses))}}function Ee(t,e){if(1&t&&(_.bc(0,"div",49),_.Tc(1,je,3,2,"span",7),_.ac()),2&t){var c=_.nc(2);_.Gb(1),_.uc("ngIf",c.responses)}}function Oe(t,e){if(1&t){var c=_.cc();_.bc(0,"button",140),_.jc("click",(function(t){return _.Mc(c),_.nc(),_.Jc(14).clear(t)})),_.bc(1,"mat-icon"),_.Vc(2,"clear"),_.ac(),_.ac()}}function Pe(t,e){if(1&t){var c=_.cc();_.bc(0,"a",51),_.jc("click",(function(t){return _.Mc(c),_.nc(2).setStatus("Pendiente")})),_.Vc(1," Pendiente "),_.ac()}}function qe(t,e){if(1&t){var c=_.cc();_.bc(0,"a",51),_.jc("click",(function(t){return _.Mc(c),_.nc(2).checkWorkTime("Finalizado")})),_.Vc(1," Finalizado "),_.ac()}}function We(t,e){if(1&t){var c=_.cc();_.bc(0,"span"),_.bc(1,"button",126),_.Wb(2,"i",127),_.ac(),_.bc(3,"input",128),_.jc("ngModelChange",(function(t){return _.Mc(c),_.nc().isPrivate=t})),_.ac(),_.bc(4,"span",129),_.Vc(5,"Privado"),_.ac(),_.bc(6,"span"),_.Vc(7,"|"),_.ac(),_.bc(8,"div",130),_.bc(9,"button",131),_.Wb(10,"i",132),_.ac(),_.Tc(11,Ee,2,1,"div",133),_.ac(),_.bc(12,"mat-form-field"),_.bc(13,"ngx-mat-file-input",134,135),_.jc("ngModelChange",(function(t){return _.Mc(c),_.nc().files=t})),_.ac(),_.Tc(15,Oe,3,0,"button",136),_.ac(),_.bc(16,"div",59),_.bc(17,"button",137),_.Vc(18),_.ac(),_.bc(19,"div",49),_.Tc(20,Pe,2,0,"a",50),_.Tc(21,qe,2,0,"a",50),_.ac(),_.ac(),_.ac()}if(2&t){var i=_.Jc(14),n=_.nc();_.Gb(1),_.uc("disabled",n.identity.company._id!=n.ticket.company._id||"Cerrado"==n.ticket.status),_.Gb(2),_.uc("disabled",n.identity.company._id!=n.ticket.company._id)("ngModel",n.isPrivate),_.Gb(8),_.uc("ngIf",n.identity.company._id==n.ticket.company._id),_.Gb(2),_.uc("ngModel",n.files),_.Gb(2),_.uc("ngIf",!i.empty),_.Gb(2),_.uc("ngClass",n.calculateClasses())("disabled",n.identity.company._id!=n.ticket.company._id||"Cerrado"==n.ticket.status&&"ROLE_REQUESTER"==n.identity.role),_.Gb(1),_.Xc(" ",n.ticket.status," "),_.Gb(2),_.uc("ngIf","Pendiente"!=n.ticket.status),_.Gb(1),_.uc("ngIf","Finalizado"!=n.ticket.status)}}function Fe(t,e){if(1&t){var c=_.cc();_.bc(0,"button",140),_.jc("click",(function(t){return _.Mc(c),_.nc(),_.Jc(3).clear(t)})),_.bc(1,"mat-icon"),_.Vc(2,"clear"),_.ac(),_.ac()}}function Re(t,e){if(1&t){var c=_.cc();_.bc(0,"button",143),_.jc("click",(function(t){return _.Mc(c),_.nc(2).cancelFinish()})),_.Wb(1,"i",144),_.ac()}}function Le(t,e){if(1&t){var c=_.cc();_.bc(0,"span"),_.bc(1,"mat-form-field"),_.bc(2,"ngx-mat-file-input",134,135),_.jc("ngModelChange",(function(t){return _.Mc(c),_.nc().files=t})),_.ac(),_.Tc(4,Fe,3,0,"button",136),_.ac(),_.bc(5,"button",126),_.Wb(6,"i",127),_.ac(),_.Tc(7,Re,2,0,"button",141),_.bc(8,"div",59),_.bc(9,"button",142),_.Vc(10),_.ac(),_.ac(),_.ac()}if(2&t){var i=_.Jc(3),n=_.nc();_.Gb(2),_.uc("ngModel",n.files),_.Gb(2),_.uc("ngIf",!i.empty),_.Gb(1),_.uc("disabled","Cerrado"==n.ticket.status),_.Gb(2),_.uc("ngIf","Finalizado"==n.ticket.status&&n.identity._id==n.ticket.requester._id),_.Gb(3),_.Xc(" ",n.ticket.status," ")}}var Ae,Be=function(t){return["/user/profile",t]},De=function(t){return{privatechattext:t}},Ye=((Ae=function(){function t(e,c,i,n,a,s,r,o,u,l,d,b,p,f){_classCallCheck(this,t),this.dialog=e,this._route=c,this._router=i,this.confirmService=n,this.loader=a,this.snackBar=s,this._userService=r,this._ticketService=o,this._teamService=u,this._textblockService=l,this._uploadService=d,this._responseService=b,this._companyService=p,this._notificationService=f,this.imagesToUpload=new Array,this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=x.a.url,this.editSub=!1,this.subMod="",this.isPrivate=!1,this.space=" ",this.ccList=[],this.allCcList=[],this.ccFilter="",this.isCc=!1,this.stat="",this.info="true",this.ticket=new X("","",null,"","","","","","","",null,"",[""],"","","",[""],null,null,""),this.textblock=new J("","",this.identity._id,"","","",[""],!1),this.emojis=!1,this.config=x.a.richTextModule}return _createClass(t,[{key:"ngOnInit",value:function(){this.getTicket(),this.getHashtags(),this.getCompanies(),this.checkInfo(),this.getCc()}},{key:"checkInfo",value:function(){this.info=0!=this.identity.infoView?"true":"false"}},{key:"openSnackBar",value:function(t,e){this.snackBar.open(t,e,{duration:1e4})}},{key:"getCc",value:function(){var t=this;this._userService.getList(this.token).subscribe((function(e){e.users&&(t.allCcList=e.users)}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}},{key:"changeInfo",value:function(){this.info="false"==this.info?"true":"false",this.getChat()}},{key:"getPrevNext",value:function(t,e){var c=this;this._ticketService.getPrevNext(this.token,this.identity._id,t,e,this.identity.role).subscribe((function(t){c.next=t.nextTicket,c.prev=t.prevTicket}),(function(t){c.openSnackBar(t.message,"Cerrar")}))}},{key:"filterCc",value:function(){var t=this;this.ccList=this.allCcList.filter((function(e){return(e.name+e.surname).toLowerCase().includes(t.ccFilter.toString().toLowerCase())}))}},{key:"setCc",value:function(t){var e=this;this._ticketService.addCc(this.token,this.ticket._id,t._id).subscribe((function(c){c.ticket?(e.newInfo(e.identity.name+" "+e.identity.surname+" puso en copia a "+t.name+" "+t.surname+" en este ticket"),e.getTicket()):e._router.navigate(["/"])}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}},{key:"deleteCc",value:function(t){var e=this;this._ticketService.removecc(this.token,this.ticket._id,t._id).subscribe((function(c){c.ticket&&(e.newInfo(e.identity.name+" "+e.identity.surname+" elmin\xf3 a "+t.name+" "+t.surname+" de los usuarios en copia"),e.getTicket())}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}},{key:"getLenght",value:function(t){return t.length}},{key:"deleteMessage",value:function(){this.openSnackBar("El mensaje fue eliminado correctamente.","Cerrar")}},{key:"errorMessage",value:function(){this.openSnackBar("No puede eliminar un mensaje con m\xe1s de dos horas de realizado","Cerrar")}},{key:"getTeams",value:function(t){var e=this;this._teamService.getList(this.token,t).subscribe((function(t){t.teams?e.teams=t.teams:e._router.navigate(["/"])}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}},{key:"getCompanies",value:function(){var t=this;this._companyService.getList(this.token).subscribe((function(e){e.companies?t.companies=e.companies:t._router.navigate(["/"])}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}},{key:"getReqTickets",value:function(t){var e=this;t&&this._ticketService.getForUser(this.token,t._id).subscribe((function(t){t.tickets?e.reqTickets=t.tickets:e._router.navigate(["/"])}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}},{key:"getChat",value:function(){var t=this;this._route.params.forEach((function(e){t._textblockService.getForTicket(t.token,e.id,t.identity.role).subscribe((function(e){e.textblocks&&(t.chat=e.textblocks,"ROLE_REQUESTER"!=t.identity.role?t.ticket.agent&&t.identity._id==t.ticket.agent._id&&t._textblockService.readAgent(t.token,t.ticket._id).subscribe((function(t){t.textblock||console.error("Error en textblock")}),(function(e){t.openSnackBar(e.message,"Cerrar")})):t.identity._id==t.ticket.requester._id&&t._textblockService.readRequester(t.token,t.ticket._id).subscribe((function(t){}),(function(e){t.openSnackBar(e.message,"Cerrar")})),t.ticket.agent&&t.ticket.agent._id&&("ROLE_REQUESTER"!=t.identity.role&&t.identity._id==t.ticket.agent._id?t._textblockService.readAgent(t.token,t.ticket._id).subscribe((function(t){}),(function(e){t.openSnackBar(e.message,"Cerrar")})):"ROLE_REQUESTER"==t.identity.role&&t.identity._id==t.ticket.requester._id&&t._textblockService.readRequester(t.token,t.ticket._id).subscribe((function(t){}),(function(t){console.error(t)}))))}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}))}},{key:"getHashtags",value:function(){var t=this;this._responseService.getList(this.token,this.identity._id).subscribe((function(e){e.responses&&(t.responses=e.responses)}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}},{key:"getTicket",value:function(){var t=this;this._route.params.forEach((function(e){t._ticketService.getOne(t.token,e.id).subscribe((function(e){t.ticket=e.ticket,setTimeout((function(){t.getChat()}),1e3),t.getPrevNext(e.ticket.numTicket,e.ticket.status),t.getTeams(e.ticket.company._id),e.ticket.team&&(t.agents=e.ticket.team.users),t.ticket.cc&&-1!=t.ticket.cc.map((function(t){return t._id})).indexOf(t.identity._id)&&(t.isCc=!0)}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}))}},{key:"selectHashtag",value:function(t){this.textblock.text=this.textblock.text+t,document.getElementById("editable").innerHTML=document.getElementById("editable").innerHTML+t}},{key:"selectAgent",value:function(t,e,c){"Pendiente"!=this.ticket.status?(this.ticket.agent=t,this.ticket.status="Pendiente",this.editTicket(),this.newInfo(this.identity._id==t?this.identity.name+" "+this.identity.surname+" se asign\xf3 como agente de esta solicitud":this.identity.name+" "+this.identity.surname+" asign\xf3 a "+e+" "+c+" como agente de esta solicitud")):(this.ticket.agent=t,this.editTicket(),this.newInfo(this.identity._id==t?this.identity.name+" "+this.identity.surname+" se asign\xf3 como agente de esta solicitud":this.identity.name+" "+this.identity.surname+" asign\xf3 a "+e+" "+c+" como agente de esta solicitud"))}},{key:"selectTeam",value:function(t,e){this.ticket.team=t,this.ticket.agent=null,this.ticket.status="Pendiente",this.editTicket(),this.newInfo(this.identity.name+" "+this.identity.surname+" asign\xf3 a "+e+" como equipo de esta solicitud"),this.newInfo(this.identity.name+" "+this.identity.surname+" ha cambiado el estado de la solicitud a pendiente")}},{key:"cancelFinish",value:function(){var t=this.textblock.text;""!=t&&(t=t.split("<span _ngco")[0]),""!=t?(this.newInfo(this.identity.name+" "+this.identity.surname+" ha reabierto el ticket"),this.createMessageNotification(this.ticket.agent._id,"#"+this.ticket.numTicket+" - "+this.identity.name+" "+this.identity.surname+" reabri\xf3 el ticket"),this.onSubmit(),this.ticket.status="Pendiente",this.editTicket()):this.openSnackBar("Escribe un mensaje antes de enviarlo","Cerrar")}},{key:"selectCompany",value:function(t,e){"Abierto"!=this.ticket.status?(this.ticket.company=t,this.ticket.team=null,this.ticket.agent=null,this.agents=null,this.ticket.status="Abierto",this.ticket.resolveDate=null,this.editTicket(),this.getTeams(t),this.newInfo(this.identity.name+" "+this.identity.surname+" asign\xf3 a "+e+" como departamento responsable de esta solicitud"),this.newInfo(this.identity.name+" "+this.identity.surname+" ha cambiado el estado de la solicitud a abierto")):(this.ticket.company=t,this.ticket.team=null,this.agents=null,this.ticket.agent=null,this.editTicket(),this.newInfo(this.identity.name+" "+this.identity.surname+" asign\xf3 a "+e+" como departamento responsable de esta solicitud"))}},{key:"selectResolveDate",value:function(){if(k(this.ticket.resolveDate).isSameOrAfter(k().format("YYYY-MM-DD"))){var t=this.ticket.resolveDate.split("-");this.ticket.resolveDate=t[2]+"-"+t[1]+"-"+t[0],this.editTicket(),this.newInfo(this.identity.name+" "+this.identity.surname+" ha actualizado la fecha estimada de soluci\xf3n a "+this.ticket.resolveDate)}else this.openSnackBar("No puede seleccionar una fecha anterior a la actual","Cerrar"),this.ticket.resolveDate=""}},{key:"calculateClasses",value:function(){var t={};switch(this.ticket.status){case"Pendiente":t={pending:!0};break;case"Abierto":t={open:!0};break;case"Cerrado":t={closer:!0};break;case"Finalizado":t={finish:!0}}return t.btn=!0,t["btn-dark"]=!0,t["dropdown-toggle"]=!0,t}},{key:"subToEdit",value:function(t){"Cerrado"!=this.ticket.status&&(this.identity.company?this.identity.company._id==this.ticket.company._id&&(this.editSub=!0,this.subMod=t):this.identity._id==this.ticket.requester._id&&(this.editSub=!0,this.subMod=t))}},{key:"editTicketSub",value:function(){this.newInfo(this.identity.name+" "+this.identity.surname+" ha cambiado el asunto de la solicitud de "+this.ticket.sub+" a "+this.subMod.toUpperCase()),this.ticket.sub=this.subMod,this.editTicket(),this.editSub=!1}},{key:"checkWorkTime",value:function(t){this.ticket.workTime?(this.stat=t,$("#timework").modal("show")):this.setStatus(t)}},{key:"setStatus",value:function(t){("Cerrado"==t||"Finalizado"==t)&&this.ticket.team&&this.ticket.agent||"Pendiente"==t&&this.ticket.team||"Abierto"==t?(this.newInfo(this.identity.name+" "+this.identity.surname+" ha cambiado el estado de la solicitud de "+this.ticket.status+" a "+t),this.ticket.status=t,this.editTicket(),"Finalizado"==t&&this.createMessageNotification(this.ticket.requester._id,"#"+this.ticket.numTicket+" - "+this.identity.name+" "+this.identity.surname+" finaliz\xf3 el ticket."),$("#timework").modal("hide")):this.openSnackBar("Debe seleccionar un responsable para cambiar el ticket a ese estado","Cerrar")}},{key:"setPriority",value:function(t){this.newInfo(this.identity.name+" "+this.identity.surname+" ha cambiado la prioridad de la solicitud de "+this.ticket.priority+" a "+t),this.ticket.priority=t,this.editTicket()}},{key:"editTicket",value:function(){var t=this;this._route.params.forEach((function(e){t._ticketService.edit(t.token,e.id,t.ticket).subscribe((function(e){e.ticket&&t.getTicket()}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}))}},{key:"newInfo",value:function(t){var e,c=this;e=new J("",t,this.identity._id,"","","INFO",[""],!1),this._route.params.forEach((function(t){e.ticket=t.id})),this._textblockService.add(this.token,e).subscribe((function(t){t.textblock&&c.pushText(t.textblock._id)}),(function(t){c.openSnackBar(t.message,"Cerrar")}))}},{key:"onSubmit",value:function(){var t,e=this;""!=this.textblock.text&&(this.textblock.text=this.textblock.text.split("<span _ngco")[0]),""!=this.textblock.text?("ROLE_REQUESTER"==this.identity.role?(this.textblock.type="REQUEST",t=this.ticket.agent,delete this.ticket.agent,delete this.ticket.team):(this.textblock.read=!0,this.textblock.type=this.isPrivate?"PRIVATE":"PUBLIC"),this._route.params.forEach((function(t){e.textblock.ticket=t.id})),this._textblockService.add(this.token,this.textblock).subscribe((function(c){if(c.textblock){var i="#"+e.ticket.numTicket+" - Nuevo mensaje";if("ROLE_REQUESTER"==e.identity.role)t&&e.createMessageNotification(t._id,i);else{var n=e.ticket.requester._id;e.createMessageNotification(n,i),e.ticket.cc&&e.ticket.cc.forEach((function(t){n=t._id,e.createMessageNotification(n,i)}))}null!=e.files&&null!=e.files&&(e._uploadService.makeFileRequest(e.url+"textblock/file/"+c.textblock._id,[],e.files.files,e.token,"file"),e.files=null)}var a,s;if("PRIVATE"!=e.textblock.type&&1==e.ticket.company.mailSender&&("ROLE_REQUESTER"!=e.identity.role?1==e.ticket.requester.receiveMail&&(a=e.ticket.requester.name+" "+e.ticket.requester.surname,s=e.ticket.requester.email):e.ticket.agent&&1==e.ticket.agent.receiveMail&&(a=e.ticket.agent.name+" "+e.ticket.agent.surname,s=e.ticket.agent.email),a)){var r=window.location.href,o=e.identity.name+" "+e.identity.surname,u=void 0;e.ticket.cc&&(u=e.ticket.cc.map((function(t){return t.email}))),e._ticketService.sendMail(e.token,o,e.ticket,c.textblock.text,a,s,r,u).subscribe((function(t){}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}e.editTicket(),e.pushText(c.textblock._id),e.textblock=new J("","",e.identity._id,"","","",[""],!1),document.getElementById("editable").innerHTML=""}),(function(t){e.openSnackBar(t,"Cerrar")}))):this.openSnackBar("Escriba un mensaje antes de enviarlo","Cerrar")}},{key:"showEmojis",value:function(){this.emojis=!this.emojis}},{key:"addEmoji",value:function(t){this.textblock.text=this.textblock.text+t,document.getElementById("editable").innerHTML=document.getElementById("editable").innerHTML+t}},{key:"pushText",value:function(t){var e=this;this._textblockService.getOne(this.token,t).subscribe((function(t){t.textblock&&e.chat.push(t.textblock)}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}},{key:"createMessageNotification",value:function(t,e){var c=this,i=k().format("YYYY-MM-DD HH:mm"),n=new nt.a("",e,"chat",i,i,"ticket/gestion/"+this.ticket._id,"primary",t,null,null);this._notificationService.add(this.token,n).subscribe((function(t){}),(function(t){c.openSnackBar("No pudo enviarse una notificaci\xf3n por sistema al usuario","Cerrar")}))}},{key:"changeDate",value:function(t){return k(t,"YYYY-MM-DD HH:mm").format("DD-MM-YYYY HH:mm")}},{key:"outOfLimit",value:function(){return 100*this.ticket.realWorkTime/this.ticket.workTime>=150}},{key:"pastePicture",value:function(t){return e=this,i=regeneratorRuntime.mark((function e(){var c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=0!=t.clipboardData.files.length,!e.t0){e.next=8;break}return this.imagesToUpload=new Array,this.imagesToUpload.push(t.clipboardData.files.item(0)),e.next=6,this._uploadService.makeFileRequest(this.url+"textblock/image",[],this.imagesToUpload,this.token,"image").then((function(t){document.getElementById("editable").innerHTML+='<a target="_blank" href="'+c.url+"textblock/image/"+t.filename+'"><img src="'+c.url+"textblock/image/"+t.filename+'" class="img-fluid" style="width: 80%; margin: 5px" alt="Responsive image"></a>'}));case 6:this.textblock.text=document.getElementById("editable").innerHTML,this.imagesToUpload=new Array;case 8:case"end":return e.stop()}}),e,this)})),new((c=void 0)||(c=Promise))((function(t,n){function a(t){try{r(i.next(t))}catch(e){n(e)}}function s(t){try{r(i.throw(t))}catch(e){n(e)}}function r(e){var i;e.done?t(e.value):(i=e.value,i instanceof c?i:new c((function(t){t(i)}))).then(a,s)}r((i=i.apply(e,[])).next())}));var e,c,i}}]),t}()).\u0275fac=function(t){return new(t||Ae)(_.Vb(p.b),_.Vb(n.a),_.Vb(n.g),_.Vb(m.a),_.Vb(h.a),_.Vb(T.a),_.Vb(v.a),_.Vb(y.a),_.Vb(K.a),_.Vb(tt),_.Vb(et.a),_.Vb(ct.a),_.Vb(it.a),_.Vb(at.a))},Ae.\u0275cmp=_.Pb({type:Ae,selectors:[["app-ticket-gestion"]],features:[_.Fb([v.a,y.a,at.a,K.a,tt,et.a,ct.a,it.a])],decls:141,vars:52,consts:[["id","ticket",1,"row"],["id","ticket-dates",1,"col-md-5","col-lg-5","col-xl-4","text-break"],[1,"card",2,"height","100%"],[3,"expanded"],[1,"accordion-text"],[1,"list-group","p-0","m-0"],[1,"list-group-item"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"list-group",3,"routerLink"],[1,"row"],[1,"col-xl-3"],["class","rounded-circle mr-2","width","50","height","50","src","assets/images/system/user-placeholder.png",4,"ngIf"],["class","rounded-circle mr-2","width","50","height","50",3,"src",4,"ngIf"],["class","col-xl-8 align-self-center",4,"ngIf"],[1,"list-group"],[2,"font-size","18px"],[2,"margin-bottom","25px"],["class","rounded-circle img-agent-team","src","assets/images/system/company-placeholder.png",4,"ngIf"],["class","rounded-circle img-agent-team",3,"src",4,"ngIf"],["class","d-inline","style","margin-left: 10px;",4,"ngIf"],["class","rounded-circle img-agent-team","src","assets/images/system/team-placeholder.png",4,"ngIf"],["class","rounded-circle img-agent-team","src","assets/images/system/user-placeholder.png",4,"ngIf"],["class","list-group-item text-center",4,"ngIf"],[1,"col-md-6","col-lg-7","col-xl-8"],[1,"container","text-center"],["type","text","name","sub",3,"ngModel","ngModelChange",4,"ngIf"],["style","margin-left: 3px;","type","button","class","btn btn-dark dark","value","Aceptar",3,"click",4,"ngIf"],["style","margin-left: 3px;","type","button","class","btn btn-danger","value","Cancelar",3,"click",4,"ngIf"],["class","d-inline",3,"click",4,"ngIf"],["class","float-left",3,"routerLink",4,"ngIf"],[1,"float-left",3,"click"],["class","fa fa-info-circle enabled","style","margin-left: 8px;",4,"ngIf"],["class","fa fa-info-circle disabled","style","margin-left: 8px;",4,"ngIf"],["class","float-right",3,"routerLink",4,"ngIf"],["id","chatbox-scroll",1,"col","chatbox-scroll"],[3,"_id","text","sign","type","user","userId","date","files","info","deleteMessage","refresh","errorMessage",4,"ngFor","ngForOf"],["class","row","style","margin-top: 10px;",4,"ngIf"],[1,"row",2,"margin-top","10px"],["id","chat-text",1,"col",3,"ngClass"],[3,"ngSubmit"],["form","ngForm"],[1,"container",2,"border","1px solid #4e5257"],[1,"p-0"],["theme","snow","placeholder","Escribe aqui tu mensaje","name","autoDesc",3,"modules","ngModel","ngModelChange"],["id","options-container",1,"container"],["class","dropdown d-inline",4,"ngIf"],[1,"dropdown","d-inline"],["data-toggle","dropdown","aria-expanded","false","type","button",1,"btn","btn-dark","dropdown-toggle","dark",2,"margin-right","15px"],["role","menu",1,"dropdown-menu"],["role","presentation","class","dropdown-item",3,"click",4,"ngIf"],["role","presentation",1,"dropdown-item",3,"click"],["width","50","height","50","src","assets/images/system/user-placeholder.png",1,"rounded-circle","mr-2"],["width","50","height","50",1,"rounded-circle","mr-2",3,"src"],[1,"col-xl-8","align-self-center"],[1,"col"],["class","row",4,"ngIf"],["aria-hidden","true",1,"fa","fa-phone"],["class","dropdown d-inline float-right",4,"ngIf"],[1,"dropdown","d-inline","float-right"],["data-toggle","dropdown","aria-expanded","false","type","button",1,"btn","btn-dark","dropdown-toggle","dark"],["role","presentation","class","dropdown-item",3,"click",4,"ngFor","ngForOf"],["src","assets/images/system/company-placeholder.png",1,"rounded-circle","img-agent-team"],[1,"rounded-circle","img-agent-team",3,"src"],[1,"d-inline",2,"margin-left","10px"],["src","assets/images/system/team-placeholder.png",1,"rounded-circle","img-agent-team"],["src","assets/images/system/user-placeholder.png",1,"rounded-circle","img-agent-team"],["style","margin-top: 10px;",4,"ngIf"],[2,"margin-top","10px"],["type","date","name","resolveDate",2,"margin-right","5px",3,"ngModel","ngModelChange","change"],["resolveDate","ngModel"],["class","list-group-item",4,"ngFor","ngForOf"],["class","rounded-circle mr-2","width","30","height","30",3,"src",4,"ngIf"],["class","rounded-circle mr-2","width","30","height","30","src","assets/images/system/user-placeholder.png",4,"ngIf"],["class","btn btn-danger float-right","type","button",3,"click",4,"ngIf"],["width","30","height","30",1,"rounded-circle","mr-2",3,"src"],["width","30","height","30","src","assets/images/system/user-placeholder.png",1,"rounded-circle","mr-2"],["type","button",1,"btn","btn-danger","float-right",3,"click"],[1,"fa","fa-trash"],[1,"list-group-item","text-center"],[1,"full-width"],["type","text","placeholder","Buscar persona","aria-label","Text","matInput","",3,"ngModel","matAutocomplete","input","ngModelChange"],["autoCC","matAutocomplete"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["type","text","name","sub",3,"ngModel","ngModelChange"],["type","button","value","Aceptar",1,"btn","btn-dark","dark",2,"margin-left","3px",3,"click"],["type","button","value","Cancelar",1,"btn","btn-danger",2,"margin-left","3px",3,"click"],[1,"d-inline",3,"click"],[1,"float-left",3,"routerLink"],[1,"fa","fa-arrow-circle-left","adjunt",2,"margin-left","6px"],[1,"fa","fa-info-circle","enabled",2,"margin-left","8px"],[1,"fa","fa-info-circle","disabled",2,"margin-left","8px"],[1,"float-right",3,"routerLink"],[1,"fa","fa-arrow-circle-right","adjunt",2,"margin-left","6px"],[3,"_id","text","sign","type","user","userId","date","files","info","deleteMessage","refresh","errorMessage"],["id","chat-text",1,"col"],[1,"container"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-open-mouth_1f603.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-open-mouth-and-smiling-eyes_1f604.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/grinning-face-with-smiling-eyes_1f601.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-open-mouth-and-tightly-closed-eyes_1f606.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-open-mouth-and-cold-sweat_1f605.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/face-with-tears-of-joy_1f602.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/winking-face_1f609.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-smiling-eyes_1f60a.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/face-with-stuck-out-tongue-and-winking-eye_1f61c.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/face-with-stuck-out-tongue-and-tightly-closed-eyes_1f61d.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/neutral-face_1f610.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/sleepy-face_1f62a.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-sunglasses_1f60e.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/astonished-face_1f632.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/face-with-cold-sweat_1f613.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/weary-face_1f629.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/angry-face_1f620.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/ok-hand-sign_1f44c.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/thumbs-up-sign_1f44d.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/thumbs-down-sign_1f44e.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/clapping-hands-sign_1f44f.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/person-raising-both-hands-in-celebration_1f64c.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/person-with-folded-hands_1f64f.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/eyes_1f440.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/skull-and-crossbones_2620.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/see-no-evil-monkey_1f648.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/hear-no-evil-monkey_1f649.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/speak-no-evil-monkey_1f64a.png","width","30px",2,"margin-right","3px"],["type","submit",1,"btn","btn-primary","float-right",3,"disabled"],[1,"fa","fa-paper-plane"],["type","checkbox","name","isPrivate",3,"disabled","ngModel","ngModelChange"],[2,"margin-left","5px","margin-right","5px"],["id","hashtag",1,"dropdown","d-inline"],["data-toggle","dropdown","aria-expanded","false","type","button",1,"btn","dropdown-toggle"],[1,"fa","fa-hashtag","adjunt"],["role","menu","class","dropdown-menu",4,"ngIf"],["name","files","placeholder","Adjuntar archivos","multiple","",3,"ngModel","ngModelChange"],["removableInput",""],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],["data-toggle","dropdown","aria-expanded","false","type","button",2,"margin-right","15px",3,"ngClass","disabled"],["class","card","style","padding: 5px;border: 1px solid gray;",4,"ngIf"],[1,"card",2,"padding","5px","border","1px solid gray"],["mat-icon-button","","matSuffix","",3,"click"],["class","btn btn-danger float-right","title","Reabrir el ticket","type","button","style","margin-right: 15px;",3,"click",4,"ngIf"],["disabled","","data-toggle","dropdown","aria-expanded","false","type","button",1,"btn","btn-dark","dropdown-toggle","dark",2,"margin-right","15px"],["title","Reabrir el ticket","type","button",1,"btn","btn-danger","float-right",2,"margin-right","15px",3,"click"],[1,"fa","fa-unlock"]],template:function(t,e){1&t&&(_.bc(0,"mat-card"),_.bc(1,"div",0),_.bc(2,"div",1),_.bc(3,"div",2),_.bc(4,"mat-accordion"),_.bc(5,"mat-expansion-panel",3),_.bc(6,"mat-expansion-panel-header"),_.bc(7,"mat-panel-title"),_.bc(8,"strong",4),_.Vc(9,"Informaci\xf3n general"),_.ac(),_.ac(),_.ac(),_.bc(10,"ul",5),_.bc(11,"li",6),_.bc(12,"span"),_.Vc(13,"N\xfamero:\xa0"),_.ac(),_.bc(14,"span"),_.bc(15,"strong"),_.Vc(16),_.ac(),_.ac(),_.ac(),_.bc(17,"li",6),_.bc(18,"span"),_.Vc(19,"Creaci\xf3n:\xa0"),_.ac(),_.bc(20,"span"),_.bc(21,"strong"),_.Vc(22),_.ac(),_.ac(),_.ac(),_.bc(23,"li",6),_.bc(24,"span"),_.Vc(25,"Actualizado:\xa0"),_.ac(),_.bc(26,"span"),_.bc(27,"strong"),_.Vc(28),_.ac(),_.ac(),_.ac(),_.bc(29,"li",6),_.bc(30,"span"),_.Vc(31,"Prioridad:\xa0"),_.ac(),_.Tc(32,jt,3,2,"span",7),_.Tc(33,Et,3,1,"span",7),_.ac(),_.bc(34,"li",6),_.bc(35,"span"),_.Vc(36," Tipo:\xa0 "),_.ac(),_.bc(37,"span"),_.Tc(38,Ot,2,1,"strong",7),_.ac(),_.ac(),_.bc(39,"li",6),_.bc(40,"span"),_.Vc(41," Subtipo:\xa0 "),_.ac(),_.bc(42,"span"),_.Tc(43,Pt,2,1,"strong",7),_.ac(),_.ac(),_.bc(44,"li",6),_.bc(45,"span"),_.Vc(46,"Fuente:\xa0"),_.ac(),_.bc(47,"span"),_.bc(48,"strong"),_.Vc(49),_.ac(),_.ac(),_.ac(),_.bc(50,"li",6),_.bc(51,"span"),_.Vc(52,"Fecha estimada de soluci\xf3n: "),_.bc(53,"span"),_.bc(54,"strong"),_.Vc(55),_.ac(),_.ac(),_.Vc(56,"\xa0"),_.ac(),_.Tc(57,qt,5,1,"span",8),_.ac(),_.ac(),_.ac(),_.bc(58,"mat-expansion-panel"),_.bc(59,"mat-expansion-panel-header"),_.bc(60,"mat-panel-title"),_.bc(61,"strong",4),_.Vc(62,"Solicitante"),_.ac(),_.ac(),_.ac(),_.bc(63,"ul",9),_.bc(64,"li",6),_.bc(65,"div",10),_.bc(66,"div",11),_.Tc(67,Wt,1,0,"img",12),_.Tc(68,Ft,1,1,"img",13),_.ac(),_.Tc(69,At,8,3,"div",14),_.ac(),_.ac(),_.ac(),_.ac(),_.bc(70,"mat-expansion-panel"),_.bc(71,"mat-expansion-panel-header"),_.bc(72,"mat-panel-title"),_.bc(73,"strong",4),_.Vc(74,"Responsabilidad"),_.ac(),_.ac(),_.ac(),_.bc(75,"ul",15),_.bc(76,"li",6),_.bc(77,"span",16),_.bc(78,"strong"),_.Vc(79,"Departamento"),_.ac(),_.ac(),_.Tc(80,Yt,2,1,"span",7),_.Wb(81,"div",17),_.Tc(82,zt,1,0,"img",18),_.Tc(83,Nt,1,1,"img",19),_.Tc(84,Ut,3,0,"p",20),_.Tc(85,$t,3,1,"p",20),_.Wb(86,"hr"),_.bc(87,"span",16),_.bc(88,"strong"),_.Vc(89,"Equipo"),_.ac(),_.ac(),_.Tc(90,Xt,2,1,"span",7),_.Wb(91,"div",17),_.Tc(92,Jt,1,0,"img",21),_.Tc(93,Kt,1,1,"img",19),_.Tc(94,Zt,3,0,"p",20),_.Tc(95,te,3,1,"p",20),_.Wb(96,"hr"),_.bc(97,"span",16),_.bc(98,"strong"),_.Vc(99,"Agente"),_.ac(),_.ac(),_.Tc(100,ie,2,1,"span",7),_.Wb(101,"div",17),_.Tc(102,ne,1,0,"img",22),_.Tc(103,ae,1,1,"img",19),_.Tc(104,se,3,1,"p",20),_.Tc(105,re,3,0,"p",20),_.Tc(106,ue,2,1,"span",7),_.ac(),_.ac(),_.ac(),_.bc(107,"mat-expansion-panel"),_.bc(108,"mat-expansion-panel-header"),_.bc(109,"mat-panel-title"),_.bc(110,"strong",4),_.Vc(111,"En copia"),_.ac(),_.ac(),_.ac(),_.bc(112,"ul",15),_.Tc(113,fe,2,1,"span",7),_.Tc(114,me,6,3,"li",23),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.bc(115,"div",24),_.bc(116,"div",25),_.Tc(117,he,1,1,"input",26),_.Tc(118,ke,1,0,"input",27),_.Tc(119,ve,1,0,"input",28),_.Tc(120,ye,3,1,"h6",29),_.Tc(121,Ce,2,3,"a",30),_.bc(122,"a",31),_.jc("click",(function(t){return e.changeInfo()})),_.Tc(123,we,1,0,"i",32),_.Tc(124,_e,1,0,"i",33),_.ac(),_.Tc(125,Te,2,3,"a",34),_.ac(),_.bc(126,"div",10),_.bc(127,"div",35),_.Tc(128,Me,1,9,"app-chatbox",36),_.ac(),_.Wb(129,"span"),_.ac(),_.Tc(130,Ie,60,0,"div",37),_.bc(131,"div",38),_.bc(132,"div",39),_.bc(133,"form",40,41),_.jc("ngSubmit",(function(t){return e.onSubmit()})),_.bc(135,"div",42),_.bc(136,"mat-card-content",43),_.bc(137,"quill-editor",44),_.jc("ngModelChange",(function(t){return e.textblock.text=t})),_.ac(),_.ac(),_.ac(),_.bc(138,"div",45),_.Tc(139,We,22,11,"span",7),_.Tc(140,Le,11,5,"span",7),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.ac()),2&t&&(_.Gb(5),_.uc("expanded",!0),_.Gb(11),_.Xc("#",e.ticket.numTicket,""),_.Gb(6),_.Wc(e.changeDate(e.ticket.createDate)),_.Gb(6),_.Wc(e.changeDate(e.ticket.lastActivity)),_.Gb(4),_.uc("ngIf",e.identity.company),_.Gb(1),_.uc("ngIf",!e.identity.company),_.Gb(5),_.uc("ngIf",e.ticket.subTypeTicket),_.Gb(5),_.uc("ngIf",e.ticket.subTypeTicket),_.Gb(6),_.Wc(e.ticket.source),_.Gb(6),_.Wc(e.ticket.resolveDate),_.Gb(2),_.uc("ngForOf",e.ticket.tags),_.Gb(6),_.uc("routerLink",_.Ac(48,Be,e.ticket.requester._id)),_.Gb(4),_.uc("ngIf","null"==e.ticket.requester.image),_.Gb(1),_.uc("ngIf","null"!=e.ticket.requester.image),_.Gb(1),_.uc("ngIf",e.ticket.requester),_.Gb(11),_.uc("ngIf",e.identity.company),_.Gb(2),_.uc("ngIf",!e.ticket.company||"null"==e.ticket.company.image),_.Gb(1),_.uc("ngIf",e.ticket.company&&"null"!=e.ticket.company.image),_.Gb(1),_.uc("ngIf",!e.ticket.company),_.Gb(1),_.uc("ngIf",e.ticket.company),_.Gb(5),_.uc("ngIf",e.identity.company),_.Gb(2),_.uc("ngIf",!e.ticket.team||"null"==e.ticket.team.image),_.Gb(1),_.uc("ngIf",e.ticket.team&&"null"!=e.ticket.team.image),_.Gb(1),_.uc("ngIf",!e.ticket.team),_.Gb(1),_.uc("ngIf",e.ticket.team),_.Gb(5),_.uc("ngIf",e.identity.company),_.Gb(2),_.uc("ngIf",!e.ticket.agent||"null"==e.ticket.agent.image),_.Gb(1),_.uc("ngIf",e.ticket.agent&&"null"!=e.ticket.agent.image),_.Gb(1),_.uc("ngIf",e.ticket.agent),_.Gb(1),_.uc("ngIf",!e.ticket.agent),_.Gb(1),_.uc("ngIf",e.identity.company),_.Gb(7),_.uc("ngIf",e.ticket.cc&&0!=e.getLenght(e.ticket.cc)),_.Gb(1),_.uc("ngIf","Cerrado"!=e.ticket.status),_.Gb(3),_.uc("ngIf",e.editSub),_.Gb(1),_.uc("ngIf",e.editSub),_.Gb(1),_.uc("ngIf",e.editSub),_.Gb(1),_.uc("ngIf",!e.editSub),_.Gb(1),_.uc("ngIf",("ROLE_REQUESTER"==e.identity.role||e.ticket.agent)&&e.prev),_.Gb(2),_.uc("ngIf","true"==e.info),_.Gb(1),_.uc("ngIf","false"==e.info),_.Gb(1),_.uc("ngIf",("ROLE_REQUESTER"==e.identity.role||e.ticket.agent)&&e.next),_.Gb(3),_.uc("ngForOf",e.chat),_.Gb(2),_.uc("ngIf",e.emojis),_.Gb(2),_.uc("ngClass",_.Ac(50,De,e.isPrivate)),_.Gb(5),_.uc("modules",e.config)("ngModel",e.textblock.text),_.Gb(2),_.uc("ngIf",e.identity.company),_.Gb(1),_.uc("ngIf",!e.identity.company))},directives:[u.a,st.a,st.c,st.d,st.e,i.m,i.l,n.h,i.k,rt.a,a.x,a.o,a.p,u.b,ot.a,a.n,a.q,a.c,b.b,s.b,ut.c,ut.a,w.p,n.j,Tt,a.a,Mt.a,o.b,b.f,r.a],styles:["#ticket-dates[_ngcontent-%COMP%]{overflow-y:auto}@media (max-width:992px){#ticket-dates[_ngcontent-%COMP%]{border-bottom:1px solid #737373}}.info-card[_ngcontent-%COMP%]{width:100%;padding-top:0}.container.title-container[_ngcontent-%COMP%]{margin-bottom:0}.title[_ngcontent-%COMP%]{width:100%}.card-body.card-req-tickets[_ngcontent-%COMP%]{height:250px;overflow-y:scroll}.chatbox-scroll[_ngcontent-%COMP%]{overflow-y:scroll;height:300px}.card.chatbox[_ngcontent-%COMP%]{max-width:80%;min-height:30%;border:1px solid #1e2833;margin:10px}.adjunt[_ngcontent-%COMP%]{cursor:pointer;font-size:20px;color:#7979ff}.chatinfo[_ngcontent-%COMP%]{border:1px solid #1e2833;margin:10px}.chat-header[_ngcontent-%COMP%]{height:30px;display:flex;background-color:#1e2833;color:#fff}#chat-textbox[_ngcontent-%COMP%]{width:100%;min-height:100px}.container[_ngcontent-%COMP%]{padding-top:5px}.disabled[_ngcontent-%COMP%]{color:red}.disabled[_ngcontent-%COMP%], .enabled[_ngcontent-%COMP%]{cursor:pointer;font-size:20px}.enabled[_ngcontent-%COMP%]{color:green}.img-requester[_ngcontent-%COMP%]{width:50px;height:50px}.img-agent-team[_ngcontent-%COMP%]{width:30px;height:30px}.status-buble[_ngcontent-%COMP%]{color:#fff;padding:5px 10px}.pending[_ngcontent-%COMP%]{background-color:#f7813e}.finish[_ngcontent-%COMP%]{background-color:#10e00c}.closer[_ngcontent-%COMP%]{background-color:#929292}.open[_ngcontent-%COMP%]{background-color:#47b8b8}.privatechattext[_ngcontent-%COMP%]{background-color:#676767;color:#fff}li[_ngcontent-%COMP%]{padding-top:9px;padding-bottom:9px}mat-card[_ngcontent-%COMP%]{padding-left:10px}.accordion-text[_ngcontent-%COMP%]{font-size:16px}"]}),Ae),ze=c("rpG9"),Ne=c("Xwq+"),Ue=c("xHqg"),$e=c("bSwM");function He(t,e){1&t&&_.Vc(0,"Solicitante")}function Qe(t,e){if(1&t){var c=_.cc();_.bc(0,"mat-option",32),_.jc("click",(function(t){_.Mc(c);var i=e.$implicit;return _.nc(2).setRequester(i)})),_.Vc(1),_.ac()}if(2&t){var i=e.$implicit;_.uc("value",i.name+" "+i.surname),_.Gb(1),_.Xc(" ",i.name+" "+i.surname," ")}}function Xe(t,e){1&t&&_.Wb(0,"img",33)}function Je(t,e){if(1&t&&_.Wb(0,"img",34),2&t){var c=_.nc(2);_.vc("src",c.url+"user/image/"+c.requester.image,_.Oc)}}function Ke(t,e){if(1&t&&(_.bc(0,"div",35),_.bc(1,"div",36),_.bc(2,"div",37),_.bc(3,"span"),_.bc(4,"strong"),_.Vc(5),_.ac(),_.ac(),_.ac(),_.ac(),_.bc(6,"div",36),_.bc(7,"div",37),_.bc(8,"span"),_.bc(9,"em"),_.Vc(10),_.ac(),_.ac(),_.ac(),_.ac(),_.bc(11,"div",36),_.bc(12,"div",37),_.bc(13,"span"),_.bc(14,"em"),_.Vc(15),_.ac(),_.ac(),_.ac(),_.ac(),_.ac()),2&t){var c=_.nc(2);_.Gb(5),_.Yc("",c.requester.name," ",c.requester.surname,""),_.Gb(5),_.Wc(c.requester.email),_.Gb(5),_.Wc(c.requester.phone)}}function Ze(t,e){if(1&t){var c=_.cc();_.bc(0,"mat-step",24),_.Tc(1,He,1,0,"ng-template",5),_.bc(2,"form",11),_.bc(3,"div",7),_.bc(4,"mat-form-field",8),_.bc(5,"input",25),_.jc("input",(function(t){return _.Mc(c),_.nc().filterRequester(t.target.value)})),_.ac(),_.bc(6,"mat-autocomplete",null,26),_.Tc(8,Qe,2,2,"mat-option",27),_.ac(),_.ac(),_.Wb(9,"span",10),_.bc(10,"div",8),_.bc(11,"div",28),_.Tc(12,Xe,1,0,"img",29),_.Tc(13,Je,1,1,"img",30),_.ac(),_.Tc(14,Ke,16,4,"div",31),_.ac(),_.ac(),_.ac(),_.bc(15,"div"),_.bc(16,"button",21),_.Vc(17,"Siguiente"),_.ac(),_.ac(),_.ac()}if(2&t){var i=_.Jc(7),n=_.nc();_.uc("stepControl",n.requesterControl),_.Gb(5),_.uc("matAutocomplete",i),_.Gb(3),_.uc("ngForOf",n.requesters),_.Gb(4),_.uc("ngIf",!n.requester||"null"==n.requester.image),_.Gb(1),_.uc("ngIf",n.requester&&"null"!=n.requester.image),_.Gb(1),_.uc("ngIf",n.requester&&""!=n.requester._id),_.Gb(2),_.uc("disabled",!n.requester)}}function tc(t,e){1&t&&_.Vc(0,"Tipo de ticket")}function ec(t,e){if(1&t){var c=_.cc();_.bc(0,"mat-option",32),_.jc("click",(function(t){_.Mc(c);var i=e.$implicit;return _.nc(2).setCompany(i)})),_.Vc(1),_.ac()}if(2&t){var i=e.$implicit;_.uc("value",i),_.Gb(1),_.Xc("",i.name," ")}}function cc(t,e){if(1&t){var c=_.cc();_.bc(0,"mat-option",32),_.jc("click",(function(t){_.Mc(c);var i=e.$implicit;return _.nc(3).setType(i)})),_.Vc(1),_.ac()}if(2&t){var i=e.$implicit;_.uc("value",i),_.Gb(1),_.Xc("",i.name," ")}}function ic(t,e){if(1&t&&(_.bc(0,"mat-form-field",8),_.bc(1,"mat-label"),_.Vc(2,"Tipo"),_.ac(),_.bc(3,"mat-select"),_.Tc(4,cc,2,2,"mat-option",27),_.ac(),_.ac()),2&t){var c=_.nc(2);_.Gb(4),_.uc("ngForOf",c.types)}}function nc(t,e){if(1&t){var c=_.cc();_.bc(0,"mat-option",32),_.jc("click",(function(t){_.Mc(c);var i=e.$implicit;return _.nc(3).setSubType(i)})),_.Vc(1),_.ac()}if(2&t){var i=e.$implicit;_.uc("value",i),_.Gb(1),_.Xc("",i.name," ")}}function ac(t,e){if(1&t&&(_.bc(0,"mat-form-field",8),_.bc(1,"mat-label"),_.Vc(2,"Sub-tipo"),_.ac(),_.bc(3,"mat-select"),_.Tc(4,nc,2,2,"mat-option",27),_.ac(),_.ac()),2&t){var c=_.nc(2);_.Gb(4),_.uc("ngForOf",c.subTypes)}}function sc(t,e){if(1&t&&(_.bc(0,"mat-step",38),_.Tc(1,tc,1,0,"ng-template",5),_.bc(2,"form",6),_.bc(3,"div",7),_.bc(4,"mat-form-field",8),_.bc(5,"mat-label"),_.Vc(6,"Departamento"),_.ac(),_.bc(7,"mat-select"),_.Tc(8,ec,2,2,"mat-option",27),_.ac(),_.ac(),_.ac(),_.bc(9,"div",7),_.Tc(10,ic,5,1,"mat-form-field",39),_.Wb(11,"span",10),_.Tc(12,ac,5,1,"mat-form-field",39),_.ac(),_.bc(13,"div",18),_.bc(14,"button",21),_.Vc(15,"Siguiente"),_.ac(),_.ac(),_.ac(),_.ac()),2&t){var c=_.nc();_.uc("stepControl",c.typeControl),_.Gb(2),_.uc("formGroup",c.typeControl),_.Gb(6),_.uc("ngForOf",c.companies),_.Gb(2),_.uc("ngIf",c.types),_.Gb(2),_.uc("ngIf",c.subTypes),_.Gb(2),_.uc("disabled",c.typeControl.invalid)}}function rc(t,e){1&t&&_.Vc(0,"Asunto y descripci\xf3n")}function oc(t,e){if(1&t){var c=_.cc();_.bc(0,"button",40),_.jc("click",(function(t){return _.Mc(c),_.nc(),_.Jc(15).clear(t)})),_.bc(1,"mat-icon"),_.Vc(2,"clear"),_.ac(),_.ac()}}function uc(t,e){1&t&&(_.bc(0,"mat-checkbox",41),_.Vc(1,"Es urgente "),_.ac()),2&t&&_.uc("color","primary")}function lc(t,e){1&t&&_.Vc(0,"Responsables")}function dc(t,e){if(1&t){var c=_.cc();_.bc(0,"mat-option",32),_.jc("click",(function(t){_.Mc(c);var i=e.$implicit;return _.nc(2).setTeam(i)})),_.Vc(1),_.ac()}if(2&t){var i=e.$implicit;_.uc("value",i),_.Gb(1),_.Xc("",i.name," ")}}function bc(t,e){if(1&t){var c=_.cc();_.bc(0,"mat-option",32),_.jc("click",(function(t){_.Mc(c);var i=e.$implicit;return _.nc(3).setAgent(i)})),_.Vc(1),_.ac()}if(2&t){var i=e.$implicit;_.uc("value",i),_.Gb(1),_.Yc("",i.name," ",i.surname," ")}}function pc(t,e){if(1&t&&(_.bc(0,"mat-form-field",8),_.bc(1,"mat-label"),_.Vc(2,"Agente"),_.ac(),_.bc(3,"mat-select"),_.Tc(4,bc,2,3,"mat-option",27),_.ac(),_.ac()),2&t){var c=_.nc(2);_.Gb(4),_.uc("ngForOf",c.agents)}}function fc(t,e){if(1&t){var c=_.cc();_.bc(0,"mat-step",42),_.Tc(1,lc,1,0,"ng-template",5),_.bc(2,"form",6),_.bc(3,"div",7),_.bc(4,"mat-form-field",8),_.bc(5,"mat-label"),_.Vc(6,"Equipo"),_.ac(),_.bc(7,"mat-select"),_.Tc(8,dc,2,2,"mat-option",27),_.ac(),_.ac(),_.Wb(9,"span",10),_.Tc(10,pc,5,1,"mat-form-field",39),_.ac(),_.bc(11,"div",18),_.bc(12,"button",19),_.Vc(13,"Anterior"),_.ac(),_.Wb(14,"span",20),_.bc(15,"button",43),_.jc("click",(function(t){return _.Mc(c),_.nc().submit()})),_.Vc(16,"Crear ticket"),_.ac(),_.ac(),_.ac(),_.ac()}if(2&t){var i=_.nc();_.uc("stepControl",i.respControl),_.Gb(2),_.uc("formGroup",i.respControl),_.Gb(6),_.uc("ngForOf",i.teams),_.Gb(2),_.uc("ngIf",i.agents)}}function gc(t,e){1&t&&_.Vc(0,"En copia")}function mc(t,e){if(1&t){var c=_.cc();_.bc(0,"mat-option",51),_.jc("click",(function(t){_.Mc(c);var i=e.$implicit;return _.nc(2).setCc(i)})),_.Vc(1),_.ac()}if(2&t){var i=e.$implicit;_.Gb(1),_.Xc(" ",i.name+" "+i.surname," ")}}function hc(t,e){if(1&t&&_.Wb(0,"img",58),2&t){var c=_.nc().$implicit,i=_.nc(3);_.vc("src",i.url+"user/image/"+c.image,_.Oc)}}function kc(t,e){1&t&&_.Wb(0,"img",59)}function vc(t,e){if(1&t){var c=_.cc();_.bc(0,"li",53),_.Tc(1,hc,1,1,"img",54),_.Tc(2,kc,1,0,"img",55),_.bc(3,"span"),_.Vc(4),_.ac(),_.bc(5,"button",56),_.jc("click",(function(t){_.Mc(c);var i=e.$implicit;return _.nc(3).deleteCc(i)})),_.Wb(6,"i",57),_.ac(),_.ac()}if(2&t){var i=e.$implicit;_.Gb(1),_.uc("ngIf","null"!=i.image),_.Gb(1),_.uc("ngIf","null"==i.image),_.Gb(2),_.Yc("",i.name," ",i.surname,"")}}function yc(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,vc,7,4,"li",52),_.ac()),2&t){var c=_.nc(2);_.Gb(1),_.uc("ngForOf",c.cc)}}function xc(t,e){if(1&t){var c=_.cc();_.bc(0,"mat-step",44),_.Tc(1,gc,1,0,"ng-template",5),_.bc(2,"form",11),_.bc(3,"div",7),_.bc(4,"mat-form-field",45),_.bc(5,"input",46),_.jc("input",(function(t){return _.Mc(c),_.nc().filterCc()}))("ngModelChange",(function(t){return _.Mc(c),_.nc().ccFilter=t})),_.ac(),_.bc(6,"mat-autocomplete",null,47),_.Tc(8,mc,2,1,"mat-option",48),_.ac(),_.ac(),_.ac(),_.bc(9,"div",7),_.bc(10,"ul",49),_.Tc(11,yc,2,1,"span",50),_.ac(),_.ac(),_.bc(12,"div",18),_.bc(13,"button",19),_.Vc(14,"Anterior"),_.ac(),_.Wb(15,"span",20),_.bc(16,"button",43),_.jc("click",(function(t){return _.Mc(c),_.nc().submit()})),_.Vc(17,"Crear ticket"),_.ac(),_.ac(),_.ac(),_.ac()}if(2&t){var i=_.Jc(7),n=_.nc();_.Gb(5),_.uc("ngModel",n.ccFilter)("matAutocomplete",i),_.Gb(3),_.uc("ngForOf",n.ccList),_.Gb(3),_.uc("ngIf",0!=n.getLenght(n.cc))}}var Cc,wc=[{path:"",children:[{path:"list/:page/:limit",component:Q,data:{title:"Lista",breadcrumb:"LISTA"}},{path:"gestion/:id",component:Ye,data:{title:"Gesti\xf3n",breadcrumb:"GESTION"}},{path:"new",component:(Cc=function(){function t(e,c,i,n,a,s,r,o,u,l,d){_classCallCheck(this,t),this._ticketService=e,this._userService=c,this._textBlockService=i,this._uploadService=n,this.snackBar=a,this._teamService=s,this._companyService=r,this._router=o,this.loader=u,this._typeTicketService=l,this._subTypeTicketService=d,this.url=x.a.url,this.config=x.a.richTextModule,this.ccList=[],this.allCcList=[],this.ccFilter="",this.token=c.getToken(),this.identity=c.getIdentity(),this.cc=new Array}return _createClass(t,[{key:"ngOnInit",value:function(){"ROLE_REQUESTER"==this.identity.role?(this.getCompany(),this.getCc()):(this.getTeams(),this.getRequesters()),this.buildForm()}},{key:"buildForm",value:function(){this.requesterControl=new a.h({requester:new a.e(null,[a.v.required])}),this.descriptionControl=new a.h({sub:new a.e(null,[a.v.required]),text:new a.e(null,[a.v.required]),important:new a.e(!1),files:new a.e(void 0)}),this.respControl=new a.h({team:new a.e(null,[a.v.required]),agent:new a.e(null,[a.v.required])}),this.typeControl=new a.h({company:new a.e(null,[a.v.required]),subtype:new a.e(null,[a.v.required]),resolve:new a.e(null)})}},{key:"getRequesters",value:function(){var t=this;this._userService.getListReq(this.token,this.identity.company._id).subscribe((function(e){e.users&&(t.requesters=e.users,t.tempRequesters=e.users)}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}},{key:"getTeams",value:function(){var t=this;this._teamService.getList(this.token,this.identity.company._id).subscribe((function(e){e.teams&&(t.teams=e.teams)}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}},{key:"getTypes",value:function(t){var e=this;this._typeTicketService.getList(this.token,t).subscribe((function(t){t.typeTickets&&(e.types=t.typeTickets)}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}},{key:"getSubTypes",value:function(t){var e=this;this._subTypeTicketService.getList(this.token,t).subscribe((function(t){t.subTypeTickets&&(e.subTypes=t.subTypeTickets)}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}},{key:"getCompany",value:function(){var t=this;this._companyService.getList(this.token).subscribe((function(e){e.companies&&(t.companies=e.companies)}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}},{key:"getCc",value:function(){var t=this;this._userService.getList(this.token).subscribe((function(e){e.users&&(t.allCcList=e.users)}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}},{key:"setTeam",value:function(t){this.respControl.controls.team.setValue(t._id),this.getAgents(t.users)}},{key:"setCompany",value:function(t){this.typeControl.controls.company.setValue(t._id),this.typeControl.controls.subtype.setValue(null),this.subTypes=null,this.getTypes(t._id)}},{key:"setType",value:function(t){this.getSubTypes(t._id)}},{key:"setSubType",value:function(t){this.subType=t,this.typeControl.controls.subtype.setValue(t._id),this.descriptionControl.controls.sub.setValue(null),this.descriptionControl.controls.text.setValue(null),t.autoSub&&""!=t.autoSub&&this.descriptionControl.controls.sub.setValue(t.autoSub),t.autoDesc&&""!=t.autoDesc&&this.descriptionControl.controls.text.setValue(t.autoDesc),this.respControl.controls.team.setValue(null),t.team&&this.respControl.controls.team.setValue(t.team._id),this.setResolve(t)}},{key:"getAgents",value:function(t){this.agents=t,this.tempAgents=t}},{key:"setAgent",value:function(t){this.respControl.controls.agent.setValue(t._id)}},{key:"setRequester",value:function(t){this.requesterControl.controls.requester.setValue(t._id),this.requester=t}},{key:"setResolve",value:function(t){var e=k().add(t.resolveDays,"days").format("DD-MM-YYYY");6!=k(e,"DD-MM-YYYY").weekday()&&0!=k(e,"DD-MM-YYYY").weekday()||(e=k(e,"DD-MM-YYYY").add(2,"days").format("DD-MM-YYYY")),this.typeControl.controls.resolve.setValue(e)}},{key:"filterRequester",value:function(t){this.requesters=this.tempRequesters.filter((function(e){return(e.name+e.surname).toLowerCase().includes(t.toString().toLowerCase())}))}},{key:"resetFiles",value:function(){this.descriptionControl.controls.files.setValue(void 0),this.openSnackBar("Adjuntos eliminados","Cerrar")}},{key:"getLenght",value:function(t){return t.length}},{key:"submit",value:function(){var t=this;if(this.loader.open("Generando ticket"),"ROLE_REQUESTER"!=this.identity.role)this.ticket=new X("","",null,null,null,null,"Abierto","","",null,null,"MANUAL",[null],"Normal",this.identity.company._id,null,new Array,null,null,""),this.ticket.requester=this.requesterControl.controls.requester.value,this.descriptionControl.controls.important.value&&(this.ticket.priority="Urgente"),this.respControl.controls.agent.value&&(this.ticket.agent=this.respControl.controls.agent.value),this.ticket.source="MANUAL";else if(this.ticket=new X("","",null,this.identity._id,null,null,"Abierto","","",null,null,"MANUAL",[null],"Normal",null,null,new Array,null,null,""),this.ticket.company=this.typeControl.controls.company.value,this.ticket.subTypeTicket=this.typeControl.controls.subtype.value,this.ticket.source="PORTAL",this.ticket.resolveDate=this.typeControl.controls.resolve.value,0!=this.cc.length){var e=new Array;this.cc.forEach((function(t){e.push(t._id)})),this.ticket.cc=e}this.ticket.sub=this.descriptionControl.controls.sub.value,this.respControl.controls.team.value&&(this.ticket.team=this.respControl.controls.team.value,this.ticket.status="Pendiente"),this._ticketService.add(this.token,this.ticket).subscribe((function(e){e.ticket&&(t.text=new J("",t.descriptionControl.controls.text.value,t.identity._id,"",e.ticket._id,"PUBLIC",[null],!1),"ROLE_REQUESTER"==t.identity.role&&(t.text.type="REQUEST"),t._textBlockService.add(t.token,t.text).subscribe((function(e){e.textblock&&(null!=t.descriptionControl.controls.files.value&&null!=t.descriptionControl.controls.files.value?t._uploadService.makeFileRequest(t.url+"textblock/file/"+e.textblock._id,[],t.descriptionControl.controls.files.value.files,t.token,"file").then((function(e){t.loader.close()}),(function(e){t.openSnackBar(e.message,"Cerrar")})):t.loader.close(),t.openSnackBar("Ticket generado correctamente","Cerrar"),t._router.navigate(["/ticket/gestion",e.textblock.ticket]))}),(function(e){t.loader.close(),t.openSnackBar(e.message,"Cerrar")})))}),(function(e){t.loader.close(),t.openSnackBar(e.message,"Cerrar")}))}},{key:"isInvalid",value:function(){return!!this.descriptionControl.invalid||"ROLE_REQUESTER"==this.identity.role&&0!=this.subType.autoChange&&null!=this.subType.autoChange&&this.descriptionControl.controls.text.value==this.subType.autoDesc&&this.descriptionControl.controls.sub.value==this.subType.autoSub}},{key:"fileChangeEvent",value:function(t){this.descriptionControl.controls.files.setValue(t.target.files),this.openSnackBar("Adjuntos a\xf1adidos","Cerrar")}},{key:"openSnackBar",value:function(t,e){this.snackBar.open(t,e,{duration:1e4})}},{key:"filterCc",value:function(){var t=this;this.ccList=this.allCcList.filter((function(e){return(e.name+e.surname).toLowerCase().includes(t.ccFilter.toString().toLowerCase())}))}},{key:"setCc",value:function(t){-1==this.cc.indexOf(t)&&this.cc.push(t)}},{key:"deleteCc",value:function(t){-1!=this.cc.indexOf(t)&&this.cc.splice(this.cc.indexOf(t),1)}}]),t}(),Cc.\u0275fac=function(t){return new(t||Cc)(_.Vb(y.a),_.Vb(v.a),_.Vb(tt),_.Vb(et.a),_.Vb(T.a),_.Vb(K.a),_.Vb(it.a),_.Vb(n.g),_.Vb(h.a),_.Vb(ze.a),_.Vb(Ne.a))},Cc.\u0275cmp=_.Pb({type:Cc,selectors:[["app-new-ticket"]],features:[_.Fb([K.a,tt,et.a,ze.a,Ne.a,it.a])],decls:30,vars:11,consts:[[1,"p-0"],[3,"linear"],["id","requesterStep",3,"stepControl",4,"ngIf"],["id","typeStep",3,"stepControl",4,"ngIf"],["id","descriptionStep",3,"stepControl"],["matStepLabel",""],["fxFlex","",3,"formGroup"],["fxLayout","row wrap","fxLayout.lt-sm","column"],["fxFlex","",1,"full-width"],["type","text","placeholder","Asunto","aria-label","Text","formControlName","sub","matInput",""],["fxFlex","16px"],["fxFlex",""],["fxFlex","","formControlName","files","name","files","placeholder","Adjuntar archivos","multiple",""],["removableInput",""],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],["fxFlex","","class","full-width","formControlName","important","name","sectorRef",3,"color",4,"ngIf"],["fxFlex","",1,"p-0"],["theme","snow","placeholder","Escribe aqui tu mensaje","name","autoDesc","formControlName","text",3,"modules"],["fxLayout","row"],["mat-raised-button","","color","accent","matStepperPrevious",""],["fxFlex","8px"],["mat-raised-button","","color","primary","matStepperNext","",3,"disabled"],["id","respStep",3,"stepControl",4,"ngIf"],["id","ccStep",3,"stepControl",4,"ngIf"],["id","requesterStep",3,"stepControl"],["type","text","placeholder","Buscar solicitante","aria-label","Text","matInput","",3,"matAutocomplete","input"],["autoReq","matAutocomplete"],[3,"value","click",4,"ngFor","ngForOf"],[1,"col-xl-5"],["style","width: 150px;height: 150px;","src","assets/images/system/user-placeholder.png",4,"ngIf"],["style","width: 150px;height: 150px;",3,"src",4,"ngIf"],["class","col-xl-6 align-self-center",4,"ngIf"],[3,"value","click"],["src","assets/images/system/user-placeholder.png",2,"width","150px","height","150px"],[2,"width","150px","height","150px",3,"src"],[1,"col-xl-6","align-self-center"],[1,"form-row"],[1,"col"],["id","typeStep",3,"stepControl"],["fxFlex","","class","full-width",4,"ngIf"],["mat-icon-button","","matSuffix","",3,"click"],["fxFlex","","formControlName","important","name","sectorRef",1,"full-width",3,"color"],["id","respStep",3,"stepControl"],["mat-raised-button","","color","primary","matStepperNext","",3,"click"],["id","ccStep",3,"stepControl"],[1,"full-width"],["type","text","placeholder","Buscar persona","aria-label","Text","matInput","","name","ccFilter",3,"ngModel","matAutocomplete","input","ngModelChange"],["autoCC","matAutocomplete"],[3,"click",4,"ngFor","ngForOf"],[1,"list-group","full-width"],[4,"ngIf"],[3,"click"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],["class","rounded-circle mr-2","width","30","height","30",3,"src",4,"ngIf"],["class","rounded-circle mr-2","width","30","height","30","src","assets/images/system/user-placeholder.png",4,"ngIf"],["type","button",1,"btn","btn-danger","float-right",3,"click"],[1,"fa","fa-trash"],["width","30","height","30",1,"rounded-circle","mr-2",3,"src"],["width","30","height","30","src","assets/images/system/user-placeholder.png",1,"rounded-circle","mr-2"]],template:function(t,e){if(1&t&&(_.bc(0,"mat-card",0),_.bc(1,"mat-card-content"),_.bc(2,"mat-horizontal-stepper",1),_.Tc(3,Ze,18,7,"mat-step",2),_.Tc(4,sc,16,6,"mat-step",3),_.bc(5,"mat-step",4),_.Tc(6,rc,1,0,"ng-template",5),_.bc(7,"form",6),_.bc(8,"div",7),_.bc(9,"mat-form-field",8),_.Wb(10,"input",9),_.ac(),_.Wb(11,"span",10),_.bc(12,"div",11),_.bc(13,"mat-form-field"),_.Wb(14,"ngx-mat-file-input",12,13),_.Tc(16,oc,3,0,"button",14),_.ac(),_.ac(),_.Wb(17,"span",10),_.Tc(18,uc,2,1,"mat-checkbox",15),_.ac(),_.bc(19,"div",7),_.bc(20,"mat-card-content",16),_.Wb(21,"quill-editor",17),_.ac(),_.ac(),_.bc(22,"div",18),_.bc(23,"button",19),_.Vc(24,"Anterior"),_.ac(),_.Wb(25,"span",20),_.bc(26,"button",21),_.Vc(27,"Siguiente"),_.ac(),_.ac(),_.ac(),_.ac(),_.Tc(28,fc,17,4,"mat-step",22),_.Tc(29,xc,18,4,"mat-step",23),_.ac(),_.ac(),_.ac()),2&t){var c=_.Jc(15);_.Gb(2),_.uc("linear",!0),_.Gb(1),_.uc("ngIf","ROLE_REQUESTER"!=e.identity.role),_.Gb(1),_.uc("ngIf","ROLE_REQUESTER"==e.identity.role),_.Gb(1),_.uc("stepControl",e.descriptionControl),_.Gb(2),_.uc("formGroup",e.descriptionControl),_.Gb(9),_.uc("ngIf",!c.empty),_.Gb(2),_.uc("ngIf","ROLE_REQUESTER"!=e.identity.role),_.Gb(3),_.uc("modules",e.config),_.Gb(5),_.uc("disabled",e.isInvalid()),_.Gb(2),_.uc("ngIf","ROLE_REQUESTER"!=e.identity.role),_.Gb(1),_.uc("ngIf","ROLE_REQUESTER"==e.identity.role)}},directives:[u.a,u.b,Ue.a,i.m,Ue.b,Ue.c,a.x,a.o,M.b,a.i,M.d,b.b,a.c,s.b,a.n,a.g,Mt.a,ot.a,o.b,Ue.f,Ue.e,a.p,ut.c,ut.a,i.l,w.p,b.e,I.a,b.f,r.a,$e.a,a.q],styles:[".butt[_ngcontent-%COMP%]{background-color:#018aca}.butt[_ngcontent-%COMP%], .butt-trash[_ngcontent-%COMP%]{font-size:12px;font-weight:300;color:#fff;display:inline-block;transition:all .5s;cursor:pointer;padding:10px 15px!important;text-transform:uppercase;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;text-align:center}.butt-trash[_ngcontent-%COMP%]{background-color:#ff1717}"]}),Cc),data:{title:"Nuevo",breadcrumb:"NUEVO"}}]}],_c=c("YUcS");c.d(e,"TicketModule",(function(){return Mc}));var Tc,Mc=((Tc=function t(){_classCallCheck(this,t)}).\u0275mod=_.Tb({type:Tc}),Tc.\u0275inj=_.Sb({factory:function(t){return new(t||Tc)},providers:[y.a,v.a],imports:[[a.j,i.c,Mt.b,Ue.d,I.b,a.t,_c.a,ut.b,st.b,$e.b,p.f,f.b,ot.b,d.b,g.a,s.c,b.d,r.b,o.c,u.c,l.b,n.k.forChild(wc)]]}),Tc)}}]);