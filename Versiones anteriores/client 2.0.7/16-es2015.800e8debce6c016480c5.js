(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"99bU":function(t,e,c){"use strict";c.r(e);var i=c("ofXK"),n=c("tyNb"),a=c("3Pt+"),s=c("qFsG"),o=c("NFeN"),r=c("bTqV"),l=c("Wp6s"),u=c("f0Cb"),d=c("zkoq"),h=c("kmnG"),b=c("0IaG"),p=c("Qu3c"),g=c("PCNd"),m=c("3kSh"),f=c("3sEA"),k=c("wd/R"),y=c("gU78"),x=c("BlIn"),v=c("YFeJ"),w=c("1yaQ"),T=c("FKr1"),_=c("fXoL"),C=c("dNgK"),M=c("XiUz"),I=c("d3UM");function G(t,e){if(1&t){const t=_.cc();_.bc(0,"mat-option",10),_.jc("click",(function(c){_.Mc(t);const i=e.$implicit;return _.nc().set(i,"requester")})),_.Vc(1),_.ac()}if(2&t){const t=e.$implicit;_.uc("value",t.name+" "+t.surname),_.Gb(1),_.Yc("",t.name," ",t.surname,"")}}function S(t,e){if(1&t){const t=_.cc();_.bc(0,"mat-option",10),_.jc("click",(function(c){_.Mc(t);const i=e.$implicit;return _.nc().set(i,"agent")})),_.Vc(1),_.ac()}if(2&t){const t=e.$implicit;_.uc("value",t.name+" "+t.surname),_.Gb(1),_.Yc("",t.name," ",t.surname,"")}}let V=(()=>{class t{constructor(t,e,c,i){this.data=t,this.dialogRef=e,this._userService=c,this.snackBar=i,this.token=c.getToken(),this.identity=c.getIdentity(),this.filter={}}ngOnInit(){this.getRequesters(),this.getAgents()}set(t,e){switch(e){case"requester":this.filter.requester=t._id;break;case"agent":this.filter.agent=t._id;break;case"status":this.filter.status=t}}deleteFilter(t){switch(t){case"requester":this.filter.requester=null;break;case"agent":this.filter.agent=null;break;case"status":this.filter.status=null;break;case"sub":this.filter.sub="";break;case"numTicket":this.filter.numTicket=null}}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}getRequesters(){this._userService.getListReq(this.token,this.identity.company._id).subscribe(t=>{t.users&&(this.allRequesters=t.users,this.requesters=t.users)},t=>{this.openSnackBar(t.message,"Cerrar")})}getAgents(){let t;t=this.identity.company?this.identity.company._id:"null",this._userService.getListAgents(this.token,t).subscribe(t=>{t.users&&(this.allAgents=t.users,this.agents=t.users)},t=>{this.openSnackBar(t.message,"Cerrar")})}sendQuery(){""==this.filter.sub&&(this.filter.sub=null),"ROLE_REQUESTER"==this.identity.role&&(this.filter.requester=this.identity._id),this.dialogRef.close(this.filter)}}return t.\u0275fac=function(e){return new(e||t)(_.Vb(b.a),_.Vb(b.g),_.Vb(y.a),_.Vb(C.a))},t.\u0275cmp=_.Pb({type:t,selectors:[["app-filter"]],features:[_.Fb([{provide:T.c,useClass:w.c,deps:[T.g]},{provide:T.f,useValue:w.a},y.a])],decls:42,vars:7,consts:[["matDialogTitle",""],[1,"p-0"],["fxLayout","row wrap","fxLayout.lt-sm","column"],["fxFlex","50",1,"pr-1"],["appearance","fill",1,"full-width"],["matInput","","type","number","name","numTicket",3,"ngModel","ngModelChange"],["matInput","","type","text","name","sub",3,"ngModel","ngModelChange"],[3,"click"],[3,"value","click",4,"ngFor","ngForOf"],["fxFlex","100",1,"pr-1"],[3,"value","click"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,e){1&t&&(_.bc(0,"h1",0),_.Vc(1),_.ac(),_.bc(2,"mat-card",1),_.bc(3,"mat-card-content"),_.bc(4,"form"),_.bc(5,"div",2),_.bc(6,"div",3),_.bc(7,"mat-form-field",4),_.bc(8,"mat-label"),_.Vc(9,"N\xfamero"),_.ac(),_.bc(10,"input",5),_.jc("ngModelChange",(function(t){return e.filter.numTicket=t})),_.ac(),_.ac(),_.ac(),_.bc(11,"div",3),_.bc(12,"mat-form-field",4),_.bc(13,"mat-label"),_.Vc(14,"Asunto"),_.ac(),_.bc(15,"input",6),_.jc("ngModelChange",(function(t){return e.filter.sub=t})),_.ac(),_.ac(),_.ac(),_.bc(16,"div",3),_.bc(17,"mat-form-field",4),_.bc(18,"mat-label"),_.Vc(19,"Solicitante"),_.ac(),_.bc(20,"mat-select"),_.bc(21,"mat-option",7),_.jc("click",(function(t){return e.deleteFilter("requester")})),_.ac(),_.Tc(22,G,2,3,"mat-option",8),_.ac(),_.ac(),_.ac(),_.bc(23,"div",3),_.bc(24,"mat-form-field",4),_.bc(25,"mat-label"),_.Vc(26,"Agente"),_.ac(),_.bc(27,"mat-select"),_.bc(28,"mat-option",7),_.jc("click",(function(t){return e.deleteFilter("agent")})),_.ac(),_.Tc(29,S,2,3,"mat-option",8),_.ac(),_.ac(),_.ac(),_.bc(30,"div",9),_.bc(31,"mat-form-field",4),_.bc(32,"mat-label"),_.Vc(33,"Estado"),_.ac(),_.bc(34,"mat-select"),_.bc(35,"mat-option",7),_.jc("click",(function(t){return e.deleteFilter("status")})),_.ac(),_.bc(36,"mat-option",10),_.jc("click",(function(t){return e.set("Pendiente","status")})),_.Vc(37,"Pendiente"),_.ac(),_.bc(38,"mat-option",10),_.jc("click",(function(t){return e.set("Finalizado","status")})),_.Vc(39,"Finalizado"),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.bc(40,"button",11),_.jc("click",(function(t){return e.sendQuery()})),_.Vc(41,"Filtrar"),_.ac(),_.ac(),_.ac()),2&t&&(_.Gb(1),_.Wc(e.data.title),_.Gb(9),_.uc("ngModel",e.filter.numTicket),_.Gb(5),_.uc("ngModel",e.filter.sub),_.Gb(7),_.uc("ngForOf",e.requesters),_.Gb(7),_.uc("ngForOf",e.agents),_.Gb(7),_.uc("value","Pendiente"),_.Gb(2),_.uc("value","Finalizado"))},directives:[b.h,l.a,l.b,a.x,a.o,a.p,M.d,M.b,h.b,h.e,s.b,a.s,a.c,a.n,a.q,I.a,T.p,i.l,r.b],encapsulation:2}),t})();function j(t,e){if(1&t){const t=_.cc();_.bc(0,"button",32),_.jc("click",(function(e){return _.Mc(t),_.nc().unify()})),_.Vc(1,"Unificar"),_.ac()}}function E(t,e){if(1&t&&_.Wb(0,"img",44),2&t){const t=_.nc().$implicit,e=_.nc();_.vc("src",e.url+"user/image/"+t.requester.image,_.Oc)}}function O(t,e){1&t&&_.Wb(0,"img",45)}function P(t,e){if(1&t&&_.Wb(0,"img",44),2&t){const t=_.nc(2).$implicit,e=_.nc();_.vc("src",e.url+"user/image/"+t.agent.image,_.Oc)}}function q(t,e){1&t&&_.Wb(0,"img",45)}function W(t,e){if(1&t&&(_.bc(0,"td",46),_.Tc(1,P,1,1,"img",36),_.Tc(2,q,1,0,"img",37),_.Vc(3),_.Wb(4,"span"),_.Vc(5),_.ac()),2&t){const t=_.nc().$implicit;_.Gb(1),_.uc("ngIf","null"!=t.agent.image),_.Gb(1),_.uc("ngIf","null"==t.agent.image),_.Gb(1),_.Xc(" ",t.agent.name," "),_.Gb(2),_.Xc(" ",t.agent.surname," ")}}function F(t,e){1&t&&_.Wb(0,"td",46)}function R(t,e){if(1&t){const t=_.cc();_.bc(0,"tbody"),_.bc(1,"tr",33),_.jc("click",(function(c){_.Mc(t);const i=e.$implicit;return _.nc().selectTicket(c,i)})),_.bc(2,"td",34),_.Vc(3),_.ac(),_.bc(4,"td",35),_.Tc(5,E,1,1,"img",36),_.Tc(6,O,1,0,"img",37),_.Vc(7),_.Wb(8,"span"),_.Vc(9),_.ac(),_.bc(10,"td",38),_.bc(11,"p",39),_.Vc(12),_.ac(),_.ac(),_.Tc(13,W,6,4,"td",40),_.Tc(14,F,1,0,"td",40),_.bc(15,"td",41),_.Vc(16),_.ac(),_.bc(17,"td",42),_.Vc(18),_.ac(),_.bc(19,"td",43),_.Vc(20),_.ac(),_.ac(),_.ac()}if(2&t){const t=e.$implicit,c=_.nc();_.Ib("Cerrado"==t.status?"closed":""),_.Gb(1),_.Ib(c.isInGroup(t)&&"ROLE_REQUESTER"!=c.identity.role?"selected":"select"),_.Gb(2),_.Wc(t.numTicket),_.Gb(2),_.uc("ngIf",t.requester&&"null"!=t.requester.image),_.Gb(1),_.uc("ngIf",!t.requester||"null"==t.requester.image),_.Gb(1),_.Xc(" ",t.requester.name," "),_.Gb(2),_.Xc(" ",t.requester.surname," "),_.Gb(2),_.vc("title",t.sub),_.Gb(1),_.Wc(t.sub),_.Gb(1),_.uc("ngIf",t.agent),_.Gb(1),_.uc("ngIf",!t.agent),_.Gb(2),_.Wc(t.status),_.Gb(2),_.Wc(c.changeDate(t.createDate)),_.Gb(2),_.Wc(c.changeDate(t.lastActivity))}}const L=function(t){return["/ticket/list",1,t]};function A(t,e){if(1&t&&(_.bc(0,"a",47),_.bc(1,"span"),_.Vc(2,"\xab"),_.ac(),_.ac()),2&t){const t=_.nc();_.uc("routerLink",_.Ac(2,L,t.limit))("queryParams",t.query)}}const B=function(t,e){return["/ticket/list",t,e]};function D(t,e){if(1&t&&(_.bc(0,"a",47),_.Vc(1),_.ac()),2&t){const t=_.nc();_.uc("routerLink",_.Bc(3,B,t.prevPage,t.limit))("queryParams",t.query),_.Gb(1),_.Wc(t.prevPage)}}function Y(t,e){if(1&t&&(_.bc(0,"a",47),_.Vc(1),_.ac()),2&t){const t=_.nc();_.uc("routerLink",_.Bc(3,B,t.nextPage,t.limit))("queryParams",t.query),_.Gb(1),_.Wc(t.nextPage)}}function z(t,e){if(1&t&&(_.bc(0,"a",47),_.bc(1,"span"),_.Vc(2,"\xbb"),_.ac(),_.ac()),2&t){const t=_.nc();_.uc("routerLink",_.Bc(2,B,t.totalPages,t.limit))("queryParams",t.query)}}let N=(()=>{class t{constructor(t,e,c,i,n,a,s,o){this.dialog=t,this._route=e,this._router=c,this.confirmService=i,this.loader=n,this.snackBar=a,this._userService=s,this._ticketService=o,this.token=s.getToken(),this.identity=s.getIdentity(),this.url=v.a.url,this.groupTicket=new Array}ngOnInit(){this.setQuery(),this.getTickets()}setQuery(){this.query={}}getTickets(){this.loader.open("Cargando tickets"),this._route.params.forEach(t=>{this._route.queryParams.forEach(e=>{var c;this.query=e,this.page=t.page,this.limit=t.limit,"ROLE_REQUESTER"==this.identity.role&&(c=this.identity._id),this._ticketService.getList(this.token,this.page,this.limit,e,this.identity.company&&null!=this.identity.company?this.identity.company._id:null,c).subscribe(t=>{t.tickets&&(this.tickets=t.tickets.docs,this.limit=t.tickets.limit,this.nextPage=t.tickets.nextPage,this.prevPage=t.tickets.prevPage,this.totalDocs=t.tickets.totalDocs,this.totalPages=t.tickets.totalPages,this.pagingCounter=t.tickets.pagingCounter,this.loader.close())},t=>{this.openSnackBar(t.message,"Cerrar")})})})}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}getSectorTickets(){this.loader.open("Cargando tickets"),this._route.params.forEach(t=>{this._route.queryParams.forEach(e=>{this.query=e,this.page=t.page,this.limit=t.perPage,this._ticketService.getSectorPaginatedList(this.token,this.page,this.limit,e,this.identity.sector._id).subscribe(t=>{t.tickets&&(this.tickets=t.tickets.docs,this.limit=t.tickets.limit,this.nextPage=t.tickets.nextPage,this.prevPage=t.tickets.prevPage,this.totalDocs=t.tickets.totalDocs,this.totalPages=t.tickets.totalPages,this.pagingCounter=t.tickets.pagingCounter,this.loader.close())},t=>{this.openSnackBar(t.message,"Cerrar")})})})}isLastPage(){return this.totalDocs<this.pagingCounter+this.limit?this.totalDocs:this.pagingCounter+this.limit-1}changeLimit(t){this.limit=t,this._router.navigate(["/ticket/list",this.page,this.limit],{queryParams:this.query})}changeDate(t){return k(t,"YYYY-MM-DD HH:mm").format("DD-MM-YYYY HH:mm")}selectTicket(t,e){t.ctrlKey?"Cerrado"!=e.status?-1!=this.groupTicket.indexOf(e.numTicket)?this.groupTicket.splice(this.groupTicket.indexOf(e.numTicket),1):this.groupTicket.push(e.numTicket):this.openSnackBar("El ticket se encuentra cerrado","Cerrar"):this._router.navigate(["/ticket/gestion",e._id])}isInGroup(t){return-1!=this.groupTicket.indexOf(t.numTicket)}unify(){this.confirmService.confirm({message:"\xbfEsta seguro que quiere unificar los tickets seleccionados? Prevalecer\xe1 el ticket mas antiguo y se pondr\xe1 en copia a los solicitantes que hayan generado las otras consultas."}).subscribe(t=>{t&&this._ticketService.unify(this.token,this.groupTicket).subscribe(t=>{t.tickets?(this.openSnackBar("Unificaci\xf3n realizada","Cerrar"),this.groupTicket=new Array,this.getTickets()):this._router.navigate(["/"])},t=>{this.openSnackBar(t.message,"Cerrar")})})}getQuery(){this._route.queryParams.forEach(t=>t)}refCheck(t){t.currentTarget.checked?this.getSectorTickets():this.getTickets()}openPopUp(){this.loader.open(),this.dialog.open(V,{width:"720px",disableClose:!1,data:{title:"Filtro de tickets"}}).afterClosed().subscribe(t=>{t&&this._router.navigate(["ticket/list",1,this.limit],{queryParams:t}),this.loader.close()})}}return t.\u0275fac=function(e){return new(e||t)(_.Vb(b.b),_.Vb(n.a),_.Vb(n.g),_.Vb(m.a),_.Vb(f.a),_.Vb(C.a),_.Vb(y.a),_.Vb(x.a))},t.\u0275cmp=_.Pb({type:t,selectors:[["app-ticket-list"]],features:[_.Fb([y.a,x.a])],decls:87,vars:11,consts:[[1,"card","shadow"],[1,"card-body"],[1,"row"],[1,"col-md-6","text-nowrap"],["id","dataTable_length",1,"dataTables_length"],[1,"form-control","form-control-sm","custom-select","custom-select-sm",3,"change"],["value","10","selected",""],["value","25"],["value","50"],["value","100"],[1,"col-md-6"],["id","dataTable_filter",1,"text-md-right","dataTables_filter"],[1,"form-check"],["type","checkbox","id","ref",1,"form-check-input",3,"disabled","change"],["for","ref",1,"form-check-label"],[1,"row",2,"margin-bottom","5px"],[1,"col","text-nowrap"],["type","button",1,"btn","btn-dark","dark'",3,"click"],[1,"fa","fa-filter"],["class","btn btn-dark dark","type","button","style","margin-left: 5px;",3,"click",4,"ngIf"],["id","dataTable",1,"table-responsive","table"],["id","dataTable",1,"table","table-hover","table-sm"],[2,"width","300px"],[3,"className",4,"ngFor","ngForOf"],[1,"col-md-6","align-self-center"],["id","dataTable_info",1,"dataTables_info"],[1,"d-lg-flex","justify-content-lg-end","dataTables_paginate","paging_simple_numbers"],[1,"pagination"],[1,"page-item"],["class","page-link",3,"routerLink","queryParams",4,"ngIf"],[1,"page-item","active"],[1,"page-link"],["type","button",1,"btn","btn-dark","dark",2,"margin-left","5px",3,"click"],[3,"click"],["data-title","Numero"],["data-title","Solicitante"],["class","rounded-circle mr-2","width","30","height","30",3,"src",4,"ngIf"],["class","rounded-circle mr-2","width","30","height","30","src","assets/images/system/user-placeholder.png",4,"ngIf"],["data-title","Asunto",1,"text-nowrap","text-truncate","text-break"],["ng-bind","ticket.sub",1,"body-cell",2,"font-size","14px",3,"title"],["data-title","Agente",4,"ngIf"],["data-title","Estado"],["data-title","Fecha"],["data-title","Novedad"],["width","30","height","30",1,"rounded-circle","mr-2",3,"src"],["width","30","height","30","src","assets/images/system/user-placeholder.png",1,"rounded-circle","mr-2"],["data-title","Agente"],[1,"page-link",3,"routerLink","queryParams"]],template:function(t,e){1&t&&(_.bc(0,"mat-card",0),_.bc(1,"div",1),_.bc(2,"div",2),_.bc(3,"div",3),_.bc(4,"div",4),_.bc(5,"label"),_.Vc(6,"Mostrar\xa0 "),_.bc(7,"select",5),_.jc("change",(function(t){return e.changeLimit(t.target.value)})),_.bc(8,"option",6),_.Vc(9,"10"),_.ac(),_.bc(10,"option",7),_.Vc(11,"25"),_.ac(),_.bc(12,"option",8),_.Vc(13,"50"),_.ac(),_.bc(14,"option",9),_.Vc(15,"100"),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.bc(16,"div",10),_.bc(17,"div",11),_.bc(18,"div",12),_.bc(19,"input",13),_.jc("change",(function(t){return e.refCheck(t)})),_.ac(),_.bc(20,"label",14),_.Vc(21,"TICKETS DEL SECTOR"),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.bc(22,"div",15),_.bc(23,"div",16),_.bc(24,"button",17),_.jc("click",(function(t){return e.openPopUp()})),_.Wb(25,"i",18),_.ac(),_.Tc(26,j,2,0,"button",19),_.ac(),_.ac(),_.bc(27,"div",20),_.bc(28,"table",21),_.bc(29,"thead"),_.bc(30,"tr"),_.bc(31,"th"),_.Vc(32,"N\xfamero"),_.ac(),_.bc(33,"th"),_.Vc(34,"Solicitante"),_.ac(),_.bc(35,"th",22),_.Vc(36,"Asunto"),_.ac(),_.bc(37,"th"),_.Vc(38,"Agente"),_.ac(),_.bc(39,"th"),_.Vc(40,"Estado"),_.ac(),_.bc(41,"th"),_.Vc(42,"Fecha"),_.ac(),_.bc(43,"th"),_.Vc(44,"Novedad"),_.ac(),_.ac(),_.ac(),_.Tc(45,R,21,16,"tbody",23),_.bc(46,"tfoot"),_.bc(47,"tr"),_.bc(48,"td"),_.bc(49,"strong"),_.Vc(50,"Numero"),_.ac(),_.ac(),_.bc(51,"td"),_.bc(52,"strong"),_.Vc(53,"Solicitante"),_.ac(),_.ac(),_.bc(54,"td"),_.bc(55,"strong"),_.Vc(56,"Asunto"),_.ac(),_.ac(),_.bc(57,"td"),_.bc(58,"strong"),_.Vc(59,"Agente"),_.ac(),_.ac(),_.bc(60,"td"),_.bc(61,"strong"),_.Vc(62,"Estado"),_.ac(),_.ac(),_.bc(63,"td"),_.bc(64,"strong"),_.Vc(65,"Fecha"),_.ac(),_.ac(),_.bc(66,"td"),_.bc(67,"strong"),_.Vc(68,"Novedad"),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.bc(69,"div",2),_.bc(70,"div",24),_.bc(71,"p",25),_.Vc(72),_.ac(),_.ac(),_.bc(73,"div",10),_.bc(74,"nav",26),_.bc(75,"ul",27),_.bc(76,"li",28),_.Tc(77,A,3,4,"a",29),_.ac(),_.bc(78,"li",28),_.Tc(79,D,2,6,"a",29),_.ac(),_.bc(80,"li",30),_.bc(81,"a",31),_.Vc(82),_.ac(),_.ac(),_.bc(83,"li",28),_.Tc(84,Y,2,6,"a",29),_.ac(),_.bc(85,"li",28),_.Tc(86,z,3,5,"a",29),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.ac()),2&t&&(_.Gb(19),_.uc("disabled",0==e.identity.sectorRef),_.Gb(7),_.uc("ngIf","ROLE_REQUESTER"!=e.identity.role&&e.groupTicket.length>1),_.Gb(19),_.uc("ngForOf",e.tickets),_.Gb(27),_.Zc("Mostrando ",e.pagingCounter," a ",e.isLastPage()," de ",e.totalDocs,""),_.Gb(5),_.uc("ngIf",null!=e.prevPage),_.Gb(2),_.uc("ngIf",null!=e.prevPage),_.Gb(3),_.Wc(e.page),_.Gb(2),_.uc("ngIf",null!=e.nextPage),_.Gb(2),_.uc("ngIf",null!=e.nextPage))},directives:[l.a,a.r,a.w,i.m,i.l,n.j],styles:[".body-cell[_ngcontent-%COMP%]{width:25em;margin:0 0 2em;text-overflow:ellipsis;overflow:hidden}.sesion-container[_ngcontent-%COMP%]{height:150px;overflow-y:auto}.selected[_ngcontent-%COMP%]{background-color:#018dda;color:#fff}.closed[_ngcontent-%COMP%]{background-color:#f1f1f1;font-style:italic}"]}),t})();class U{constructor(t,e,c,i,n,a,s,o,r,l,u,d,h,b,p,g,m,f,k,y){this._id=t,this.sub=e,this.numTicket=c,this.requester=i,this.agent=n,this.team=a,this.status=s,this.lastActivity=o,this.createDate=r,this.resolveDate=l,this.rating=u,this.source=d,this.tags=h,this.priority=b,this.company=p,this.subTypeTicket=g,this.cc=m,this.workTime=f,this.realWorkTime=k,this.obsWorkTime=y}}class H{constructor(t,e,c,i,n,a,s,o){this._id=t,this.text=e,this.user=c,this.createDate=i,this.ticket=n,this.type=a,this.files=s,this.read=o}}var Q=c("3uMe"),X=(c("AJX/"),c("tk/3"));let J=(()=>{class t{constructor(t){this._httpClient=t,this.httpOptions={headers:new X.e({"Content-Type":"application/json",Authorization:"null"})},this.url=v.a.url}add(t,e){let c=JSON.stringify(e);return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.post(this.url+"textblock/add",c,this.httpOptions)}edit(t,e,c){let i=JSON.stringify(c);return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.put(this.url+"textblock/update/"+e,i,this.httpOptions)}delete(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.delete(this.url+"textblock/delete/"+e,this.httpOptions)}readAgent(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.put(this.url+"textblock/read-agent/"+e,{read:!0},this.httpOptions)}readRequester(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.put(this.url+"textblock/read-requester/"+e,{read:!0},this.httpOptions)}getList(t){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"textblock/textblocks",this.httpOptions)}getOne(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"textblock/textblock/"+e,this.httpOptions)}getForText(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"textblock/for-text/"+e,this.httpOptions)}getForTicket(t,e,c){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"textblock/for-ticket/"+e+"/"+c,this.httpOptions)}}return t.\u0275fac=function(e){return new(e||t)(_.fc(X.c))},t.\u0275prov=_.Rb({token:t,factory:t.\u0275fac}),t})();var K=c("Q2c7"),Z=c("jZsi"),tt=c("wkIo"),et=c("AV9v"),ct=c("47Ty"),it=c("7EHt"),nt=c("znSr"),at=c("CzEO"),st=c("/1cH");function ot(t,e){if(1&t&&(_.bc(0,"label",10),_.Vc(1),_.ac()),2&t){const t=_.nc();_.Gb(1),_.Wc(t.user)}}function rt(t,e){1&t&&(_.bc(0,"label",10),_.Vc(1,"Informaci\xf3n"),_.ac())}function lt(t,e){if(1&t){const t=_.cc();_.bc(0,"div",11),_.bc(1,"button",12),_.Wb(2,"i",13),_.ac(),_.bc(3,"div",14),_.bc(4,"a",15),_.jc("click",(function(e){return _.Mc(t),_.nc().delete()})),_.Vc(5," Eliminar "),_.ac(),_.ac(),_.ac()}}function ut(t,e){1&t&&_.Wb(0,"hr")}function dt(t,e){if(1&t&&_.Wb(0,"p",6),2&t){const t=_.nc();_.uc("innerHTML",t.sign,_.Nc)}}function ht(t,e){1&t&&_.Wb(0,"i",26)}function bt(t,e){1&t&&_.Wb(0,"i",27)}function pt(t,e){1&t&&_.Wb(0,"i",28)}function gt(t,e){1&t&&_.Wb(0,"i",29)}function mt(t,e){1&t&&_.Wb(0,"i",30)}function ft(t,e){1&t&&_.Wb(0,"i",31)}function kt(t,e){1&t&&_.Wb(0,"i",32)}function yt(t,e){if(1&t&&(_.bc(0,"span"),_.bc(1,"a",18),_.Tc(2,ht,1,0,"i",19),_.Tc(3,bt,1,0,"i",20),_.Tc(4,pt,1,0,"i",21),_.Tc(5,gt,1,0,"i",22),_.Tc(6,mt,1,0,"i",23),_.Tc(7,ft,1,0,"i",24),_.Tc(8,kt,1,0,"i",25),_.ac(),_.ac()),2&t){const t=e.$implicit,c=_.nc(2);_.Gb(1),_.vc("href",c.url+"textblock/file/"+t,_.Oc),_.Gb(1),_.uc("ngIf",c.checkExt(t)&&"docx"==c.checkExt(t)||"odt"==c.checkExt(t)),_.Gb(1),_.uc("ngIf",c.checkExt(t)&&("xlsx"==c.checkExt(t)||"xls"==c.checkExt(t))),_.Gb(1),_.uc("ngIf",c.checkExt(t)&&"pdf"==c.checkExt(t)),_.Gb(1),_.uc("ngIf",c.checkExt(t)&&("jpge"==c.checkExt(t)||"jpg"==c.checkExt(t)||"jpeg"==c.checkExt(t)||"png"==c.checkExt(t)||"tiff"==c.checkExt(t)||"tif"==c.checkExt(t))),_.Gb(1),_.uc("ngIf",c.checkExt(t)&&("zip"==c.checkExt(t)||"rar"==c.checkExt(t))),_.Gb(1),_.uc("ngIf",c.checkExt(t)&&"msg"==c.checkExt(t)),_.Gb(1),_.uc("ngIf",!c.checkExt(t))}}function xt(t,e){if(1&t&&(_.bc(0,"div",16),_.Tc(1,yt,9,8,"span",17),_.ac()),2&t){const t=_.nc();_.Gb(1),_.uc("ngForOf",t.groupFiles)}}let vt=(()=>{class t{constructor(t,e){this._textblockService=t,this._userService=e,this.deleteMessage=new _.o,this.errorMessage=new _.o,this.refresh=new _.o,this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=v.a.url}ngOnInit(){this.date=k(this.date,"YYYY-MM-DD HH:mm").format("DD-MM-YYYY HH:mm"),this.groupFiles=this.files.split(",")}ngAfterViewInit(){this.scrollElement(),$("table").attr("border","1")}scrollElement(){var t=document.getElementById("chatbox-scroll");t.scrollTop=t.scrollHeight}checkExt(t){let e=t.split(".")[1];return("pdf"==e||"xlsx"==e||"xls"==e||"msg"==e||"docx"==e||"odt"==e||"rar"==e||"zip"==e||"png"==e||"jpge"==e||"jpeg"==e||"jpg"==e||"tif"==e||"tiff"==e)&&e}getCardClass(){var t;switch(this.type){case"PUBLIC":case"PRIVATE":t={card:!0,chatbox:!0};break;case"INFO":t="true"==this.info?{card:!0,chatinfo:!0}:{diplaynone:!0};break;case"REQUEST":t={card:!0,chatbox:!0,"ml-auto":!0};break;default:alert("Hubo un problema con la conversaci\xf3n del ticket, por favor reportarlo al administrador")}return t}getContainerClass(){var t;switch(this.type){case"PUBLIC":case"PRIVATE":t={container:!0,chatheader:!0};break;case"INFO":t={container:!0,infoheader:!0};break;case"REQUEST":t={container:!0,chatheaderreq:!0};break;default:alert("Hubo un problema con la conversaci\xf3n del ticket, por favor reportarlo al administrador")}return t}getCardBodyClass(){return"PRIVATE"==this.type?{"card-body":!0,chatprivate:!0}:{"card-body":!0}}delete(){let t=k().format("YYYY-MM-DD HH:ss"),e=k(this.date,"DD-MM-YYYY HH:ss").add(2,"hours").format("YYYY-MM-DD HH:ss");k(t).isSameOrBefore(e)?this.updateChatbox():this.errorMessage.next()}updateChatbox(){this._textblockService.delete(this.token,this._id).subscribe(t=>{t.textblock&&(this.deleteMessage.next(),this.refresh.next())},t=>{null!=t&&(JSON.parse(t._body),console.error(t))})}}return t.\u0275fac=function(e){return new(e||t)(_.Vb(J),_.Vb(y.a))},t.\u0275cmp=_.Pb({type:t,selectors:[["app-chatbox"]],inputs:{_id:"_id",text:"text",sign:"sign",user:"user",userId:"userId",date:"date",type:"type",files:"files",info:"info"},outputs:{deleteMessage:"deleteMessage",errorMessage:"errorMessage",refresh:"refresh"},features:[_.Fb([y.a,J])],decls:13,vars:11,consts:[[3,"ngClass"],[2,"padding-right","0","padding-left","0",3,"ngClass"],[1,"user-date",2,"margin-top","4px"],["style","margin-left: 13px;",4,"ngIf"],["class","dropdown float-right","style","margin-top:-7px;",4,"ngIf"],[1,"float-right",2,"margin-right","15px"],[1,"card-text",3,"innerHTML"],[4,"ngIf"],["class","card-text",3,"innerHTML",4,"ngIf"],["class","text-right",4,"ngIf"],[2,"margin-left","13px"],[1,"dropdown","float-right",2,"margin-top","-7px"],["data-toggle","dropdown","aria-expanded","false","type","button",1,"btn","btn-sm"],[1,"fas","fa-ellipsis-v","option"],["role","menu",1,"dropdown-menu"],["role","presentation",1,"dropdown-item",3,"click"],[1,"text-right"],[4,"ngFor","ngForOf"],["target","blank",3,"href"],["class","fas fa-file-word adjunt adjunt-icon",4,"ngIf"],["class","fas fa-file-excel adjunt adjunt-icon",4,"ngIf"],["class","fas fa-file-pdf adjunt adjunt-icon",4,"ngIf"],["class","fas fa-file-image adjunt adjunt-icon",4,"ngIf"],["class","fas fa-file-archive adjunt adjunt-icon",4,"ngIf"],["class","fas fa-envelope adjunt adjunt-icon",4,"ngIf"],["class","fas fa-file adjunt adjunt-icon",4,"ngIf"],[1,"fas","fa-file-word","adjunt","adjunt-icon"],[1,"fas","fa-file-excel","adjunt","adjunt-icon"],[1,"fas","fa-file-pdf","adjunt","adjunt-icon"],[1,"fas","fa-file-image","adjunt","adjunt-icon"],[1,"fas","fa-file-archive","adjunt","adjunt-icon"],[1,"fas","fa-envelope","adjunt","adjunt-icon"],[1,"fas","fa-file","adjunt","adjunt-icon"]],template:function(t,e){1&t&&(_.bc(0,"div",0),_.bc(1,"div",1),_.bc(2,"div",2),_.Tc(3,ot,2,1,"label",3),_.Tc(4,rt,2,0,"label",3),_.Tc(5,lt,6,0,"div",4),_.bc(6,"label",5),_.Vc(7),_.ac(),_.ac(),_.ac(),_.bc(8,"div",0),_.Wb(9,"p",6),_.Tc(10,ut,1,0,"hr",7),_.Tc(11,dt,1,1,"p",8),_.Tc(12,xt,2,1,"div",9),_.ac(),_.ac()),2&t&&(_.uc("ngClass",e.getCardClass()),_.Gb(1),_.uc("ngClass",e.getContainerClass()),_.Gb(2),_.uc("ngIf","INFO"!=e.type),_.Gb(1),_.uc("ngIf","INFO"==e.type),_.Gb(1),_.uc("ngIf",e.userId==e.identity._id&&"INFO"!=e.type),_.Gb(2),_.Wc(e.date),_.Gb(1),_.uc("ngClass",e.getCardBodyClass()),_.Gb(1),_.uc("innerHTML",e.text,_.Nc),_.Gb(1),_.uc("ngIf",""!=e.sign&&"INFO"!=e.type),_.Gb(1),_.uc("ngIf",""!=e.sign&&"INFO"!=e.type),_.Gb(1),_.uc("ngIf",e.files))},directives:[i.k,nt.a,i.m,i.l],styles:[".card[_ngcontent-%COMP%]{box-shadow:2px 2px 10px #666}.option[_ngcontent-%COMP%]{color:#dcdcdc}.adjunt-icon[_ngcontent-%COMP%]{font-size:23px;padding-top:5px;margin-left:3px}.chatheader[_ngcontent-%COMP%]{height:30px;display:flex;background-color:#1e2833;color:#fff}.chatinfo[_ngcontent-%COMP%]{border:1px solid #1e2833;margin:10px}@media (min-width:300px){.user-date[_ngcontent-%COMP%]{font-size:12px}}.user-date[_ngcontent-%COMP%]{width:80%}.infoheader[_ngcontent-%COMP%]{background-color:#5ab3e6;color:#000}.card.chatbox[_ngcontent-%COMP%]{max-width:80%;min-height:30%;border:1px solid #1e2833;margin:10px}.user-date[_ngcontent-%COMP%]{width:100%}.chatheaderreq[_ngcontent-%COMP%]{height:30px;display:flex;background-color:#46a376;color:#fff}.chatprivate[_ngcontent-%COMP%]{background-color:#676767;color:#fff}.adjunt[_ngcontent-%COMP%]{cursor:pointer;font-size:20px;color:#7979ff}.card-text[_ngcontent-%COMP%]{overflow-x:auto}.diplaynone[_ngcontent-%COMP%]{display:none}"]}),t})();var wt=c("7ZcW");function Tt(t,e){if(1&t){const t=_.cc();_.bc(0,"a",51),_.jc("click",(function(e){return _.Mc(t),_.nc(3).setPriority("Urgente")})),_.Vc(1," Urgente "),_.ac()}}function _t(t,e){if(1&t){const t=_.cc();_.bc(0,"a",51),_.jc("click",(function(e){return _.Mc(t),_.nc(3).setPriority("Normal")})),_.Vc(1," Normal "),_.ac()}}function Ct(t,e){if(1&t&&(_.bc(0,"div",47),_.bc(1,"button",48),_.Vc(2),_.ac(),_.bc(3,"div",49),_.Tc(4,Tt,2,0,"a",50),_.Tc(5,_t,2,0,"a",50),_.ac(),_.ac()),2&t){const t=_.nc(2);_.Gb(2),_.Xc(" ",t.ticket.priority," "),_.Gb(2),_.uc("ngIf","Urgente"!=t.ticket.priority),_.Gb(1),_.uc("ngIf","Normal"!=t.ticket.priority)}}function Mt(t,e){if(1&t&&(_.bc(0,"span"),_.bc(1,"strong"),_.Vc(2),_.ac(),_.ac()),2&t){const t=_.nc(2);_.Gb(2),_.Wc(t.ticket.priority)}}function It(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,Ct,6,3,"div",46),_.Tc(2,Mt,3,1,"span",7),_.ac()),2&t){const t=_.nc();_.Gb(1),_.uc("ngIf",t.identity.company._id==t.ticket.company._id&&"Cerrado"!=t.ticket.status),_.Gb(1),_.uc("ngIf",t.identity.company._id!=t.ticket.company._id||"Cerrado"==t.ticket.status)}}function Gt(t,e){if(1&t&&(_.bc(0,"span"),_.bc(1,"strong"),_.Vc(2),_.ac(),_.ac()),2&t){const t=_.nc();_.Gb(2),_.Wc(t.ticket.priority)}}function St(t,e){if(1&t&&(_.bc(0,"strong"),_.Vc(1),_.ac()),2&t){const t=_.nc();_.Gb(1),_.Xc(" ",t.ticket.subTypeTicket.typeTicket.name," ")}}function Vt(t,e){if(1&t&&(_.bc(0,"strong"),_.Vc(1),_.ac()),2&t){const t=_.nc();_.Gb(1),_.Xc(" ",t.ticket.subTypeTicket.name," ")}}function jt(t,e){if(1&t&&(_.bc(0,"span"),_.bc(1,"strong"),_.Vc(2),_.bc(3,"span"),_.Vc(4,";"),_.ac(),_.ac(),_.ac()),2&t){const t=e.$implicit;_.Gb(2),_.Wc(t.name)}}function Et(t,e){1&t&&_.Wb(0,"img",52)}function Ot(t,e){if(1&t&&_.Wb(0,"img",53),2&t){const t=_.nc();_.vc("src",t.url+"user/image/"+t.ticket.requester.image,_.Oc)}}function Pt(t,e){if(1&t&&(_.bc(0,"div",10),_.bc(1,"div",55),_.bc(2,"span"),_.bc(3,"em"),_.Vc(4),_.ac(),_.ac(),_.ac(),_.ac()),2&t){const t=_.nc(2);_.Gb(4),_.Wc(t.ticket.requester.sector.name)}}function qt(t,e){if(1&t&&(_.bc(0,"div",10),_.bc(1,"div",55),_.bc(2,"span"),_.bc(3,"em"),_.Wb(4,"i",57),_.Vc(5),_.ac(),_.ac(),_.ac(),_.ac()),2&t){const t=_.nc(2);_.Gb(5),_.Xc(" ",t.ticket.requester.phone,"")}}function Wt(t,e){if(1&t&&(_.bc(0,"div",54),_.bc(1,"div",10),_.bc(2,"div",55),_.bc(3,"span"),_.bc(4,"strong"),_.Vc(5),_.ac(),_.ac(),_.ac(),_.ac(),_.Tc(6,Pt,5,1,"div",56),_.Tc(7,qt,6,1,"div",56),_.ac()),2&t){const t=_.nc();_.Gb(5),_.Wc(t.ticket.requester.name+" "+t.ticket.requester.surname),_.Gb(1),_.uc("ngIf",t.ticket.requester.sector),_.Gb(1),_.uc("ngIf",null!=t.ticket.requester.phone)}}function Ft(t,e){if(1&t){const t=_.cc();_.bc(0,"a",51),_.jc("click",(function(c){_.Mc(t);const i=e.$implicit;return _.nc(3).selectCompany(i._id,i.name)})),_.Vc(1),_.ac()}if(2&t){const t=e.$implicit;_.Gb(1),_.Xc(" ",t.name," ")}}function Rt(t,e){if(1&t&&(_.bc(0,"div",59),_.bc(1,"button",60),_.Vc(2," Cambiar "),_.ac(),_.bc(3,"div",49),_.Tc(4,Ft,2,1,"a",61),_.ac(),_.ac()),2&t){const t=_.nc(2);_.Gb(4),_.uc("ngForOf",t.companies)}}function Lt(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,Rt,5,1,"div",58),_.ac()),2&t){const t=_.nc();_.Gb(1),_.uc("ngIf",t.identity.company._id==t.ticket.company._id&&"Cerrado"!=t.ticket.status)}}function At(t,e){1&t&&_.Wb(0,"img",62)}function Bt(t,e){if(1&t&&_.Wb(0,"img",63),2&t){const t=_.nc();_.vc("src",t.url+"company/image/"+t.ticket.company.image,_.Oc)}}function Dt(t,e){1&t&&(_.bc(0,"p",64),_.bc(1,"strong"),_.Vc(2,"Sin departamento"),_.ac(),_.ac())}function Yt(t,e){if(1&t&&(_.bc(0,"p",64),_.bc(1,"strong"),_.Vc(2),_.ac(),_.ac()),2&t){const t=_.nc();_.Gb(2),_.Wc(t.ticket.company.name)}}function zt(t,e){if(1&t){const t=_.cc();_.bc(0,"a",51),_.jc("click",(function(c){_.Mc(t);const i=e.$implicit;return _.nc(3).selectTeam(i._id,i.name)})),_.Vc(1),_.ac()}if(2&t){const t=e.$implicit;_.Gb(1),_.Xc(" ",t.name," ")}}function Nt(t,e){if(1&t&&(_.bc(0,"div",59),_.bc(1,"button",60),_.Vc(2," Cambiar "),_.ac(),_.bc(3,"div",49),_.Tc(4,zt,2,1,"a",61),_.ac(),_.ac()),2&t){const t=_.nc(2);_.Gb(4),_.uc("ngForOf",t.teams)}}function Ut(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,Nt,5,1,"div",58),_.ac()),2&t){const t=_.nc();_.Gb(1),_.uc("ngIf",t.identity.company._id==t.ticket.company._id&&"Cerrado"!=t.ticket.status)}}function $t(t,e){1&t&&_.Wb(0,"img",65)}function Ht(t,e){if(1&t&&_.Wb(0,"img",63),2&t){const t=_.nc();_.vc("src",t.url+"team/image/"+t.ticket.team.image,_.Oc)}}function Qt(t,e){1&t&&(_.bc(0,"p",64),_.bc(1,"strong"),_.Vc(2,"Sin equipo"),_.ac(),_.ac())}function Xt(t,e){if(1&t&&(_.bc(0,"p",64),_.bc(1,"strong"),_.Vc(2),_.ac(),_.ac()),2&t){const t=_.nc();_.Gb(2),_.Wc(t.ticket.team.name)}}function Jt(t,e){if(1&t){const t=_.cc();_.bc(0,"a",51),_.jc("click",(function(c){_.Mc(t);const i=e.$implicit;return _.nc(3).selectAgent(i._id,i.name,i.surname)})),_.Vc(1),_.ac()}if(2&t){const t=e.$implicit;_.Gb(1),_.Xc(" ",t.name+" "+t.surname," ")}}function Kt(t,e){if(1&t&&(_.bc(0,"div",59),_.bc(1,"button",60),_.Vc(2," Cambiar "),_.ac(),_.bc(3,"div",49),_.Tc(4,Jt,2,1,"a",61),_.ac(),_.ac()),2&t){const t=_.nc(2);_.Gb(4),_.uc("ngForOf",t.agents)}}function Zt(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,Kt,5,1,"div",58),_.ac()),2&t){const t=_.nc();_.Gb(1),_.uc("ngIf",t.identity.company._id==t.ticket.company._id&&"Cerrado"!=t.ticket.status)}}function te(t,e){1&t&&_.Wb(0,"img",66)}function ee(t,e){if(1&t&&_.Wb(0,"img",63),2&t){const t=_.nc();_.vc("src",t.url+"user/image/"+t.ticket.agent.image,_.Oc)}}function ce(t,e){if(1&t&&(_.bc(0,"p",64),_.bc(1,"strong"),_.Vc(2),_.ac(),_.ac()),2&t){const t=_.nc();_.Gb(2),_.Wc(t.ticket.agent.name+" "+t.ticket.agent.surname)}}function ie(t,e){1&t&&(_.bc(0,"p",64),_.bc(1,"strong"),_.Vc(2,"Sin agente"),_.ac(),_.ac())}function ne(t,e){if(1&t){const t=_.cc();_.bc(0,"div",68),_.bc(1,"span"),_.Vc(2,"Fecha estimada de soluci\xf3n "),_.ac(),_.bc(3,"input",69,70),_.jc("ngModelChange",(function(e){return _.Mc(t),_.nc(2).ticket.resolveDate=e}))("change",(function(e){return _.Mc(t),_.nc(2).selectResolveDate()})),_.ac(),_.ac()}if(2&t){const t=_.nc(2);_.Gb(3),_.uc("ngModel",t.ticket.resolveDate)}}function ae(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,ne,5,1,"div",67),_.ac()),2&t){const t=_.nc();_.Gb(1),_.uc("ngIf",t.identity.company._id==t.ticket.company._id)}}function se(t,e){if(1&t&&_.Wb(0,"img",75),2&t){const t=_.nc().$implicit,e=_.nc(2);_.vc("src",e.url+"user/image/"+t.image,_.Oc)}}function oe(t,e){1&t&&_.Wb(0,"img",76)}function re(t,e){if(1&t){const t=_.cc();_.bc(0,"button",77),_.jc("click",(function(e){_.Mc(t);const c=_.nc().$implicit;return _.nc(2).deleteCc(c)})),_.Wb(1,"i",78),_.ac()}}function le(t,e){if(1&t&&(_.bc(0,"li",6),_.Tc(1,se,1,1,"img",72),_.Tc(2,oe,1,0,"img",73),_.bc(3,"span"),_.Vc(4),_.ac(),_.Tc(5,re,2,0,"button",74),_.ac()),2&t){const t=e.$implicit,c=_.nc(2);_.Gb(1),_.uc("ngIf","null"!=t.image),_.Gb(1),_.uc("ngIf","null"==t.image),_.Gb(2),_.Yc("",t.name," ",t.surname,""),_.Gb(1),_.uc("ngIf","Cerrado"!=c.ticket.status)}}function ue(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,le,6,5,"li",71),_.ac()),2&t){const t=_.nc();_.Gb(1),_.uc("ngForOf",t.ticket.cc)}}function de(t,e){if(1&t){const t=_.cc();_.bc(0,"mat-option",84),_.jc("click",(function(c){_.Mc(t);const i=e.$implicit;return _.nc(2).setCc(i)})),_.Vc(1),_.ac()}if(2&t){const t=e.$implicit;_.Gb(1),_.Xc(" ",t.name+" "+t.surname," ")}}function he(t,e){if(1&t){const t=_.cc();_.bc(0,"li",79),_.bc(1,"mat-form-field",80),_.bc(2,"input",81),_.jc("input",(function(e){return _.Mc(t),_.nc().filterCc()}))("ngModelChange",(function(e){return _.Mc(t),_.nc().ccFilter=e})),_.ac(),_.bc(3,"mat-autocomplete",null,82),_.Tc(5,de,2,1,"mat-option",83),_.ac(),_.ac(),_.ac()}if(2&t){const t=_.Jc(4),e=_.nc();_.Gb(2),_.uc("ngModel",e.ccFilter)("matAutocomplete",t),_.Gb(3),_.uc("ngForOf",e.ccList)}}function be(t,e){if(1&t){const t=_.cc();_.bc(0,"input",85),_.jc("ngModelChange",(function(e){return _.Mc(t),_.nc().subMod=e})),_.ac()}if(2&t){const t=_.nc();_.uc("ngModel",t.subMod)}}function pe(t,e){if(1&t){const t=_.cc();_.bc(0,"input",86),_.jc("click",(function(e){return _.Mc(t),_.nc().editTicketSub()})),_.ac()}}function ge(t,e){if(1&t){const t=_.cc();_.bc(0,"input",87),_.jc("click",(function(e){return _.Mc(t),_.nc().editSub=!1})),_.ac()}}function me(t,e){if(1&t){const t=_.cc();_.bc(0,"h6",88),_.jc("click",(function(e){_.Mc(t);const c=_.nc();return c.subToEdit(c.ticket.sub)})),_.bc(1,"strong"),_.Vc(2),_.ac(),_.ac()}if(2&t){const t=_.nc();_.Gb(2),_.Wc(t.ticket.sub)}}const fe=function(t){return["/ticket/gestion",t]};function ke(t,e){if(1&t&&(_.bc(0,"a",89),_.Wb(1,"i",90),_.ac()),2&t){const t=_.nc();_.uc("routerLink",_.Ac(1,fe,t.prev._id))}}function ye(t,e){1&t&&_.Wb(0,"i",91)}function xe(t,e){1&t&&_.Wb(0,"i",92)}function ve(t,e){if(1&t&&(_.bc(0,"a",93),_.Wb(1,"i",94),_.ac()),2&t){const t=_.nc();_.uc("routerLink",_.Ac(1,fe,t.next._id))}}function we(t,e){if(1&t){const t=_.cc();_.bc(0,"app-chatbox",95),_.jc("deleteMessage",(function(e){return _.Mc(t),_.nc().deleteMessage()}))("refresh",(function(e){return _.Mc(t),_.nc().getChat()}))("errorMessage",(function(e){return _.Mc(t),_.nc().errorMessage()})),_.ac()}if(2&t){const t=e.$implicit,c=_.nc();_.vc("_id",t._id),_.vc("text",t.text),_.vc("sign",t.user.sign),_.vc("type",t.type),_.vc("user",t.user.name+c.space+t.user.surname),_.vc("userId",t.user._id),_.vc("date",t.createDate),_.vc("files",t.files),_.vc("info",c.info)}}function Te(t,e){if(1&t){const t=_.cc();_.bc(0,"div",38),_.bc(1,"div",96),_.bc(2,"div",97),_.bc(3,"div"),_.bc(4,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f603}")})),_.Wb(5,"img",98),_.ac(),_.bc(6,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f604}")})),_.Wb(7,"img",99),_.ac(),_.bc(8,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f601}")})),_.Wb(9,"img",100),_.ac(),_.bc(10,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f606}")})),_.Wb(11,"img",101),_.ac(),_.bc(12,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f605}")})),_.Wb(13,"img",102),_.ac(),_.bc(14,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f602}")})),_.Wb(15,"img",103),_.ac(),_.bc(16,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f609}")})),_.Wb(17,"img",104),_.ac(),_.bc(18,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f60a}")})),_.Wb(19,"img",105),_.ac(),_.bc(20,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f61c}")})),_.Wb(21,"img",106),_.ac(),_.bc(22,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f61d}")})),_.Wb(23,"img",107),_.ac(),_.bc(24,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f610}")})),_.Wb(25,"img",108),_.ac(),_.bc(26,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f62a}")})),_.Wb(27,"img",109),_.ac(),_.bc(28,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f60e}")})),_.Wb(29,"img",110),_.ac(),_.bc(30,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f632}")})),_.Wb(31,"img",111),_.ac(),_.bc(32,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f613}")})),_.Wb(33,"img",112),_.ac(),_.bc(34,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f629}")})),_.Wb(35,"img",113),_.ac(),_.bc(36,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f620}")})),_.Wb(37,"img",114),_.ac(),_.bc(38,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f44c}")})),_.Wb(39,"img",115),_.ac(),_.bc(40,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f44d}")})),_.Wb(41,"img",116),_.ac(),_.bc(42,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f44e}")})),_.Wb(43,"img",117),_.ac(),_.bc(44,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f44f}")})),_.Wb(45,"img",118),_.ac(),_.bc(46,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f64c}")})),_.Wb(47,"img",119),_.ac(),_.bc(48,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f64f}")})),_.Wb(49,"img",120),_.ac(),_.bc(50,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f440}")})),_.Wb(51,"img",121),_.ac(),_.bc(52,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u2620\ufe0f")})),_.Wb(53,"img",122),_.ac(),_.bc(54,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f648}")})),_.Wb(55,"img",123),_.ac(),_.bc(56,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f649}")})),_.Wb(57,"img",124),_.ac(),_.bc(58,"a",84),_.jc("click",(function(e){return _.Mc(t),_.nc().addEmoji("\u{1f64a}")})),_.Wb(59,"img",125),_.ac(),_.ac(),_.ac(),_.ac(),_.ac()}}function _e(t,e){if(1&t){const t=_.cc();_.bc(0,"a",51),_.jc("click",(function(c){_.Mc(t);const i=e.$implicit;return _.nc(5).selectHashtag(i.resp)})),_.Vc(1),_.ac()}if(2&t){const t=e.$implicit;_.Gb(1),_.Xc(" ",t.hashtag," ")}}function Ce(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,_e,2,1,"a",61),_.ac()),2&t){const t=_.nc(4);_.Gb(1),_.uc("ngForOf",t.responses)}}function Me(t,e){1&t&&(_.bc(0,"span",139),_.Vc(1," No tenes ning\xfana respuesta r\xe1pida configurada "),_.ac())}function Ie(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,Ce,2,1,"span",7),_.Tc(2,Me,2,0,"span",138),_.ac()),2&t){const t=_.nc(3);_.Gb(1),_.uc("ngIf",0!=t.getLenght(t.responses)),_.Gb(1),_.uc("ngIf",0==t.getLenght(t.responses))}}function Ge(t,e){if(1&t&&(_.bc(0,"div",49),_.Tc(1,Ie,3,2,"span",7),_.ac()),2&t){const t=_.nc(2);_.Gb(1),_.uc("ngIf",t.responses)}}function Se(t,e){if(1&t){const t=_.cc();_.bc(0,"button",140),_.jc("click",(function(e){return _.Mc(t),_.nc(),_.Jc(14).clear(e)})),_.bc(1,"mat-icon"),_.Vc(2,"clear"),_.ac(),_.ac()}}function Ve(t,e){if(1&t){const t=_.cc();_.bc(0,"a",51),_.jc("click",(function(e){return _.Mc(t),_.nc(2).setStatus("Pendiente")})),_.Vc(1," Pendiente "),_.ac()}}function je(t,e){if(1&t){const t=_.cc();_.bc(0,"a",51),_.jc("click",(function(e){return _.Mc(t),_.nc(2).checkWorkTime("Finalizado")})),_.Vc(1," Finalizado "),_.ac()}}function Ee(t,e){if(1&t){const t=_.cc();_.bc(0,"span"),_.bc(1,"button",126),_.Wb(2,"i",127),_.ac(),_.bc(3,"input",128),_.jc("ngModelChange",(function(e){return _.Mc(t),_.nc().isPrivate=e})),_.ac(),_.bc(4,"span",129),_.Vc(5,"Privado"),_.ac(),_.bc(6,"span"),_.Vc(7,"|"),_.ac(),_.bc(8,"div",130),_.bc(9,"button",131),_.Wb(10,"i",132),_.ac(),_.Tc(11,Ge,2,1,"div",133),_.ac(),_.bc(12,"mat-form-field"),_.bc(13,"ngx-mat-file-input",134,135),_.jc("ngModelChange",(function(e){return _.Mc(t),_.nc().files=e})),_.ac(),_.Tc(15,Se,3,0,"button",136),_.ac(),_.bc(16,"div",59),_.bc(17,"button",137),_.Vc(18),_.ac(),_.bc(19,"div",49),_.Tc(20,Ve,2,0,"a",50),_.Tc(21,je,2,0,"a",50),_.ac(),_.ac(),_.ac()}if(2&t){const t=_.Jc(14),e=_.nc();_.Gb(1),_.uc("disabled",e.identity.company._id!=e.ticket.company._id||"Cerrado"==e.ticket.status),_.Gb(2),_.uc("disabled",e.identity.company._id!=e.ticket.company._id)("ngModel",e.isPrivate),_.Gb(8),_.uc("ngIf",e.identity.company._id==e.ticket.company._id),_.Gb(2),_.uc("ngModel",e.files),_.Gb(2),_.uc("ngIf",!t.empty),_.Gb(2),_.uc("ngClass",e.calculateClasses())("disabled",e.identity.company._id!=e.ticket.company._id||"Cerrado"==e.ticket.status&&"ROLE_REQUESTER"==e.identity.role),_.Gb(1),_.Xc(" ",e.ticket.status," "),_.Gb(2),_.uc("ngIf","Pendiente"!=e.ticket.status),_.Gb(1),_.uc("ngIf","Finalizado"!=e.ticket.status)}}function Oe(t,e){if(1&t){const t=_.cc();_.bc(0,"button",140),_.jc("click",(function(e){return _.Mc(t),_.nc(),_.Jc(3).clear(e)})),_.bc(1,"mat-icon"),_.Vc(2,"clear"),_.ac(),_.ac()}}function Pe(t,e){if(1&t){const t=_.cc();_.bc(0,"button",143),_.jc("click",(function(e){return _.Mc(t),_.nc(2).cancelFinish()})),_.Wb(1,"i",144),_.ac()}}function qe(t,e){if(1&t){const t=_.cc();_.bc(0,"span"),_.bc(1,"mat-form-field"),_.bc(2,"ngx-mat-file-input",134,135),_.jc("ngModelChange",(function(e){return _.Mc(t),_.nc().files=e})),_.ac(),_.Tc(4,Oe,3,0,"button",136),_.ac(),_.bc(5,"button",126),_.Wb(6,"i",127),_.ac(),_.Tc(7,Pe,2,0,"button",141),_.bc(8,"div",59),_.bc(9,"button",142),_.Vc(10),_.ac(),_.ac(),_.ac()}if(2&t){const t=_.Jc(3),e=_.nc();_.Gb(2),_.uc("ngModel",e.files),_.Gb(2),_.uc("ngIf",!t.empty),_.Gb(1),_.uc("disabled","Cerrado"==e.ticket.status),_.Gb(2),_.uc("ngIf","Finalizado"==e.ticket.status&&e.identity._id==e.ticket.requester._id),_.Gb(3),_.Xc(" ",e.ticket.status," ")}}const We=function(t){return["/user/profile",t]},Fe=function(t){return{privatechattext:t}};let Re=(()=>{class t{constructor(t,e,c,i,n,a,s,o,r,l,u,d,h,b){this.dialog=t,this._route=e,this._router=c,this.confirmService=i,this.loader=n,this.snackBar=a,this._userService=s,this._ticketService=o,this._teamService=r,this._textblockService=l,this._uploadService=u,this._responseService=d,this._companyService=h,this._notificationService=b,this.imagesToUpload=new Array,this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=v.a.url,this.editSub=!1,this.subMod="",this.isPrivate=!1,this.space=" ",this.ccList=[],this.allCcList=[],this.ccFilter="",this.isCc=!1,this.stat="",this.info="true",this.ticket=new U("","",null,"","","","","","","",null,"",[""],"","","",[""],null,null,""),this.textblock=new H("","",this.identity._id,"","","",[""],!1),this.emojis=!1,this.config=v.a.richTextModule}ngOnInit(){this.getTicket(),this.getHashtags(),this.getCompanies(),this.checkInfo(),this.getCc()}checkInfo(){this.info=0!=this.identity.infoView?"true":"false"}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}getCc(){this._userService.getList(this.token).subscribe(t=>{t.users&&(this.allCcList=t.users)},t=>{this.openSnackBar(t.message,"Cerrar")})}changeInfo(){this.info="false"==this.info?"true":"false",this.getChat()}getPrevNext(t,e){this._ticketService.getPrevNext(this.token,this.identity._id,t,e,this.identity.role).subscribe(t=>{this.next=t.nextTicket,this.prev=t.prevTicket},t=>{this.openSnackBar(t.message,"Cerrar")})}filterCc(){this.ccList=this.allCcList.filter(t=>(t.name+t.surname).toLowerCase().includes(this.ccFilter.toString().toLowerCase()))}setCc(t){this._ticketService.addCc(this.token,this.ticket._id,t._id).subscribe(e=>{e.ticket?(this.newInfo(this.identity.name+" "+this.identity.surname+" puso en copia a "+t.name+" "+t.surname+" en este ticket"),this.getTicket()):this._router.navigate(["/"])},t=>{this.openSnackBar(t.message,"Cerrar")})}deleteCc(t){this._ticketService.removecc(this.token,this.ticket._id,t._id).subscribe(e=>{e.ticket&&(this.newInfo(this.identity.name+" "+this.identity.surname+" elmin\xf3 a "+t.name+" "+t.surname+" de los usuarios en copia"),this.getTicket())},t=>{this.openSnackBar(t.message,"Cerrar")})}getLenght(t){return t.length}deleteMessage(){this.openSnackBar("El mensaje fue eliminado correctamente.","Cerrar")}errorMessage(){this.openSnackBar("No puede eliminar un mensaje con m\xe1s de dos horas de realizado","Cerrar")}getTeams(t){this._teamService.getList(this.token,t).subscribe(t=>{t.teams?this.teams=t.teams:this._router.navigate(["/"])},t=>{this.openSnackBar(t.message,"Cerrar")})}getCompanies(){this._companyService.getList(this.token).subscribe(t=>{t.companies?this.companies=t.companies:this._router.navigate(["/"])},t=>{this.openSnackBar(t.message,"Cerrar")})}getReqTickets(t){t&&this._ticketService.getForUser(this.token,t._id).subscribe(t=>{t.tickets?this.reqTickets=t.tickets:this._router.navigate(["/"])},t=>{this.openSnackBar(t.message,"Cerrar")})}getChat(){this._route.params.forEach(t=>{this._textblockService.getForTicket(this.token,t.id,this.identity.role).subscribe(t=>{t.textblocks&&(this.chat=t.textblocks,"ROLE_REQUESTER"!=this.identity.role?this.ticket.agent&&this.identity._id==this.ticket.agent._id&&this._textblockService.readAgent(this.token,this.ticket._id).subscribe(t=>{t.textblock||console.error("Error en textblock")},t=>{this.openSnackBar(t.message,"Cerrar")}):this.identity._id==this.ticket.requester._id&&this._textblockService.readRequester(this.token,this.ticket._id).subscribe(t=>{},t=>{this.openSnackBar(t.message,"Cerrar")}),this.ticket.agent&&this.ticket.agent._id&&("ROLE_REQUESTER"!=this.identity.role&&this.identity._id==this.ticket.agent._id?this._textblockService.readAgent(this.token,this.ticket._id).subscribe(t=>{},t=>{this.openSnackBar(t.message,"Cerrar")}):"ROLE_REQUESTER"==this.identity.role&&this.identity._id==this.ticket.requester._id&&this._textblockService.readRequester(this.token,this.ticket._id).subscribe(t=>{},t=>{console.error(t)})))},t=>{this.openSnackBar(t.message,"Cerrar")})})}getHashtags(){this._responseService.getList(this.token,this.identity._id).subscribe(t=>{t.responses&&(this.responses=t.responses)},t=>{this.openSnackBar(t.message,"Cerrar")})}getTicket(){this._route.params.forEach(t=>{this._ticketService.getOne(this.token,t.id).subscribe(t=>{this.ticket=t.ticket,setTimeout(()=>{this.getChat()},1e3),this.getPrevNext(t.ticket.numTicket,t.ticket.status),this.getTeams(t.ticket.company._id),t.ticket.team&&(this.agents=t.ticket.team.users),this.ticket.cc&&-1!=this.ticket.cc.map((function(t){return t._id})).indexOf(this.identity._id)&&(this.isCc=!0)},t=>{this.openSnackBar(t.message,"Cerrar")})})}selectHashtag(t){this.textblock.text=this.textblock.text+t,document.getElementById("editable").innerHTML=document.getElementById("editable").innerHTML+t}selectAgent(t,e,c){"Pendiente"!=this.ticket.status?(this.ticket.agent=t,this.ticket.status="Pendiente",this.editTicket(),this.newInfo(this.identity._id==t?this.identity.name+" "+this.identity.surname+" se asign\xf3 como agente de esta solicitud":this.identity.name+" "+this.identity.surname+" asign\xf3 a "+e+" "+c+" como agente de esta solicitud")):(this.ticket.agent=t,this.editTicket(),this.newInfo(this.identity._id==t?this.identity.name+" "+this.identity.surname+" se asign\xf3 como agente de esta solicitud":this.identity.name+" "+this.identity.surname+" asign\xf3 a "+e+" "+c+" como agente de esta solicitud"))}selectTeam(t,e){this.ticket.team=t,this.ticket.agent=null,this.ticket.status="Pendiente",this.editTicket(),this.newInfo(this.identity.name+" "+this.identity.surname+" asign\xf3 a "+e+" como equipo de esta solicitud"),this.newInfo(this.identity.name+" "+this.identity.surname+" ha cambiado el estado de la solicitud a pendiente")}cancelFinish(){let t=this.textblock.text;""!=t&&(t=t.split("<span _ngco")[0]),""!=t?(this.newInfo(this.identity.name+" "+this.identity.surname+" ha reabierto el ticket"),this.createMessageNotification(this.ticket.agent._id,"#"+this.ticket.numTicket+" - "+this.identity.name+" "+this.identity.surname+" reabri\xf3 el ticket"),this.onSubmit(),this.ticket.status="Pendiente",this.editTicket()):this.openSnackBar("Escribe un mensaje antes de enviarlo","Cerrar")}selectCompany(t,e){"Abierto"!=this.ticket.status?(this.ticket.company=t,this.ticket.team=null,this.ticket.agent=null,this.agents=null,this.ticket.status="Abierto",this.ticket.resolveDate=null,this.editTicket(),this.getTeams(t),this.newInfo(this.identity.name+" "+this.identity.surname+" asign\xf3 a "+e+" como departamento responsable de esta solicitud"),this.newInfo(this.identity.name+" "+this.identity.surname+" ha cambiado el estado de la solicitud a abierto")):(this.ticket.company=t,this.ticket.team=null,this.agents=null,this.ticket.agent=null,this.editTicket(),this.newInfo(this.identity.name+" "+this.identity.surname+" asign\xf3 a "+e+" como departamento responsable de esta solicitud"))}selectResolveDate(){if(k(this.ticket.resolveDate).isSameOrAfter(k().format("YYYY-MM-DD"))){var t=this.ticket.resolveDate.split("-");this.ticket.resolveDate=t[2]+"-"+t[1]+"-"+t[0],this.editTicket(),this.newInfo(this.identity.name+" "+this.identity.surname+" ha actualizado la fecha estimada de soluci\xf3n a "+this.ticket.resolveDate)}else this.openSnackBar("No puede seleccionar una fecha anterior a la actual","Cerrar"),this.ticket.resolveDate=""}calculateClasses(){var t={};switch(this.ticket.status){case"Pendiente":t={pending:!0};break;case"Abierto":t={open:!0};break;case"Cerrado":t={closer:!0};break;case"Finalizado":t={finish:!0}}return t.btn=!0,t["btn-dark"]=!0,t["dropdown-toggle"]=!0,t}subToEdit(t){"Cerrado"!=this.ticket.status&&(this.identity.company?this.identity.company._id==this.ticket.company._id&&(this.editSub=!0,this.subMod=t):this.identity._id==this.ticket.requester._id&&(this.editSub=!0,this.subMod=t))}editTicketSub(){this.newInfo(this.identity.name+" "+this.identity.surname+" ha cambiado el asunto de la solicitud de "+this.ticket.sub+" a "+this.subMod.toUpperCase()),this.ticket.sub=this.subMod,this.editTicket(),this.editSub=!1}checkWorkTime(t){this.ticket.workTime?(this.stat=t,$("#timework").modal("show")):this.setStatus(t)}setStatus(t){("Cerrado"==t||"Finalizado"==t)&&this.ticket.team&&this.ticket.agent||"Pendiente"==t&&this.ticket.team||"Abierto"==t?(this.newInfo(this.identity.name+" "+this.identity.surname+" ha cambiado el estado de la solicitud de "+this.ticket.status+" a "+t),this.ticket.status=t,this.editTicket(),"Finalizado"==t&&this.createMessageNotification(this.ticket.requester._id,"#"+this.ticket.numTicket+" - "+this.identity.name+" "+this.identity.surname+" finaliz\xf3 el ticket."),$("#timework").modal("hide")):this.openSnackBar("Debe seleccionar un responsable para cambiar el ticket a ese estado","Cerrar")}setPriority(t){this.newInfo(this.identity.name+" "+this.identity.surname+" ha cambiado la prioridad de la solicitud de "+this.ticket.priority+" a "+t),this.ticket.priority=t,this.editTicket()}editTicket(){this._route.params.forEach(t=>{this._ticketService.edit(this.token,t.id,this.ticket).subscribe(t=>{t.ticket&&this.getTicket()},t=>{this.openSnackBar(t.message,"Cerrar")})})}newInfo(t){var e;e=new H("",t,this.identity._id,"","","INFO",[""],!1),this._route.params.forEach(t=>{e.ticket=t.id}),this._textblockService.add(this.token,e).subscribe(t=>{t.textblock&&this.pushText(t.textblock._id)},t=>{this.openSnackBar(t.message,"Cerrar")})}onSubmit(){let t;""!=this.textblock.text&&(this.textblock.text=this.textblock.text.split("<span _ngco")[0]),""!=this.textblock.text?("ROLE_REQUESTER"==this.identity.role?(this.textblock.type="REQUEST",t=this.ticket.agent,delete this.ticket.agent,delete this.ticket.team):(this.textblock.read=!0,this.textblock.type=this.isPrivate?"PRIVATE":"PUBLIC"),this._route.params.forEach(t=>{this.textblock.ticket=t.id}),this._textblockService.add(this.token,this.textblock).subscribe(e=>{if(e.textblock){let c="#"+this.ticket.numTicket+" - Nuevo mensaje";if("ROLE_REQUESTER"==this.identity.role)t&&this.createMessageNotification(t._id,c);else{let t=this.ticket.requester._id;this.createMessageNotification(t,c),this.ticket.cc&&this.ticket.cc.forEach(e=>{t=e._id,this.createMessageNotification(t,c)})}null!=this.files&&null!=this.files&&(this._uploadService.makeFileRequest(this.url+"textblock/file/"+e.textblock._id,[],this.files.files,this.token,"file"),this.files=null)}let c,i;if("PRIVATE"!=this.textblock.type&&1==this.ticket.company.mailSender&&("ROLE_REQUESTER"!=this.identity.role?1==this.ticket.requester.receiveMail&&(c=this.ticket.requester.name+" "+this.ticket.requester.surname,i=this.ticket.requester.email):this.ticket.agent&&1==this.ticket.agent.receiveMail&&(c=this.ticket.agent.name+" "+this.ticket.agent.surname,i=this.ticket.agent.email),c)){let t=window.location.href,n=this.identity.name+" "+this.identity.surname,a=void 0;this.ticket.cc&&(a=this.ticket.cc.map((function(t){return t.email}))),this._ticketService.sendMail(this.token,n,this.ticket,e.textblock.text,c,i,t,a).subscribe(t=>{},t=>{this.openSnackBar(t.message,"Cerrar")})}this.editTicket(),this.pushText(e.textblock._id),this.textblock=new H("","",this.identity._id,"","","",[""],!1),document.getElementById("editable").innerHTML=""},t=>{this.openSnackBar(t,"Cerrar")})):this.openSnackBar("Escriba un mensaje antes de enviarlo","Cerrar")}showEmojis(){this.emojis=!this.emojis}addEmoji(t){this.textblock.text=this.textblock.text+t,document.getElementById("editable").innerHTML=document.getElementById("editable").innerHTML+t}pushText(t){this._textblockService.getOne(this.token,t).subscribe(t=>{t.textblock&&this.chat.push(t.textblock)},t=>{this.openSnackBar(t.message,"Cerrar")})}createMessageNotification(t,e){let c=k().format("YYYY-MM-DD HH:mm"),i=new et.a("",e,"chat",c,c,"ticket/gestion/"+this.ticket._id,"primary",t,null,null);this._notificationService.add(this.token,i).subscribe(t=>{},t=>{this.openSnackBar("No pudo enviarse una notificaci\xf3n por sistema al usuario","Cerrar")})}changeDate(t){return k(t,"YYYY-MM-DD HH:mm").format("DD-MM-YYYY HH:mm")}outOfLimit(){return 100*this.ticket.realWorkTime/this.ticket.workTime>=150}pastePicture(t){return e=this,void 0,i=function*(){0!=t.clipboardData.files.length&&(this.imagesToUpload=new Array,this.imagesToUpload.push(t.clipboardData.files.item(0)),yield this._uploadService.makeFileRequest(this.url+"textblock/image",[],this.imagesToUpload,this.token,"image").then(t=>{document.getElementById("editable").innerHTML+='<a target="_blank" href="'+this.url+"textblock/image/"+t.filename+'"><img src="'+this.url+"textblock/image/"+t.filename+'" class="img-fluid" style="width: 80%; margin: 5px" alt="Responsive image"></a>'}),this.textblock.text=document.getElementById("editable").innerHTML,this.imagesToUpload=new Array)},new((c=void 0)||(c=Promise))((function(t,n){function a(t){try{o(i.next(t))}catch(e){n(e)}}function s(t){try{o(i.throw(t))}catch(e){n(e)}}function o(e){var i;e.done?t(e.value):(i=e.value,i instanceof c?i:new c((function(t){t(i)}))).then(a,s)}o((i=i.apply(e,[])).next())}));var e,c,i}}return t.\u0275fac=function(e){return new(e||t)(_.Vb(b.b),_.Vb(n.a),_.Vb(n.g),_.Vb(m.a),_.Vb(f.a),_.Vb(C.a),_.Vb(y.a),_.Vb(x.a),_.Vb(Q.a),_.Vb(J),_.Vb(K.a),_.Vb(Z.a),_.Vb(tt.a),_.Vb(ct.a))},t.\u0275cmp=_.Pb({type:t,selectors:[["app-ticket-gestion"]],features:[_.Fb([y.a,x.a,ct.a,Q.a,J,K.a,Z.a,tt.a])],decls:141,vars:52,consts:[["id","ticket",1,"row"],["id","ticket-dates",1,"col-md-5","col-lg-5","col-xl-4","text-break"],[1,"card",2,"height","100%"],[3,"expanded"],[1,"accordion-text"],[1,"list-group","p-0","m-0"],[1,"list-group-item"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"list-group",3,"routerLink"],[1,"row"],[1,"col-xl-3"],["class","rounded-circle mr-2","width","50","height","50","src","assets/images/system/user-placeholder.png",4,"ngIf"],["class","rounded-circle mr-2","width","50","height","50",3,"src",4,"ngIf"],["class","col-xl-8 align-self-center",4,"ngIf"],[1,"list-group"],[2,"font-size","18px"],[2,"margin-bottom","25px"],["class","rounded-circle img-agent-team","src","assets/images/system/company-placeholder.png",4,"ngIf"],["class","rounded-circle img-agent-team",3,"src",4,"ngIf"],["class","d-inline","style","margin-left: 10px;",4,"ngIf"],["class","rounded-circle img-agent-team","src","assets/images/system/team-placeholder.png",4,"ngIf"],["class","rounded-circle img-agent-team","src","assets/images/system/user-placeholder.png",4,"ngIf"],["class","list-group-item text-center",4,"ngIf"],[1,"col-md-6","col-lg-7","col-xl-8"],[1,"container","text-center"],["type","text","name","sub",3,"ngModel","ngModelChange",4,"ngIf"],["style","margin-left: 3px;","type","button","class","btn btn-dark dark","value","Aceptar",3,"click",4,"ngIf"],["style","margin-left: 3px;","type","button","class","btn btn-danger","value","Cancelar",3,"click",4,"ngIf"],["class","d-inline",3,"click",4,"ngIf"],["class","float-left",3,"routerLink",4,"ngIf"],[1,"float-left",3,"click"],["class","fa fa-info-circle enabled","style","margin-left: 8px;",4,"ngIf"],["class","fa fa-info-circle disabled","style","margin-left: 8px;",4,"ngIf"],["class","float-right",3,"routerLink",4,"ngIf"],["id","chatbox-scroll",1,"col","chatbox-scroll"],[3,"_id","text","sign","type","user","userId","date","files","info","deleteMessage","refresh","errorMessage",4,"ngFor","ngForOf"],["class","row","style","margin-top: 10px;",4,"ngIf"],[1,"row",2,"margin-top","10px"],["id","chat-text",1,"col",3,"ngClass"],[3,"ngSubmit"],["form","ngForm"],[1,"container",2,"border","1px solid #4e5257"],[1,"p-0"],["theme","snow","placeholder","Escribe aqui tu mensaje","name","autoDesc",3,"modules","ngModel","ngModelChange"],["id","options-container",1,"container"],["class","dropdown d-inline",4,"ngIf"],[1,"dropdown","d-inline"],["data-toggle","dropdown","aria-expanded","false","type","button",1,"btn","btn-dark","dropdown-toggle","dark",2,"margin-right","15px"],["role","menu",1,"dropdown-menu"],["role","presentation","class","dropdown-item",3,"click",4,"ngIf"],["role","presentation",1,"dropdown-item",3,"click"],["width","50","height","50","src","assets/images/system/user-placeholder.png",1,"rounded-circle","mr-2"],["width","50","height","50",1,"rounded-circle","mr-2",3,"src"],[1,"col-xl-8","align-self-center"],[1,"col"],["class","row",4,"ngIf"],["aria-hidden","true",1,"fa","fa-phone"],["class","dropdown d-inline float-right",4,"ngIf"],[1,"dropdown","d-inline","float-right"],["data-toggle","dropdown","aria-expanded","false","type","button",1,"btn","btn-dark","dropdown-toggle","dark"],["role","presentation","class","dropdown-item",3,"click",4,"ngFor","ngForOf"],["src","assets/images/system/company-placeholder.png",1,"rounded-circle","img-agent-team"],[1,"rounded-circle","img-agent-team",3,"src"],[1,"d-inline",2,"margin-left","10px"],["src","assets/images/system/team-placeholder.png",1,"rounded-circle","img-agent-team"],["src","assets/images/system/user-placeholder.png",1,"rounded-circle","img-agent-team"],["style","margin-top: 10px;",4,"ngIf"],[2,"margin-top","10px"],["type","date","name","resolveDate",2,"margin-right","5px",3,"ngModel","ngModelChange","change"],["resolveDate","ngModel"],["class","list-group-item",4,"ngFor","ngForOf"],["class","rounded-circle mr-2","width","30","height","30",3,"src",4,"ngIf"],["class","rounded-circle mr-2","width","30","height","30","src","assets/images/system/user-placeholder.png",4,"ngIf"],["class","btn btn-danger float-right","type","button",3,"click",4,"ngIf"],["width","30","height","30",1,"rounded-circle","mr-2",3,"src"],["width","30","height","30","src","assets/images/system/user-placeholder.png",1,"rounded-circle","mr-2"],["type","button",1,"btn","btn-danger","float-right",3,"click"],[1,"fa","fa-trash"],[1,"list-group-item","text-center"],[1,"full-width"],["type","text","placeholder","Buscar persona","aria-label","Text","matInput","",3,"ngModel","matAutocomplete","input","ngModelChange"],["autoCC","matAutocomplete"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["type","text","name","sub",3,"ngModel","ngModelChange"],["type","button","value","Aceptar",1,"btn","btn-dark","dark",2,"margin-left","3px",3,"click"],["type","button","value","Cancelar",1,"btn","btn-danger",2,"margin-left","3px",3,"click"],[1,"d-inline",3,"click"],[1,"float-left",3,"routerLink"],[1,"fa","fa-arrow-circle-left","adjunt",2,"margin-left","6px"],[1,"fa","fa-info-circle","enabled",2,"margin-left","8px"],[1,"fa","fa-info-circle","disabled",2,"margin-left","8px"],[1,"float-right",3,"routerLink"],[1,"fa","fa-arrow-circle-right","adjunt",2,"margin-left","6px"],[3,"_id","text","sign","type","user","userId","date","files","info","deleteMessage","refresh","errorMessage"],["id","chat-text",1,"col"],[1,"container"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-open-mouth_1f603.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-open-mouth-and-smiling-eyes_1f604.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/grinning-face-with-smiling-eyes_1f601.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-open-mouth-and-tightly-closed-eyes_1f606.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-open-mouth-and-cold-sweat_1f605.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/face-with-tears-of-joy_1f602.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/winking-face_1f609.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-smiling-eyes_1f60a.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/face-with-stuck-out-tongue-and-winking-eye_1f61c.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/face-with-stuck-out-tongue-and-tightly-closed-eyes_1f61d.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/neutral-face_1f610.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/sleepy-face_1f62a.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-sunglasses_1f60e.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/astonished-face_1f632.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/face-with-cold-sweat_1f613.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/weary-face_1f629.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/angry-face_1f620.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/ok-hand-sign_1f44c.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/thumbs-up-sign_1f44d.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/thumbs-down-sign_1f44e.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/clapping-hands-sign_1f44f.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/person-raising-both-hands-in-celebration_1f64c.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/person-with-folded-hands_1f64f.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/eyes_1f440.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/skull-and-crossbones_2620.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/see-no-evil-monkey_1f648.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/hear-no-evil-monkey_1f649.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/speak-no-evil-monkey_1f64a.png","width","30px",2,"margin-right","3px"],["type","submit",1,"btn","btn-primary","float-right",3,"disabled"],[1,"fa","fa-paper-plane"],["type","checkbox","name","isPrivate",3,"disabled","ngModel","ngModelChange"],[2,"margin-left","5px","margin-right","5px"],["id","hashtag",1,"dropdown","d-inline"],["data-toggle","dropdown","aria-expanded","false","type","button",1,"btn","dropdown-toggle"],[1,"fa","fa-hashtag","adjunt"],["role","menu","class","dropdown-menu",4,"ngIf"],["name","files","placeholder","Adjuntar archivos","multiple","",3,"ngModel","ngModelChange"],["removableInput",""],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],["data-toggle","dropdown","aria-expanded","false","type","button",2,"margin-right","15px",3,"ngClass","disabled"],["class","card","style","padding: 5px;border: 1px solid gray;",4,"ngIf"],[1,"card",2,"padding","5px","border","1px solid gray"],["mat-icon-button","","matSuffix","",3,"click"],["class","btn btn-danger float-right","title","Reabrir el ticket","type","button","style","margin-right: 15px;",3,"click",4,"ngIf"],["disabled","","data-toggle","dropdown","aria-expanded","false","type","button",1,"btn","btn-dark","dropdown-toggle","dark",2,"margin-right","15px"],["title","Reabrir el ticket","type","button",1,"btn","btn-danger","float-right",2,"margin-right","15px",3,"click"],[1,"fa","fa-unlock"]],template:function(t,e){1&t&&(_.bc(0,"mat-card"),_.bc(1,"div",0),_.bc(2,"div",1),_.bc(3,"div",2),_.bc(4,"mat-accordion"),_.bc(5,"mat-expansion-panel",3),_.bc(6,"mat-expansion-panel-header"),_.bc(7,"mat-panel-title"),_.bc(8,"strong",4),_.Vc(9,"Informaci\xf3n general"),_.ac(),_.ac(),_.ac(),_.bc(10,"ul",5),_.bc(11,"li",6),_.bc(12,"span"),_.Vc(13,"N\xfamero:\xa0"),_.ac(),_.bc(14,"span"),_.bc(15,"strong"),_.Vc(16),_.ac(),_.ac(),_.ac(),_.bc(17,"li",6),_.bc(18,"span"),_.Vc(19,"Creaci\xf3n:\xa0"),_.ac(),_.bc(20,"span"),_.bc(21,"strong"),_.Vc(22),_.ac(),_.ac(),_.ac(),_.bc(23,"li",6),_.bc(24,"span"),_.Vc(25,"Actualizado:\xa0"),_.ac(),_.bc(26,"span"),_.bc(27,"strong"),_.Vc(28),_.ac(),_.ac(),_.ac(),_.bc(29,"li",6),_.bc(30,"span"),_.Vc(31,"Prioridad:\xa0"),_.ac(),_.Tc(32,It,3,2,"span",7),_.Tc(33,Gt,3,1,"span",7),_.ac(),_.bc(34,"li",6),_.bc(35,"span"),_.Vc(36," Tipo:\xa0 "),_.ac(),_.bc(37,"span"),_.Tc(38,St,2,1,"strong",7),_.ac(),_.ac(),_.bc(39,"li",6),_.bc(40,"span"),_.Vc(41," Subtipo:\xa0 "),_.ac(),_.bc(42,"span"),_.Tc(43,Vt,2,1,"strong",7),_.ac(),_.ac(),_.bc(44,"li",6),_.bc(45,"span"),_.Vc(46,"Fuente:\xa0"),_.ac(),_.bc(47,"span"),_.bc(48,"strong"),_.Vc(49),_.ac(),_.ac(),_.ac(),_.bc(50,"li",6),_.bc(51,"span"),_.Vc(52,"Fecha estimada de soluci\xf3n: "),_.bc(53,"span"),_.bc(54,"strong"),_.Vc(55),_.ac(),_.ac(),_.Vc(56,"\xa0"),_.ac(),_.Tc(57,jt,5,1,"span",8),_.ac(),_.ac(),_.ac(),_.bc(58,"mat-expansion-panel"),_.bc(59,"mat-expansion-panel-header"),_.bc(60,"mat-panel-title"),_.bc(61,"strong",4),_.Vc(62,"Solicitante"),_.ac(),_.ac(),_.ac(),_.bc(63,"ul",9),_.bc(64,"li",6),_.bc(65,"div",10),_.bc(66,"div",11),_.Tc(67,Et,1,0,"img",12),_.Tc(68,Ot,1,1,"img",13),_.ac(),_.Tc(69,Wt,8,3,"div",14),_.ac(),_.ac(),_.ac(),_.ac(),_.bc(70,"mat-expansion-panel"),_.bc(71,"mat-expansion-panel-header"),_.bc(72,"mat-panel-title"),_.bc(73,"strong",4),_.Vc(74,"Responsabilidad"),_.ac(),_.ac(),_.ac(),_.bc(75,"ul",15),_.bc(76,"li",6),_.bc(77,"span",16),_.bc(78,"strong"),_.Vc(79,"Departamento"),_.ac(),_.ac(),_.Tc(80,Lt,2,1,"span",7),_.Wb(81,"div",17),_.Tc(82,At,1,0,"img",18),_.Tc(83,Bt,1,1,"img",19),_.Tc(84,Dt,3,0,"p",20),_.Tc(85,Yt,3,1,"p",20),_.Wb(86,"hr"),_.bc(87,"span",16),_.bc(88,"strong"),_.Vc(89,"Equipo"),_.ac(),_.ac(),_.Tc(90,Ut,2,1,"span",7),_.Wb(91,"div",17),_.Tc(92,$t,1,0,"img",21),_.Tc(93,Ht,1,1,"img",19),_.Tc(94,Qt,3,0,"p",20),_.Tc(95,Xt,3,1,"p",20),_.Wb(96,"hr"),_.bc(97,"span",16),_.bc(98,"strong"),_.Vc(99,"Agente"),_.ac(),_.ac(),_.Tc(100,Zt,2,1,"span",7),_.Wb(101,"div",17),_.Tc(102,te,1,0,"img",22),_.Tc(103,ee,1,1,"img",19),_.Tc(104,ce,3,1,"p",20),_.Tc(105,ie,3,0,"p",20),_.Tc(106,ae,2,1,"span",7),_.ac(),_.ac(),_.ac(),_.bc(107,"mat-expansion-panel"),_.bc(108,"mat-expansion-panel-header"),_.bc(109,"mat-panel-title"),_.bc(110,"strong",4),_.Vc(111,"En copia"),_.ac(),_.ac(),_.ac(),_.bc(112,"ul",15),_.Tc(113,ue,2,1,"span",7),_.Tc(114,he,6,3,"li",23),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.bc(115,"div",24),_.bc(116,"div",25),_.Tc(117,be,1,1,"input",26),_.Tc(118,pe,1,0,"input",27),_.Tc(119,ge,1,0,"input",28),_.Tc(120,me,3,1,"h6",29),_.Tc(121,ke,2,3,"a",30),_.bc(122,"a",31),_.jc("click",(function(t){return e.changeInfo()})),_.Tc(123,ye,1,0,"i",32),_.Tc(124,xe,1,0,"i",33),_.ac(),_.Tc(125,ve,2,3,"a",34),_.ac(),_.bc(126,"div",10),_.bc(127,"div",35),_.Tc(128,we,1,9,"app-chatbox",36),_.ac(),_.Wb(129,"span"),_.ac(),_.Tc(130,Te,60,0,"div",37),_.bc(131,"div",38),_.bc(132,"div",39),_.bc(133,"form",40,41),_.jc("ngSubmit",(function(t){return e.onSubmit()})),_.bc(135,"div",42),_.bc(136,"mat-card-content",43),_.bc(137,"quill-editor",44),_.jc("ngModelChange",(function(t){return e.textblock.text=t})),_.ac(),_.ac(),_.ac(),_.bc(138,"div",45),_.Tc(139,Ee,22,11,"span",7),_.Tc(140,qe,11,5,"span",7),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.ac(),_.ac()),2&t&&(_.Gb(5),_.uc("expanded",!0),_.Gb(11),_.Xc("#",e.ticket.numTicket,""),_.Gb(6),_.Wc(e.changeDate(e.ticket.createDate)),_.Gb(6),_.Wc(e.changeDate(e.ticket.lastActivity)),_.Gb(4),_.uc("ngIf",e.identity.company),_.Gb(1),_.uc("ngIf",!e.identity.company),_.Gb(5),_.uc("ngIf",e.ticket.subTypeTicket),_.Gb(5),_.uc("ngIf",e.ticket.subTypeTicket),_.Gb(6),_.Wc(e.ticket.source),_.Gb(6),_.Wc(e.ticket.resolveDate),_.Gb(2),_.uc("ngForOf",e.ticket.tags),_.Gb(6),_.uc("routerLink",_.Ac(48,We,e.ticket.requester._id)),_.Gb(4),_.uc("ngIf","null"==e.ticket.requester.image),_.Gb(1),_.uc("ngIf","null"!=e.ticket.requester.image),_.Gb(1),_.uc("ngIf",e.ticket.requester),_.Gb(11),_.uc("ngIf",e.identity.company),_.Gb(2),_.uc("ngIf",!e.ticket.company||"null"==e.ticket.company.image),_.Gb(1),_.uc("ngIf",e.ticket.company&&"null"!=e.ticket.company.image),_.Gb(1),_.uc("ngIf",!e.ticket.company),_.Gb(1),_.uc("ngIf",e.ticket.company),_.Gb(5),_.uc("ngIf",e.identity.company),_.Gb(2),_.uc("ngIf",!e.ticket.team||"null"==e.ticket.team.image),_.Gb(1),_.uc("ngIf",e.ticket.team&&"null"!=e.ticket.team.image),_.Gb(1),_.uc("ngIf",!e.ticket.team),_.Gb(1),_.uc("ngIf",e.ticket.team),_.Gb(5),_.uc("ngIf",e.identity.company),_.Gb(2),_.uc("ngIf",!e.ticket.agent||"null"==e.ticket.agent.image),_.Gb(1),_.uc("ngIf",e.ticket.agent&&"null"!=e.ticket.agent.image),_.Gb(1),_.uc("ngIf",e.ticket.agent),_.Gb(1),_.uc("ngIf",!e.ticket.agent),_.Gb(1),_.uc("ngIf",e.identity.company),_.Gb(7),_.uc("ngIf",e.ticket.cc&&0!=e.getLenght(e.ticket.cc)),_.Gb(1),_.uc("ngIf","Cerrado"!=e.ticket.status),_.Gb(3),_.uc("ngIf",e.editSub),_.Gb(1),_.uc("ngIf",e.editSub),_.Gb(1),_.uc("ngIf",e.editSub),_.Gb(1),_.uc("ngIf",!e.editSub),_.Gb(1),_.uc("ngIf",("ROLE_REQUESTER"==e.identity.role||e.ticket.agent)&&e.prev),_.Gb(2),_.uc("ngIf","true"==e.info),_.Gb(1),_.uc("ngIf","false"==e.info),_.Gb(1),_.uc("ngIf",("ROLE_REQUESTER"==e.identity.role||e.ticket.agent)&&e.next),_.Gb(3),_.uc("ngForOf",e.chat),_.Gb(2),_.uc("ngIf",e.emojis),_.Gb(2),_.uc("ngClass",_.Ac(50,Fe,e.isPrivate)),_.Gb(5),_.uc("modules",e.config)("ngModel",e.textblock.text),_.Gb(2),_.uc("ngIf",e.identity.company),_.Gb(1),_.uc("ngIf",!e.identity.company))},directives:[l.a,it.a,it.c,it.d,it.e,i.m,i.l,n.h,i.k,nt.a,a.x,a.o,a.p,l.b,at.a,a.n,a.q,a.c,h.b,s.b,st.c,st.a,T.p,n.j,vt,a.a,wt.a,r.b,h.f,o.a],styles:["#ticket-dates[_ngcontent-%COMP%]{overflow-y:auto}@media (max-width:992px){#ticket-dates[_ngcontent-%COMP%]{border-bottom:1px solid #737373}}.info-card[_ngcontent-%COMP%]{width:100%;padding-top:0}.container.title-container[_ngcontent-%COMP%]{margin-bottom:0}.title[_ngcontent-%COMP%]{width:100%}.card-body.card-req-tickets[_ngcontent-%COMP%]{height:250px;overflow-y:scroll}.chatbox-scroll[_ngcontent-%COMP%]{overflow-y:scroll;height:300px}.card.chatbox[_ngcontent-%COMP%]{max-width:80%;min-height:30%;border:1px solid #1e2833;margin:10px}.adjunt[_ngcontent-%COMP%]{cursor:pointer;font-size:20px;color:#7979ff}.chatinfo[_ngcontent-%COMP%]{border:1px solid #1e2833;margin:10px}.chat-header[_ngcontent-%COMP%]{height:30px;display:flex;background-color:#1e2833;color:#fff}#chat-textbox[_ngcontent-%COMP%]{width:100%;min-height:100px}.container[_ngcontent-%COMP%]{padding-top:5px}.disabled[_ngcontent-%COMP%]{color:red}.disabled[_ngcontent-%COMP%], .enabled[_ngcontent-%COMP%]{cursor:pointer;font-size:20px}.enabled[_ngcontent-%COMP%]{color:green}.img-requester[_ngcontent-%COMP%]{width:50px;height:50px}.img-agent-team[_ngcontent-%COMP%]{width:30px;height:30px}.status-buble[_ngcontent-%COMP%]{color:#fff;padding:5px 10px}.pending[_ngcontent-%COMP%]{background-color:#f7813e}.finish[_ngcontent-%COMP%]{background-color:#10e00c}.closer[_ngcontent-%COMP%]{background-color:#929292}.open[_ngcontent-%COMP%]{background-color:#47b8b8}.privatechattext[_ngcontent-%COMP%]{background-color:#676767;color:#fff}li[_ngcontent-%COMP%]{padding-top:9px;padding-bottom:9px}mat-card[_ngcontent-%COMP%]{padding-left:10px}.accordion-text[_ngcontent-%COMP%]{font-size:16px}"]}),t})();var Le=c("rpG9"),Ae=c("Xwq+"),Be=c("xHqg"),De=c("bSwM");function Ye(t,e){1&t&&_.Vc(0,"Solicitante")}function ze(t,e){if(1&t){const t=_.cc();_.bc(0,"mat-option",32),_.jc("click",(function(c){_.Mc(t);const i=e.$implicit;return _.nc(2).setRequester(i)})),_.Vc(1),_.ac()}if(2&t){const t=e.$implicit;_.uc("value",t.name+" "+t.surname),_.Gb(1),_.Xc(" ",t.name+" "+t.surname," ")}}function Ne(t,e){1&t&&_.Wb(0,"img",33)}function Ue(t,e){if(1&t&&_.Wb(0,"img",34),2&t){const t=_.nc(2);_.vc("src",t.url+"user/image/"+t.requester.image,_.Oc)}}function $e(t,e){if(1&t&&(_.bc(0,"div",35),_.bc(1,"div",36),_.bc(2,"div",37),_.bc(3,"span"),_.bc(4,"strong"),_.Vc(5),_.ac(),_.ac(),_.ac(),_.ac(),_.bc(6,"div",36),_.bc(7,"div",37),_.bc(8,"span"),_.bc(9,"em"),_.Vc(10),_.ac(),_.ac(),_.ac(),_.ac(),_.bc(11,"div",36),_.bc(12,"div",37),_.bc(13,"span"),_.bc(14,"em"),_.Vc(15),_.ac(),_.ac(),_.ac(),_.ac(),_.ac()),2&t){const t=_.nc(2);_.Gb(5),_.Yc("",t.requester.name," ",t.requester.surname,""),_.Gb(5),_.Wc(t.requester.email),_.Gb(5),_.Wc(t.requester.phone)}}function He(t,e){if(1&t){const t=_.cc();_.bc(0,"mat-step",24),_.Tc(1,Ye,1,0,"ng-template",5),_.bc(2,"form",11),_.bc(3,"div",7),_.bc(4,"mat-form-field",8),_.bc(5,"input",25),_.jc("input",(function(e){return _.Mc(t),_.nc().filterRequester(e.target.value)})),_.ac(),_.bc(6,"mat-autocomplete",null,26),_.Tc(8,ze,2,2,"mat-option",27),_.ac(),_.ac(),_.Wb(9,"span",10),_.bc(10,"div",8),_.bc(11,"div",28),_.Tc(12,Ne,1,0,"img",29),_.Tc(13,Ue,1,1,"img",30),_.ac(),_.Tc(14,$e,16,4,"div",31),_.ac(),_.ac(),_.ac(),_.bc(15,"div"),_.bc(16,"button",21),_.Vc(17,"Siguiente"),_.ac(),_.ac(),_.ac()}if(2&t){const t=_.Jc(7),e=_.nc();_.uc("stepControl",e.requesterControl),_.Gb(5),_.uc("matAutocomplete",t),_.Gb(3),_.uc("ngForOf",e.requesters),_.Gb(4),_.uc("ngIf",!e.requester||"null"==e.requester.image),_.Gb(1),_.uc("ngIf",e.requester&&"null"!=e.requester.image),_.Gb(1),_.uc("ngIf",e.requester&&""!=e.requester._id),_.Gb(2),_.uc("disabled",!e.requester)}}function Qe(t,e){1&t&&_.Vc(0,"Tipo de ticket")}function Xe(t,e){if(1&t){const t=_.cc();_.bc(0,"mat-option",32),_.jc("click",(function(c){_.Mc(t);const i=e.$implicit;return _.nc(2).setCompany(i)})),_.Vc(1),_.ac()}if(2&t){const t=e.$implicit;_.uc("value",t),_.Gb(1),_.Xc("",t.name," ")}}function Je(t,e){if(1&t){const t=_.cc();_.bc(0,"mat-option",32),_.jc("click",(function(c){_.Mc(t);const i=e.$implicit;return _.nc(3).setType(i)})),_.Vc(1),_.ac()}if(2&t){const t=e.$implicit;_.uc("value",t),_.Gb(1),_.Xc("",t.name," ")}}function Ke(t,e){if(1&t&&(_.bc(0,"mat-form-field",8),_.bc(1,"mat-label"),_.Vc(2,"Tipo"),_.ac(),_.bc(3,"mat-select"),_.Tc(4,Je,2,2,"mat-option",27),_.ac(),_.ac()),2&t){const t=_.nc(2);_.Gb(4),_.uc("ngForOf",t.types)}}function Ze(t,e){if(1&t){const t=_.cc();_.bc(0,"mat-option",32),_.jc("click",(function(c){_.Mc(t);const i=e.$implicit;return _.nc(3).setSubType(i)})),_.Vc(1),_.ac()}if(2&t){const t=e.$implicit;_.uc("value",t),_.Gb(1),_.Xc("",t.name," ")}}function tc(t,e){if(1&t&&(_.bc(0,"mat-form-field",8),_.bc(1,"mat-label"),_.Vc(2,"Sub-tipo"),_.ac(),_.bc(3,"mat-select"),_.Tc(4,Ze,2,2,"mat-option",27),_.ac(),_.ac()),2&t){const t=_.nc(2);_.Gb(4),_.uc("ngForOf",t.subTypes)}}function ec(t,e){if(1&t&&(_.bc(0,"mat-step",38),_.Tc(1,Qe,1,0,"ng-template",5),_.bc(2,"form",6),_.bc(3,"div",7),_.bc(4,"mat-form-field",8),_.bc(5,"mat-label"),_.Vc(6,"Departamento"),_.ac(),_.bc(7,"mat-select"),_.Tc(8,Xe,2,2,"mat-option",27),_.ac(),_.ac(),_.ac(),_.bc(9,"div",7),_.Tc(10,Ke,5,1,"mat-form-field",39),_.Wb(11,"span",10),_.Tc(12,tc,5,1,"mat-form-field",39),_.ac(),_.bc(13,"div",18),_.bc(14,"button",21),_.Vc(15,"Siguiente"),_.ac(),_.ac(),_.ac(),_.ac()),2&t){const t=_.nc();_.uc("stepControl",t.typeControl),_.Gb(2),_.uc("formGroup",t.typeControl),_.Gb(6),_.uc("ngForOf",t.companies),_.Gb(2),_.uc("ngIf",t.types),_.Gb(2),_.uc("ngIf",t.subTypes),_.Gb(2),_.uc("disabled",t.typeControl.invalid)}}function cc(t,e){1&t&&_.Vc(0,"Asunto y descripci\xf3n")}function ic(t,e){if(1&t){const t=_.cc();_.bc(0,"button",40),_.jc("click",(function(e){return _.Mc(t),_.nc(),_.Jc(15).clear(e)})),_.bc(1,"mat-icon"),_.Vc(2,"clear"),_.ac(),_.ac()}}function nc(t,e){1&t&&(_.bc(0,"mat-checkbox",41),_.Vc(1,"Es urgente "),_.ac()),2&t&&_.uc("color","primary")}function ac(t,e){1&t&&_.Vc(0,"Responsables")}function sc(t,e){if(1&t){const t=_.cc();_.bc(0,"mat-option",32),_.jc("click",(function(c){_.Mc(t);const i=e.$implicit;return _.nc(2).setTeam(i)})),_.Vc(1),_.ac()}if(2&t){const t=e.$implicit;_.uc("value",t),_.Gb(1),_.Xc("",t.name," ")}}function oc(t,e){if(1&t){const t=_.cc();_.bc(0,"mat-option",32),_.jc("click",(function(c){_.Mc(t);const i=e.$implicit;return _.nc(3).setAgent(i)})),_.Vc(1),_.ac()}if(2&t){const t=e.$implicit;_.uc("value",t),_.Gb(1),_.Yc("",t.name," ",t.surname," ")}}function rc(t,e){if(1&t&&(_.bc(0,"mat-form-field",8),_.bc(1,"mat-label"),_.Vc(2,"Agente"),_.ac(),_.bc(3,"mat-select"),_.Tc(4,oc,2,3,"mat-option",27),_.ac(),_.ac()),2&t){const t=_.nc(2);_.Gb(4),_.uc("ngForOf",t.agents)}}function lc(t,e){if(1&t){const t=_.cc();_.bc(0,"mat-step",42),_.Tc(1,ac,1,0,"ng-template",5),_.bc(2,"form",6),_.bc(3,"div",7),_.bc(4,"mat-form-field",8),_.bc(5,"mat-label"),_.Vc(6,"Equipo"),_.ac(),_.bc(7,"mat-select"),_.Tc(8,sc,2,2,"mat-option",27),_.ac(),_.ac(),_.Wb(9,"span",10),_.Tc(10,rc,5,1,"mat-form-field",39),_.ac(),_.bc(11,"div",18),_.bc(12,"button",19),_.Vc(13,"Anterior"),_.ac(),_.Wb(14,"span",20),_.bc(15,"button",43),_.jc("click",(function(e){return _.Mc(t),_.nc().submit()})),_.Vc(16,"Crear ticket"),_.ac(),_.ac(),_.ac(),_.ac()}if(2&t){const t=_.nc();_.uc("stepControl",t.respControl),_.Gb(2),_.uc("formGroup",t.respControl),_.Gb(6),_.uc("ngForOf",t.teams),_.Gb(2),_.uc("ngIf",t.agents)}}function uc(t,e){1&t&&_.Vc(0,"En copia")}function dc(t,e){if(1&t){const t=_.cc();_.bc(0,"mat-option",51),_.jc("click",(function(c){_.Mc(t);const i=e.$implicit;return _.nc(2).setCc(i)})),_.Vc(1),_.ac()}if(2&t){const t=e.$implicit;_.Gb(1),_.Xc(" ",t.name+" "+t.surname," ")}}function hc(t,e){if(1&t&&_.Wb(0,"img",58),2&t){const t=_.nc().$implicit,e=_.nc(3);_.vc("src",e.url+"user/image/"+t.image,_.Oc)}}function bc(t,e){1&t&&_.Wb(0,"img",59)}function pc(t,e){if(1&t){const t=_.cc();_.bc(0,"li",53),_.Tc(1,hc,1,1,"img",54),_.Tc(2,bc,1,0,"img",55),_.bc(3,"span"),_.Vc(4),_.ac(),_.bc(5,"button",56),_.jc("click",(function(c){_.Mc(t);const i=e.$implicit;return _.nc(3).deleteCc(i)})),_.Wb(6,"i",57),_.ac(),_.ac()}if(2&t){const t=e.$implicit;_.Gb(1),_.uc("ngIf","null"!=t.image),_.Gb(1),_.uc("ngIf","null"==t.image),_.Gb(2),_.Yc("",t.name," ",t.surname,"")}}function gc(t,e){if(1&t&&(_.bc(0,"span"),_.Tc(1,pc,7,4,"li",52),_.ac()),2&t){const t=_.nc(2);_.Gb(1),_.uc("ngForOf",t.cc)}}function mc(t,e){if(1&t){const t=_.cc();_.bc(0,"mat-step",44),_.Tc(1,uc,1,0,"ng-template",5),_.bc(2,"form",11),_.bc(3,"div",7),_.bc(4,"mat-form-field",45),_.bc(5,"input",46),_.jc("input",(function(e){return _.Mc(t),_.nc().filterCc()}))("ngModelChange",(function(e){return _.Mc(t),_.nc().ccFilter=e})),_.ac(),_.bc(6,"mat-autocomplete",null,47),_.Tc(8,dc,2,1,"mat-option",48),_.ac(),_.ac(),_.ac(),_.bc(9,"div",7),_.bc(10,"ul",49),_.Tc(11,gc,2,1,"span",50),_.ac(),_.ac(),_.bc(12,"div",18),_.bc(13,"button",19),_.Vc(14,"Anterior"),_.ac(),_.Wb(15,"span",20),_.bc(16,"button",43),_.jc("click",(function(e){return _.Mc(t),_.nc().submit()})),_.Vc(17,"Crear ticket"),_.ac(),_.ac(),_.ac(),_.ac()}if(2&t){const t=_.Jc(7),e=_.nc();_.Gb(5),_.uc("ngModel",e.ccFilter)("matAutocomplete",t),_.Gb(3),_.uc("ngForOf",e.ccList),_.Gb(3),_.uc("ngIf",0!=e.getLenght(e.cc))}}const fc=[{path:"",children:[{path:"list/:page/:limit",component:N,data:{title:"Lista",breadcrumb:"LISTA"}},{path:"gestion/:id",component:Re,data:{title:"Gesti\xf3n",breadcrumb:"GESTION"}},{path:"new",component:(()=>{class t{constructor(t,e,c,i,n,a,s,o,r,l,u){this._ticketService=t,this._userService=e,this._textBlockService=c,this._uploadService=i,this.snackBar=n,this._teamService=a,this._companyService=s,this._router=o,this.loader=r,this._typeTicketService=l,this._subTypeTicketService=u,this.url=v.a.url,this.config=v.a.richTextModule,this.ccList=[],this.allCcList=[],this.ccFilter="",this.token=e.getToken(),this.identity=e.getIdentity(),this.cc=new Array}ngOnInit(){"ROLE_REQUESTER"==this.identity.role?(this.getCompany(),this.getCc()):(this.getTeams(),this.getRequesters()),this.buildForm()}buildForm(){this.requesterControl=new a.h({requester:new a.e(null,[a.v.required])}),this.descriptionControl=new a.h({sub:new a.e(null,[a.v.required]),text:new a.e(null,[a.v.required]),important:new a.e(!1),files:new a.e(void 0)}),this.respControl=new a.h({team:new a.e(null,[a.v.required]),agent:new a.e(null,[a.v.required])}),this.typeControl=new a.h({company:new a.e(null,[a.v.required]),subtype:new a.e(null,[a.v.required]),resolve:new a.e(null)})}getRequesters(){this._userService.getListReq(this.token,this.identity.company._id).subscribe(t=>{t.users&&(this.requesters=t.users,this.tempRequesters=t.users)},t=>{this.openSnackBar(t.message,"Cerrar")})}getTeams(){this._teamService.getList(this.token,this.identity.company._id).subscribe(t=>{t.teams&&(this.teams=t.teams)},t=>{this.openSnackBar(t.message,"Cerrar")})}getTypes(t){this._typeTicketService.getList(this.token,t).subscribe(t=>{t.typeTickets&&(this.types=t.typeTickets)},t=>{this.openSnackBar(t.message,"Cerrar")})}getSubTypes(t){this._subTypeTicketService.getList(this.token,t).subscribe(t=>{t.subTypeTickets&&(this.subTypes=t.subTypeTickets)},t=>{this.openSnackBar(t.message,"Cerrar")})}getCompany(){this._companyService.getList(this.token).subscribe(t=>{t.companies&&(this.companies=t.companies)},t=>{this.openSnackBar(t.message,"Cerrar")})}getCc(){this._userService.getList(this.token).subscribe(t=>{t.users&&(this.allCcList=t.users)},t=>{this.openSnackBar(t.message,"Cerrar")})}setTeam(t){this.respControl.controls.team.setValue(t._id),this.getAgents(t.users)}setCompany(t){this.typeControl.controls.company.setValue(t._id),this.typeControl.controls.subtype.setValue(null),this.subTypes=null,this.getTypes(t._id)}setType(t){this.getSubTypes(t._id)}setSubType(t){this.subType=t,this.typeControl.controls.subtype.setValue(t._id),this.descriptionControl.controls.sub.setValue(null),this.descriptionControl.controls.text.setValue(null),t.autoSub&&""!=t.autoSub&&this.descriptionControl.controls.sub.setValue(t.autoSub),t.autoDesc&&""!=t.autoDesc&&this.descriptionControl.controls.text.setValue(t.autoDesc),this.respControl.controls.team.setValue(null),t.team&&this.respControl.controls.team.setValue(t.team._id),this.setResolve(t)}getAgents(t){this.agents=t,this.tempAgents=t}setAgent(t){this.respControl.controls.agent.setValue(t._id)}setRequester(t){this.requesterControl.controls.requester.setValue(t._id),this.requester=t}setResolve(t){let e=k().add(t.resolveDays,"days").format("DD-MM-YYYY");6!=k(e,"DD-MM-YYYY").weekday()&&0!=k(e,"DD-MM-YYYY").weekday()||(e=k(e,"DD-MM-YYYY").add(2,"days").format("DD-MM-YYYY")),this.typeControl.controls.resolve.setValue(e)}filterRequester(t){this.requesters=this.tempRequesters.filter(e=>(e.name+e.surname).toLowerCase().includes(t.toString().toLowerCase()))}resetFiles(){this.descriptionControl.controls.files.setValue(void 0),this.openSnackBar("Adjuntos eliminados","Cerrar")}getLenght(t){return t.length}submit(){if(this.loader.open("Generando ticket"),"ROLE_REQUESTER"!=this.identity.role)this.ticket=new U("","",null,null,null,null,"Abierto","","",null,null,"MANUAL",[null],"Normal",this.identity.company._id,null,new Array,null,null,""),this.ticket.requester=this.requesterControl.controls.requester.value,this.descriptionControl.controls.important.value&&(this.ticket.priority="Urgente"),this.respControl.controls.agent.value&&(this.ticket.agent=this.respControl.controls.agent.value),this.ticket.source="MANUAL";else if(this.ticket=new U("","",null,this.identity._id,null,null,"Abierto","","",null,null,"MANUAL",[null],"Normal",null,null,new Array,null,null,""),this.ticket.company=this.typeControl.controls.company.value,this.ticket.subTypeTicket=this.typeControl.controls.subtype.value,this.ticket.source="PORTAL",this.ticket.resolveDate=this.typeControl.controls.resolve.value,0!=this.cc.length){let t=new Array;this.cc.forEach(e=>{t.push(e._id)}),this.ticket.cc=t}this.ticket.sub=this.descriptionControl.controls.sub.value,this.respControl.controls.team.value&&(this.ticket.team=this.respControl.controls.team.value,this.ticket.status="Pendiente"),this._ticketService.add(this.token,this.ticket).subscribe(t=>{t.ticket&&(this.text=new H("",this.descriptionControl.controls.text.value,this.identity._id,"",t.ticket._id,"PUBLIC",[null],!1),"ROLE_REQUESTER"==this.identity.role&&(this.text.type="REQUEST"),this._textBlockService.add(this.token,this.text).subscribe(t=>{t.textblock&&(null!=this.descriptionControl.controls.files.value&&null!=this.descriptionControl.controls.files.value?this._uploadService.makeFileRequest(this.url+"textblock/file/"+t.textblock._id,[],this.descriptionControl.controls.files.value.files,this.token,"file").then(t=>{this.loader.close()},t=>{this.openSnackBar(t.message,"Cerrar")}):this.loader.close(),this.openSnackBar("Ticket generado correctamente","Cerrar"),this._router.navigate(["/ticket/gestion",t.textblock.ticket]))},t=>{this.loader.close(),this.openSnackBar(t.message,"Cerrar")}))},t=>{this.loader.close(),this.openSnackBar(t.message,"Cerrar")})}isInvalid(){return!!this.descriptionControl.invalid||"ROLE_REQUESTER"==this.identity.role&&0!=this.subType.autoChange&&null!=this.subType.autoChange&&this.descriptionControl.controls.text.value==this.subType.autoDesc&&this.descriptionControl.controls.sub.value==this.subType.autoSub}fileChangeEvent(t){this.descriptionControl.controls.files.setValue(t.target.files),this.openSnackBar("Adjuntos a\xf1adidos","Cerrar")}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}filterCc(){this.ccList=this.allCcList.filter(t=>(t.name+t.surname).toLowerCase().includes(this.ccFilter.toString().toLowerCase()))}setCc(t){-1==this.cc.indexOf(t)&&this.cc.push(t)}deleteCc(t){-1!=this.cc.indexOf(t)&&this.cc.splice(this.cc.indexOf(t),1)}}return t.\u0275fac=function(e){return new(e||t)(_.Vb(x.a),_.Vb(y.a),_.Vb(J),_.Vb(K.a),_.Vb(C.a),_.Vb(Q.a),_.Vb(tt.a),_.Vb(n.g),_.Vb(f.a),_.Vb(Le.a),_.Vb(Ae.a))},t.\u0275cmp=_.Pb({type:t,selectors:[["app-new-ticket"]],features:[_.Fb([Q.a,J,K.a,Le.a,Ae.a,tt.a])],decls:30,vars:11,consts:[[1,"p-0"],[3,"linear"],["id","requesterStep",3,"stepControl",4,"ngIf"],["id","typeStep",3,"stepControl",4,"ngIf"],["id","descriptionStep",3,"stepControl"],["matStepLabel",""],["fxFlex","",3,"formGroup"],["fxLayout","row wrap","fxLayout.lt-sm","column"],["fxFlex","",1,"full-width"],["type","text","placeholder","Asunto","aria-label","Text","formControlName","sub","matInput",""],["fxFlex","16px"],["fxFlex",""],["fxFlex","","formControlName","files","name","files","placeholder","Adjuntar archivos","multiple",""],["removableInput",""],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],["fxFlex","","class","full-width","formControlName","important","name","sectorRef",3,"color",4,"ngIf"],["fxFlex","",1,"p-0"],["theme","snow","placeholder","Escribe aqui tu mensaje","name","autoDesc","formControlName","text",3,"modules"],["fxLayout","row"],["mat-raised-button","","color","accent","matStepperPrevious",""],["fxFlex","8px"],["mat-raised-button","","color","primary","matStepperNext","",3,"disabled"],["id","respStep",3,"stepControl",4,"ngIf"],["id","ccStep",3,"stepControl",4,"ngIf"],["id","requesterStep",3,"stepControl"],["type","text","placeholder","Buscar solicitante","aria-label","Text","matInput","",3,"matAutocomplete","input"],["autoReq","matAutocomplete"],[3,"value","click",4,"ngFor","ngForOf"],[1,"col-xl-5"],["style","width: 150px;height: 150px;","src","assets/images/system/user-placeholder.png",4,"ngIf"],["style","width: 150px;height: 150px;",3,"src",4,"ngIf"],["class","col-xl-6 align-self-center",4,"ngIf"],[3,"value","click"],["src","assets/images/system/user-placeholder.png",2,"width","150px","height","150px"],[2,"width","150px","height","150px",3,"src"],[1,"col-xl-6","align-self-center"],[1,"form-row"],[1,"col"],["id","typeStep",3,"stepControl"],["fxFlex","","class","full-width",4,"ngIf"],["mat-icon-button","","matSuffix","",3,"click"],["fxFlex","","formControlName","important","name","sectorRef",1,"full-width",3,"color"],["id","respStep",3,"stepControl"],["mat-raised-button","","color","primary","matStepperNext","",3,"click"],["id","ccStep",3,"stepControl"],[1,"full-width"],["type","text","placeholder","Buscar persona","aria-label","Text","matInput","","name","ccFilter",3,"ngModel","matAutocomplete","input","ngModelChange"],["autoCC","matAutocomplete"],[3,"click",4,"ngFor","ngForOf"],[1,"list-group","full-width"],[4,"ngIf"],[3,"click"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],["class","rounded-circle mr-2","width","30","height","30",3,"src",4,"ngIf"],["class","rounded-circle mr-2","width","30","height","30","src","assets/images/system/user-placeholder.png",4,"ngIf"],["type","button",1,"btn","btn-danger","float-right",3,"click"],[1,"fa","fa-trash"],["width","30","height","30",1,"rounded-circle","mr-2",3,"src"],["width","30","height","30","src","assets/images/system/user-placeholder.png",1,"rounded-circle","mr-2"]],template:function(t,e){if(1&t&&(_.bc(0,"mat-card",0),_.bc(1,"mat-card-content"),_.bc(2,"mat-horizontal-stepper",1),_.Tc(3,He,18,7,"mat-step",2),_.Tc(4,ec,16,6,"mat-step",3),_.bc(5,"mat-step",4),_.Tc(6,cc,1,0,"ng-template",5),_.bc(7,"form",6),_.bc(8,"div",7),_.bc(9,"mat-form-field",8),_.Wb(10,"input",9),_.ac(),_.Wb(11,"span",10),_.bc(12,"div",11),_.bc(13,"mat-form-field"),_.Wb(14,"ngx-mat-file-input",12,13),_.Tc(16,ic,3,0,"button",14),_.ac(),_.ac(),_.Wb(17,"span",10),_.Tc(18,nc,2,1,"mat-checkbox",15),_.ac(),_.bc(19,"div",7),_.bc(20,"mat-card-content",16),_.Wb(21,"quill-editor",17),_.ac(),_.ac(),_.bc(22,"div",18),_.bc(23,"button",19),_.Vc(24,"Anterior"),_.ac(),_.Wb(25,"span",20),_.bc(26,"button",21),_.Vc(27,"Siguiente"),_.ac(),_.ac(),_.ac(),_.ac(),_.Tc(28,lc,17,4,"mat-step",22),_.Tc(29,mc,18,4,"mat-step",23),_.ac(),_.ac(),_.ac()),2&t){const t=_.Jc(15);_.Gb(2),_.uc("linear",!0),_.Gb(1),_.uc("ngIf","ROLE_REQUESTER"!=e.identity.role),_.Gb(1),_.uc("ngIf","ROLE_REQUESTER"==e.identity.role),_.Gb(1),_.uc("stepControl",e.descriptionControl),_.Gb(2),_.uc("formGroup",e.descriptionControl),_.Gb(9),_.uc("ngIf",!t.empty),_.Gb(2),_.uc("ngIf","ROLE_REQUESTER"!=e.identity.role),_.Gb(3),_.uc("modules",e.config),_.Gb(5),_.uc("disabled",e.isInvalid()),_.Gb(2),_.uc("ngIf","ROLE_REQUESTER"!=e.identity.role),_.Gb(1),_.uc("ngIf","ROLE_REQUESTER"==e.identity.role)}},directives:[l.a,l.b,Be.a,i.m,Be.b,Be.c,a.x,a.o,M.b,a.i,M.d,h.b,a.c,s.b,a.n,a.g,wt.a,at.a,r.b,Be.f,Be.e,a.p,st.c,st.a,i.l,T.p,h.e,I.a,h.f,o.a,De.a,a.q],styles:[".butt[_ngcontent-%COMP%]{background-color:#018aca}.butt[_ngcontent-%COMP%], .butt-trash[_ngcontent-%COMP%]{font-size:12px;font-weight:300;color:#fff;display:inline-block;transition:all .5s;cursor:pointer;padding:10px 15px!important;text-transform:uppercase;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;text-align:center}.butt-trash[_ngcontent-%COMP%]{background-color:#ff1717}"]}),t})(),data:{title:"Nuevo",breadcrumb:"NUEVO"}}]}];var kc=c("YUcS");c.d(e,"TicketModule",(function(){return yc}));let yc=(()=>{class t{}return t.\u0275mod=_.Tb({type:t}),t.\u0275inj=_.Sb({factory:function(e){return new(e||t)},providers:[x.a,y.a],imports:[[a.j,i.c,wt.b,Be.d,I.b,a.t,kc.a,st.b,it.b,De.b,b.f,p.b,at.b,d.b,g.a,s.c,h.d,o.b,r.c,l.c,u.b,n.k.forChild(fc)]]}),t})()}}]);