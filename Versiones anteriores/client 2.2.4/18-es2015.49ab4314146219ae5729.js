(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{"9Mbw":function(t,e,c){"use strict";c.r(e);var r=c("ofXK"),a=c("tyNb"),o=c("3Pt+"),i=c("qFsG"),n=c("NFeN"),s=c("bTqV"),d=c("Wp6s"),l=c("f0Cb"),b=c("kmnG"),u=c("0IaG"),m=c("Qu3c"),p=c("PCNd"),h=c("YUcS"),g=c("7EHt"),f=c("/1cH"),x=c("d3UM"),v=c("iadO"),w=c("xHqg"),k=c("bSwM"),I=c("7ZcW"),S=c("CzEO"),G=c("lDzL");class M{constructor(t,e,c,r,a,o,i,n,s,d){this._id=t,this.numOrder=e,this.date=c,this.dateRequired=r,this.uploadDate=a,this.company=o,this.sectorDestiny=i,this.justification=n,this.obs=s,this.status=d}}var V=c("3sEA"),_=c("L/iA"),y=c("U14E"),C=c("YFeJ"),O=c("gU78"),T=c("wd/R"),A=c("fXoL"),R=c("dNgK");function D(t,e){if(1&t&&A.Vc(0),2&t){const t=e.row;A.Xc(" ",null==t?null:t.numOrder," ")}}function L(t,e){if(1&t&&A.Vc(0),2&t){const t=e.row;A.Xc(" ",null==t?null:t.sectorDestiny," ")}}function F(t,e){if(1&t&&A.Vc(0),2&t){const t=e.row;A.Xc(" ",null==t?null:t.status," ")}}function E(t,e){if(1&t&&A.Vc(0),2&t){const t=e.row,c=A.nc();A.Xc(" ",c.changeDate(null==t?null:t.date)," ")}}function N(t,e){if(1&t&&A.Vc(0),2&t){const t=e.row,c=A.nc();A.Xc(" ",c.changeDate(null==t?null:t.dateRequired)," ")}}const P=function(t){return["/deposit/order/get/",t]},j=function(t){return["/deposit/order/receive/",t]};function B(t,e){if(1&t){const t=A.cc();A.bc(0,"button",13),A.jc("click",(function(c){A.Mc(t);const r=e.row;return A.nc().print(r)})),A.bc(1,"mat-icon"),A.Vc(2,"print"),A.ac(),A.ac(),A.bc(3,"button",14),A.bc(4,"mat-icon"),A.Vc(5,"list_alt"),A.ac(),A.ac(),A.bc(6,"button",15),A.bc(7,"mat-icon"),A.Vc(8,"add_task"),A.ac(),A.ac()}if(2&t){const t=e.row;A.uc("matTooltip","Autorizado"==t.status||"Recibido"==t.status?"Imprimir orden":"La orden a\xfan esta pendiente de autorizar")("disabled","Autorizado"!=t.status&&"Recibido"!=t.status),A.Gb(3),A.uc("routerLink",A.Ac(5,P,t._id)),A.Gb(3),A.uc("disabled","Autorizado"!=t.status&&"Recibido"!=t.status)("routerLink",A.Ac(7,j,t._id))}}function W(t,e){if(1&t&&(A.bc(0,"tr"),A.bc(1,"td",40),A.Vc(2),A.ac(),A.bc(3,"td",40),A.Vc(4),A.ac(),A.bc(5,"td",41),A.Vc(6),A.ac(),A.bc(7,"td",41),A.Vc(8),A.ac(),A.bc(9,"td",42),A.Vc(10),A.ac(),A.bc(11,"td",43),A.Vc(12),A.ac(),A.ac()),2&t){const t=e.$implicit,c=e.index;A.Gb(2),A.Wc(c+1),A.Gb(2),A.Wc(t.cant),A.Gb(2),A.Wc(t.item.name),A.Gb(2),A.Wc(t.item.brand),A.Gb(2),A.Wc(t.obs),A.Gb(2),A.Wc(t.costSector)}}function z(t,e){if(1&t&&(A.bc(0,"div",16),A.bc(1,"div",17),A.bc(2,"div",18),A.bc(3,"table",19),A.bc(4,"tbody"),A.bc(5,"tr",20),A.bc(6,"td",21),A.Vc(7,"Fecha: "),A.bc(8,"strong"),A.Vc(9),A.ac(),A.ac(),A.bc(10,"td",22),A.bc(11,"strong"),A.Vc(12,"FORMULARIO \xdaNICO DE REQUERIMIENTO"),A.ac(),A.ac(),A.bc(13,"td",23),A.Vc(14,"N\xfamero"),A.ac(),A.bc(15,"td",24),A.Wb(16,"strong"),A.Vc(17),A.ac(),A.ac(),A.bc(18,"tr"),A.bc(19,"td",24),A.Vc(20,"A"),A.ac(),A.bc(21,"td",22),A.Vc(22,"FECHA DE ENTREGA REQUERIDA: "),A.bc(23,"strong"),A.Vc(24),A.ac(),A.ac(),A.bc(25,"td",23),A.Vc(26,"ORIGINAL"),A.ac(),A.bc(27,"td",24),A.Vc(28,"X"),A.ac(),A.ac(),A.bc(29,"tr"),A.bc(30,"td",25),A.Vc(31,"Solicitante: "),A.bc(32,"strong"),A.Vc(33),A.ac(),A.ac(),A.ac(),A.bc(34,"tr"),A.bc(35,"td",25),A.Vc(36,"Destino: "),A.bc(37,"strong"),A.Vc(38),A.ac(),A.ac(),A.ac(),A.bc(39,"tr",20),A.bc(40,"td",26),A.bc(41,"strong"),A.Vc(42,"JUSTIFICACI\xd3N DE LA COMPRA"),A.ac(),A.ac(),A.ac(),A.bc(43,"tr"),A.bc(44,"td",27),A.Wb(45,"div",28),A.ac(),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(46,"div",18),A.bc(47,"table",29),A.bc(48,"thead"),A.bc(49,"tr"),A.bc(50,"th",30),A.Vc(51,"Item"),A.ac(),A.bc(52,"th",31),A.Vc(53,"Cant"),A.ac(),A.bc(54,"th",32),A.Vc(55,"Articulo"),A.ac(),A.bc(56,"th",24),A.Vc(57,"Marca"),A.ac(),A.bc(58,"th",24),A.Vc(59,"Observaciones"),A.ac(),A.bc(60,"th",33),A.Vc(61,"Centro de costo"),A.ac(),A.ac(),A.ac(),A.bc(62,"tbody"),A.Tc(63,W,13,6,"tr",34),A.ac(),A.ac(),A.ac(),A.bc(64,"div",18),A.bc(65,"table",19),A.bc(66,"tbody"),A.bc(67,"tr",21),A.bc(68,"td",35),A.bc(69,"strong"),A.Vc(70,"Observaciones:"),A.ac(),A.bc(71,"span"),A.Vc(72),A.ac(),A.ac(),A.ac(),A.bc(73,"tr",21),A.bc(74,"td",36),A.bc(75,"p",37),A.Vc(76,"SOLICITO: FIRMA Y ACLARACI\xd3N"),A.ac(),A.Wb(77,"div",38),A.bc(78,"span",39),A.Vc(79,"Guillermo Luparia"),A.ac(),A.ac(),A.bc(80,"td",36),A.bc(81,"p",37),A.Vc(82,"AUTORIZO: FIRMA Y ACLARACI\xd3N"),A.ac(),A.Wb(83,"div",38),A.bc(84,"span",39),A.Vc(85,"Guillermo Luparia"),A.ac(),A.ac(),A.bc(86,"td",36),A.bc(87,"p",37),A.Vc(88,"GERENCIA: FIRMA Y ACLARACI\xd3N"),A.ac(),A.ac(),A.ac(),A.ac(),A.ac(),A.ac(),A.ac(),A.ac()),2&t){const t=A.nc();A.Gb(9),A.Wc(t.changeDate(t.orderPrint.date)),A.Gb(8),A.Xc(" ",t.num,""),A.Gb(7),A.Wc(t.changeDate(t.orderPrint.dateRequired)),A.Gb(9),A.Wc(t.orderPrint.company.name),A.Gb(5),A.Wc(t.orderPrint.sectorDestiny),A.Gb(7),A.uc("innerHTML",t.orderPrint.justification,A.Nc),A.Gb(18),A.uc("ngForOf",t.orderItems),A.Gb(9),A.Xc(" ",t.orderPrint.obs,"")}}const H=function(){return{y:"50px",delay:"300ms"}},q=function(t){return{value:"*",params:t}},X=function(){return["/deposit/order/new"]},J=function(){return{x:"50px",delay:"600ms"}};let Y=(()=>{class t{constructor(t,e,c,r,a,o){this.snack=t,this._userService=e,this.snackBar=c,this.loader=r,this._orderService=a,this._orderItemService=o,this.url=C.a.url,this.token=e.getToken(),this.identity=e.getIdentity(),this.orderPrint=new M("",0,null,null,null,null,"","","","")}ngOnInit(){this.getOrders()}getOrders(){this._orderService.getList(this.token,{company:this.identity.company._id}).subscribe(t=>{t.orders&&(this.orders=t.orders)},t=>{this.openSnackBar(t.message,"Cerrar")})}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}print(t){this.orderPrint=t,this.num=this.getNum(t),this.getOrderList(t)}getNum(t){let e=T(t.date).format("YYYY"),c="";return c=this.orderPrint.numOrder<10?"000"+String(this.orderPrint.numOrder):this.orderPrint.numOrder<100?"00"+String(this.orderPrint.numOrder):this.orderPrint.numOrder<1e3?"0"+String(this.orderPrint.numOrder):String(this.orderPrint.numOrder),e+"-"+c}changeDate(t){return T(t).format("DD/MM/YYYY")}getOrderList(t){this._orderItemService.getList(this.token,{order:t._id}).subscribe(e=>{e.orderItems&&(this.orderItems=e.orderItems,setTimeout(()=>{let e=document.getElementById("order").innerHTML;this._orderService.print(this.token,e,t._id).subscribe(e=>{this._orderService.getPrint(t._id).subscribe(e=>{e.message?(this.loader.open("Generando orden, esto puede tardar unos segundos"),setTimeout(()=>{window.open(this.url+"order/print/"+t._id,"_blank"),this.loader.close()},1e4)):window.open(this.url+"order/print/"+t._id,"_blank")},e=>{window.open(this.url+"order/print/"+t._id,"_blank")})},t=>{console.error(t)})},1500))},t=>{this.openSnackBar(t.message,"Cerrar")})}}return t.\u0275fac=function(e){return new(e||t)(A.Vb(R.a),A.Vb(O.a),A.Vb(R.a),A.Vb(V.a),A.Vb(_.a),A.Vb(y.a))},t.\u0275cmp=A.Pb({type:t,selectors:[["app-order-list"]],features:[A.Fb([O.a,_.a,y.a])],decls:20,vars:25,consts:[[1,"m-333"],["mat-raised-button","","color","primary",1,"mb-05",3,"routerLink"],[3,"vertical"],[1,"p-0"],[1,"material","ml-0","mr-0",3,"rows","columnMode","headerHeight","footerHeight","scrollbarH","limit","rowHeight"],["name","#","prop","numOrder",3,"flexGrow"],["ngx-datatable-cell-template",""],["name","Destino","prop","sectorDestiny",3,"flexGrow"],["name","Estado","prop","status",3,"flexGrow"],["name","Genera","prop","date",3,"flexGrow"],["name","Entrega","prop","dateRequired",3,"flexGrow"],["name","Acciones",3,"flexGrow"],["id","order","class","card print",4,"ngIf"],["mat-icon-button","","mat-sm-button","","color","primary",3,"matTooltip","disabled","click"],["mat-icon-button","","mat-sm-button","","color","primary","matTooltip","Ver orden",3,"routerLink"],["mat-icon-button","","mat-sm-button","","color","primary","matTooltip","Recibir insumos",3,"disabled","routerLink"],["id","order",1,"card","print"],[1,"card-body"],[1,"table-responsive","table-bordered"],[1,"table","table-bordered"],[2,"background-color","#3f9ecb"],[1,"cell"],["colspan","3",1,"text-center","cell"],[1,"text-left","cell"],[1,"text-center","cell"],["colspan","6",1,"text-left","cell"],["colspan","6",1,"text-center","cell"],["colspan","6",1,"cell"],[3,"innerHTML"],[1,"table-bordered",2,"width","100%"],[1,"cell",2,"width","50px"],[1,"text-center","cell",2,"width","50px"],[1,"text-center","cell",2,"width","134px"],[1,"text-center","cell",2,"width","137px"],[4,"ngFor","ngForOf"],["colspan","3",2,"font-size","12px"],[1,"text-center","cell","firma"],[2,"font-size","10px"],[2,"height","25px"],[2,"color","rgb(255,0,0)"],[1,"text-right","cell",2,"padding-right","5px"],[1,"cell",2,"padding-left","5px"],[1,"cell","obs",2,"padding-left","5px"],[1,"text-center","cell",2,"padding-left","5px"]],template:function(t,e){1&t&&(A.bc(0,"div",0),A.bc(1,"button",1),A.Vc(2,"Nueva orden"),A.ac(),A.Wb(3,"mat-divider",2),A.ac(),A.bc(4,"mat-card",3),A.bc(5,"mat-card-content",3),A.bc(6,"ngx-datatable",4),A.bc(7,"ngx-datatable-column",5),A.Tc(8,D,1,1,"ng-template",6),A.ac(),A.bc(9,"ngx-datatable-column",7),A.Tc(10,L,1,1,"ng-template",6),A.ac(),A.bc(11,"ngx-datatable-column",8),A.Tc(12,F,1,1,"ng-template",6),A.ac(),A.bc(13,"ngx-datatable-column",9),A.Tc(14,E,1,1,"ng-template",6),A.ac(),A.bc(15,"ngx-datatable-column",10),A.Tc(16,N,1,1,"ng-template",6),A.ac(),A.bc(17,"ngx-datatable-column",11),A.Tc(18,B,9,9,"ng-template",6),A.ac(),A.ac(),A.ac(),A.ac(),A.Tc(19,z,89,8,"div",12)),2&t&&(A.uc("@animate",A.Ac(19,q,A.zc(18,H))),A.Gb(1),A.uc("routerLink",A.zc(21,X)),A.Gb(2),A.uc("vertical",!0),A.Gb(1),A.uc("@animate",A.Ac(23,q,A.zc(22,J))),A.Gb(2),A.uc("rows",e.orders)("columnMode","flex")("headerHeight",50)("footerHeight",50)("scrollbarH",!0)("limit",10)("rowHeight",50),A.Gb(1),A.uc("flexGrow",1),A.Gb(2),A.uc("flexGrow",6),A.Gb(2),A.uc("flexGrow",3),A.Gb(2),A.uc("flexGrow",3),A.Gb(2),A.uc("flexGrow",3),A.Gb(2),A.uc("flexGrow",3),A.Gb(2),A.uc("ngIf",""!=e.orderPrint._id))},directives:[s.b,a.h,l.a,d.a,d.c,G.d,G.b,G.a,r.m,m.a,n.a,r.l],styles:['.cell[_ngcontent-%COMP%]{color:#000;font-size:12px}.print[_ngcontent-%COMP%]{display:none}.card[_ngcontent-%COMP%]:after{content:"";background:url(https://upload.wikimedia.org/wikipedia/commons/7/7d/Sanatorio_Mar%C3%ADtimo_de_Vi%C3%B1a_del_Mar.svg) no-repeat;opacity:.1;top:0;left:0;bottom:0;right:0;position:absolute;z-index:1;height:100%;width:100%;margin:20px}']}),t})();class U{constructor(t,e,c,r,a,o,i,n){this._id=t,this.order=e,this.item=c,this.cant=r,this.obs=a,this.code=o,this.costSector=i,this.cantReceived=n}}var $=c("Nptc"),K=c("AASI"),Q=c("kwbH"),Z=c("O4PR"),tt=c("sd1j"),et=c("FKr1"),ct=c("XiUz");function rt(t,e){if(1&t&&(A.bc(0,"small"),A.Vc(1),A.ac()),2&t){const t=A.nc().$implicit;A.Gb(1),A.Xc(" | ",t.brand,"")}}function at(t,e){if(1&t&&(A.bc(0,"mat-option",14),A.Vc(1),A.Tc(2,rt,2,1,"small",15),A.ac()),2&t){const t=e.$implicit;A.uc("value",t),A.Gb(1),A.Xc(" ",t.name," "),A.Gb(1),A.uc("ngIf",t.brand)}}function ot(t,e){if(1&t&&(A.bc(0,"mat-option",14),A.bc(1,"span"),A.Vc(2),A.ac(),A.ac()),2&t){const t=e.$implicit;A.uc("value",t.name),A.Gb(2),A.Wc(t.name)}}let it=(()=>{class t{constructor(t,e,c,r,a,o){this.data=t,this.dialogRef=e,this.snackBar=c,this._userService=r,this._itemService=a,this._sectorService=o,this.place="Articulo",this.tmpSectors=[],this.token=r.getToken(),this.identity=r.getIdentity()}ngOnInit(){if(this.data.payload){let t=this.data.payload;this.orderItem=new U("",t.order,t.item,t.cant,t.obs,t.code,t.costSector,0),this.place=this.orderItem.item.name+" | "+this.orderItem.item.brand}else this.orderItem=new U("",null,null,1,"","","",0);this.getItems(),this.getSectors()}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}submit(t){this.dialogRef.close(t?{delete:!0}:{item:this.orderItem})}getItems(){this._itemService.getList(this.token,{company:this.identity.company._id}).subscribe(t=>{t.items&&(this.items=t.items)},t=>{this.openSnackBar(t.message,"Cerrar")})}getSectors(){this._sectorService.getList(this.token).subscribe(t=>{t.sectors&&(this.sectors=t.sectors)},t=>{this.openSnackBar(t.message,"Cerrar")})}filterSector(t){this.tmpSectors=this.sectors.filter(e=>e.name.toLowerCase().includes(t.toString().toLowerCase()))}}return t.\u0275fac=function(e){return new(e||t)(A.Vb(u.a),A.Vb(u.g),A.Vb(R.a),A.Vb(O.a),A.Vb(Q.a),A.Vb(Z.a))},t.\u0275cmp=A.Pb({type:t,selectors:[["app-orderitem-popup"]],features:[A.Fb([Q.a,O.a,Z.a])],decls:23,vars:9,consts:[["matDialogTitle",""],[1,"p-0"],["fxLayout","row wrap","fxLayout.lt-sm","column"],["fxFlex","100",1,"pr-1"],[1,"full-width"],["name","item",3,"placeholder","ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["type","number","placeholder","Cantidad","aria-label","Text","min","1","matInput","","name","cant",3,"ngModel","ngModelChange"],["type","text","placeholder","Observacion","aria-label","Text","matInput","","name","obs",3,"ngModel","ngModelChange"],["type","text","placeholder","Centro de costo","aria-label","Text","matInput","","name","costSector",3,"ngModel","matAutocomplete","input","ngModelChange"],["autoActiveFirstOption",""],["autoSector","matAutocomplete"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"],[3,"value"],[4,"ngIf"]],template:function(t,e){if(1&t&&(A.bc(0,"h1",0),A.Vc(1),A.ac(),A.bc(2,"mat-card",1),A.bc(3,"mat-card-content"),A.bc(4,"form"),A.bc(5,"div",2),A.bc(6,"div",3),A.bc(7,"mat-form-field",4),A.bc(8,"mat-select",5),A.jc("ngModelChange",(function(t){return e.orderItem.item=t})),A.Tc(9,at,3,3,"mat-option",6),A.ac(),A.ac(),A.bc(10,"mat-form-field",4),A.bc(11,"input",7),A.jc("ngModelChange",(function(t){return e.orderItem.cant=t})),A.ac(),A.ac(),A.bc(12,"mat-form-field",4),A.bc(13,"input",8),A.jc("ngModelChange",(function(t){return e.orderItem.obs=t})),A.ac(),A.ac(),A.bc(14,"mat-form-field",4),A.bc(15,"input",9),A.jc("input",(function(t){return e.filterSector(t.target.value)}))("ngModelChange",(function(t){return e.orderItem.costSector=t})),A.ac(),A.bc(16,"mat-autocomplete",10,11),A.Tc(18,ot,3,2,"mat-option",6),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(19,"button",12),A.jc("click",(function(t){return e.submit()})),A.Vc(20,"Guardar"),A.ac(),A.bc(21,"button",13),A.jc("click",(function(t){return e.submit(!0)})),A.Vc(22,"Eliminar"),A.ac(),A.ac(),A.ac(),A.ac()),2&t){const t=A.Jc(17);A.Gb(1),A.Wc(e.data.title),A.Gb(7),A.uc("placeholder",e.place)("ngModel",e.orderItem.item),A.Gb(1),A.uc("ngForOf",e.items),A.Gb(2),A.uc("ngModel",e.orderItem.cant),A.Gb(2),A.uc("ngModel",e.orderItem.obs),A.Gb(2),A.uc("ngModel",e.orderItem.costSector)("matAutocomplete",t),A.Gb(3),A.uc("ngForOf",e.tmpSectors)}},directives:[d.a,d.c,o.x,o.o,o.p,ct.d,ct.b,b.a,x.a,o.n,o.q,r.l,o.s,i.b,o.c,f.c,f.a,s.b,et.p,r.m],encapsulation:2}),t})();var nt=c("3kSh");function st(t,e){1&t&&A.Vc(0,"Orden")}function dt(t,e){if(1&t&&(A.bc(0,"mat-option",35),A.bc(1,"span"),A.Vc(2),A.ac(),A.ac()),2&t){const t=e.$implicit;A.uc("value",t.name),A.Gb(2),A.Wc(t.name)}}function lt(t,e){if(1&t){const t=A.cc();A.bc(0,"mat-step",18),A.Tc(1,st,1,0,"ng-template",4),A.bc(2,"form"),A.bc(3,"div",5),A.bc(4,"div",19),A.bc(5,"div",7),A.bc(6,"mat-form-field",20),A.bc(7,"mat-label"),A.Vc(8,"Fecha"),A.ac(),A.bc(9,"input",21),A.jc("ngModelChange",(function(e){return A.Mc(t),A.nc().order.date=e})),A.ac(),A.Wb(10,"mat-datepicker-toggle",22),A.Wb(11,"mat-datepicker",null,23),A.ac(),A.ac(),A.bc(13,"div",7),A.bc(14,"mat-form-field",20),A.bc(15,"input",24),A.jc("input",(function(e){return A.Mc(t),A.nc().filterSector(e.target.value)}))("ngModelChange",(function(e){return A.Mc(t),A.nc().order.sectorDestiny=e})),A.ac(),A.bc(16,"mat-autocomplete",25,26),A.Tc(18,dt,3,2,"mat-option",27),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(19,"div",28),A.bc(20,"div",7),A.bc(21,"mat-form-field",20),A.bc(22,"mat-label"),A.Vc(23,"Fecha de entrega requerida"),A.ac(),A.bc(24,"input",29),A.jc("ngModelChange",(function(e){return A.Mc(t),A.nc().order.dateRequired=e})),A.ac(),A.Wb(25,"mat-datepicker-toggle",22),A.Wb(26,"mat-datepicker",null,30),A.ac(),A.ac(),A.bc(28,"div",7),A.bc(29,"mat-form-field",20),A.bc(30,"input",31),A.jc("ngModelChange",(function(e){return A.Mc(t),A.nc().order.obs=e})),A.ac(),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(31,"div",5),A.bc(32,"div",6),A.bc(33,"quill-editor",32),A.jc("ngModelChange",(function(e){return A.Mc(t),A.nc().order.justification=e})),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(34,"div",33),A.bc(35,"button",34),A.Vc(36,"Siguiente"),A.ac(),A.ac(),A.ac()}if(2&t){const t=A.Jc(12),e=A.Jc(17),c=A.Jc(27),r=A.nc();A.Gb(9),A.uc("ngModel",r.order.date)("matDatepicker",t),A.Gb(1),A.uc("for",t),A.Gb(5),A.uc("ngModel",r.order.sectorDestiny)("matAutocomplete",e),A.Gb(3),A.uc("ngForOf",r.tmpSectors),A.Gb(6),A.uc("ngModel",r.order.dateRequired)("matDatepicker",c),A.Gb(1),A.uc("for",c),A.Gb(5),A.uc("ngModel",r.order.obs),A.Gb(3),A.uc("modules",r.config)("ngModel",r.order.justification)}}function bt(t,e){1&t&&A.Vc(0,"Articulos")}function ut(t,e){1&t&&A.Vc(0),2&t&&A.Xc(" ",e.rowIndex+1," ")}function mt(t,e){1&t&&A.Vc(0),2&t&&A.Xc(" ",e.row.cant," ")}function pt(t,e){if(1&t&&(A.bc(0,"small",36),A.Vc(1),A.ac()),2&t){const t=A.nc().row;A.uc("matTooltip",t.item.name+" | "+t.item.brand),A.Gb(1),A.Xc(" | ",t.item.brand,"")}}function ht(t,e){if(1&t&&(A.bc(0,"span",36),A.Vc(1),A.ac(),A.Tc(2,pt,2,2,"small",37)),2&t){const t=e.row;A.uc("matTooltip",t.item.name+" | "+t.item.brand),A.Gb(1),A.Wc(t.item.name),A.Gb(1),A.uc("ngIf",t.item.brand)}}function gt(t,e){if(1&t&&(A.bc(0,"span",36),A.Vc(1),A.ac()),2&t){const t=e.row;A.uc("matTooltip",t.obs),A.Gb(1),A.Wc(t.obs)}}function ft(t,e){if(1&t&&(A.bc(0,"span",36),A.Vc(1),A.ac()),2&t){const t=e.row;A.uc("matTooltip",t.costSector),A.Gb(1),A.Wc(t.costSector)}}function xt(t,e){if(1&t){const t=A.cc();A.bc(0,"button",38),A.jc("click",(function(e){return A.Mc(t),A.nc().send(!1)})),A.Vc(1,"Guardar"),A.ac()}}function vt(t,e){if(1&t){const t=A.cc();A.bc(0,"button",38),A.jc("click",(function(e){return A.Mc(t),A.nc().send(!1)})),A.Vc(1,"Enviar a autorizar"),A.ac()}}function wt(t,e){if(1&t){const t=A.cc();A.bc(0,"button",38),A.jc("click",(function(e){return A.Mc(t),A.nc().send(!0)})),A.Vc(1,"Crear y autorizar"),A.ac()}}function kt(t,e){if(1&t){const t=A.cc();A.bc(0,"button",38),A.jc("click",(function(e){return A.Mc(t),A.nc().send(!0)})),A.Vc(1,"Autorizar"),A.ac()}}let It=(()=>{class t{constructor(t,e,c,r,a,o,i,n,s,d,l){this._userService=t,this.snackBar=e,this._router=c,this.loader=r,this.dialog=a,this.confirmService=o,this._orderService=i,this._orderItemService=n,this._stockService=s,this._depositService=d,this._sectorService=l,this.config=C.a.richTextModule,this.tmpItems=[],this.tmpSectors=[],this.token=t.getToken(),this.identity=t.getIdentity(),this.order=new M("",null,new Date,new Date,null,this.identity.company._id,null,"","","No creado"),this.orderItem=new U("","",null,1,"","","",0)}ngOnInit(){this.order.dateRequired.setMonth(this.order.dateRequired.getMonth()+1),this.getDeposits(),this.getSectors()}getSectors(){this._sectorService.getList(this.token).subscribe(t=>{t.sectors&&(this.sectors=t.sectors)},t=>{this.openSnackBar(t.message,"Cerrar")})}getDeposits(){this._depositService.getList(this.token,{company:this.identity.company._id}).subscribe(t=>{if(t.deposits){let e=new Array;t.deposits.forEach(t=>{e.push(t._id)}),this.getStockMissing(e)}},t=>{console.error(t)})}getStockMissing(t){this._stockService.getList(this.token,{deposit:t,onOrder:!1,$where:"this.cant < this.cantMin"}).subscribe(t=>{t.stocks&&(this.orderItems=new Array,this.lowStocks=t.stocks,0!=this.lowStocks.length&&this.confirmService.confirm({message:"Existen insumos por debajo del stock minimo \xbfDeseas a\xf1adirlos a esta orden?"}).subscribe(t=>{t&&(this.lowStocks.forEach(t=>{let e=new U("",null,t.item,t.cantMin-t.cant,"","",null,0);this.orderItems.push(e)}),this.orderItems=[...this.orderItems])}))},t=>{console.error(t)})}filterSector(t){this.tmpSectors=this.sectors.filter(e=>e.name.toLowerCase().includes(t.toString().toLowerCase()))}getLenght(t){return t.length}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}onActivate(t){"click"==t.type&&this.newItem(!1,t.row)}newItem(t,e){this.dialog.open(it,{width:"720px",disableClose:!1,data:{payload:e,title:t?"Nuevo articulo":"Editar articulo"}}).afterClosed().subscribe(c=>{if(c){if(c.delete)this.orderItems.splice(this.orderItems.indexOf(e),1),this.orderItems=[...this.orderItems];else{let r=new U("",null,c.item.item,c.item.cant,c.item.obs,c.item.code,c.item.costSector,0);this.loader.open(),t?this.orderItems=this.orderItems.concat([r]):(e.cant=r.cant,e.item=r.item,e.obs=r.obs,e.costSector=r.costSector)}this.loader.close()}})}send(t){this.order.status=t?"Autorizado":"Pendiente",this._orderService.add(this.token,this.order).subscribe(e=>{if(e.order){let c=e.order,r={onOrder:!0};this.orderItems.forEach(t=>{t.order=c._id,this._stockService.editMany(this.token,t.item._id,r).subscribe(t=>{},t=>{console.error(t)}),this._orderItemService.add(this.token,t).subscribe(t=>{},t=>{console.error(t)})}),this.openSnackBar(t?"Pedido autorizado":"Pedido enviado para autorizar","Cerrar"),this._router.navigate(["deposit/home"])}},t=>{this.openSnackBar(t.message,"Cerrar")})}}return t.\u0275fac=function(e){return new(e||t)(A.Vb(O.a),A.Vb(R.a),A.Vb(a.g),A.Vb(V.a),A.Vb(u.b),A.Vb(nt.a),A.Vb(_.a),A.Vb(y.a),A.Vb($.a),A.Vb(K.a),A.Vb(Z.a))},t.\u0275cmp=A.Pb({type:t,selectors:[["app-new-order"]],features:[A.Fb([{provide:et.c,useClass:tt.b},{provide:et.f,useValue:tt.a},_.a,y.a,$.a,K.a,Q.a,Z.a])],decls:29,vars:18,consts:[[1,"p-0"],[3,"linear"],["id","orderStep",4,"ngIf"],["id","orderItemsStep"],["matStepLabel",""],["fxLayout","row wrap"],["fxFlex","100","fxFlex.gt-xs","100",1,"pr-1"],[1,"pb-1"],["mat-raised-button","","color","primary",3,"disabled","click"],[1,"material","bg-white",3,"rows","columnMode","headerHeight","footerHeight","limit","rowHeight","activate"],["name","Item",3,"flexGrow"],["ngx-datatable-cell-template",""],["name","Cantidad",3,"flexGrow"],["name","Descripci\xf3n",3,"flexGrow"],["name","Observaci\xf3n",3,"flexGrow"],["name","Centro de costo",3,"flexGrow"],["mat-raised-button","","color","primary","matStepperNext","",3,"click",4,"ngIf"],["fxFlex","16px"],["id","orderStep"],["fxFlex","100","fxFlex.gt-xs","50",1,"pr-1"],[1,"full-width"],["matInput","","name","date",3,"ngModel","matDatepicker","ngModelChange"],["matSuffix","",3,"for"],["date",""],["type","text","placeholder","Destino","aria-label","Text","matInput","","name","sectorDestiny",3,"ngModel","matAutocomplete","input","ngModelChange"],["autoActiveFirstOption",""],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["fxFlex","100","fxFlex.gt-xs","50"],["matInput","","name","dateRequired",3,"ngModel","matDatepicker","ngModelChange"],["dateRequired",""],["type","text","placeholder","Observaciones","aria-label","Text","matInput","","name","obs",3,"ngModel","ngModelChange"],["theme","snow","placeholder","Justificativo de compra","name","justification",3,"modules","ngModel","ngModelChange"],[2,"margin-top","50px"],["mat-raised-button","","color","primary","matStepperNext",""],[3,"value"],[3,"matTooltip"],[3,"matTooltip",4,"ngIf"],["mat-raised-button","","color","primary","matStepperNext","",3,"click"]],template:function(t,e){1&t&&(A.bc(0,"mat-card",0),A.bc(1,"mat-card-content"),A.bc(2,"mat-horizontal-stepper",1),A.Tc(3,lt,37,12,"mat-step",2),A.bc(4,"mat-step",3),A.Tc(5,bt,1,0,"ng-template",4),A.bc(6,"form"),A.bc(7,"div",5),A.bc(8,"div",6),A.bc(9,"div",7),A.bc(10,"button",8),A.jc("click",(function(t){return e.newItem(!0)})),A.Vc(11,"A\xf1adir articulo"),A.ac(),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(12,"ngx-datatable",9),A.jc("activate",(function(t){return e.onActivate(t)})),A.bc(13,"ngx-datatable-column",10),A.Tc(14,ut,1,1,"ng-template",11),A.ac(),A.bc(15,"ngx-datatable-column",12),A.Tc(16,mt,1,1,"ng-template",11),A.ac(),A.bc(17,"ngx-datatable-column",13),A.Tc(18,ht,3,3,"ng-template",11),A.ac(),A.bc(19,"ngx-datatable-column",14),A.Tc(20,gt,2,2,"ng-template",11),A.ac(),A.bc(21,"ngx-datatable-column",15),A.Tc(22,ft,2,2,"ng-template",11),A.ac(),A.ac(),A.bc(23,"div"),A.Tc(24,xt,2,0,"button",16),A.Tc(25,vt,2,0,"button",16),A.Wb(26,"span",17),A.Tc(27,wt,2,0,"button",16),A.Tc(28,kt,2,0,"button",16),A.ac(),A.ac(),A.ac(),A.ac(),A.ac()),2&t&&(A.Gb(2),A.uc("linear",!0),A.Gb(1),A.uc("ngIf","ROLE_ADMIN"==e.identity.role),A.Gb(7),A.uc("disabled","No creado"!=e.order.status&&"ROLE_ADMIN"!=e.identity.role||"Autorizado"==e.order.status||"Finalizado"==e.order.status),A.Gb(2),A.uc("rows",e.orderItems)("columnMode","flex")("headerHeight",40)("footerHeight",50)("limit",10)("rowHeight",45),A.Gb(1),A.uc("flexGrow",1),A.Gb(2),A.uc("flexGrow",1),A.Gb(2),A.uc("flexGrow",7),A.Gb(2),A.uc("flexGrow",7),A.Gb(2),A.uc("flexGrow",3),A.Gb(3),A.uc("ngIf","Pendiente"==e.order.status&&"ROLE_ADMIN"==e.identity.role),A.Gb(1),A.uc("ngIf","No creado"==e.order.status),A.Gb(2),A.uc("ngIf","No creado"==e.order.status&&"ROLE_ADMIN"==e.identity.role),A.Gb(1),A.uc("ngIf","Pendiente"==e.order.status&&"ROLE_ADMIN"==e.identity.role))},directives:[d.a,d.c,w.a,r.m,w.b,w.c,o.x,o.o,o.p,ct.d,ct.b,s.b,G.d,G.b,G.a,b.a,b.d,i.b,o.c,v.b,o.n,o.q,v.d,b.e,v.a,f.c,f.a,r.l,S.a,w.e,et.p,m.a],styles:[".butt[_ngcontent-%COMP%]{background-color:#018aca}.butt[_ngcontent-%COMP%], .butt-trash[_ngcontent-%COMP%]{font-size:12px;font-weight:300;color:#fff;display:inline-block;transition:all .5s;cursor:pointer;padding:10px 15px!important;text-transform:uppercase;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;text-align:center}.butt-trash[_ngcontent-%COMP%]{background-color:#ff1717}"]}),t})();function St(t,e){1&t&&A.Vc(0,"Orden")}function Gt(t,e){if(1&t&&(A.bc(0,"mat-option",35),A.bc(1,"span"),A.Vc(2),A.ac(),A.ac()),2&t){const t=e.$implicit;A.uc("value",t.name),A.Gb(2),A.Wc(t.name)}}function Mt(t,e){if(1&t){const t=A.cc();A.bc(0,"mat-step",18),A.Tc(1,St,1,0,"ng-template",4),A.bc(2,"form"),A.bc(3,"div",5),A.bc(4,"div",19),A.bc(5,"div",7),A.bc(6,"mat-form-field",20),A.bc(7,"mat-label"),A.Vc(8,"Fecha"),A.ac(),A.bc(9,"input",21),A.jc("ngModelChange",(function(e){return A.Mc(t),A.nc().order.date=e})),A.ac(),A.Wb(10,"mat-datepicker-toggle",22),A.Wb(11,"mat-datepicker",null,23),A.ac(),A.ac(),A.bc(13,"div",7),A.bc(14,"mat-form-field",20),A.bc(15,"input",24),A.jc("input",(function(e){return A.Mc(t),A.nc().filterSector(e.target.value)}))("ngModelChange",(function(e){return A.Mc(t),A.nc().order.sectorDestiny=e})),A.ac(),A.bc(16,"mat-autocomplete",25,26),A.Tc(18,Gt,3,2,"mat-option",27),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(19,"div",28),A.bc(20,"div",7),A.bc(21,"mat-form-field",20),A.bc(22,"mat-label"),A.Vc(23,"Fecha de entrega requerida"),A.ac(),A.bc(24,"input",29),A.jc("ngModelChange",(function(e){return A.Mc(t),A.nc().order.dateRequired=e})),A.ac(),A.Wb(25,"mat-datepicker-toggle",22),A.Wb(26,"mat-datepicker",null,30),A.ac(),A.ac(),A.bc(28,"div",7),A.bc(29,"mat-form-field",20),A.bc(30,"input",31),A.jc("ngModelChange",(function(e){return A.Mc(t),A.nc().order.obs=e})),A.ac(),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(31,"div",5),A.bc(32,"div",6),A.bc(33,"quill-editor",32),A.jc("ngModelChange",(function(e){return A.Mc(t),A.nc().order.justification=e})),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(34,"div",33),A.bc(35,"button",34),A.Vc(36,"Siguiente"),A.ac(),A.ac(),A.ac()}if(2&t){const t=A.Jc(12),e=A.Jc(17),c=A.Jc(27),r=A.nc();A.Gb(9),A.uc("ngModel",r.order.date)("matDatepicker",t),A.Gb(1),A.uc("for",t),A.Gb(5),A.uc("ngModel",r.order.sectorDestiny)("matAutocomplete",e),A.Gb(3),A.uc("ngForOf",r.tmpSectors),A.Gb(6),A.uc("ngModel",r.order.dateRequired)("matDatepicker",c),A.Gb(1),A.uc("for",c),A.Gb(5),A.uc("ngModel",r.order.obs),A.Gb(3),A.uc("modules",r.config)("ngModel",r.order.justification)}}function Vt(t,e){1&t&&A.Vc(0,"Articulos")}function _t(t,e){1&t&&A.Vc(0),2&t&&A.Xc(" ",e.rowIndex+1," ")}function yt(t,e){1&t&&A.Vc(0),2&t&&A.Xc(" ",e.row.cant," ")}function Ct(t,e){if(1&t&&(A.bc(0,"small",36),A.Vc(1),A.ac()),2&t){const t=A.nc().row;A.uc("matTooltip",t.item.name+" | "+t.item.brand),A.Gb(1),A.Xc(" | ",t.item.brand,"")}}function Ot(t,e){if(1&t&&(A.bc(0,"span",36),A.Vc(1),A.ac(),A.Tc(2,Ct,2,2,"small",37)),2&t){const t=e.row;A.uc("matTooltip",t.item.name+" | "+t.item.brand),A.Gb(1),A.Wc(t.item.name),A.Gb(1),A.uc("ngIf",t.item.brand)}}function Tt(t,e){if(1&t&&(A.bc(0,"span",36),A.Vc(1),A.ac()),2&t){const t=e.row;A.uc("matTooltip",t.obs),A.Gb(1),A.Wc(t.obs)}}function At(t,e){if(1&t&&(A.bc(0,"span",36),A.Vc(1),A.ac()),2&t){const t=e.row;A.uc("matTooltip",t.costSector),A.Gb(1),A.Wc(t.costSector)}}function Rt(t,e){if(1&t){const t=A.cc();A.bc(0,"button",38),A.jc("click",(function(e){return A.Mc(t),A.nc().send(!1)})),A.Vc(1,"Guardar"),A.ac()}}function Dt(t,e){if(1&t){const t=A.cc();A.bc(0,"button",38),A.jc("click",(function(e){return A.Mc(t),A.nc().send(!1)})),A.Vc(1,"Enviar a autorizar"),A.ac()}}function Lt(t,e){if(1&t){const t=A.cc();A.bc(0,"button",38),A.jc("click",(function(e){return A.Mc(t),A.nc().send(!0)})),A.Vc(1,"Crear y autorizar"),A.ac()}}function Ft(t,e){if(1&t){const t=A.cc();A.bc(0,"button",38),A.jc("click",(function(e){return A.Mc(t),A.nc().send(!0)})),A.Vc(1,"Autorizar"),A.ac()}}let Et=(()=>{class t{constructor(t,e,c,r,a,o,i,n,s,d){this._userService=t,this.snackBar=e,this._router=c,this.loader=r,this.dialog=a,this._route=o,this._stockService=i,this._orderService=n,this._orderItemService=s,this._sectorService=d,this.config=C.a.richTextModule,this.tmpItems=[],this.tmpSectors=[],this.addOrderItems=new Array,this.deleteOrderItems=new Array,this.editOrderItems=new Array,this.token=t.getToken(),this.identity=t.getIdentity(),this.order=new M("",null,new Date,new Date,null,this.identity.company._id,null,"","","No creado")}ngOnInit(){this.getSectors(),this.getOrders()}getOrders(){this._route.params.forEach(t=>{this._orderService.getOne(this.token,t.id).subscribe(t=>{t.order?(this.order=t.order,this._orderItemService.getList(this.token,{order:this.order._id}).subscribe(t=>{t.orderItems&&(this.orderItems=t.orderItems)},t=>{this.openSnackBar(t.message,"Cerrar")})):(this.openSnackBar("Orden no encontrada","Cerrar"),this._router.navigate(["deposit/home"]))},t=>{this._router.navigate(["deposit/home"]),this.openSnackBar(t.message,"Cerrar")})})}getSectors(){this._sectorService.getList(this.token).subscribe(t=>{t.sectors&&(this.sectors=t.sectors)},t=>{this.openSnackBar(t.message,"Cerrar")})}filterSector(t){this.tmpSectors=this.sectors.filter(e=>e.name.toLowerCase().includes(t.toString().toLowerCase()))}getLenght(t){return t.length}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}onActivate(t){"click"==t.type&&this.newItem(!1,t.row)}newItem(t,e){this.dialog.open(it,{width:"720px",disableClose:!1,data:{payload:e,title:t?"Nuevo articulo":"Editar articulo"}}).afterClosed().subscribe(c=>{if(c){if(c.delete)""!=e._id?this.deleteOrderItems.push(e):this.addOrderItems.splice(this.addOrderItems.indexOf(e),1),this.orderItems.splice(this.orderItems.indexOf(e),1),this.orderItems=[...this.orderItems];else{let r=new U("",null,c.item.item,c.item.cant,c.item.obs,c.item.code,c.item.costSector,0);this.loader.open(),t?(this.addOrderItems.push(r),this.orderItems=this.orderItems.concat([r])):(e.cant=r.cant,e.item=r.item,e.obs=r.obs,e.costSector=r.costSector,""!=e._id&&this.editOrderItems.push(e))}this.loader.close()}})}send(t){this.order.status=t?"Autorizado":"Pendiente",this._orderService.edit(this.token,this.order._id,this.order).subscribe(e=>{e.order&&(this.addOrderItems.forEach(t=>{t.order=this.order._id,this._orderItemService.add(this.token,t).subscribe(t=>{},t=>{})}),this.editOrderItems.forEach(t=>{this._orderItemService.edit(this.token,t._id,t).subscribe(t=>{},t=>{})}),this.deleteOrderItems.forEach(t=>{this._orderItemService.delete(this.token,t._id).subscribe(t=>{},t=>{})}),this.openSnackBar(t?"Pedido autorizado":"Pedido guardado","Cerrar"),this._router.navigate(["deposit/home"]))},t=>{this.openSnackBar(t.message,"Cerrar")})}}return t.\u0275fac=function(e){return new(e||t)(A.Vb(O.a),A.Vb(R.a),A.Vb(a.g),A.Vb(V.a),A.Vb(u.b),A.Vb(a.a),A.Vb($.a),A.Vb(_.a),A.Vb(y.a),A.Vb(Z.a))},t.\u0275cmp=A.Pb({type:t,selectors:[["app-new-order"]],features:[A.Fb([{provide:et.c,useClass:tt.b},{provide:et.f,useValue:tt.a},_.a,y.a,Q.a,Z.a,$.a])],decls:29,vars:18,consts:[[1,"p-0"],[3,"linear"],["id","orderStep",4,"ngIf"],["id","orderItemsStep"],["matStepLabel",""],["fxLayout","row wrap"],["fxFlex","100","fxFlex.gt-xs","100",1,"pr-1"],[1,"pb-1"],["mat-raised-button","","color","primary",3,"disabled","click"],[1,"material","bg-white",3,"rows","columnMode","headerHeight","footerHeight","limit","rowHeight","activate"],["name","Item",3,"flexGrow"],["ngx-datatable-cell-template",""],["name","Cantidad",3,"flexGrow"],["name","Descripci\xf3n",3,"flexGrow"],["name","Observaci\xf3n",3,"flexGrow"],["name","Centro de costo",3,"flexGrow"],["mat-raised-button","","color","primary","matStepperNext","",3,"click",4,"ngIf"],["fxFlex","16px"],["id","orderStep"],["fxFlex","100","fxFlex.gt-xs","50",1,"pr-1"],[1,"full-width"],["matInput","","name","date",3,"ngModel","matDatepicker","ngModelChange"],["matSuffix","",3,"for"],["date",""],["type","text","placeholder","Destino","aria-label","Text","matInput","","name","sectorDestiny",3,"ngModel","matAutocomplete","input","ngModelChange"],["autoActiveFirstOption",""],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["fxFlex","100","fxFlex.gt-xs","50"],["matInput","","name","dateRequired",3,"ngModel","matDatepicker","ngModelChange"],["dateRequired",""],["type","text","placeholder","Observaciones","aria-label","Text","matInput","","name","obs",3,"ngModel","ngModelChange"],["theme","snow","placeholder","Justificativo de compra","name","justification",3,"modules","ngModel","ngModelChange"],[2,"margin-top","50px"],["mat-raised-button","","color","primary","matStepperNext",""],[3,"value"],[3,"matTooltip"],[3,"matTooltip",4,"ngIf"],["mat-raised-button","","color","primary","matStepperNext","",3,"click"]],template:function(t,e){1&t&&(A.bc(0,"mat-card",0),A.bc(1,"mat-card-content"),A.bc(2,"mat-horizontal-stepper",1),A.Tc(3,Mt,37,12,"mat-step",2),A.bc(4,"mat-step",3),A.Tc(5,Vt,1,0,"ng-template",4),A.bc(6,"form"),A.bc(7,"div",5),A.bc(8,"div",6),A.bc(9,"div",7),A.bc(10,"button",8),A.jc("click",(function(t){return e.newItem(!0)})),A.Vc(11,"A\xf1adir articulo"),A.ac(),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(12,"ngx-datatable",9),A.jc("activate",(function(t){return e.onActivate(t)})),A.bc(13,"ngx-datatable-column",10),A.Tc(14,_t,1,1,"ng-template",11),A.ac(),A.bc(15,"ngx-datatable-column",12),A.Tc(16,yt,1,1,"ng-template",11),A.ac(),A.bc(17,"ngx-datatable-column",13),A.Tc(18,Ot,3,3,"ng-template",11),A.ac(),A.bc(19,"ngx-datatable-column",14),A.Tc(20,Tt,2,2,"ng-template",11),A.ac(),A.bc(21,"ngx-datatable-column",15),A.Tc(22,At,2,2,"ng-template",11),A.ac(),A.ac(),A.bc(23,"div"),A.Tc(24,Rt,2,0,"button",16),A.Tc(25,Dt,2,0,"button",16),A.Wb(26,"span",17),A.Tc(27,Lt,2,0,"button",16),A.Tc(28,Ft,2,0,"button",16),A.ac(),A.ac(),A.ac(),A.ac(),A.ac()),2&t&&(A.Gb(2),A.uc("linear",!0),A.Gb(1),A.uc("ngIf","ROLE_ADMIN"==e.identity.role),A.Gb(7),A.uc("disabled","No creado"!=e.order.status&&"ROLE_ADMIN"!=e.identity.role||"Autorizado"==e.order.status||"Finalizado"==e.order.status),A.Gb(2),A.uc("rows",e.orderItems)("columnMode","flex")("headerHeight",40)("footerHeight",50)("limit",10)("rowHeight",45),A.Gb(1),A.uc("flexGrow",1),A.Gb(2),A.uc("flexGrow",1),A.Gb(2),A.uc("flexGrow",7),A.Gb(2),A.uc("flexGrow",7),A.Gb(2),A.uc("flexGrow",3),A.Gb(3),A.uc("ngIf","Pendiente"==e.order.status&&"ROLE_ADMIN"==e.identity.role),A.Gb(1),A.uc("ngIf","No creado"==e.order.status),A.Gb(2),A.uc("ngIf","No creado"==e.order.status&&"ROLE_ADMIN"==e.identity.role),A.Gb(1),A.uc("ngIf","Pendiente"==e.order.status&&"ROLE_ADMIN"==e.identity.role))},directives:[d.a,d.c,w.a,r.m,w.b,w.c,o.x,o.o,o.p,ct.d,ct.b,s.b,G.d,G.b,G.a,b.a,b.d,i.b,o.c,v.b,o.n,o.q,v.d,b.e,v.a,f.c,f.a,r.l,S.a,w.e,et.p,m.a],styles:[".butt[_ngcontent-%COMP%]{background-color:#018aca}.butt[_ngcontent-%COMP%], .butt-trash[_ngcontent-%COMP%]{font-size:12px;font-weight:300;color:#fff;display:inline-block;transition:all .5s;cursor:pointer;padding:10px 15px!important;text-transform:uppercase;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;text-align:center}.butt-trash[_ngcontent-%COMP%]{background-color:#ff1717}"]}),t})();var Nt=c("vHsL"),Pt=c("49gX");function jt(t,e){if(1&t&&(A.bc(0,"mat-option",15),A.Vc(1),A.ac()),2&t){const t=e.$implicit;A.uc("value",t),A.Gb(1),A.Xc(" ",t.name," ")}}function Bt(t,e){1&t&&A.Vc(0),2&t&&A.Xc(" ",e.rowIndex+1," ")}function Wt(t,e){if(1&t&&(A.bc(0,"span",16),A.Vc(1),A.bc(2,"small"),A.Vc(3),A.ac(),A.ac()),2&t){const t=e.row;A.uc("matTooltip",t.item.name+" "+t.item.brand),A.Gb(1),A.Xc(" ",t.item.name," "),A.Gb(2),A.Wc(t.item.brand)}}function zt(t,e){if(1&t&&(A.bc(0,"span",16),A.Vc(1),A.ac()),2&t){const t=e.row;A.uc("matTooltip",t.obs),A.Gb(1),A.Xc(" ",t.obs," ")}}function Ht(t,e){if(1&t&&A.Vc(0),2&t){const t=e.row;A.Xc(" ",t.cant-t.cantReceived," ")}}function qt(t,e){if(1&t){const t=A.cc();A.bc(0,"input",17),A.jc("ngModelChange",(function(c){return A.Mc(t),e.row.cantReceived=c})),A.ac()}if(2&t){const t=e.row;A.uc("min",t.cantReceived2)("max",t.cant)("ngModel",t.cantReceived)}}const Xt=function(){return["/deposit/order/list"]},Jt=[{path:"",children:[{path:"new",component:It,data:{title:"Nueva orden",breadcrumb:"NUEVA ORDEN"}},{path:"get/:id",component:Et,data:{title:"Orden",breadcrumb:"ORDEN"}},{path:"list",component:Y,data:{title:"Orden",breadcrumb:"ORDEN"}},{path:"receive/:id",component:(()=>{class t{constructor(t,e,c,r,a,o,i,n,s,d,l,b){this._userService=t,this.snackBar=e,this._router=c,this.loader=r,this.dialog=a,this.confirmService=o,this._route=i,this._movimService=n,this._orderService=s,this._orderItemService=d,this._stockService=l,this._depositService=b,this.token=t.getToken(),this.identity=t.getIdentity(),this.order=new M("",null,new Date,new Date,null,this.identity.company._id,null,"","","No creado")}ngOnInit(){this.order.dateRequired.setMonth(this.order.dateRequired.getMonth()+1),this.getDeposits(),this.getOrders(),this.getStocks()}getStocks(){this._stockService.getList(this.token,{}).subscribe(t=>{t.stocks&&(this.stocks=t.stocks)},t=>{this.openSnackBar(t.message,"Cerrar")})}getDeposits(){this._depositService.getList(this.token,{company:this.identity.company._id}).subscribe(t=>{t.deposits&&(this.deposits=t.deposits,this.deposit=this.deposits[0])},t=>{console.error(t)})}getOrders(){this._route.params.forEach(t=>{this._orderService.getOne(this.token,t.id).subscribe(t=>{t.order?(this.order=t.order,this._orderItemService.getList(this.token,{order:this.order._id}).subscribe(t=>{t.orderItems&&(this.orderItems=t.orderItems,this.orderItems.forEach(t=>{t.cantReceived2=t.cantReceived}))},t=>{this.openSnackBar(t.message,"Cerrar")})):(this.openSnackBar("Orden no encontrada","Cerrar"),this._router.navigate(["deposit/home"]))},t=>{this._router.navigate(["deposit/home"]),this.openSnackBar(t.message,"Cerrar")})})}getLenght(t){return t.length}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}send(){let t=!0,e=!0,c="";return this.orderItems.forEach(r=>{(r.cant-r.cantReceived<0||r.cant<r.cant-r.cantReceived)&&(t=!1),r.cantReceived-r.cantReceived2>0&&!this.existStock(r.item._id,this.deposit._id)&&(c=c+r.item.name+" "+r.item.brand+", "),r.cant-r.cantReceived>0&&(e=!1)}),t?""!=c?this.openSnackBar("Los siguientes items no estan habilitados en el dep\xf3sito: "+c+"verificar.","Cerrar"):(""==c&&t&&this.orderItems.forEach(t=>{t.cantReceived-t.cantReceived2>0&&this._orderItemService.edit(this.token,t._id,{cantReceived:t.cantReceived}).subscribe(e=>{if(e.orderItem){setTimeout(()=>{this.addMovim(t)},1e3*Math.random());let e=!1;t.cant==t.cantReceived&&(e=!0),this.editStock(t.item._id,this.deposit._id,t.cantReceived-t.cantReceived2,e)}},t=>{this.openSnackBar(t.message,"Cerrar")})}),e&&this._orderService.edit(this.token,this.order._id,{status:"Recibido"}).subscribe(t=>{},t=>{this.openSnackBar(t.message,"Cerrar")}),this.openSnackBar("Movimiento realizado correctamente","Cerrar"),void this._router.navigate(["deposit/order/list"])):this.openSnackBar("Hay valores que no coinciden en lo que se recibe.","Cerrar")}addMovim(t){let e=new Pt.a("",null,"Pedido",this.deposit._id,t.item._id,this.identity.company._id,t.cantReceived-t.cantReceived2,this.identity._id,null,new Date,new Date,null,null,null,null,"");this._movimService.add(this.token,e).subscribe(t=>{},t=>{this.openSnackBar(t.message,"Cerrar")})}editStock(t,e,c,r){let a={$inc:{cant:c}};r&&(a.onOrder=!1);let o=this.stocks.findIndex((function(c){return c.deposit._id==e&&c.item._id==t}));this._stockService.edit(this.token,this.stocks[o]._id,a).subscribe(t=>{},t=>{this.openSnackBar(t.message,"Cerrar")})}existStock(t,e){return-1!=this.stocks.findIndex((function(c){return c.deposit._id==e&&c.item._id==t}))}}return t.\u0275fac=function(e){return new(e||t)(A.Vb(O.a),A.Vb(R.a),A.Vb(a.g),A.Vb(V.a),A.Vb(u.b),A.Vb(nt.a),A.Vb(a.a),A.Vb(Nt.a),A.Vb(_.a),A.Vb(y.a),A.Vb($.a),A.Vb(K.a))},t.\u0275cmp=A.Pb({type:t,selectors:[["app-receive-order"]],features:[A.Fb([_.a,y.a,$.a,K.a,Nt.a])],decls:24,vars:15,consts:[[1,"p-0"],[1,"full-width",2,"margin-top","20px","padding-bottom","0px","padding-top","0px"],["placeholder","Dep\xf3sito","name","deposit",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"material","bg-white",3,"rows","columnMode","headerHeight","footerHeight","limit","rowHeight"],["name","Item",3,"flexGrow"],["ngx-datatable-cell-template",""],["name","Articulo",3,"flexGrow"],["name","Observaciones",3,"flexGrow"],["name","Faltante",3,"flexGrow"],["name","Recibido",3,"flexGrow"],["ngx-datatable-cell-template","","style","padding-bottom: 10px;"],["mat-raised-button","","color","accent",3,"routerLink"],["fxFlex","16px"],["mat-raised-button","","color","primary",3,"click"],[3,"value"],[3,"matTooltip"],["type","number","matInput","",2,"border","0",3,"min","max","ngModel","ngModelChange"]],template:function(t,e){1&t&&(A.bc(0,"mat-card",0),A.bc(1,"mat-card-content"),A.bc(2,"mat-form-field",1),A.bc(3,"mat-select",2),A.jc("ngModelChange",(function(t){return e.deposit=t})),A.Tc(4,jt,2,2,"mat-option",3),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(5,"mat-card",0),A.bc(6,"mat-card-content"),A.bc(7,"ngx-datatable",4),A.bc(8,"ngx-datatable-column",5),A.Tc(9,Bt,1,1,"ng-template",6),A.ac(),A.bc(10,"ngx-datatable-column",7),A.Tc(11,Wt,4,3,"ng-template",6),A.ac(),A.bc(12,"ngx-datatable-column",8),A.Tc(13,zt,2,2,"ng-template",6),A.ac(),A.bc(14,"ngx-datatable-column",9),A.Tc(15,Ht,1,1,"ng-template",6),A.ac(),A.bc(16,"ngx-datatable-column",10),A.Tc(17,qt,1,3,"ng-template",11),A.ac(),A.ac(),A.bc(18,"div"),A.bc(19,"button",12),A.Vc(20,"Volver"),A.ac(),A.Wb(21,"span",13),A.bc(22,"button",14),A.jc("click",(function(t){return e.send()})),A.Vc(23,"Recibir"),A.ac(),A.ac(),A.ac(),A.ac()),2&t&&(A.Gb(3),A.uc("ngModel",e.deposit),A.Gb(1),A.uc("ngForOf",e.deposits),A.Gb(3),A.uc("rows",e.orderItems)("columnMode","flex")("headerHeight",40)("footerHeight",50)("limit",10)("rowHeight",45),A.Gb(1),A.uc("flexGrow",1),A.Gb(2),A.uc("flexGrow",4),A.Gb(2),A.uc("flexGrow",4),A.Gb(2),A.uc("flexGrow",1),A.Gb(2),A.uc("flexGrow",2),A.Gb(3),A.uc("routerLink",A.zc(14,Xt)))},directives:[d.a,d.c,b.a,x.a,o.n,o.q,r.l,G.d,G.b,G.a,s.b,a.h,ct.b,et.p,m.a,o.s,i.b,o.c],encapsulation:2}),t})(),data:{title:"Recibir pedido",breadcrumb:"RECIBIR PEDIDO"}}]}];c.d(e,"AppOrderModule",(function(){return Yt}));let Yt=(()=>{class t{}return t.\u0275mod=A.Tb({type:t}),t.\u0275inj=A.Sb({factory:function(e){return new(e||t)},imports:[[r.c,o.t,b.c,I.b,S.b,w.d,o.j,G.e,l.b,g.b,f.b,u.f,x.b,p.a,m.b,v.c,n.b,s.c,d.e,k.b,i.c,h.a,a.k.forChild(Jt)]]}),t})()}}]);