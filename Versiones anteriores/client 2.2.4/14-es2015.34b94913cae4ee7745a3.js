(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"3uMe":function(t,e,c){"use strict";c.d(e,"a",(function(){return s})),c("AJX/");var i=c("YFeJ"),n=c("tk/3"),a=c("fXoL");let s=(()=>{class t{constructor(t){this._httpClient=t,this.httpOptions={headers:new n.e({"Content-Type":"application/json",Authorization:"null"})},this.url=i.a.url}add(t,e){let c=JSON.stringify(e);return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.post(this.url+"team/add",c,this.httpOptions)}edit(t,e,c){let i=JSON.stringify(c);return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.put(this.url+"team/update/"+e,i,this.httpOptions)}addUser(t,e,c){var i={user:c};return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.put(this.url+"team/add-user/"+e,i,this.httpOptions)}removeUser(t,e,c){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.put(this.url+"team/remove-user/"+e,{user:c},this.httpOptions)}delete(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.delete(this.url+"team/delete/"+e,this.httpOptions)}getForName(t,e,c){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"team/for-name/"+e+"/"+c,this.httpOptions)}getList(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"team/teams/"+e,this.httpOptions)}getTeamsOfUser(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"team/for-user/"+e,this.httpOptions)}getAgentsList(t,e,c){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"team/agents/"+e+"/"+c,this.httpOptions)}getOne(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"team/team/"+e,this.httpOptions)}}return t.\u0275fac=function(e){return new(e||t)(a.fc(n.c))},t.\u0275prov=a.Rb({token:t,factory:t.\u0275fac}),t})()},"99bU":function(t,e,c){"use strict";c.r(e);var i=c("ofXK"),n=c("tyNb"),a=c("3Pt+"),s=c("qFsG"),o=c("NFeN"),r=c("bTqV"),l=c("Wp6s"),u=c("f0Cb"),d=c("zkoq"),h=c("kmnG"),p=c("0IaG"),b=c("Qu3c"),m=c("PCNd"),g=c("3kSh"),f=c("3sEA"),k=c("wd/R"),y=c("gU78"),x=c("BlIn"),v=c("YFeJ"),T=c("1yaQ"),_=c("FKr1"),w=c("fXoL"),C=c("dNgK"),M=c("XiUz"),S=c("d3UM");function I(t,e){if(1&t){const t=w.cc();w.bc(0,"mat-option",10),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc().set(i,"requester")})),w.Vc(1),w.ac()}if(2&t){const t=e.$implicit;w.uc("value",t.name+" "+t.surname),w.Gb(1),w.Yc("",t.name," ",t.surname,"")}}function G(t,e){if(1&t){const t=w.cc();w.bc(0,"mat-option",10),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc().set(i,"agent")})),w.Vc(1),w.ac()}if(2&t){const t=e.$implicit;w.uc("value",t.name+" "+t.surname),w.Gb(1),w.Yc("",t.name," ",t.surname,"")}}let O=(()=>{class t{constructor(t,e,c,i){this.data=t,this.dialogRef=e,this._userService=c,this.snackBar=i,this.token=c.getToken(),this.identity=c.getIdentity(),this.filter={}}ngOnInit(){this.getRequesters(),this.getAgents()}set(t,e){switch(e){case"requester":this.filter.requester=t._id;break;case"agent":this.filter.agent=t._id;break;case"status":this.filter.status=t}}deleteFilter(t){switch(t){case"requester":this.filter.requester=null;break;case"agent":this.filter.agent=null;break;case"status":this.filter.status=null;break;case"sub":this.filter.sub="";break;case"numTicket":this.filter.numTicket=null}}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}getRequesters(){this._userService.getListReq(this.token,this.identity.company._id).subscribe(t=>{t.users&&(this.allRequesters=t.users,this.requesters=t.users)},t=>{this.openSnackBar(t.message,"Cerrar")})}getAgents(){let t;t=this.identity.company?this.identity.company._id:"null",this._userService.getListAgents(this.token,t).subscribe(t=>{t.users&&(this.allAgents=t.users,this.agents=t.users)},t=>{this.openSnackBar(t.message,"Cerrar")})}sendQuery(){""==this.filter.sub&&(this.filter.sub=null),"ROLE_REQUESTER"==this.identity.role&&(this.filter.requester=this.identity._id),this.dialogRef.close(this.filter)}}return t.\u0275fac=function(e){return new(e||t)(w.Vb(p.a),w.Vb(p.g),w.Vb(y.a),w.Vb(C.a))},t.\u0275cmp=w.Pb({type:t,selectors:[["app-filter"]],features:[w.Fb([{provide:_.c,useClass:T.c,deps:[_.g]},{provide:_.f,useValue:T.a},y.a])],decls:42,vars:7,consts:[["matDialogTitle",""],[1,"p-0"],["fxLayout","row wrap","fxLayout.lt-sm","column"],["fxFlex","50",1,"pr-1"],["appearance","fill",1,"full-width"],["matInput","","type","number","name","numTicket",3,"ngModel","ngModelChange"],["matInput","","type","text","name","sub",3,"ngModel","ngModelChange"],[3,"click"],[3,"value","click",4,"ngFor","ngForOf"],["fxFlex","100",1,"pr-1"],[3,"value","click"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,e){1&t&&(w.bc(0,"h1",0),w.Vc(1),w.ac(),w.bc(2,"mat-card",1),w.bc(3,"mat-card-content"),w.bc(4,"form"),w.bc(5,"div",2),w.bc(6,"div",3),w.bc(7,"mat-form-field",4),w.bc(8,"mat-label"),w.Vc(9,"N\xfamero"),w.ac(),w.bc(10,"input",5),w.jc("ngModelChange",(function(t){return e.filter.numTicket=t})),w.ac(),w.ac(),w.ac(),w.bc(11,"div",3),w.bc(12,"mat-form-field",4),w.bc(13,"mat-label"),w.Vc(14,"Asunto"),w.ac(),w.bc(15,"input",6),w.jc("ngModelChange",(function(t){return e.filter.sub=t})),w.ac(),w.ac(),w.ac(),w.bc(16,"div",3),w.bc(17,"mat-form-field",4),w.bc(18,"mat-label"),w.Vc(19,"Solicitante"),w.ac(),w.bc(20,"mat-select"),w.bc(21,"mat-option",7),w.jc("click",(function(t){return e.deleteFilter("requester")})),w.ac(),w.Tc(22,I,2,3,"mat-option",8),w.ac(),w.ac(),w.ac(),w.bc(23,"div",3),w.bc(24,"mat-form-field",4),w.bc(25,"mat-label"),w.Vc(26,"Agente"),w.ac(),w.bc(27,"mat-select"),w.bc(28,"mat-option",7),w.jc("click",(function(t){return e.deleteFilter("agent")})),w.ac(),w.Tc(29,G,2,3,"mat-option",8),w.ac(),w.ac(),w.ac(),w.bc(30,"div",9),w.bc(31,"mat-form-field",4),w.bc(32,"mat-label"),w.Vc(33,"Estado"),w.ac(),w.bc(34,"mat-select"),w.bc(35,"mat-option",7),w.jc("click",(function(t){return e.deleteFilter("status")})),w.ac(),w.bc(36,"mat-option",10),w.jc("click",(function(t){return e.set("Pendiente","status")})),w.Vc(37,"Pendiente"),w.ac(),w.bc(38,"mat-option",10),w.jc("click",(function(t){return e.set("Finalizado","status")})),w.Vc(39,"Finalizado"),w.ac(),w.ac(),w.ac(),w.ac(),w.ac(),w.ac(),w.bc(40,"button",11),w.jc("click",(function(t){return e.sendQuery()})),w.Vc(41,"Filtrar"),w.ac(),w.ac(),w.ac()),2&t&&(w.Gb(1),w.Wc(e.data.title),w.Gb(9),w.uc("ngModel",e.filter.numTicket),w.Gb(5),w.uc("ngModel",e.filter.sub),w.Gb(7),w.uc("ngForOf",e.requesters),w.Gb(7),w.uc("ngForOf",e.agents),w.Gb(7),w.uc("value","Pendiente"),w.Gb(2),w.uc("value","Finalizado"))},directives:[p.h,l.a,l.c,a.x,a.o,a.p,M.d,M.b,h.a,h.d,s.b,a.s,a.c,a.n,a.q,S.a,_.p,i.l,r.b],encapsulation:2}),t})();function V(t,e){if(1&t){const t=w.cc();w.bc(0,"button",32),w.jc("click",(function(e){return w.Mc(t),w.nc().unify()})),w.Vc(1,"Unificar"),w.ac()}}function E(t,e){if(1&t&&w.Wb(0,"img",44),2&t){const t=w.nc().$implicit,e=w.nc();w.vc("src",e.url+"user/image/"+t.requester.image,w.Oc)}}function j(t,e){1&t&&w.Wb(0,"img",45)}function q(t,e){if(1&t&&w.Wb(0,"img",44),2&t){const t=w.nc(2).$implicit,e=w.nc();w.vc("src",e.url+"user/image/"+t.agent.image,w.Oc)}}function P(t,e){1&t&&w.Wb(0,"img",45)}function F(t,e){if(1&t&&(w.bc(0,"td",46),w.Tc(1,q,1,1,"img",36),w.Tc(2,P,1,0,"img",37),w.Vc(3),w.Wb(4,"span"),w.Vc(5),w.ac()),2&t){const t=w.nc().$implicit;w.Gb(1),w.uc("ngIf","null"!=t.agent.image),w.Gb(1),w.uc("ngIf","null"==t.agent.image),w.Gb(1),w.Xc(" ",t.agent.name," "),w.Gb(2),w.Xc(" ",t.agent.surname," ")}}function R(t,e){1&t&&w.Wb(0,"td",46)}function W(t,e){if(1&t){const t=w.cc();w.bc(0,"tbody"),w.bc(1,"tr",33),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc().selectTicket(c,i)})),w.bc(2,"td",34),w.Vc(3),w.ac(),w.bc(4,"td",35),w.Tc(5,E,1,1,"img",36),w.Tc(6,j,1,0,"img",37),w.Vc(7),w.Wb(8,"span"),w.Vc(9),w.ac(),w.bc(10,"td",38),w.bc(11,"p",39),w.Vc(12),w.ac(),w.ac(),w.Tc(13,F,6,4,"td",40),w.Tc(14,R,1,0,"td",40),w.bc(15,"td",41),w.Vc(16),w.ac(),w.bc(17,"td",42),w.Vc(18),w.ac(),w.bc(19,"td",43),w.Vc(20),w.ac(),w.ac(),w.ac()}if(2&t){const t=e.$implicit,c=w.nc();w.Ib("Cerrado"==t.status?"closed":""),w.Gb(1),w.Ib(c.isInGroup(t)&&"ROLE_REQUESTER"!=c.identity.role?"selected":"select"),w.Gb(2),w.Wc(t.numTicket),w.Gb(2),w.uc("ngIf",t.requester&&"null"!=t.requester.image),w.Gb(1),w.uc("ngIf",!t.requester||"null"==t.requester.image),w.Gb(1),w.Xc(" ",t.requester.name," "),w.Gb(2),w.Xc(" ",t.requester.surname," "),w.Gb(2),w.vc("title",t.sub),w.Gb(1),w.Wc(t.sub),w.Gb(1),w.uc("ngIf",t.agent),w.Gb(1),w.uc("ngIf",!t.agent),w.Gb(2),w.Wc(t.status),w.Gb(2),w.Wc(c.changeDate(t.createDate)),w.Gb(2),w.Wc(c.changeDate(t.lastActivity))}}const L=function(t){return["/ticket/list",1,t]};function A(t,e){if(1&t&&(w.bc(0,"a",47),w.bc(1,"span"),w.Vc(2,"\xab"),w.ac(),w.ac()),2&t){const t=w.nc();w.uc("routerLink",w.Ac(2,L,t.limit))("queryParams",t.query)}}const B=function(t,e){return["/ticket/list",t,e]};function D(t,e){if(1&t&&(w.bc(0,"a",47),w.Vc(1),w.ac()),2&t){const t=w.nc();w.uc("routerLink",w.Bc(3,B,t.prevPage,t.limit))("queryParams",t.query),w.Gb(1),w.Wc(t.prevPage)}}function z(t,e){if(1&t&&(w.bc(0,"a",47),w.Vc(1),w.ac()),2&t){const t=w.nc();w.uc("routerLink",w.Bc(3,B,t.nextPage,t.limit))("queryParams",t.query),w.Gb(1),w.Wc(t.nextPage)}}function Y(t,e){if(1&t&&(w.bc(0,"a",47),w.bc(1,"span"),w.Vc(2,"\xbb"),w.ac(),w.ac()),2&t){const t=w.nc();w.uc("routerLink",w.Bc(2,B,t.totalPages,t.limit))("queryParams",t.query)}}let N=(()=>{class t{constructor(t,e,c,i,n,a,s,o){this.dialog=t,this._route=e,this._router=c,this.confirmService=i,this.loader=n,this.snackBar=a,this._userService=s,this._ticketService=o,this.token=s.getToken(),this.identity=s.getIdentity(),this.url=v.a.url,this.groupTicket=new Array}ngOnInit(){this.setQuery(),this.getTickets()}setQuery(){this.query={}}getTickets(){this.loader.open("Cargando tickets"),this._route.params.forEach(t=>{this._route.queryParams.forEach(e=>{var c;this.query=e,this.page=t.page,this.limit=t.limit,"ROLE_REQUESTER"==this.identity.role&&(c=this.identity._id),this._ticketService.getList(this.token,this.page,this.limit,e,this.identity.company&&null!=this.identity.company?this.identity.company._id:null,c).subscribe(t=>{t.tickets&&(this.tickets=t.tickets.docs,this.limit=t.tickets.limit,this.nextPage=t.tickets.nextPage,this.prevPage=t.tickets.prevPage,this.totalDocs=t.tickets.totalDocs,this.totalPages=t.tickets.totalPages,this.pagingCounter=t.tickets.pagingCounter,this.loader.close())},t=>{this.openSnackBar(t.message,"Cerrar")})})})}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}getSectorTickets(){this.loader.open("Cargando tickets"),this._route.params.forEach(t=>{this._route.queryParams.forEach(e=>{this.query=e,this.page=t.page,this.limit=t.perPage;var c=this.identity.sector._id;console.log(this.identity),this._ticketService.getSectorPaginatedList(this.token,this.page,this.limit,e,c).subscribe(t=>{t.tickets&&(this.tickets=t.tickets.docs,this.limit=t.tickets.limit,this.nextPage=t.tickets.nextPage,this.prevPage=t.tickets.prevPage,this.totalDocs=t.tickets.totalDocs,this.totalPages=t.tickets.totalPages,this.pagingCounter=t.tickets.pagingCounter,this.loader.close())},t=>{this.openSnackBar(t.message,"Cerrar")})})})}isLastPage(){return this.totalDocs<this.pagingCounter+this.limit?this.totalDocs:this.pagingCounter+this.limit-1}changeLimit(t){this.limit=t,this._router.navigate(["/ticket/list",this.page,this.limit],{queryParams:this.query})}changeDate(t){return k(t,"YYYY-MM-DD HH:mm").format("DD-MM-YYYY HH:mm")}selectTicket(t,e){t.ctrlKey?"Cerrado"!=e.status?-1!=this.groupTicket.indexOf(e.numTicket)?this.groupTicket.splice(this.groupTicket.indexOf(e.numTicket),1):this.groupTicket.push(e.numTicket):this.openSnackBar("El ticket se encuentra cerrado","Cerrar"):this._router.navigate(["/ticket/gestion",e._id])}isInGroup(t){return-1!=this.groupTicket.indexOf(t.numTicket)}unify(){this.confirmService.confirm({message:"\xbfEsta seguro que quiere unificar los tickets seleccionados? Prevalecer\xe1 el ticket mas antiguo y se pondr\xe1 en copia a los solicitantes que hayan generado las otras consultas."}).subscribe(t=>{t&&this._ticketService.unify(this.token,this.groupTicket).subscribe(t=>{t.tickets?(this.openSnackBar("Unificaci\xf3n realizada","Cerrar"),this.groupTicket=new Array,this.getTickets()):this._router.navigate(["/"])},t=>{this.openSnackBar(t.message,"Cerrar")})})}getQuery(){this._route.queryParams.forEach(t=>t)}refCheck(t){t.currentTarget.checked?this.getSectorTickets():this.getTickets()}openPopUp(){this.loader.open(),this.dialog.open(O,{width:"720px",disableClose:!1,data:{title:"Filtro de tickets"}}).afterClosed().subscribe(t=>{t&&this._router.navigate(["ticket/list",1,this.limit],{queryParams:t}),this.loader.close()})}}return t.\u0275fac=function(e){return new(e||t)(w.Vb(p.b),w.Vb(n.a),w.Vb(n.g),w.Vb(g.a),w.Vb(f.a),w.Vb(C.a),w.Vb(y.a),w.Vb(x.a))},t.\u0275cmp=w.Pb({type:t,selectors:[["app-ticket-list"]],features:[w.Fb([y.a,x.a])],decls:87,vars:11,consts:[[1,"card","shadow"],[1,"card-body"],[1,"row"],[1,"col-md-6","text-nowrap"],["id","dataTable_length",1,"dataTables_length"],[1,"form-control","form-control-sm","custom-select","custom-select-sm",3,"change"],["value","10","selected",""],["value","25"],["value","50"],["value","100"],[1,"col-md-6"],["id","dataTable_filter",1,"text-md-right","dataTables_filter"],[1,"form-check"],["type","checkbox","id","ref",1,"form-check-input",3,"disabled","change"],["for","ref",1,"form-check-label"],[1,"row",2,"margin-bottom","5px"],[1,"col","text-nowrap"],["type","button",1,"btn","btn-dark","dark'",3,"click"],[1,"fa","fa-filter"],["class","btn btn-dark dark","type","button","style","margin-left: 5px;",3,"click",4,"ngIf"],["id","dataTable",1,"table-responsive","table"],["id","dataTable",1,"table","table-hover","table-sm"],[2,"width","300px"],[3,"className",4,"ngFor","ngForOf"],[1,"col-md-6","align-self-center"],["id","dataTable_info",1,"dataTables_info"],[1,"d-lg-flex","justify-content-lg-end","dataTables_paginate","paging_simple_numbers"],[1,"pagination"],[1,"page-item"],["class","page-link",3,"routerLink","queryParams",4,"ngIf"],[1,"page-item","active"],[1,"page-link"],["type","button",1,"btn","btn-dark","dark",2,"margin-left","5px",3,"click"],[3,"click"],["data-title","Numero"],["data-title","Solicitante"],["class","rounded-circle mr-2","width","30","height","30",3,"src",4,"ngIf"],["class","rounded-circle mr-2","width","30","height","30","src","assets/images/system/user-placeholder.png",4,"ngIf"],["data-title","Asunto",1,"text-nowrap","text-truncate","text-break"],["ng-bind","ticket.sub",1,"body-cell",2,"font-size","14px",3,"title"],["data-title","Agente",4,"ngIf"],["data-title","Estado"],["data-title","Fecha"],["data-title","Novedad"],["width","30","height","30",1,"rounded-circle","mr-2",3,"src"],["width","30","height","30","src","assets/images/system/user-placeholder.png",1,"rounded-circle","mr-2"],["data-title","Agente"],[1,"page-link",3,"routerLink","queryParams"]],template:function(t,e){1&t&&(w.bc(0,"mat-card",0),w.bc(1,"div",1),w.bc(2,"div",2),w.bc(3,"div",3),w.bc(4,"div",4),w.bc(5,"label"),w.Vc(6,"Mostrar\xa0 "),w.bc(7,"select",5),w.jc("change",(function(t){return e.changeLimit(t.target.value)})),w.bc(8,"option",6),w.Vc(9,"10"),w.ac(),w.bc(10,"option",7),w.Vc(11,"25"),w.ac(),w.bc(12,"option",8),w.Vc(13,"50"),w.ac(),w.bc(14,"option",9),w.Vc(15,"100"),w.ac(),w.ac(),w.ac(),w.ac(),w.ac(),w.bc(16,"div",10),w.bc(17,"div",11),w.bc(18,"div",12),w.bc(19,"input",13),w.jc("change",(function(t){return e.refCheck(t)})),w.ac(),w.bc(20,"label",14),w.Vc(21,"TICKETS DEL SECTOR"),w.ac(),w.ac(),w.ac(),w.ac(),w.ac(),w.bc(22,"div",15),w.bc(23,"div",16),w.bc(24,"button",17),w.jc("click",(function(t){return e.openPopUp()})),w.Wb(25,"i",18),w.ac(),w.Tc(26,V,2,0,"button",19),w.ac(),w.ac(),w.bc(27,"div",20),w.bc(28,"table",21),w.bc(29,"thead"),w.bc(30,"tr"),w.bc(31,"th"),w.Vc(32,"N\xfamero"),w.ac(),w.bc(33,"th"),w.Vc(34,"Solicitante"),w.ac(),w.bc(35,"th",22),w.Vc(36,"Asunto"),w.ac(),w.bc(37,"th"),w.Vc(38,"Agente"),w.ac(),w.bc(39,"th"),w.Vc(40,"Estado"),w.ac(),w.bc(41,"th"),w.Vc(42,"Fecha"),w.ac(),w.bc(43,"th"),w.Vc(44,"Novedad"),w.ac(),w.ac(),w.ac(),w.Tc(45,W,21,16,"tbody",23),w.bc(46,"tfoot"),w.bc(47,"tr"),w.bc(48,"td"),w.bc(49,"strong"),w.Vc(50,"Numero"),w.ac(),w.ac(),w.bc(51,"td"),w.bc(52,"strong"),w.Vc(53,"Solicitante"),w.ac(),w.ac(),w.bc(54,"td"),w.bc(55,"strong"),w.Vc(56,"Asunto"),w.ac(),w.ac(),w.bc(57,"td"),w.bc(58,"strong"),w.Vc(59,"Agente"),w.ac(),w.ac(),w.bc(60,"td"),w.bc(61,"strong"),w.Vc(62,"Estado"),w.ac(),w.ac(),w.bc(63,"td"),w.bc(64,"strong"),w.Vc(65,"Fecha"),w.ac(),w.ac(),w.bc(66,"td"),w.bc(67,"strong"),w.Vc(68,"Novedad"),w.ac(),w.ac(),w.ac(),w.ac(),w.ac(),w.ac(),w.bc(69,"div",2),w.bc(70,"div",24),w.bc(71,"p",25),w.Vc(72),w.ac(),w.ac(),w.bc(73,"div",10),w.bc(74,"nav",26),w.bc(75,"ul",27),w.bc(76,"li",28),w.Tc(77,A,3,4,"a",29),w.ac(),w.bc(78,"li",28),w.Tc(79,D,2,6,"a",29),w.ac(),w.bc(80,"li",30),w.bc(81,"a",31),w.Vc(82),w.ac(),w.ac(),w.bc(83,"li",28),w.Tc(84,z,2,6,"a",29),w.ac(),w.bc(85,"li",28),w.Tc(86,Y,3,5,"a",29),w.ac(),w.ac(),w.ac(),w.ac(),w.ac(),w.ac(),w.ac()),2&t&&(w.Gb(19),w.uc("disabled",0==e.identity.sectorRef),w.Gb(7),w.uc("ngIf","ROLE_REQUESTER"!=e.identity.role&&e.groupTicket.length>1),w.Gb(19),w.uc("ngForOf",e.tickets),w.Gb(27),w.Zc("Mostrando ",e.pagingCounter," a ",e.isLastPage()," de ",e.totalDocs,""),w.Gb(5),w.uc("ngIf",null!=e.prevPage),w.Gb(2),w.uc("ngIf",null!=e.prevPage),w.Gb(3),w.Wc(e.page),w.Gb(2),w.uc("ngIf",null!=e.nextPage),w.Gb(2),w.uc("ngIf",null!=e.nextPage))},directives:[l.a,a.r,a.w,i.m,i.l,n.j],styles:[".body-cell[_ngcontent-%COMP%]{width:25em;margin:0 0 2em;text-overflow:ellipsis;overflow:hidden}.sesion-container[_ngcontent-%COMP%]{height:150px;overflow-y:auto}.selected[_ngcontent-%COMP%]{background-color:#018dda;color:#fff}.closed[_ngcontent-%COMP%]{background-color:#f1f1f1;font-style:italic}"]}),t})();class U{constructor(t,e,c,i,n,a,s,o,r,l,u,d,h,p,b,m,g,f,k,y){this._id=t,this.sub=e,this.numTicket=c,this.requester=i,this.agent=n,this.team=a,this.status=s,this.lastActivity=o,this.createDate=r,this.resolveDate=l,this.rating=u,this.source=d,this.tags=h,this.priority=p,this.company=b,this.subTypeTicket=m,this.cc=g,this.workTime=f,this.realWorkTime=k,this.obsWorkTime=y}}class H{constructor(t,e,c,i,n,a,s,o){this._id=t,this.text=e,this.user=c,this.createDate=i,this.ticket=n,this.type=a,this.files=s,this.read=o}}var Q=c("3uMe"),X=(c("AJX/"),c("tk/3"));let J=(()=>{class t{constructor(t){this._httpClient=t,this.httpOptions={headers:new X.e({"Content-Type":"application/json",Authorization:"null"})},this.url=v.a.url}add(t,e){let c=JSON.stringify(e);return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.post(this.url+"textblock/add",c,this.httpOptions)}edit(t,e,c){let i=JSON.stringify(c);return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.put(this.url+"textblock/update/"+e,i,this.httpOptions)}delete(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.delete(this.url+"textblock/delete/"+e,this.httpOptions)}readAgent(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.put(this.url+"textblock/read-agent/"+e,{read:!0},this.httpOptions)}readRequester(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.put(this.url+"textblock/read-requester/"+e,{read:!0},this.httpOptions)}getList(t){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"textblock/textblocks",this.httpOptions)}getOne(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"textblock/textblock/"+e,this.httpOptions)}getForText(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"textblock/for-text/"+e,this.httpOptions)}getForTicket(t,e,c){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"textblock/for-ticket/"+e+"/"+c,this.httpOptions)}}return t.\u0275fac=function(e){return new(e||t)(w.fc(X.c))},t.\u0275prov=w.Rb({token:t,factory:t.\u0275fac}),t})();var K=c("Q2c7"),Z=c("jZsi"),tt=c("wkIo"),et=c("AV9v"),ct=c("47Ty"),it=c("vHsL"),nt=c("Nptc"),at=c("AASI"),st=c("49gX"),ot=c("7EHt"),rt=c("znSr"),lt=c("CzEO"),ut=c("/1cH");function dt(t,e){if(1&t&&(w.bc(0,"label",10),w.Vc(1),w.ac()),2&t){const t=w.nc();w.Gb(1),w.Wc(t.user)}}function ht(t,e){1&t&&(w.bc(0,"label",10),w.Vc(1,"Informaci\xf3n"),w.ac())}function pt(t,e){if(1&t){const t=w.cc();w.bc(0,"div",11),w.bc(1,"button",12),w.Wb(2,"i",13),w.ac(),w.bc(3,"div",14),w.bc(4,"a",15),w.jc("click",(function(e){return w.Mc(t),w.nc().delete()})),w.Vc(5," Eliminar "),w.ac(),w.ac(),w.ac()}}function bt(t,e){1&t&&w.Wb(0,"hr")}function mt(t,e){if(1&t&&w.Wb(0,"p",6),2&t){const t=w.nc();w.uc("innerHTML",t.sign,w.Nc)}}function gt(t,e){1&t&&w.Wb(0,"i",26)}function ft(t,e){1&t&&w.Wb(0,"i",27)}function kt(t,e){1&t&&w.Wb(0,"i",28)}function yt(t,e){1&t&&w.Wb(0,"i",29)}function xt(t,e){1&t&&w.Wb(0,"i",30)}function vt(t,e){1&t&&w.Wb(0,"i",31)}function Tt(t,e){1&t&&w.Wb(0,"i",32)}function _t(t,e){if(1&t&&(w.bc(0,"span"),w.bc(1,"a",18),w.Tc(2,gt,1,0,"i",19),w.Tc(3,ft,1,0,"i",20),w.Tc(4,kt,1,0,"i",21),w.Tc(5,yt,1,0,"i",22),w.Tc(6,xt,1,0,"i",23),w.Tc(7,vt,1,0,"i",24),w.Tc(8,Tt,1,0,"i",25),w.ac(),w.ac()),2&t){const t=e.$implicit,c=w.nc(2);w.Gb(1),w.vc("href",c.url+"textblock/file/"+t,w.Oc),w.Gb(1),w.uc("ngIf",c.checkExt(t)&&"docx"==c.checkExt(t)||"odt"==c.checkExt(t)),w.Gb(1),w.uc("ngIf",c.checkExt(t)&&("xlsx"==c.checkExt(t)||"xls"==c.checkExt(t))),w.Gb(1),w.uc("ngIf",c.checkExt(t)&&"pdf"==c.checkExt(t)),w.Gb(1),w.uc("ngIf",c.checkExt(t)&&("jpge"==c.checkExt(t)||"jpg"==c.checkExt(t)||"jpeg"==c.checkExt(t)||"png"==c.checkExt(t)||"tiff"==c.checkExt(t)||"tif"==c.checkExt(t))),w.Gb(1),w.uc("ngIf",c.checkExt(t)&&("zip"==c.checkExt(t)||"rar"==c.checkExt(t))),w.Gb(1),w.uc("ngIf",c.checkExt(t)&&"msg"==c.checkExt(t)),w.Gb(1),w.uc("ngIf",!c.checkExt(t))}}function wt(t,e){if(1&t&&(w.bc(0,"div",16),w.Tc(1,_t,9,8,"span",17),w.ac()),2&t){const t=w.nc();w.Gb(1),w.uc("ngForOf",t.groupFiles)}}let Ct=(()=>{class t{constructor(t,e){this._textblockService=t,this._userService=e,this.deleteMessage=new w.o,this.errorMessage=new w.o,this.refresh=new w.o,this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=v.a.url}ngOnInit(){this.date=k(this.date,"YYYY-MM-DD HH:mm").format("DD-MM-YYYY HH:mm"),this.groupFiles=this.files.split(",")}ngAfterViewInit(){this.scrollElement(),$("table").attr("border","1")}scrollElement(){var t=document.getElementById("chatbox-scroll");t.scrollTop=t.scrollHeight}checkExt(t){let e=t.split(".")[1];return("pdf"==e||"xlsx"==e||"xls"==e||"msg"==e||"docx"==e||"odt"==e||"rar"==e||"zip"==e||"png"==e||"jpge"==e||"jpeg"==e||"jpg"==e||"tif"==e||"tiff"==e)&&e}getCardClass(){var t;switch(this.type){case"PUBLIC":case"PRIVATE":t={card:!0,chatbox:!0};break;case"INFO":t="true"==this.info?{card:!0,chatinfo:!0}:{diplaynone:!0};break;case"REQUEST":t={card:!0,chatbox:!0,"ml-auto":!0};break;default:alert("Hubo un problema con la conversaci\xf3n del ticket, por favor reportarlo al administrador")}return t}getContainerClass(){var t;switch(this.type){case"PUBLIC":case"PRIVATE":t={container:!0,chatheader:!0};break;case"INFO":t={container:!0,infoheader:!0};break;case"REQUEST":t={container:!0,chatheaderreq:!0};break;default:alert("Hubo un problema con la conversaci\xf3n del ticket, por favor reportarlo al administrador")}return t}getCardBodyClass(){return"PRIVATE"==this.type?{"card-body":!0,chatprivate:!0}:{"card-body":!0}}delete(){let t=k().format("YYYY-MM-DD HH:ss"),e=k(this.date,"DD-MM-YYYY HH:ss").add(2,"hours").format("YYYY-MM-DD HH:ss");k(t).isSameOrBefore(e)?this.updateChatbox():this.errorMessage.next()}updateChatbox(){this._textblockService.delete(this.token,this._id).subscribe(t=>{t.textblock&&(this.deleteMessage.next(),this.refresh.next())},t=>{null!=t&&(JSON.parse(t._body),console.error(t))})}}return t.\u0275fac=function(e){return new(e||t)(w.Vb(J),w.Vb(y.a))},t.\u0275cmp=w.Pb({type:t,selectors:[["app-chatbox"]],inputs:{_id:"_id",text:"text",sign:"sign",user:"user",userId:"userId",date:"date",type:"type",files:"files",info:"info"},outputs:{deleteMessage:"deleteMessage",errorMessage:"errorMessage",refresh:"refresh"},features:[w.Fb([y.a,J])],decls:13,vars:11,consts:[[3,"ngClass"],[2,"padding-right","0","padding-left","0",3,"ngClass"],[1,"user-date",2,"margin-top","4px"],["style","margin-left: 13px;",4,"ngIf"],["class","dropdown float-right","style","margin-top:-7px;",4,"ngIf"],[1,"float-right",2,"margin-right","15px"],[1,"card-text",3,"innerHTML"],[4,"ngIf"],["class","card-text",3,"innerHTML",4,"ngIf"],["class","text-right",4,"ngIf"],[2,"margin-left","13px"],[1,"dropdown","float-right",2,"margin-top","-7px"],["data-toggle","dropdown","aria-expanded","false","type","button",1,"btn","btn-sm"],[1,"fas","fa-ellipsis-v","option"],["role","menu",1,"dropdown-menu"],["role","presentation",1,"dropdown-item",3,"click"],[1,"text-right"],[4,"ngFor","ngForOf"],["target","blank",3,"href"],["class","fas fa-file-word adjunt adjunt-icon",4,"ngIf"],["class","fas fa-file-excel adjunt adjunt-icon",4,"ngIf"],["class","fas fa-file-pdf adjunt adjunt-icon",4,"ngIf"],["class","fas fa-file-image adjunt adjunt-icon",4,"ngIf"],["class","fas fa-file-archive adjunt adjunt-icon",4,"ngIf"],["class","fas fa-envelope adjunt adjunt-icon",4,"ngIf"],["class","fas fa-file adjunt adjunt-icon",4,"ngIf"],[1,"fas","fa-file-word","adjunt","adjunt-icon"],[1,"fas","fa-file-excel","adjunt","adjunt-icon"],[1,"fas","fa-file-pdf","adjunt","adjunt-icon"],[1,"fas","fa-file-image","adjunt","adjunt-icon"],[1,"fas","fa-file-archive","adjunt","adjunt-icon"],[1,"fas","fa-envelope","adjunt","adjunt-icon"],[1,"fas","fa-file","adjunt","adjunt-icon"]],template:function(t,e){1&t&&(w.bc(0,"div",0),w.bc(1,"div",1),w.bc(2,"div",2),w.Tc(3,dt,2,1,"label",3),w.Tc(4,ht,2,0,"label",3),w.Tc(5,pt,6,0,"div",4),w.bc(6,"label",5),w.Vc(7),w.ac(),w.ac(),w.ac(),w.bc(8,"div",0),w.Wb(9,"p",6),w.Tc(10,bt,1,0,"hr",7),w.Tc(11,mt,1,1,"p",8),w.Tc(12,wt,2,1,"div",9),w.ac(),w.ac()),2&t&&(w.uc("ngClass",e.getCardClass()),w.Gb(1),w.uc("ngClass",e.getContainerClass()),w.Gb(2),w.uc("ngIf","INFO"!=e.type),w.Gb(1),w.uc("ngIf","INFO"==e.type),w.Gb(1),w.uc("ngIf",e.userId==e.identity._id&&"INFO"!=e.type),w.Gb(2),w.Wc(e.date),w.Gb(1),w.uc("ngClass",e.getCardBodyClass()),w.Gb(1),w.uc("innerHTML",e.text,w.Nc),w.Gb(1),w.uc("ngIf",""!=e.sign&&"INFO"!=e.type),w.Gb(1),w.uc("ngIf",""!=e.sign&&"INFO"!=e.type),w.Gb(1),w.uc("ngIf",e.files))},directives:[i.k,rt.a,i.m,i.l],styles:[".card[_ngcontent-%COMP%]{box-shadow:2px 2px 10px #666}.option[_ngcontent-%COMP%]{color:#dcdcdc}.adjunt-icon[_ngcontent-%COMP%]{font-size:23px;padding-top:5px;margin-left:3px}.chatheader[_ngcontent-%COMP%]{height:30px;display:flex;background-color:#1e2833;color:#fff}.chatinfo[_ngcontent-%COMP%]{border:1px solid #1e2833;margin:10px}@media (min-width:300px){.user-date[_ngcontent-%COMP%]{font-size:12px}}.user-date[_ngcontent-%COMP%]{width:80%}.infoheader[_ngcontent-%COMP%]{background-color:#5ab3e6;color:#000}.card.chatbox[_ngcontent-%COMP%]{max-width:80%;min-height:30%;border:1px solid #1e2833;margin:10px}.user-date[_ngcontent-%COMP%]{width:100%}.chatheaderreq[_ngcontent-%COMP%]{height:30px;display:flex;background-color:#46a376;color:#fff}.chatprivate[_ngcontent-%COMP%]{background-color:#676767;color:#fff}.adjunt[_ngcontent-%COMP%]{cursor:pointer;font-size:20px;color:#7979ff}.card-text[_ngcontent-%COMP%]{overflow-x:auto}.diplaynone[_ngcontent-%COMP%]{display:none}"]}),t})();var Mt=c("7ZcW");function St(t,e){if(1&t){const t=w.cc();w.bc(0,"a",51),w.jc("click",(function(e){return w.Mc(t),w.nc(3).setPriority("Urgente")})),w.Vc(1," Urgente "),w.ac()}}function It(t,e){if(1&t){const t=w.cc();w.bc(0,"a",51),w.jc("click",(function(e){return w.Mc(t),w.nc(3).setPriority("Normal")})),w.Vc(1," Normal "),w.ac()}}function Gt(t,e){if(1&t&&(w.bc(0,"div",47),w.bc(1,"button",48),w.Vc(2),w.ac(),w.bc(3,"div",49),w.Tc(4,St,2,0,"a",50),w.Tc(5,It,2,0,"a",50),w.ac(),w.ac()),2&t){const t=w.nc(2);w.Gb(2),w.Xc(" ",t.ticket.priority," "),w.Gb(2),w.uc("ngIf","Urgente"!=t.ticket.priority),w.Gb(1),w.uc("ngIf","Normal"!=t.ticket.priority)}}function Ot(t,e){if(1&t&&(w.bc(0,"span"),w.bc(1,"strong"),w.Vc(2),w.ac(),w.ac()),2&t){const t=w.nc(2);w.Gb(2),w.Wc(t.ticket.priority)}}function Vt(t,e){if(1&t&&(w.bc(0,"span"),w.Tc(1,Gt,6,3,"div",46),w.Tc(2,Ot,3,1,"span",7),w.ac()),2&t){const t=w.nc();w.Gb(1),w.uc("ngIf",t.identity.company._id==t.ticket.company._id&&"Cerrado"!=t.ticket.status),w.Gb(1),w.uc("ngIf",t.identity.company._id!=t.ticket.company._id||"Cerrado"==t.ticket.status)}}function Et(t,e){if(1&t&&(w.bc(0,"span"),w.bc(1,"strong"),w.Vc(2),w.ac(),w.ac()),2&t){const t=w.nc();w.Gb(2),w.Wc(t.ticket.priority)}}function jt(t,e){if(1&t&&(w.bc(0,"strong"),w.Vc(1),w.ac()),2&t){const t=w.nc();w.Gb(1),w.Xc(" ",t.ticket.subTypeTicket.typeTicket.name," ")}}function qt(t,e){if(1&t&&(w.bc(0,"strong"),w.Vc(1),w.ac()),2&t){const t=w.nc();w.Gb(1),w.Xc(" ",t.ticket.subTypeTicket.name," ")}}function Pt(t,e){if(1&t&&(w.bc(0,"span"),w.bc(1,"strong"),w.Vc(2),w.bc(3,"span"),w.Vc(4,";"),w.ac(),w.ac(),w.ac()),2&t){const t=e.$implicit;w.Gb(2),w.Wc(t.name)}}function Ft(t,e){1&t&&w.Wb(0,"img",52)}function Rt(t,e){if(1&t&&w.Wb(0,"img",53),2&t){const t=w.nc();w.vc("src",t.url+"user/image/"+t.ticket.requester.image,w.Oc)}}function Wt(t,e){if(1&t&&(w.bc(0,"div",10),w.bc(1,"div",55),w.bc(2,"span"),w.bc(3,"em"),w.Vc(4),w.ac(),w.ac(),w.ac(),w.ac()),2&t){const t=w.nc(2);w.Gb(4),w.Wc(t.ticket.requester.sector.name)}}function Lt(t,e){if(1&t&&(w.bc(0,"div",10),w.bc(1,"div",55),w.bc(2,"span"),w.bc(3,"em"),w.Wb(4,"i",57),w.Vc(5),w.ac(),w.ac(),w.ac(),w.ac()),2&t){const t=w.nc(2);w.Gb(5),w.Xc(" ",t.ticket.requester.phone,"")}}function At(t,e){if(1&t&&(w.bc(0,"div",54),w.bc(1,"div",10),w.bc(2,"div",55),w.bc(3,"span"),w.bc(4,"strong"),w.Vc(5),w.ac(),w.ac(),w.ac(),w.ac(),w.Tc(6,Wt,5,1,"div",56),w.Tc(7,Lt,6,1,"div",56),w.ac()),2&t){const t=w.nc();w.Gb(5),w.Wc(t.ticket.requester.name+" "+t.ticket.requester.surname),w.Gb(1),w.uc("ngIf",t.ticket.requester.sector),w.Gb(1),w.uc("ngIf",null!=t.ticket.requester.phone)}}function Bt(t,e){if(1&t){const t=w.cc();w.bc(0,"a",51),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc(3).selectCompany(i._id,i.name)})),w.Vc(1),w.ac()}if(2&t){const t=e.$implicit;w.Gb(1),w.Xc(" ",t.name," ")}}function Dt(t,e){if(1&t&&(w.bc(0,"div",59),w.bc(1,"button",60),w.Vc(2," Cambiar "),w.ac(),w.bc(3,"div",49),w.Tc(4,Bt,2,1,"a",61),w.ac(),w.ac()),2&t){const t=w.nc(2);w.Gb(4),w.uc("ngForOf",t.companies)}}function zt(t,e){if(1&t&&(w.bc(0,"span"),w.Tc(1,Dt,5,1,"div",58),w.ac()),2&t){const t=w.nc();w.Gb(1),w.uc("ngIf",t.identity.company._id==t.ticket.company._id&&"Cerrado"!=t.ticket.status)}}function Yt(t,e){1&t&&w.Wb(0,"img",62)}function Nt(t,e){if(1&t&&w.Wb(0,"img",63),2&t){const t=w.nc();w.vc("src",t.url+"company/image/"+t.ticket.company.image,w.Oc)}}function Ut(t,e){1&t&&(w.bc(0,"p",64),w.bc(1,"strong"),w.Vc(2,"Sin departamento"),w.ac(),w.ac())}function $t(t,e){if(1&t&&(w.bc(0,"p",64),w.bc(1,"strong"),w.Vc(2),w.ac(),w.ac()),2&t){const t=w.nc();w.Gb(2),w.Wc(t.ticket.company.name)}}function Ht(t,e){if(1&t){const t=w.cc();w.bc(0,"a",51),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc(3).selectTeam(i._id,i.name)})),w.Vc(1),w.ac()}if(2&t){const t=e.$implicit;w.Gb(1),w.Xc(" ",t.name," ")}}function Qt(t,e){if(1&t&&(w.bc(0,"div",59),w.bc(1,"button",60),w.Vc(2," Cambiar "),w.ac(),w.bc(3,"div",49),w.Tc(4,Ht,2,1,"a",61),w.ac(),w.ac()),2&t){const t=w.nc(2);w.Gb(4),w.uc("ngForOf",t.teams)}}function Xt(t,e){if(1&t&&(w.bc(0,"span"),w.Tc(1,Qt,5,1,"div",58),w.ac()),2&t){const t=w.nc();w.Gb(1),w.uc("ngIf",t.identity.company._id==t.ticket.company._id&&"Cerrado"!=t.ticket.status)}}function Jt(t,e){1&t&&w.Wb(0,"img",65)}function Kt(t,e){if(1&t&&w.Wb(0,"img",63),2&t){const t=w.nc();w.vc("src",t.url+"team/image/"+t.ticket.team.image,w.Oc)}}function Zt(t,e){1&t&&(w.bc(0,"p",64),w.bc(1,"strong"),w.Vc(2,"Sin equipo"),w.ac(),w.ac())}function te(t,e){if(1&t&&(w.bc(0,"p",64),w.bc(1,"strong"),w.Vc(2),w.ac(),w.ac()),2&t){const t=w.nc();w.Gb(2),w.Wc(t.ticket.team.name)}}function ee(t,e){if(1&t){const t=w.cc();w.bc(0,"a",51),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc(3).selectAgent(i._id,i.name,i.surname)})),w.Vc(1),w.ac()}if(2&t){const t=e.$implicit;w.Gb(1),w.Xc(" ",t.name+" "+t.surname," ")}}function ce(t,e){if(1&t&&(w.bc(0,"div",59),w.bc(1,"button",60),w.Vc(2," Cambiar "),w.ac(),w.bc(3,"div",49),w.Tc(4,ee,2,1,"a",61),w.ac(),w.ac()),2&t){const t=w.nc(2);w.Gb(4),w.uc("ngForOf",t.agents)}}function ie(t,e){if(1&t&&(w.bc(0,"span"),w.Tc(1,ce,5,1,"div",58),w.ac()),2&t){const t=w.nc();w.Gb(1),w.uc("ngIf",t.identity.company._id==t.ticket.company._id&&"Cerrado"!=t.ticket.status)}}function ne(t,e){1&t&&w.Wb(0,"img",66)}function ae(t,e){if(1&t&&w.Wb(0,"img",63),2&t){const t=w.nc();w.vc("src",t.url+"user/image/"+t.ticket.agent.image,w.Oc)}}function se(t,e){if(1&t&&(w.bc(0,"p",64),w.bc(1,"strong"),w.Vc(2),w.ac(),w.ac()),2&t){const t=w.nc();w.Gb(2),w.Wc(t.ticket.agent.name+" "+t.ticket.agent.surname)}}function oe(t,e){1&t&&(w.bc(0,"p",64),w.bc(1,"strong"),w.Vc(2,"Sin agente"),w.ac(),w.ac())}function re(t,e){if(1&t){const t=w.cc();w.bc(0,"div",68),w.bc(1,"span"),w.Vc(2,"Fecha estimada de soluci\xf3n "),w.ac(),w.bc(3,"input",69,70),w.jc("ngModelChange",(function(e){return w.Mc(t),w.nc(2).ticket.resolveDate=e}))("change",(function(e){return w.Mc(t),w.nc(2).selectResolveDate()})),w.ac(),w.ac()}if(2&t){const t=w.nc(2);w.Gb(3),w.uc("ngModel",t.ticket.resolveDate)}}function le(t,e){if(1&t&&(w.bc(0,"span"),w.Tc(1,re,5,1,"div",67),w.ac()),2&t){const t=w.nc();w.Gb(1),w.uc("ngIf",t.identity.company._id==t.ticket.company._id)}}function ue(t,e){if(1&t&&(w.bc(0,"small"),w.Vc(1),w.ac()),2&t){const t=w.nc().$implicit;w.Gb(1),w.Xc(" | ",t.item.brand,"")}}function de(t,e){if(1&t&&(w.bc(0,"li",6),w.bc(1,"span"),w.Vc(2),w.ac(),w.Tc(3,ue,2,1,"small",7),w.ac()),2&t){const t=e.$implicit,c=w.nc(2);w.Gb(2),w.Wc(t.item.name),w.Gb(1),w.uc("ngIf",t.item.brand&&"ROLE_REQUESTER"!=c.identity.role)}}function he(t,e){if(1&t&&(w.bc(0,"span"),w.Tc(1,de,4,2,"li",71),w.ac()),2&t){const t=w.nc();w.Gb(1),w.uc("ngForOf",t.movimsTicket)}}function pe(t,e){if(1&t){const t=w.cc();w.bc(0,"mat-option",79),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc(2).getStock(i)})),w.Vc(1),w.ac()}if(2&t){const t=e.$implicit;w.uc("value",t),w.Gb(1),w.Xc(" ",t.name," ")}}function be(t,e){if(1&t){const t=w.cc();w.bc(0,"mat-option",80),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc(2).setStock(i)})),w.bc(1,"span"),w.Vc(2),w.ac(),w.Vc(3," | "),w.bc(4,"small"),w.Vc(5),w.ac(),w.ac()}if(2&t){const t=e.$implicit;w.yc("matTooltip","",t.item.name," (",t.cant,") - ",t.item.brand,""),w.Gb(2),w.Yc("",t.item.name," (",t.cant,")"),w.Gb(3),w.Wc(t.item.brand)}}function me(t,e){if(1&t){const t=w.cc();w.bc(0,"li",72),w.bc(1,"mat-form-field",73),w.bc(2,"mat-label"),w.Vc(3,"Dep\xf3sito"),w.ac(),w.bc(4,"mat-select",74),w.jc("ngModelChange",(function(e){return w.Mc(t),w.nc().deposit=e})),w.Tc(5,pe,2,2,"mat-option",75),w.ac(),w.ac(),w.bc(6,"mat-form-field",73),w.bc(7,"input",76),w.jc("input",(function(e){return w.Mc(t),w.nc().filterStock()}))("ngModelChange",(function(e){return w.Mc(t),w.nc().stockFilter=e})),w.ac(),w.bc(8,"mat-autocomplete",null,77),w.Tc(10,be,6,6,"mat-option",78),w.ac(),w.ac(),w.ac()}if(2&t){const t=w.Jc(9),e=w.nc();w.Gb(4),w.uc("ngModel",e.deposit),w.Gb(1),w.uc("ngForOf",e.deposits),w.Gb(2),w.uc("ngModel",e.stockFilter)("matAutocomplete",t),w.Gb(3),w.uc("ngForOf",e.stocks)}}function ge(t,e){if(1&t&&w.Wb(0,"img",84),2&t){const t=w.nc().$implicit,e=w.nc(2);w.vc("src",e.url+"user/image/"+t.image,w.Oc)}}function fe(t,e){1&t&&w.Wb(0,"img",85)}function ke(t,e){if(1&t){const t=w.cc();w.bc(0,"button",86),w.jc("click",(function(e){w.Mc(t);const c=w.nc().$implicit;return w.nc(2).deleteCc(c)})),w.Wb(1,"i",87),w.ac()}}function ye(t,e){if(1&t&&(w.bc(0,"li",6),w.Tc(1,ge,1,1,"img",81),w.Tc(2,fe,1,0,"img",82),w.bc(3,"span"),w.Vc(4),w.ac(),w.Tc(5,ke,2,0,"button",83),w.ac()),2&t){const t=e.$implicit,c=w.nc(2);w.Gb(1),w.uc("ngIf","null"!=t.image),w.Gb(1),w.uc("ngIf","null"==t.image),w.Gb(2),w.Yc("",t.name," ",t.surname,""),w.Gb(1),w.uc("ngIf","Cerrado"!=c.ticket.status)}}function xe(t,e){if(1&t&&(w.bc(0,"span"),w.Tc(1,ye,6,5,"li",71),w.ac()),2&t){const t=w.nc();w.Gb(1),w.uc("ngForOf",t.ticket.cc)}}function ve(t,e){if(1&t){const t=w.cc();w.bc(0,"mat-option",91),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc(2).setCc(i)})),w.Vc(1),w.ac()}if(2&t){const t=e.$implicit;w.Gb(1),w.Xc(" ",t.name+" "+t.surname," ")}}function Te(t,e){if(1&t){const t=w.cc();w.bc(0,"li",72),w.bc(1,"mat-form-field",73),w.bc(2,"input",88),w.jc("input",(function(e){return w.Mc(t),w.nc().filterCc()}))("ngModelChange",(function(e){return w.Mc(t),w.nc().ccFilter=e})),w.ac(),w.bc(3,"mat-autocomplete",null,89),w.Tc(5,ve,2,1,"mat-option",90),w.ac(),w.ac(),w.ac()}if(2&t){const t=w.Jc(4),e=w.nc();w.Gb(2),w.uc("ngModel",e.ccFilter)("matAutocomplete",t),w.Gb(3),w.uc("ngForOf",e.ccList)}}function _e(t,e){if(1&t){const t=w.cc();w.bc(0,"input",92),w.jc("ngModelChange",(function(e){return w.Mc(t),w.nc().subMod=e})),w.ac()}if(2&t){const t=w.nc();w.uc("ngModel",t.subMod)}}function we(t,e){if(1&t){const t=w.cc();w.bc(0,"input",93),w.jc("click",(function(e){return w.Mc(t),w.nc().editTicketSub()})),w.ac()}}function Ce(t,e){if(1&t){const t=w.cc();w.bc(0,"input",94),w.jc("click",(function(e){return w.Mc(t),w.nc().editSub=!1})),w.ac()}}function Me(t,e){if(1&t){const t=w.cc();w.bc(0,"h6",95),w.jc("click",(function(e){w.Mc(t);const c=w.nc();return c.subToEdit(c.ticket.sub)})),w.bc(1,"strong"),w.Vc(2),w.ac(),w.ac()}if(2&t){const t=w.nc();w.Gb(2),w.Wc(t.ticket.sub)}}const Se=function(t){return["/ticket/gestion",t]};function Ie(t,e){if(1&t&&(w.bc(0,"a",96),w.Wb(1,"i",97),w.ac()),2&t){const t=w.nc();w.uc("routerLink",w.Ac(1,Se,t.prev._id))}}function Ge(t,e){1&t&&w.Wb(0,"i",98)}function Oe(t,e){1&t&&w.Wb(0,"i",99)}function Ve(t,e){if(1&t&&(w.bc(0,"a",100),w.Wb(1,"i",101),w.ac()),2&t){const t=w.nc();w.uc("routerLink",w.Ac(1,Se,t.next._id))}}function Ee(t,e){if(1&t){const t=w.cc();w.bc(0,"app-chatbox",102),w.jc("deleteMessage",(function(e){return w.Mc(t),w.nc().deleteMessage()}))("refresh",(function(e){return w.Mc(t),w.nc().getChat()}))("errorMessage",(function(e){return w.Mc(t),w.nc().errorMessage()})),w.ac()}if(2&t){const t=e.$implicit,c=w.nc();w.vc("_id",t._id),w.vc("text",t.text),w.vc("sign",t.user.sign),w.vc("type",t.type),w.vc("user",t.user.name+c.space+t.user.surname),w.vc("userId",t.user._id),w.vc("date",t.createDate),w.vc("files",t.files),w.vc("info",c.info)}}function je(t,e){if(1&t){const t=w.cc();w.bc(0,"div",38),w.bc(1,"div",103),w.bc(2,"div",104),w.bc(3,"div"),w.bc(4,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f603}")})),w.Wb(5,"img",105),w.ac(),w.bc(6,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f604}")})),w.Wb(7,"img",106),w.ac(),w.bc(8,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f601}")})),w.Wb(9,"img",107),w.ac(),w.bc(10,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f606}")})),w.Wb(11,"img",108),w.ac(),w.bc(12,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f605}")})),w.Wb(13,"img",109),w.ac(),w.bc(14,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f602}")})),w.Wb(15,"img",110),w.ac(),w.bc(16,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f609}")})),w.Wb(17,"img",111),w.ac(),w.bc(18,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f60a}")})),w.Wb(19,"img",112),w.ac(),w.bc(20,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f61c}")})),w.Wb(21,"img",113),w.ac(),w.bc(22,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f61d}")})),w.Wb(23,"img",114),w.ac(),w.bc(24,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f610}")})),w.Wb(25,"img",115),w.ac(),w.bc(26,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f62a}")})),w.Wb(27,"img",116),w.ac(),w.bc(28,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f60e}")})),w.Wb(29,"img",117),w.ac(),w.bc(30,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f632}")})),w.Wb(31,"img",118),w.ac(),w.bc(32,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f613}")})),w.Wb(33,"img",119),w.ac(),w.bc(34,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f629}")})),w.Wb(35,"img",120),w.ac(),w.bc(36,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f620}")})),w.Wb(37,"img",121),w.ac(),w.bc(38,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f44c}")})),w.Wb(39,"img",122),w.ac(),w.bc(40,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f44d}")})),w.Wb(41,"img",123),w.ac(),w.bc(42,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f44e}")})),w.Wb(43,"img",124),w.ac(),w.bc(44,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f44f}")})),w.Wb(45,"img",125),w.ac(),w.bc(46,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f64c}")})),w.Wb(47,"img",126),w.ac(),w.bc(48,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f64f}")})),w.Wb(49,"img",127),w.ac(),w.bc(50,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f440}")})),w.Wb(51,"img",128),w.ac(),w.bc(52,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u2620\ufe0f")})),w.Wb(53,"img",129),w.ac(),w.bc(54,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f648}")})),w.Wb(55,"img",130),w.ac(),w.bc(56,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f649}")})),w.Wb(57,"img",131),w.ac(),w.bc(58,"a",91),w.jc("click",(function(e){return w.Mc(t),w.nc().addEmoji("\u{1f64a}")})),w.Wb(59,"img",132),w.ac(),w.ac(),w.ac(),w.ac(),w.ac()}}function qe(t,e){if(1&t){const t=w.cc();w.bc(0,"a",51),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc(5).selectHashtag(i.resp)})),w.Vc(1),w.ac()}if(2&t){const t=e.$implicit;w.Gb(1),w.Xc(" ",t.hashtag," ")}}function Pe(t,e){if(1&t&&(w.bc(0,"span"),w.Tc(1,qe,2,1,"a",61),w.ac()),2&t){const t=w.nc(4);w.Gb(1),w.uc("ngForOf",t.responses)}}function Fe(t,e){1&t&&(w.bc(0,"span",146),w.Vc(1," No tenes ning\xfana respuesta r\xe1pida configurada "),w.ac())}function Re(t,e){if(1&t&&(w.bc(0,"span"),w.Tc(1,Pe,2,1,"span",7),w.Tc(2,Fe,2,0,"span",145),w.ac()),2&t){const t=w.nc(3);w.Gb(1),w.uc("ngIf",0!=t.getLenght(t.responses)),w.Gb(1),w.uc("ngIf",0==t.getLenght(t.responses))}}function We(t,e){if(1&t&&(w.bc(0,"div",49),w.Tc(1,Re,3,2,"span",7),w.ac()),2&t){const t=w.nc(2);w.Gb(1),w.uc("ngIf",t.responses)}}function Le(t,e){if(1&t){const t=w.cc();w.bc(0,"button",147),w.jc("click",(function(e){return w.Mc(t),w.nc(),w.Jc(14).clear(e)})),w.bc(1,"mat-icon"),w.Vc(2,"clear"),w.ac(),w.ac()}}function Ae(t,e){if(1&t){const t=w.cc();w.bc(0,"a",51),w.jc("click",(function(e){return w.Mc(t),w.nc(2).setStatus("Pendiente")})),w.Vc(1," Pendiente "),w.ac()}}function Be(t,e){if(1&t){const t=w.cc();w.bc(0,"a",51),w.jc("click",(function(e){return w.Mc(t),w.nc(2).checkWorkTime("Finalizado")})),w.Vc(1," Finalizado "),w.ac()}}function De(t,e){if(1&t){const t=w.cc();w.bc(0,"span"),w.bc(1,"button",133),w.Wb(2,"i",134),w.ac(),w.bc(3,"input",135),w.jc("ngModelChange",(function(e){return w.Mc(t),w.nc().isPrivate=e})),w.ac(),w.bc(4,"span",136),w.Vc(5,"Privado"),w.ac(),w.bc(6,"span"),w.Vc(7,"|"),w.ac(),w.bc(8,"div",137),w.bc(9,"button",138),w.Wb(10,"i",139),w.ac(),w.Tc(11,We,2,1,"div",140),w.ac(),w.bc(12,"mat-form-field"),w.bc(13,"ngx-mat-file-input",141,142),w.jc("ngModelChange",(function(e){return w.Mc(t),w.nc().files=e})),w.ac(),w.Tc(15,Le,3,0,"button",143),w.ac(),w.bc(16,"div",59),w.bc(17,"button",144),w.Vc(18),w.ac(),w.bc(19,"div",49),w.Tc(20,Ae,2,0,"a",50),w.Tc(21,Be,2,0,"a",50),w.ac(),w.ac(),w.ac()}if(2&t){const t=w.Jc(14),e=w.nc();w.Gb(1),w.uc("disabled",e.identity.company._id!=e.ticket.company._id||"Cerrado"==e.ticket.status),w.Gb(2),w.uc("disabled",e.identity.company._id!=e.ticket.company._id)("ngModel",e.isPrivate),w.Gb(8),w.uc("ngIf",e.identity.company._id==e.ticket.company._id),w.Gb(2),w.uc("ngModel",e.files),w.Gb(2),w.uc("ngIf",!t.empty),w.Gb(2),w.uc("ngClass",e.calculateClasses())("disabled",e.identity.company._id!=e.ticket.company._id||"Cerrado"==e.ticket.status&&"ROLE_REQUESTER"==e.identity.role),w.Gb(1),w.Xc(" ",e.ticket.status," "),w.Gb(2),w.uc("ngIf","Pendiente"!=e.ticket.status),w.Gb(1),w.uc("ngIf","Finalizado"!=e.ticket.status)}}function ze(t,e){if(1&t){const t=w.cc();w.bc(0,"button",147),w.jc("click",(function(e){return w.Mc(t),w.nc(),w.Jc(3).clear(e)})),w.bc(1,"mat-icon"),w.Vc(2,"clear"),w.ac(),w.ac()}}function Ye(t,e){if(1&t){const t=w.cc();w.bc(0,"button",150),w.jc("click",(function(e){return w.Mc(t),w.nc(2).cancelFinish()})),w.Wb(1,"i",151),w.ac()}}function Ne(t,e){if(1&t){const t=w.cc();w.bc(0,"span"),w.bc(1,"mat-form-field"),w.bc(2,"ngx-mat-file-input",141,142),w.jc("ngModelChange",(function(e){return w.Mc(t),w.nc().files=e})),w.ac(),w.Tc(4,ze,3,0,"button",143),w.ac(),w.bc(5,"button",133),w.Wb(6,"i",134),w.ac(),w.Tc(7,Ye,2,0,"button",148),w.bc(8,"div",59),w.bc(9,"button",149),w.Vc(10),w.ac(),w.ac(),w.ac()}if(2&t){const t=w.Jc(3),e=w.nc();w.Gb(2),w.uc("ngModel",e.files),w.Gb(2),w.uc("ngIf",!t.empty),w.Gb(1),w.uc("disabled","Cerrado"==e.ticket.status),w.Gb(2),w.uc("ngIf","Finalizado"==e.ticket.status&&e.identity._id==e.ticket.requester._id),w.Gb(3),w.Xc(" ",e.ticket.status," ")}}const Ue=function(t){return["/user/profile",t]},$e=function(t){return{privatechattext:t}};let He=(()=>{class t{constructor(t,e,c,i,n,a,s,o,r,l,u,d,h,p,b,m,g){this.dialog=t,this._route=e,this._router=c,this.confirmService=i,this.loader=n,this.snackBar=a,this._userService=s,this._ticketService=o,this._teamService=r,this._textblockService=l,this._uploadService=u,this._responseService=d,this._companyService=h,this._notificationService=p,this._depositService=b,this._stockService=m,this._movimService=g,this.stocks=[],this.allStocks=[],this.stockFilter="",this.movimsTicket=[],this.imagesToUpload=new Array,this.identity=this._userService.getIdentity(),this.token=this._userService.getToken(),this.url=v.a.url,this.editSub=!1,this.subMod="",this.isPrivate=!1,this.space=" ",this.ccList=[],this.allCcList=[],this.ccFilter="",this.isCc=!1,this.stat="",this.info="true",this.ticket=new U("","",null,"","","","","","","",null,"",[""],"","","",[""],null,null,""),this.textblock=new H("","",this.identity._id,"","","",[""],!1),this.emojis=!1,this.config=v.a.richTextModule}ngOnInit(){this.getTicket(),this.getHashtags(),this.getCompanies(),this.checkInfo(),this.getCc(),this.getDeposits()}getDeposits(){this._depositService.getList(this.token,{company:this.identity.company._id}).subscribe(t=>{t.deposits&&(this.deposits=t.deposits,this.deposit=this.deposits[0],this.getStock(this.deposits[0]))},t=>{this.openSnackBar(t.message,"Cerrar")})}getStock(t){let e={deposit:t._id};this.stockFilter="",this.stocks=[],this._stockService.getList(this.token,e).subscribe(t=>{t.stocks&&(this.allStocks=t.stocks,console.log(this.allStocks))},t=>{this.openSnackBar(t.message,"Cerrar")})}filterStock(){this.stocks=this.allStocks.filter(t=>(t.item.name+t.item.brand).toLowerCase().includes(this.stockFilter.toString().toLowerCase()))}getMovims(t){this._movimService.getList(this.token,{ticket:t._id}).subscribe(t=>{t.movims&&(this.movimsTicket=t.movims)},t=>{this.openSnackBar(t.message,"Cerrar")})}setStock(t){if(0==t.cant)return this.openSnackBar("No hay insumo en stock para descontar","Cerrar");this.confirmService.confirm({message:"\xbfDescontar "+t.item.name+" "+t.item.brand+" del dep\xf3sito "+t.deposit.name+"?"}).subscribe(e=>{if(!e)return;let c=null;c={$inc:{cant:-1}},this._stockService.edit(this.token,t._id,c).subscribe(e=>{e.stock&&this.saveMovim(t)},t=>{this.openSnackBar(t.message,"Cerrar")})})}saveMovim(t){let e=new st.a("",null,"Egreso",t.deposit._id,t.item._id,this.ticket.company._id,1,this.identity._id,null,new Date,new Date,null,this.ticket.requester._id,this.ticket._id,null,"");this.ticket.requester.sector&&(e.sector=this.ticket.requester.sector._id),this._movimService.add(this.token,e).subscribe(e=>{e.movim&&(this.openSnackBar("Movimiento realizado correctamente","Cerrar"),this.newInfo(this.identity.name+" "+this.identity.surname+" agreg\xf3 un/a "+t.item.name+" como insumo en este ticket."),t.cant=t.cant-1,this.getMovims(this.ticket))},t=>{this.openSnackBar(t.message,"Cerrar")})}checkInfo(){this.info=0!=this.identity.infoView?"true":"false"}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}getCc(){this._userService.getList(this.token).subscribe(t=>{t.users&&(this.allCcList=t.users)},t=>{this.openSnackBar(t.message,"Cerrar")})}changeInfo(){this.info="false"==this.info?"true":"false",this.getChat()}getPrevNext(t,e){this._ticketService.getPrevNext(this.token,this.identity._id,t,e,this.identity.role).subscribe(t=>{this.next=t.nextTicket,this.prev=t.prevTicket},t=>{this.openSnackBar(t.message,"Cerrar")})}filterCc(){this.ccList=this.allCcList.filter(t=>(t.name+t.surname).toLowerCase().includes(this.ccFilter.toString().toLowerCase()))}setCc(t){this._ticketService.addCc(this.token,this.ticket._id,t._id).subscribe(e=>{e.ticket?(this.newInfo(this.identity.name+" "+this.identity.surname+" puso en copia a "+t.name+" "+t.surname+" en este ticket"),this.getTicket()):this._router.navigate(["/"])},t=>{this.openSnackBar(t.message,"Cerrar")})}deleteCc(t){this._ticketService.removecc(this.token,this.ticket._id,t._id).subscribe(e=>{e.ticket&&(this.newInfo(this.identity.name+" "+this.identity.surname+" elmin\xf3 a "+t.name+" "+t.surname+" de los usuarios en copia"),this.getTicket())},t=>{this.openSnackBar(t.message,"Cerrar")})}getLenght(t){return t.length}deleteMessage(){this.openSnackBar("El mensaje fue eliminado correctamente.","Cerrar")}errorMessage(){this.openSnackBar("No puede eliminar un mensaje con m\xe1s de dos horas de realizado","Cerrar")}getTeams(t){this._teamService.getList(this.token,t).subscribe(t=>{t.teams?this.teams=t.teams:this._router.navigate(["/"])},t=>{this.openSnackBar(t.message,"Cerrar")})}getCompanies(){this._companyService.getList(this.token).subscribe(t=>{t.companies?this.companies=t.companies:this._router.navigate(["/"])},t=>{this.openSnackBar(t.message,"Cerrar")})}getReqTickets(t){t&&this._ticketService.getForUser(this.token,t._id).subscribe(t=>{t.tickets?this.reqTickets=t.tickets:this._router.navigate(["/"])},t=>{this.openSnackBar(t.message,"Cerrar")})}getChat(){this._route.params.forEach(t=>{this._textblockService.getForTicket(this.token,t.id,this.identity.role).subscribe(t=>{t.textblocks&&(this.chat=t.textblocks,"ROLE_REQUESTER"!=this.identity.role?this.ticket.agent&&this.identity._id==this.ticket.agent._id&&this._textblockService.readAgent(this.token,this.ticket._id).subscribe(t=>{t.textblock||console.error("Error en textblock")},t=>{this.openSnackBar(t.message,"Cerrar")}):this.identity._id==this.ticket.requester._id&&this._textblockService.readRequester(this.token,this.ticket._id).subscribe(t=>{},t=>{this.openSnackBar(t.message,"Cerrar")}),this.ticket.agent&&this.ticket.agent._id&&("ROLE_REQUESTER"!=this.identity.role&&this.identity._id==this.ticket.agent._id?this._textblockService.readAgent(this.token,this.ticket._id).subscribe(t=>{},t=>{this.openSnackBar(t.message,"Cerrar")}):"ROLE_REQUESTER"==this.identity.role&&this.identity._id==this.ticket.requester._id&&this._textblockService.readRequester(this.token,this.ticket._id).subscribe(t=>{},t=>{console.error(t)})))},t=>{this.openSnackBar(t.message,"Cerrar")})})}getHashtags(){this._responseService.getList(this.token,this.identity._id).subscribe(t=>{t.responses&&(this.responses=t.responses)},t=>{this.openSnackBar(t.message,"Cerrar")})}getTicket(){this._route.params.forEach(t=>{this._ticketService.getOne(this.token,t.id).subscribe(t=>{this.ticket=t.ticket,setTimeout(()=>{this.getChat()},1e3),this.getPrevNext(t.ticket.numTicket,t.ticket.status),this.getTeams(t.ticket.company._id),t.ticket.team&&(this.agents=t.ticket.team.users),this.ticket.cc&&-1!=this.ticket.cc.map((function(t){return t._id})).indexOf(this.identity._id)&&(this.isCc=!0),this.getMovims(t.ticket)},t=>{this.openSnackBar(t.message,"Cerrar")})})}selectHashtag(t){this.textblock.text=this.textblock.text+t,document.getElementById("editable").innerHTML=document.getElementById("editable").innerHTML+t}selectAgent(t,e,c){"Pendiente"!=this.ticket.status?(this.ticket.agent=t,this.ticket.status="Pendiente",this.editTicket(),this.newInfo(this.identity._id==t?this.identity.name+" "+this.identity.surname+" se asign\xf3 como agente de esta solicitud":this.identity.name+" "+this.identity.surname+" asign\xf3 a "+e+" "+c+" como agente de esta solicitud")):(this.ticket.agent=t,this.editTicket(),this.newInfo(this.identity._id==t?this.identity.name+" "+this.identity.surname+" se asign\xf3 como agente de esta solicitud":this.identity.name+" "+this.identity.surname+" asign\xf3 a "+e+" "+c+" como agente de esta solicitud"))}selectTeam(t,e){this.ticket.team=t,this.ticket.agent=null,this.ticket.status="Pendiente",this.editTicket(),this.newInfo(this.identity.name+" "+this.identity.surname+" asign\xf3 a "+e+" como equipo de esta solicitud"),this.newInfo(this.identity.name+" "+this.identity.surname+" ha cambiado el estado de la solicitud a pendiente")}cancelFinish(){let t=this.textblock.text;""!=t&&(t=t.split("<span _ngco")[0]),""!=t?(this.newInfo(this.identity.name+" "+this.identity.surname+" ha reabierto el ticket"),this.createMessageNotification(this.ticket.agent._id,"#"+this.ticket.numTicket+" - "+this.identity.name+" "+this.identity.surname+" reabri\xf3 el ticket"),this.onSubmit(),this.ticket.status="Pendiente",this.editTicket()):this.openSnackBar("Escribe un mensaje antes de enviarlo","Cerrar")}selectCompany(t,e){"Abierto"!=this.ticket.status?(this.ticket.company=t,this.ticket.team=null,this.ticket.agent=null,this.agents=null,this.ticket.status="Abierto",this.ticket.resolveDate=null,this.editTicket(),this.getTeams(t),this.newInfo(this.identity.name+" "+this.identity.surname+" asign\xf3 a "+e+" como departamento responsable de esta solicitud"),this.newInfo(this.identity.name+" "+this.identity.surname+" ha cambiado el estado de la solicitud a abierto")):(this.ticket.company=t,this.ticket.team=null,this.agents=null,this.ticket.agent=null,this.editTicket(),this.newInfo(this.identity.name+" "+this.identity.surname+" asign\xf3 a "+e+" como departamento responsable de esta solicitud"))}selectResolveDate(){if(k(this.ticket.resolveDate).isSameOrAfter(k().format("YYYY-MM-DD"))){var t=this.ticket.resolveDate.split("-");this.ticket.resolveDate=t[2]+"-"+t[1]+"-"+t[0],this.editTicket(),this.newInfo(this.identity.name+" "+this.identity.surname+" ha actualizado la fecha estimada de soluci\xf3n a "+this.ticket.resolveDate)}else this.openSnackBar("No puede seleccionar una fecha anterior a la actual","Cerrar"),this.ticket.resolveDate=""}calculateClasses(){var t={};switch(this.ticket.status){case"Pendiente":t={pending:!0};break;case"Abierto":t={open:!0};break;case"Cerrado":t={closer:!0};break;case"Finalizado":t={finish:!0}}return t.btn=!0,t["btn-dark"]=!0,t["dropdown-toggle"]=!0,t}subToEdit(t){"Cerrado"!=this.ticket.status&&(this.identity.company?this.identity.company._id==this.ticket.company._id&&(this.editSub=!0,this.subMod=t):this.identity._id==this.ticket.requester._id&&(this.editSub=!0,this.subMod=t))}editTicketSub(){this.newInfo(this.identity.name+" "+this.identity.surname+" ha cambiado el asunto de la solicitud de "+this.ticket.sub+" a "+this.subMod.toUpperCase()),this.ticket.sub=this.subMod,this.editTicket(),this.editSub=!1}checkWorkTime(t){this.ticket.workTime?(this.stat=t,$("#timework").modal("show")):this.setStatus(t)}setStatus(t){("Cerrado"==t||"Finalizado"==t)&&this.ticket.team&&this.ticket.agent||"Pendiente"==t&&this.ticket.team||"Abierto"==t?(this.newInfo(this.identity.name+" "+this.identity.surname+" ha cambiado el estado de la solicitud de "+this.ticket.status+" a "+t),this.ticket.status=t,this.editTicket(),"Finalizado"==t&&this.createMessageNotification(this.ticket.requester._id,"#"+this.ticket.numTicket+" - "+this.identity.name+" "+this.identity.surname+" finaliz\xf3 el ticket."),$("#timework").modal("hide")):this.openSnackBar("Debe seleccionar un responsable para cambiar el ticket a ese estado","Cerrar")}setPriority(t){this.newInfo(this.identity.name+" "+this.identity.surname+" ha cambiado la prioridad de la solicitud de "+this.ticket.priority+" a "+t),this.ticket.priority=t,this.editTicket()}editTicket(){this._route.params.forEach(t=>{this._ticketService.edit(this.token,t.id,this.ticket).subscribe(t=>{t.ticket&&this.getTicket()},t=>{this.openSnackBar(t.message,"Cerrar")})})}newInfo(t){var e;e=new H("",t,this.identity._id,"","","INFO",[""],!1),this._route.params.forEach(t=>{e.ticket=t.id}),this._textblockService.add(this.token,e).subscribe(t=>{t.textblock&&this.pushText(t.textblock._id)},t=>{this.openSnackBar(t.message,"Cerrar")})}onSubmit(){let t;""!=this.textblock.text&&(this.textblock.text=this.textblock.text.split("<span _ngco")[0]),""!=this.textblock.text?("ROLE_REQUESTER"==this.identity.role?(this.textblock.type="REQUEST",t=this.ticket.agent,delete this.ticket.agent,delete this.ticket.team):(this.textblock.read=!0,this.textblock.type=this.isPrivate?"PRIVATE":"PUBLIC"),this._route.params.forEach(t=>{this.textblock.ticket=t.id}),this._textblockService.add(this.token,this.textblock).subscribe(e=>{if(e.textblock){let c="#"+this.ticket.numTicket+" - Nuevo mensaje";if("ROLE_REQUESTER"==this.identity.role)t&&this.createMessageNotification(t._id,c);else{let t=this.ticket.requester._id;this.createMessageNotification(t,c),this.ticket.cc&&this.ticket.cc.forEach(e=>{t=e._id,this.createMessageNotification(t,c)})}null!=this.files&&null!=this.files&&(this._uploadService.makeFileRequest(this.url+"textblock/file/"+e.textblock._id,[],this.files.files,this.token,"file"),this.files=null)}let c,i;if("PRIVATE"!=this.textblock.type&&1==this.ticket.company.mailSender&&("ROLE_REQUESTER"!=this.identity.role?1==this.ticket.requester.receiveMail&&(c=this.ticket.requester.name+" "+this.ticket.requester.surname,i=this.ticket.requester.email):this.ticket.agent&&1==this.ticket.agent.receiveMail&&(c=this.ticket.agent.name+" "+this.ticket.agent.surname,i=this.ticket.agent.email),c)){let t=window.location.href,n=this.identity.name+" "+this.identity.surname,a=void 0;this.ticket.cc&&(a=this.ticket.cc.map((function(t){return t.email}))),this._ticketService.sendMail(this.token,n,this.ticket,e.textblock.text,c,i,t,a).subscribe(t=>{},t=>{this.openSnackBar(t.message,"Cerrar")})}this.editTicket(),this.pushText(e.textblock._id),this.textblock=new H("","",this.identity._id,"","","",[""],!1),document.getElementById("editable").innerHTML=""},t=>{this.openSnackBar(t,"Cerrar")})):this.openSnackBar("Escriba un mensaje antes de enviarlo","Cerrar")}showEmojis(){this.emojis=!this.emojis}addEmoji(t){this.textblock.text=this.textblock.text+t,document.getElementById("editable").innerHTML=document.getElementById("editable").innerHTML+t}pushText(t){this._textblockService.getOne(this.token,t).subscribe(t=>{t.textblock&&this.chat.push(t.textblock)},t=>{this.openSnackBar(t.message,"Cerrar")})}createMessageNotification(t,e){let c=k().format("YYYY-MM-DD HH:mm"),i=new et.a("",e,"chat",c,c,"ticket/gestion/"+this.ticket._id,"primary",t,null,null);this._notificationService.add(this.token,i).subscribe(t=>{},t=>{this.openSnackBar("No pudo enviarse una notificaci\xf3n por sistema al usuario","Cerrar")})}changeDate(t){return k(t,"YYYY-MM-DD HH:mm").format("DD-MM-YYYY HH:mm")}outOfLimit(){return 100*this.ticket.realWorkTime/this.ticket.workTime>=150}pastePicture(t){return e=this,void 0,i=function*(){0!=t.clipboardData.files.length&&(this.imagesToUpload=new Array,this.imagesToUpload.push(t.clipboardData.files.item(0)),yield this._uploadService.makeFileRequest(this.url+"textblock/image",[],this.imagesToUpload,this.token,"image").then(t=>{document.getElementById("editable").innerHTML+='<a target="_blank" href="'+this.url+"textblock/image/"+t.filename+'"><img src="'+this.url+"textblock/image/"+t.filename+'" class="img-fluid" style="width: 80%; margin: 5px" alt="Responsive image"></a>'}),this.textblock.text=document.getElementById("editable").innerHTML,this.imagesToUpload=new Array)},new((c=void 0)||(c=Promise))((function(t,n){function a(t){try{o(i.next(t))}catch(e){n(e)}}function s(t){try{o(i.throw(t))}catch(e){n(e)}}function o(e){var i;e.done?t(e.value):(i=e.value,i instanceof c?i:new c((function(t){t(i)}))).then(a,s)}o((i=i.apply(e,[])).next())}));var e,c,i}}return t.\u0275fac=function(e){return new(e||t)(w.Vb(p.b),w.Vb(n.a),w.Vb(n.g),w.Vb(g.a),w.Vb(f.a),w.Vb(C.a),w.Vb(y.a),w.Vb(x.a),w.Vb(Q.a),w.Vb(J),w.Vb(K.a),w.Vb(Z.a),w.Vb(tt.a),w.Vb(ct.a),w.Vb(at.a),w.Vb(nt.a),w.Vb(it.a))},t.\u0275cmp=w.Pb({type:t,selectors:[["app-ticket-gestion"]],features:[w.Fb([y.a,x.a,ct.a,Q.a,J,K.a,Z.a,tt.a,it.a,nt.a,at.a])],decls:149,vars:54,consts:[["id","ticket",1,"row"],["id","ticket-dates",1,"col-md-5","col-lg-5","col-xl-4","text-break"],[1,"card",2,"height","100%"],[3,"expanded"],[1,"accordion-text"],[1,"list-group","p-0","m-0"],[1,"list-group-item"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"list-group",3,"routerLink"],[1,"row"],[1,"col-xl-3"],["class","rounded-circle mr-2","width","50","height","50","src","assets/images/system/user-placeholder.png",4,"ngIf"],["class","rounded-circle mr-2","width","50","height","50",3,"src",4,"ngIf"],["class","col-xl-8 align-self-center",4,"ngIf"],[1,"list-group"],[2,"font-size","18px"],[2,"margin-bottom","25px"],["class","rounded-circle img-agent-team","src","assets/images/system/company-placeholder.png",4,"ngIf"],["class","rounded-circle img-agent-team",3,"src",4,"ngIf"],["class","d-inline","style","margin-left: 10px;",4,"ngIf"],["class","rounded-circle img-agent-team","src","assets/images/system/team-placeholder.png",4,"ngIf"],["class","rounded-circle img-agent-team","src","assets/images/system/user-placeholder.png",4,"ngIf"],["class","list-group-item text-center",4,"ngIf"],[1,"col-md-6","col-lg-7","col-xl-8"],[1,"container","text-center"],["type","text","name","sub",3,"ngModel","ngModelChange",4,"ngIf"],["style","margin-left: 3px;","type","button","class","btn btn-dark dark","value","Aceptar",3,"click",4,"ngIf"],["style","margin-left: 3px;","type","button","class","btn btn-danger","value","Cancelar",3,"click",4,"ngIf"],["class","d-inline",3,"click",4,"ngIf"],["class","float-left",3,"routerLink",4,"ngIf"],[1,"float-left",3,"click"],["class","fa fa-info-circle enabled","style","margin-left: 8px;",4,"ngIf"],["class","fa fa-info-circle disabled","style","margin-left: 8px;",4,"ngIf"],["class","float-right",3,"routerLink",4,"ngIf"],["id","chatbox-scroll",1,"col","chatbox-scroll"],[3,"_id","text","sign","type","user","userId","date","files","info","deleteMessage","refresh","errorMessage",4,"ngFor","ngForOf"],["class","row","style","margin-top: 10px;",4,"ngIf"],[1,"row",2,"margin-top","10px"],["id","chat-text",1,"col",3,"ngClass"],[3,"ngSubmit"],["form","ngForm"],[1,"container",2,"border","1px solid #4e5257"],[1,"p-0"],["theme","snow","placeholder","Escribe aqui tu mensaje","name","autoDesc",3,"modules","ngModel","ngModelChange"],["id","options-container",1,"container"],["class","dropdown d-inline",4,"ngIf"],[1,"dropdown","d-inline"],["data-toggle","dropdown","aria-expanded","false","type","button",1,"btn","btn-dark","dropdown-toggle","dark",2,"margin-right","15px"],["role","menu",1,"dropdown-menu"],["role","presentation","class","dropdown-item",3,"click",4,"ngIf"],["role","presentation",1,"dropdown-item",3,"click"],["width","50","height","50","src","assets/images/system/user-placeholder.png",1,"rounded-circle","mr-2"],["width","50","height","50",1,"rounded-circle","mr-2",3,"src"],[1,"col-xl-8","align-self-center"],[1,"col"],["class","row",4,"ngIf"],["aria-hidden","true",1,"fa","fa-phone"],["class","dropdown d-inline float-right",4,"ngIf"],[1,"dropdown","d-inline","float-right"],["data-toggle","dropdown","aria-expanded","false","type","button",1,"btn","btn-dark","dropdown-toggle","dark"],["role","presentation","class","dropdown-item",3,"click",4,"ngFor","ngForOf"],["src","assets/images/system/company-placeholder.png",1,"rounded-circle","img-agent-team"],[1,"rounded-circle","img-agent-team",3,"src"],[1,"d-inline",2,"margin-left","10px"],["src","assets/images/system/team-placeholder.png",1,"rounded-circle","img-agent-team"],["src","assets/images/system/user-placeholder.png",1,"rounded-circle","img-agent-team"],["style","margin-top: 10px;",4,"ngIf"],[2,"margin-top","10px"],["type","date","name","resolveDate",2,"margin-right","5px",3,"ngModel","ngModelChange","change"],["resolveDate","ngModel"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item","text-center"],[1,"full-width"],[3,"ngModel","ngModelChange"],[3,"value","click",4,"ngFor","ngForOf"],["type","text","placeholder","Buscar insumo","aria-label","Text","matInput","",3,"ngModel","matAutocomplete","input","ngModelChange"],["autoStock","matAutocomplete"],[3,"matTooltip","click",4,"ngFor","ngForOf"],[3,"value","click"],[3,"matTooltip","click"],["class","rounded-circle mr-2","width","30","height","30",3,"src",4,"ngIf"],["class","rounded-circle mr-2","width","30","height","30","src","assets/images/system/user-placeholder.png",4,"ngIf"],["class","btn btn-danger float-right","type","button",3,"click",4,"ngIf"],["width","30","height","30",1,"rounded-circle","mr-2",3,"src"],["width","30","height","30","src","assets/images/system/user-placeholder.png",1,"rounded-circle","mr-2"],["type","button",1,"btn","btn-danger","float-right",3,"click"],[1,"fa","fa-trash"],["type","text","placeholder","Buscar persona","aria-label","Text","matInput","",3,"ngModel","matAutocomplete","input","ngModelChange"],["autoCC","matAutocomplete"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["type","text","name","sub",3,"ngModel","ngModelChange"],["type","button","value","Aceptar",1,"btn","btn-dark","dark",2,"margin-left","3px",3,"click"],["type","button","value","Cancelar",1,"btn","btn-danger",2,"margin-left","3px",3,"click"],[1,"d-inline",3,"click"],[1,"float-left",3,"routerLink"],[1,"fa","fa-arrow-circle-left","adjunt",2,"margin-left","6px"],[1,"fa","fa-info-circle","enabled",2,"margin-left","8px"],[1,"fa","fa-info-circle","disabled",2,"margin-left","8px"],[1,"float-right",3,"routerLink"],[1,"fa","fa-arrow-circle-right","adjunt",2,"margin-left","6px"],[3,"_id","text","sign","type","user","userId","date","files","info","deleteMessage","refresh","errorMessage"],["id","chat-text",1,"col"],[1,"container"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-open-mouth_1f603.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-open-mouth-and-smiling-eyes_1f604.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/grinning-face-with-smiling-eyes_1f601.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-open-mouth-and-tightly-closed-eyes_1f606.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-open-mouth-and-cold-sweat_1f605.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/face-with-tears-of-joy_1f602.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/winking-face_1f609.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-smiling-eyes_1f60a.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/face-with-stuck-out-tongue-and-winking-eye_1f61c.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/face-with-stuck-out-tongue-and-tightly-closed-eyes_1f61d.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/neutral-face_1f610.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/sleepy-face_1f62a.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/smiling-face-with-sunglasses_1f60e.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/astonished-face_1f632.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/face-with-cold-sweat_1f613.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/weary-face_1f629.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/angry-face_1f620.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/ok-hand-sign_1f44c.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/thumbs-up-sign_1f44d.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/thumbs-down-sign_1f44e.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/clapping-hands-sign_1f44f.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/person-raising-both-hands-in-celebration_1f64c.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/person-with-folded-hands_1f64f.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/eyes_1f440.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/skull-and-crossbones_2620.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/see-no-evil-monkey_1f648.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/hear-no-evil-monkey_1f649.png","width","30px",2,"margin-right","3px"],["src","https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/72/whatsapp/238/speak-no-evil-monkey_1f64a.png","width","30px",2,"margin-right","3px"],["type","submit",1,"btn","btn-primary","float-right",3,"disabled"],[1,"fa","fa-paper-plane"],["type","checkbox","name","isPrivate",3,"disabled","ngModel","ngModelChange"],[2,"margin-left","5px","margin-right","5px"],["id","hashtag",1,"dropdown","d-inline"],["data-toggle","dropdown","aria-expanded","false","type","button",1,"btn","dropdown-toggle"],[1,"fa","fa-hashtag","adjunt"],["role","menu","class","dropdown-menu",4,"ngIf"],["name","files","placeholder","Adjuntar archivos","multiple","",3,"ngModel","ngModelChange"],["removableInput",""],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],["data-toggle","dropdown","aria-expanded","false","type","button",2,"margin-right","15px",3,"ngClass","disabled"],["class","card","style","padding: 5px;border: 1px solid gray;",4,"ngIf"],[1,"card",2,"padding","5px","border","1px solid gray"],["mat-icon-button","","matSuffix","",3,"click"],["class","btn btn-danger float-right","title","Reabrir el ticket","type","button","style","margin-right: 15px;",3,"click",4,"ngIf"],["disabled","","data-toggle","dropdown","aria-expanded","false","type","button",1,"btn","btn-dark","dropdown-toggle","dark",2,"margin-right","15px"],["title","Reabrir el ticket","type","button",1,"btn","btn-danger","float-right",2,"margin-right","15px",3,"click"],[1,"fa","fa-unlock"]],template:function(t,e){1&t&&(w.bc(0,"mat-card"),w.bc(1,"div",0),w.bc(2,"div",1),w.bc(3,"div",2),w.bc(4,"mat-accordion"),w.bc(5,"mat-expansion-panel",3),w.bc(6,"mat-expansion-panel-header"),w.bc(7,"mat-panel-title"),w.bc(8,"strong",4),w.Vc(9,"Informaci\xf3n general"),w.ac(),w.ac(),w.ac(),w.bc(10,"ul",5),w.bc(11,"li",6),w.bc(12,"span"),w.Vc(13,"N\xfamero:\xa0"),w.ac(),w.bc(14,"span"),w.bc(15,"strong"),w.Vc(16),w.ac(),w.ac(),w.ac(),w.bc(17,"li",6),w.bc(18,"span"),w.Vc(19,"Creaci\xf3n:\xa0"),w.ac(),w.bc(20,"span"),w.bc(21,"strong"),w.Vc(22),w.ac(),w.ac(),w.ac(),w.bc(23,"li",6),w.bc(24,"span"),w.Vc(25,"Actualizado:\xa0"),w.ac(),w.bc(26,"span"),w.bc(27,"strong"),w.Vc(28),w.ac(),w.ac(),w.ac(),w.bc(29,"li",6),w.bc(30,"span"),w.Vc(31,"Prioridad:\xa0"),w.ac(),w.Tc(32,Vt,3,2,"span",7),w.Tc(33,Et,3,1,"span",7),w.ac(),w.bc(34,"li",6),w.bc(35,"span"),w.Vc(36," Tipo:\xa0 "),w.ac(),w.bc(37,"span"),w.Tc(38,jt,2,1,"strong",7),w.ac(),w.ac(),w.bc(39,"li",6),w.bc(40,"span"),w.Vc(41," Subtipo:\xa0 "),w.ac(),w.bc(42,"span"),w.Tc(43,qt,2,1,"strong",7),w.ac(),w.ac(),w.bc(44,"li",6),w.bc(45,"span"),w.Vc(46,"Fuente:\xa0"),w.ac(),w.bc(47,"span"),w.bc(48,"strong"),w.Vc(49),w.ac(),w.ac(),w.ac(),w.bc(50,"li",6),w.bc(51,"span"),w.Vc(52,"Fecha estimada de soluci\xf3n: "),w.bc(53,"span"),w.bc(54,"strong"),w.Vc(55),w.ac(),w.ac(),w.Vc(56,"\xa0"),w.ac(),w.Tc(57,Pt,5,1,"span",8),w.ac(),w.ac(),w.ac(),w.bc(58,"mat-expansion-panel"),w.bc(59,"mat-expansion-panel-header"),w.bc(60,"mat-panel-title"),w.bc(61,"strong",4),w.Vc(62,"Solicitante"),w.ac(),w.ac(),w.ac(),w.bc(63,"ul",9),w.bc(64,"li",6),w.bc(65,"div",10),w.bc(66,"div",11),w.Tc(67,Ft,1,0,"img",12),w.Tc(68,Rt,1,1,"img",13),w.ac(),w.Tc(69,At,8,3,"div",14),w.ac(),w.ac(),w.ac(),w.ac(),w.bc(70,"mat-expansion-panel"),w.bc(71,"mat-expansion-panel-header"),w.bc(72,"mat-panel-title"),w.bc(73,"strong",4),w.Vc(74,"Responsabilidad"),w.ac(),w.ac(),w.ac(),w.bc(75,"ul",15),w.bc(76,"li",6),w.bc(77,"span",16),w.bc(78,"strong"),w.Vc(79,"Departamento"),w.ac(),w.ac(),w.Tc(80,zt,2,1,"span",7),w.Wb(81,"div",17),w.Tc(82,Yt,1,0,"img",18),w.Tc(83,Nt,1,1,"img",19),w.Tc(84,Ut,3,0,"p",20),w.Tc(85,$t,3,1,"p",20),w.Wb(86,"hr"),w.bc(87,"span",16),w.bc(88,"strong"),w.Vc(89,"Equipo"),w.ac(),w.ac(),w.Tc(90,Xt,2,1,"span",7),w.Wb(91,"div",17),w.Tc(92,Jt,1,0,"img",21),w.Tc(93,Kt,1,1,"img",19),w.Tc(94,Zt,3,0,"p",20),w.Tc(95,te,3,1,"p",20),w.Wb(96,"hr"),w.bc(97,"span",16),w.bc(98,"strong"),w.Vc(99,"Agente"),w.ac(),w.ac(),w.Tc(100,ie,2,1,"span",7),w.Wb(101,"div",17),w.Tc(102,ne,1,0,"img",22),w.Tc(103,ae,1,1,"img",19),w.Tc(104,se,3,1,"p",20),w.Tc(105,oe,3,0,"p",20),w.Tc(106,le,2,1,"span",7),w.ac(),w.ac(),w.ac(),w.bc(107,"mat-expansion-panel"),w.bc(108,"mat-expansion-panel-header"),w.bc(109,"mat-panel-title"),w.bc(110,"strong",4),w.Vc(111,"Insumos"),w.ac(),w.ac(),w.ac(),w.bc(112,"ul",15),w.Tc(113,he,2,1,"span",7),w.Tc(114,me,11,5,"li",23),w.ac(),w.ac(),w.bc(115,"mat-expansion-panel"),w.bc(116,"mat-expansion-panel-header"),w.bc(117,"mat-panel-title"),w.bc(118,"strong",4),w.Vc(119,"En copia"),w.ac(),w.ac(),w.ac(),w.bc(120,"ul",15),w.Tc(121,xe,2,1,"span",7),w.Tc(122,Te,6,3,"li",23),w.ac(),w.ac(),w.ac(),w.ac(),w.ac(),w.bc(123,"div",24),w.bc(124,"div",25),w.Tc(125,_e,1,1,"input",26),w.Tc(126,we,1,0,"input",27),w.Tc(127,Ce,1,0,"input",28),w.Tc(128,Me,3,1,"h6",29),w.Tc(129,Ie,2,3,"a",30),w.bc(130,"a",31),w.jc("click",(function(t){return e.changeInfo()})),w.Tc(131,Ge,1,0,"i",32),w.Tc(132,Oe,1,0,"i",33),w.ac(),w.Tc(133,Ve,2,3,"a",34),w.ac(),w.bc(134,"div",10),w.bc(135,"div",35),w.Tc(136,Ee,1,9,"app-chatbox",36),w.ac(),w.Wb(137,"span"),w.ac(),w.Tc(138,je,60,0,"div",37),w.bc(139,"div",38),w.bc(140,"div",39),w.bc(141,"form",40,41),w.jc("ngSubmit",(function(t){return e.onSubmit()})),w.bc(143,"div",42),w.bc(144,"mat-card-content",43),w.bc(145,"quill-editor",44),w.jc("ngModelChange",(function(t){return e.textblock.text=t})),w.ac(),w.ac(),w.ac(),w.bc(146,"div",45),w.Tc(147,De,22,11,"span",7),w.Tc(148,Ne,11,5,"span",7),w.ac(),w.ac(),w.ac(),w.ac(),w.ac(),w.ac(),w.ac()),2&t&&(w.Gb(5),w.uc("expanded",!0),w.Gb(11),w.Xc("#",e.ticket.numTicket,""),w.Gb(6),w.Wc(e.changeDate(e.ticket.createDate)),w.Gb(6),w.Wc(e.changeDate(e.ticket.lastActivity)),w.Gb(4),w.uc("ngIf",e.identity.company),w.Gb(1),w.uc("ngIf",!e.identity.company),w.Gb(5),w.uc("ngIf",e.ticket.subTypeTicket),w.Gb(5),w.uc("ngIf",e.ticket.subTypeTicket),w.Gb(6),w.Wc(e.ticket.source),w.Gb(6),w.Wc(e.ticket.resolveDate),w.Gb(2),w.uc("ngForOf",e.ticket.tags),w.Gb(6),w.uc("routerLink",w.Ac(50,Ue,e.ticket.requester._id)),w.Gb(4),w.uc("ngIf","null"==e.ticket.requester.image),w.Gb(1),w.uc("ngIf","null"!=e.ticket.requester.image),w.Gb(1),w.uc("ngIf",e.ticket.requester),w.Gb(11),w.uc("ngIf",e.identity.company),w.Gb(2),w.uc("ngIf",!e.ticket.company||"null"==e.ticket.company.image),w.Gb(1),w.uc("ngIf",e.ticket.company&&"null"!=e.ticket.company.image),w.Gb(1),w.uc("ngIf",!e.ticket.company),w.Gb(1),w.uc("ngIf",e.ticket.company),w.Gb(5),w.uc("ngIf",e.identity.company),w.Gb(2),w.uc("ngIf",!e.ticket.team||"null"==e.ticket.team.image),w.Gb(1),w.uc("ngIf",e.ticket.team&&"null"!=e.ticket.team.image),w.Gb(1),w.uc("ngIf",!e.ticket.team),w.Gb(1),w.uc("ngIf",e.ticket.team),w.Gb(5),w.uc("ngIf",e.identity.company),w.Gb(2),w.uc("ngIf",!e.ticket.agent||"null"==e.ticket.agent.image),w.Gb(1),w.uc("ngIf",e.ticket.agent&&"null"!=e.ticket.agent.image),w.Gb(1),w.uc("ngIf",e.ticket.agent),w.Gb(1),w.uc("ngIf",!e.ticket.agent),w.Gb(1),w.uc("ngIf",e.identity.company),w.Gb(7),w.uc("ngIf",e.movimsTicket&&0!=e.getLenght(e.movimsTicket)),w.Gb(1),w.uc("ngIf","ROLE_REQUESTER"!=e.identity.role&&e.identity.company._id==e.ticket.company._id&&"Cerrado"!=e.ticket.status),w.Gb(7),w.uc("ngIf",e.ticket.cc&&0!=e.getLenght(e.ticket.cc)),w.Gb(1),w.uc("ngIf","Cerrado"!=e.ticket.status),w.Gb(3),w.uc("ngIf",e.editSub),w.Gb(1),w.uc("ngIf",e.editSub),w.Gb(1),w.uc("ngIf",e.editSub),w.Gb(1),w.uc("ngIf",!e.editSub),w.Gb(1),w.uc("ngIf",("ROLE_REQUESTER"==e.identity.role||e.ticket.agent)&&e.prev),w.Gb(2),w.uc("ngIf","true"==e.info),w.Gb(1),w.uc("ngIf","false"==e.info),w.Gb(1),w.uc("ngIf",("ROLE_REQUESTER"==e.identity.role||e.ticket.agent)&&e.next),w.Gb(3),w.uc("ngForOf",e.chat),w.Gb(2),w.uc("ngIf",e.emojis),w.Gb(2),w.uc("ngClass",w.Ac(52,$e,e.isPrivate)),w.Gb(5),w.uc("modules",e.config)("ngModel",e.textblock.text),w.Gb(2),w.uc("ngIf",e.identity.company),w.Gb(1),w.uc("ngIf",!e.identity.company))},directives:[l.a,ot.a,ot.c,ot.d,ot.e,i.m,i.l,n.h,i.k,rt.a,a.x,a.o,a.p,l.c,lt.a,a.n,a.q,a.c,h.a,h.d,S.a,s.b,ut.c,ut.a,_.p,b.a,n.j,Ct,a.a,Mt.a,r.b,h.e,o.a],styles:["#ticket-dates[_ngcontent-%COMP%]{overflow-y:auto}@media (max-width:992px){#ticket-dates[_ngcontent-%COMP%]{border-bottom:1px solid #737373}}.info-card[_ngcontent-%COMP%]{width:100%;padding-top:0}.container.title-container[_ngcontent-%COMP%]{margin-bottom:0}.title[_ngcontent-%COMP%]{width:100%}.card-body.card-req-tickets[_ngcontent-%COMP%]{height:250px;overflow-y:scroll}.chatbox-scroll[_ngcontent-%COMP%]{overflow-y:scroll;height:300px}.card.chatbox[_ngcontent-%COMP%]{max-width:80%;min-height:30%;border:1px solid #1e2833;margin:10px}.adjunt[_ngcontent-%COMP%]{cursor:pointer;font-size:20px;color:#7979ff}.chatinfo[_ngcontent-%COMP%]{border:1px solid #1e2833;margin:10px}.chat-header[_ngcontent-%COMP%]{height:30px;display:flex;background-color:#1e2833;color:#fff}#chat-textbox[_ngcontent-%COMP%]{width:100%;min-height:100px}.container[_ngcontent-%COMP%]{padding-top:5px}.disabled[_ngcontent-%COMP%]{color:red}.disabled[_ngcontent-%COMP%], .enabled[_ngcontent-%COMP%]{cursor:pointer;font-size:20px}.enabled[_ngcontent-%COMP%]{color:green}.img-requester[_ngcontent-%COMP%]{width:50px;height:50px}.img-agent-team[_ngcontent-%COMP%]{width:30px;height:30px}.status-buble[_ngcontent-%COMP%]{color:#fff;padding:5px 10px}.pending[_ngcontent-%COMP%]{background-color:#f7813e}.finish[_ngcontent-%COMP%]{background-color:#10e00c}.closer[_ngcontent-%COMP%]{background-color:#929292}.open[_ngcontent-%COMP%]{background-color:#47b8b8}.privatechattext[_ngcontent-%COMP%]{background-color:#676767;color:#fff}li[_ngcontent-%COMP%]{padding-top:9px;padding-bottom:9px}mat-card[_ngcontent-%COMP%]{padding-left:10px}.accordion-text[_ngcontent-%COMP%]{font-size:16px}"]}),t})();var Qe=c("rpG9"),Xe=c("Xwq+"),Je=c("xHqg"),Ke=c("bSwM");function Ze(t,e){1&t&&w.Vc(0,"Solicitante")}function tc(t,e){if(1&t&&(w.bc(0,"mat-option",33),w.Vc(1),w.ac()),2&t){const t=e.$implicit;w.uc("value",t),w.Gb(1),w.Xc(" ",t.name+" "+t.surname," ")}}function ec(t,e){1&t&&w.Wb(0,"img",34)}function cc(t,e){if(1&t&&w.Wb(0,"img",35),2&t){const t=w.nc(2);w.vc("src",t.url+"user/image/"+t.requester.image,w.Oc)}}function ic(t,e){if(1&t&&(w.bc(0,"div",36),w.bc(1,"div",37),w.bc(2,"div",38),w.bc(3,"span"),w.bc(4,"strong"),w.Vc(5),w.ac(),w.ac(),w.ac(),w.ac(),w.bc(6,"div",37),w.bc(7,"div",38),w.bc(8,"span"),w.bc(9,"em"),w.Vc(10),w.ac(),w.ac(),w.ac(),w.ac(),w.bc(11,"div",37),w.bc(12,"div",38),w.bc(13,"span"),w.bc(14,"em"),w.Vc(15),w.ac(),w.ac(),w.ac(),w.ac(),w.ac()),2&t){const t=w.nc(2);w.Gb(5),w.Yc("",t.requester.name," ",t.requester.surname,""),w.Gb(5),w.Wc(t.requester.email),w.Gb(5),w.Wc(t.requester.phone)}}function nc(t,e){if(1&t){const t=w.cc();w.bc(0,"mat-step",24),w.Tc(1,Ze,1,0,"ng-template",5),w.bc(2,"form",11),w.bc(3,"div",7),w.bc(4,"mat-form-field",8),w.bc(5,"input",25),w.jc("input",(function(e){return w.Mc(t),w.nc().filterRequester(e.target.value)})),w.ac(),w.bc(6,"mat-autocomplete",26,27),w.jc("optionSelected",(function(e){return w.Mc(t),w.nc().setRequester(e.option.value)})),w.Tc(8,tc,2,2,"mat-option",28),w.ac(),w.ac(),w.Wb(9,"span",10),w.bc(10,"div",8),w.bc(11,"div",29),w.Tc(12,ec,1,0,"img",30),w.Tc(13,cc,1,1,"img",31),w.ac(),w.Tc(14,ic,16,4,"div",32),w.ac(),w.ac(),w.ac(),w.bc(15,"div"),w.bc(16,"button",21),w.Vc(17,"Siguiente"),w.ac(),w.ac(),w.ac()}if(2&t){const t=w.Jc(7),e=w.nc();w.uc("stepControl",e.requesterControl),w.Gb(5),w.uc("matAutocomplete",t),w.Gb(1),w.uc("displayWith",e.displayRequester),w.Gb(2),w.uc("ngForOf",e.requesters),w.Gb(4),w.uc("ngIf",!e.requester||"null"==e.requester.image),w.Gb(1),w.uc("ngIf",e.requester&&"null"!=e.requester.image),w.Gb(1),w.uc("ngIf",e.requester&&""!=e.requester._id),w.Gb(2),w.uc("disabled",!e.requester)}}function ac(t,e){1&t&&w.Vc(0,"Tipo de ticket")}function sc(t,e){if(1&t){const t=w.cc();w.bc(0,"mat-option",42),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc(2).setCompany(i)})),w.Vc(1),w.ac()}if(2&t){const t=e.$implicit;w.uc("value",t),w.Gb(1),w.Xc("",t.name," ")}}function oc(t,e){if(1&t){const t=w.cc();w.bc(0,"mat-option",42),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc(3).setType(i)})),w.Vc(1),w.ac()}if(2&t){const t=e.$implicit;w.uc("value",t),w.Gb(1),w.Xc("",t.name," ")}}function rc(t,e){if(1&t&&(w.bc(0,"mat-form-field",8),w.bc(1,"mat-label"),w.Vc(2,"Tipo"),w.ac(),w.bc(3,"mat-select"),w.Tc(4,oc,2,2,"mat-option",40),w.ac(),w.ac()),2&t){const t=w.nc(2);w.Gb(4),w.uc("ngForOf",t.types)}}function lc(t,e){if(1&t){const t=w.cc();w.bc(0,"mat-option",42),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc(3).setSubType(i)})),w.Vc(1),w.ac()}if(2&t){const t=e.$implicit;w.uc("value",t),w.Gb(1),w.Xc("",t.name," ")}}function uc(t,e){if(1&t&&(w.bc(0,"mat-form-field",8),w.bc(1,"mat-label"),w.Vc(2,"Sub-tipo"),w.ac(),w.bc(3,"mat-select"),w.Tc(4,lc,2,2,"mat-option",40),w.ac(),w.ac()),2&t){const t=w.nc(2);w.Gb(4),w.uc("ngForOf",t.subTypes)}}function dc(t,e){if(1&t&&(w.bc(0,"mat-step",39),w.Tc(1,ac,1,0,"ng-template",5),w.bc(2,"form",6),w.bc(3,"div",7),w.bc(4,"mat-form-field",8),w.bc(5,"mat-label"),w.Vc(6,"Departamento"),w.ac(),w.bc(7,"mat-select"),w.Tc(8,sc,2,2,"mat-option",40),w.ac(),w.ac(),w.ac(),w.bc(9,"div",7),w.Tc(10,rc,5,1,"mat-form-field",41),w.Wb(11,"span",10),w.Tc(12,uc,5,1,"mat-form-field",41),w.ac(),w.bc(13,"div",18),w.bc(14,"button",21),w.Vc(15,"Siguiente"),w.ac(),w.ac(),w.ac(),w.ac()),2&t){const t=w.nc();w.uc("stepControl",t.typeControl),w.Gb(2),w.uc("formGroup",t.typeControl),w.Gb(6),w.uc("ngForOf",t.companies),w.Gb(2),w.uc("ngIf",t.types),w.Gb(2),w.uc("ngIf",t.subTypes),w.Gb(2),w.uc("disabled",t.typeControl.invalid)}}function hc(t,e){1&t&&w.Vc(0,"Asunto y descripci\xf3n")}function pc(t,e){if(1&t){const t=w.cc();w.bc(0,"button",43),w.jc("click",(function(e){return w.Mc(t),w.nc(),w.Jc(15).clear(e)})),w.bc(1,"mat-icon"),w.Vc(2,"clear"),w.ac(),w.ac()}}function bc(t,e){1&t&&(w.bc(0,"mat-checkbox",44),w.Vc(1,"Es urgente "),w.ac()),2&t&&w.uc("color","primary")}function mc(t,e){1&t&&w.Vc(0,"Responsables")}function gc(t,e){if(1&t){const t=w.cc();w.bc(0,"mat-option",42),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc(2).setTeam(i)})),w.Vc(1),w.ac()}if(2&t){const t=e.$implicit;w.uc("value",t),w.Gb(1),w.Xc("",t.name," ")}}function fc(t,e){if(1&t){const t=w.cc();w.bc(0,"mat-option",42),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc(3).setAgent(i)})),w.Vc(1),w.ac()}if(2&t){const t=e.$implicit;w.uc("value",t),w.Gb(1),w.Yc("",t.name," ",t.surname," ")}}function kc(t,e){if(1&t&&(w.bc(0,"mat-form-field",8),w.bc(1,"mat-label"),w.Vc(2,"Agente"),w.ac(),w.bc(3,"mat-select"),w.Tc(4,fc,2,3,"mat-option",40),w.ac(),w.ac()),2&t){const t=w.nc(2);w.Gb(4),w.uc("ngForOf",t.agents)}}function yc(t,e){if(1&t){const t=w.cc();w.bc(0,"mat-step",45),w.Tc(1,mc,1,0,"ng-template",5),w.bc(2,"form",6),w.bc(3,"div",7),w.bc(4,"mat-form-field",8),w.bc(5,"mat-label"),w.Vc(6,"Equipo"),w.ac(),w.bc(7,"mat-select"),w.Tc(8,gc,2,2,"mat-option",40),w.ac(),w.ac(),w.Wb(9,"span",10),w.Tc(10,kc,5,1,"mat-form-field",41),w.ac(),w.bc(11,"div",18),w.bc(12,"button",19),w.Vc(13,"Anterior"),w.ac(),w.Wb(14,"span",20),w.bc(15,"button",46),w.jc("click",(function(e){return w.Mc(t),w.nc().submit()})),w.Vc(16,"Crear ticket"),w.ac(),w.ac(),w.ac(),w.ac()}if(2&t){const t=w.nc();w.uc("stepControl",t.respControl),w.Gb(2),w.uc("formGroup",t.respControl),w.Gb(6),w.uc("ngForOf",t.teams),w.Gb(2),w.uc("ngIf",t.agents)}}function xc(t,e){1&t&&w.Vc(0,"En copia")}function vc(t,e){if(1&t){const t=w.cc();w.bc(0,"mat-option",54),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc(2).setCc(i)})),w.Vc(1),w.ac()}if(2&t){const t=e.$implicit;w.Gb(1),w.Xc(" ",t.name+" "+t.surname," ")}}function Tc(t,e){if(1&t&&w.Wb(0,"img",61),2&t){const t=w.nc().$implicit,e=w.nc(3);w.vc("src",e.url+"user/image/"+t.image,w.Oc)}}function _c(t,e){1&t&&w.Wb(0,"img",62)}function wc(t,e){if(1&t){const t=w.cc();w.bc(0,"li",56),w.Tc(1,Tc,1,1,"img",57),w.Tc(2,_c,1,0,"img",58),w.bc(3,"span"),w.Vc(4),w.ac(),w.bc(5,"button",59),w.jc("click",(function(c){w.Mc(t);const i=e.$implicit;return w.nc(3).deleteCc(i)})),w.Wb(6,"i",60),w.ac(),w.ac()}if(2&t){const t=e.$implicit;w.Gb(1),w.uc("ngIf","null"!=t.image),w.Gb(1),w.uc("ngIf","null"==t.image),w.Gb(2),w.Yc("",t.name," ",t.surname,"")}}function Cc(t,e){if(1&t&&(w.bc(0,"span"),w.Tc(1,wc,7,4,"li",55),w.ac()),2&t){const t=w.nc(2);w.Gb(1),w.uc("ngForOf",t.cc)}}function Mc(t,e){if(1&t){const t=w.cc();w.bc(0,"mat-step",47),w.Tc(1,xc,1,0,"ng-template",5),w.bc(2,"form",11),w.bc(3,"div",7),w.bc(4,"mat-form-field",48),w.bc(5,"input",49),w.jc("input",(function(e){return w.Mc(t),w.nc().filterCc()}))("ngModelChange",(function(e){return w.Mc(t),w.nc().ccFilter=e})),w.ac(),w.bc(6,"mat-autocomplete",null,50),w.Tc(8,vc,2,1,"mat-option",51),w.ac(),w.ac(),w.ac(),w.bc(9,"div",7),w.bc(10,"ul",52),w.Tc(11,Cc,2,1,"span",53),w.ac(),w.ac(),w.bc(12,"div",18),w.bc(13,"button",19),w.Vc(14,"Anterior"),w.ac(),w.Wb(15,"span",20),w.bc(16,"button",46),w.jc("click",(function(e){return w.Mc(t),w.nc().submit()})),w.Vc(17,"Crear ticket"),w.ac(),w.ac(),w.ac(),w.ac()}if(2&t){const t=w.Jc(7),e=w.nc();w.Gb(5),w.uc("ngModel",e.ccFilter)("matAutocomplete",t),w.Gb(3),w.uc("ngForOf",e.ccList),w.Gb(3),w.uc("ngIf",0!=e.getLenght(e.cc))}}const Sc=[{path:"",children:[{path:"list/:page/:limit",component:N,data:{title:"Lista",breadcrumb:"LISTA"}},{path:"gestion/:id",component:He,data:{title:"Gesti\xf3n",breadcrumb:"GESTION"}},{path:"new",component:(()=>{class t{constructor(t,e,c,i,n,a,s,o,r,l,u){this._ticketService=t,this._userService=e,this._textBlockService=c,this._uploadService=i,this.snackBar=n,this._teamService=a,this._companyService=s,this._router=o,this.loader=r,this._typeTicketService=l,this._subTypeTicketService=u,this.url=v.a.url,this.config=v.a.richTextModule,this.ccList=[],this.allCcList=[],this.ccFilter="",this.token=e.getToken(),this.identity=e.getIdentity(),this.cc=new Array}ngOnInit(){"ROLE_REQUESTER"==this.identity.role?(this.getCompany(),this.getCc()):(this.getTeams(),this.getRequesters()),this.buildForm()}buildForm(){this.requesterControl=new a.h({requester:new a.e(null,[a.v.required])}),this.descriptionControl=new a.h({sub:new a.e(null,[a.v.required]),text:new a.e(null,[a.v.required]),important:new a.e(!1),files:new a.e(void 0)}),this.respControl=new a.h({team:new a.e(null,[a.v.required]),agent:new a.e(null,[a.v.required])}),this.typeControl=new a.h({company:new a.e(null,[a.v.required]),subtype:new a.e(null,[a.v.required]),resolve:new a.e(null)})}getRequesters(){this._userService.getListReq(this.token,this.identity.company._id).subscribe(t=>{t.users&&(this.requesters=t.users,this.tempRequesters=t.users)},t=>{this.openSnackBar(t.message,"Cerrar")})}getTeams(){this._teamService.getList(this.token,this.identity.company._id).subscribe(t=>{t.teams&&(this.teams=t.teams)},t=>{this.openSnackBar(t.message,"Cerrar")})}getTypes(t){this._typeTicketService.getList(this.token,t).subscribe(t=>{t.typeTickets&&(this.types=t.typeTickets)},t=>{this.openSnackBar(t.message,"Cerrar")})}getSubTypes(t){this._subTypeTicketService.getList(this.token,t).subscribe(t=>{t.subTypeTickets&&(this.subTypes=t.subTypeTickets)},t=>{this.openSnackBar(t.message,"Cerrar")})}getCompany(){this._companyService.getList(this.token).subscribe(t=>{t.companies&&(this.companies=t.companies)},t=>{this.openSnackBar(t.message,"Cerrar")})}getCc(){this._userService.getList(this.token).subscribe(t=>{t.users&&(this.allCcList=t.users)},t=>{this.openSnackBar(t.message,"Cerrar")})}setTeam(t){this.respControl.controls.team.setValue(t._id),this.getAgents(t.users)}setCompany(t){this.typeControl.controls.company.setValue(t._id),this.typeControl.controls.subtype.setValue(null),this.subTypes=null,this.getTypes(t._id)}setType(t){this.getSubTypes(t._id)}setSubType(t){this.subType=t,this.typeControl.controls.subtype.setValue(t._id),this.descriptionControl.controls.sub.setValue(null),this.descriptionControl.controls.text.setValue(null),t.autoSub&&""!=t.autoSub&&this.descriptionControl.controls.sub.setValue(t.autoSub),t.autoDesc&&""!=t.autoDesc&&this.descriptionControl.controls.text.setValue(t.autoDesc),this.respControl.controls.team.setValue(null),t.team&&this.respControl.controls.team.setValue(t.team._id),this.setResolve(t)}getAgents(t){this.agents=t,this.tempAgents=t}setAgent(t){this.respControl.controls.agent.setValue(t._id)}setRequester(t){this.requesterControl.controls.requester.setValue(t._id),this.requester=t}setResolve(t){let e=k().add(t.resolveDays,"days").format("DD-MM-YYYY");6!=k(e,"DD-MM-YYYY").weekday()&&0!=k(e,"DD-MM-YYYY").weekday()||(e=k(e,"DD-MM-YYYY").add(2,"days").format("DD-MM-YYYY")),this.typeControl.controls.resolve.setValue(e)}filterRequester(t){this.requesters=this.tempRequesters.filter(e=>(e.name+e.surname).toLowerCase().includes(t.toString().toLowerCase()))}resetFiles(){this.descriptionControl.controls.files.setValue(void 0),this.openSnackBar("Adjuntos eliminados","Cerrar")}getLenght(t){return t.length}displayRequester(t){return t.name+" "+t.surname}submit(){if(this.loader.open("Generando ticket"),"ROLE_REQUESTER"!=this.identity.role)this.ticket=new U("","",null,null,null,null,"Abierto","","",null,null,"MANUAL",[null],"Normal",this.identity.company._id,null,new Array,null,null,""),this.ticket.requester=this.requesterControl.controls.requester.value,this.descriptionControl.controls.important.value&&(this.ticket.priority="Urgente"),this.respControl.controls.agent.value&&(this.ticket.agent=this.respControl.controls.agent.value),this.ticket.source="MANUAL";else if(this.ticket=new U("","",null,this.identity._id,null,null,"Abierto","","",null,null,"MANUAL",[null],"Normal",null,null,new Array,null,null,""),this.ticket.company=this.typeControl.controls.company.value,this.ticket.subTypeTicket=this.typeControl.controls.subtype.value,this.ticket.source="PORTAL",this.ticket.resolveDate=this.typeControl.controls.resolve.value,0!=this.cc.length){let t=new Array;this.cc.forEach(e=>{t.push(e._id)}),this.ticket.cc=t}this.ticket.sub=this.descriptionControl.controls.sub.value,this.respControl.controls.team.value&&(this.ticket.team=this.respControl.controls.team.value,this.ticket.status="Pendiente"),this._ticketService.add(this.token,this.ticket).subscribe(t=>{t.ticket&&(this.text=new H("",this.descriptionControl.controls.text.value,this.identity._id,"",t.ticket._id,"PUBLIC",[null],!1),"ROLE_REQUESTER"==this.identity.role&&(this.text.type="REQUEST"),this._textBlockService.add(this.token,this.text).subscribe(t=>{t.textblock&&(null!=this.descriptionControl.controls.files.value&&null!=this.descriptionControl.controls.files.value?this._uploadService.makeFileRequest(this.url+"textblock/file/"+t.textblock._id,[],this.descriptionControl.controls.files.value.files,this.token,"file").then(t=>{this.loader.close()},t=>{this.openSnackBar(t.message,"Cerrar")}):this.loader.close(),this.openSnackBar("Ticket generado correctamente","Cerrar"),this._router.navigate(["/ticket/gestion",t.textblock.ticket]))},t=>{this.loader.close(),this.openSnackBar(t.message,"Cerrar")}))},t=>{this.loader.close(),this.openSnackBar(t.message,"Cerrar")})}isInvalid(){return!!this.descriptionControl.invalid||"ROLE_REQUESTER"==this.identity.role&&0!=this.subType.autoChange&&null!=this.subType.autoChange&&this.descriptionControl.controls.text.value==this.subType.autoDesc&&this.descriptionControl.controls.sub.value==this.subType.autoSub}fileChangeEvent(t){this.descriptionControl.controls.files.setValue(t.target.files),this.openSnackBar("Adjuntos a\xf1adidos","Cerrar")}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}filterCc(){this.ccList=this.allCcList.filter(t=>(t.name+t.surname).toLowerCase().includes(this.ccFilter.toString().toLowerCase()))}setCc(t){-1==this.cc.indexOf(t)&&this.cc.push(t)}deleteCc(t){-1!=this.cc.indexOf(t)&&this.cc.splice(this.cc.indexOf(t),1)}}return t.\u0275fac=function(e){return new(e||t)(w.Vb(x.a),w.Vb(y.a),w.Vb(J),w.Vb(K.a),w.Vb(C.a),w.Vb(Q.a),w.Vb(tt.a),w.Vb(n.g),w.Vb(f.a),w.Vb(Qe.a),w.Vb(Xe.a))},t.\u0275cmp=w.Pb({type:t,selectors:[["app-new-ticket"]],features:[w.Fb([Q.a,J,K.a,Qe.a,Xe.a,tt.a])],decls:30,vars:11,consts:[[1,"p-0"],[3,"linear"],["id","requesterStep",3,"stepControl",4,"ngIf"],["id","typeStep",3,"stepControl",4,"ngIf"],["id","descriptionStep",3,"stepControl"],["matStepLabel",""],["fxFlex","",3,"formGroup"],["fxLayout","row wrap","fxLayout.lt-sm","column"],["fxFlex","",1,"full-width"],["type","text","placeholder","Asunto","aria-label","Text","formControlName","sub","matInput",""],["fxFlex","16px"],["fxFlex",""],["fxFlex","","formControlName","files","name","files","placeholder","Adjuntar archivos","multiple",""],["removableInput",""],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],["fxFlex","","class","full-width","formControlName","important","name","sectorRef",3,"color",4,"ngIf"],["fxFlex","",1,"p-0"],["theme","snow","placeholder","Escribe aqui tu mensaje","name","autoDesc","formControlName","text",3,"modules"],["fxLayout","row"],["mat-raised-button","","color","accent","matStepperPrevious",""],["fxFlex","8px"],["mat-raised-button","","color","primary","matStepperNext","",3,"disabled"],["id","respStep",3,"stepControl",4,"ngIf"],["id","ccStep",3,"stepControl",4,"ngIf"],["id","requesterStep",3,"stepControl"],["type","text","placeholder","Buscar solicitante","aria-label","Text","matInput","",3,"matAutocomplete","input"],[3,"displayWith","optionSelected"],["autoReq","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"col-xl-5"],["style","width: 150px;height: 150px;","src","assets/images/system/user-placeholder.png",4,"ngIf"],["style","width: 150px;height: 150px;",3,"src",4,"ngIf"],["class","col-xl-6 align-self-center",4,"ngIf"],[3,"value"],["src","assets/images/system/user-placeholder.png",2,"width","150px","height","150px"],[2,"width","150px","height","150px",3,"src"],[1,"col-xl-6","align-self-center"],[1,"form-row"],[1,"col"],["id","typeStep",3,"stepControl"],[3,"value","click",4,"ngFor","ngForOf"],["fxFlex","","class","full-width",4,"ngIf"],[3,"value","click"],["mat-icon-button","","matSuffix","",3,"click"],["fxFlex","","formControlName","important","name","sectorRef",1,"full-width",3,"color"],["id","respStep",3,"stepControl"],["mat-raised-button","","color","primary","matStepperNext","",3,"click"],["id","ccStep",3,"stepControl"],[1,"full-width"],["type","text","placeholder","Buscar persona","aria-label","Text","matInput","","name","ccFilter",3,"ngModel","matAutocomplete","input","ngModelChange"],["autoCC","matAutocomplete"],[3,"click",4,"ngFor","ngForOf"],[1,"list-group","full-width"],[4,"ngIf"],[3,"click"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],["class","rounded-circle mr-2","width","30","height","30",3,"src",4,"ngIf"],["class","rounded-circle mr-2","width","30","height","30","src","assets/images/system/user-placeholder.png",4,"ngIf"],["type","button",1,"btn","btn-danger","float-right",3,"click"],[1,"fa","fa-trash"],["width","30","height","30",1,"rounded-circle","mr-2",3,"src"],["width","30","height","30","src","assets/images/system/user-placeholder.png",1,"rounded-circle","mr-2"]],template:function(t,e){if(1&t&&(w.bc(0,"mat-card",0),w.bc(1,"mat-card-content"),w.bc(2,"mat-horizontal-stepper",1),w.Tc(3,nc,18,8,"mat-step",2),w.Tc(4,dc,16,6,"mat-step",3),w.bc(5,"mat-step",4),w.Tc(6,hc,1,0,"ng-template",5),w.bc(7,"form",6),w.bc(8,"div",7),w.bc(9,"mat-form-field",8),w.Wb(10,"input",9),w.ac(),w.Wb(11,"span",10),w.bc(12,"div",11),w.bc(13,"mat-form-field"),w.Wb(14,"ngx-mat-file-input",12,13),w.Tc(16,pc,3,0,"button",14),w.ac(),w.ac(),w.Wb(17,"span",10),w.Tc(18,bc,2,1,"mat-checkbox",15),w.ac(),w.bc(19,"div",7),w.bc(20,"mat-card-content",16),w.Wb(21,"quill-editor",17),w.ac(),w.ac(),w.bc(22,"div",18),w.bc(23,"button",19),w.Vc(24,"Anterior"),w.ac(),w.Wb(25,"span",20),w.bc(26,"button",21),w.Vc(27,"Siguiente"),w.ac(),w.ac(),w.ac(),w.ac(),w.Tc(28,yc,17,4,"mat-step",22),w.Tc(29,Mc,18,4,"mat-step",23),w.ac(),w.ac(),w.ac()),2&t){const t=w.Jc(15);w.Gb(2),w.uc("linear",!0),w.Gb(1),w.uc("ngIf","ROLE_REQUESTER"!=e.identity.role),w.Gb(1),w.uc("ngIf","ROLE_REQUESTER"==e.identity.role),w.Gb(1),w.uc("stepControl",e.descriptionControl),w.Gb(2),w.uc("formGroup",e.descriptionControl),w.Gb(9),w.uc("ngIf",!t.empty),w.Gb(2),w.uc("ngIf","ROLE_REQUESTER"!=e.identity.role),w.Gb(3),w.uc("modules",e.config),w.Gb(5),w.uc("disabled",e.isInvalid()),w.Gb(2),w.uc("ngIf","ROLE_REQUESTER"!=e.identity.role),w.Gb(1),w.uc("ngIf","ROLE_REQUESTER"==e.identity.role)}},directives:[l.a,l.c,Je.a,i.m,Je.b,Je.c,a.x,a.o,M.b,a.i,M.d,h.a,a.c,s.b,a.n,a.g,Mt.a,lt.a,r.b,Je.f,Je.e,a.p,ut.c,ut.a,i.l,_.p,h.d,S.a,h.e,o.a,Ke.a,a.q],styles:[".butt[_ngcontent-%COMP%]{background-color:#018aca}.butt[_ngcontent-%COMP%], .butt-trash[_ngcontent-%COMP%]{font-size:12px;font-weight:300;color:#fff;display:inline-block;transition:all .5s;cursor:pointer;padding:10px 15px!important;text-transform:uppercase;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;text-align:center}.butt-trash[_ngcontent-%COMP%]{background-color:#ff1717}"]}),t})(),data:{title:"Nuevo",breadcrumb:"NUEVO"}}]}];var Ic=c("YUcS");c.d(e,"TicketModule",(function(){return Gc}));let Gc=(()=>{class t{}return t.\u0275mod=w.Tb({type:t}),t.\u0275inj=w.Sb({factory:function(e){return new(e||t)},providers:[x.a,y.a],imports:[[a.j,i.c,Mt.b,Je.d,S.b,a.t,Ic.a,ut.b,ot.b,Ke.b,p.f,b.b,lt.b,d.b,m.a,s.c,h.c,o.b,r.c,l.e,u.b,n.k.forChild(Sc)]]}),t})()},Q2c7:function(t,e,c){"use strict";c.d(e,"a",(function(){return s})),c("AJX/");var i=c("YFeJ"),n=c("fXoL"),a=c("qlzE");let s=(()=>{class t{constructor(t){this._http=t,this.url=i.a.url}makeFileRequest(t,e,c,i,n){return new Promise((function(e,a){for(var s=new FormData,o=new XMLHttpRequest,r=0;r<c.length;r++)s.append(n,c[r],c[r].name);o.onreadystatechange=function(){4==o.readyState&&(200==o.status?e(JSON.parse(o.response)):a(o.response))},o.open("POST",t,!0),o.setRequestHeader("Authorization",i),o.send(s)}))}}return t.\u0275fac=function(e){return new(e||t)(n.fc(a.a))},t.\u0275prov=n.Rb({token:t,factory:t.\u0275fac}),t})()}}]);