function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var c=Object.prototype.toString.call(e).slice(8,-1);return"Object"===c&&e.constructor&&(c=e.constructor.name),"Map"===c||"Set"===c?Array.from(e):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var c=0,r=new Array(t);c<t;c++)r[c]=e[c];return r}function _defineProperties(e,t){for(var c=0;c<t.length;c++){var r=t[c];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,c){return t&&_defineProperties(e.prototype,t),c&&_defineProperties(e,c),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{"9Mbw":function(e,t,c){"use strict";c.r(t);var r=c("ofXK"),n=c("tyNb"),a=c("3Pt+"),o=c("qFsG"),i=c("NFeN"),s=c("bTqV"),d=c("Wp6s"),u=c("f0Cb"),l=c("kmnG"),b=c("0IaG"),m=c("Qu3c"),f=c("PCNd"),p=c("YUcS"),g=c("7EHt"),h=c("/1cH"),v=c("d3UM"),k=c("iadO"),x=c("xHqg"),y=c("bSwM"),w=c("7ZcW"),I=c("CzEO"),_=c("lDzL"),S=function e(t,c,r,n,a,o,i,s,d,u){_classCallCheck(this,e),this._id=t,this.numOrder=c,this.date=r,this.dateRequired=n,this.uploadDate=a,this.company=o,this.sectorDestiny=i,this.justification=s,this.obs=d,this.status=u},G=c("3sEA"),M=c("L/iA"),V=c("U14E"),C=c("YFeJ"),O=c("gU78"),T=c("wd/R"),A=c("fXoL"),R=c("dNgK");function L(e,t){if(1&e&&A.Vc(0),2&e){var c=t.row;A.Xc(" ",null==c?null:c.numOrder," ")}}function D(e,t){if(1&e&&A.Vc(0),2&e){var c=t.row;A.Xc(" ",null==c?null:c.sectorDestiny," ")}}function F(e,t){if(1&e&&A.Vc(0),2&e){var c=t.row;A.Xc(" ",null==c?null:c.status," ")}}function E(e,t){if(1&e&&A.Vc(0),2&e){var c=t.row,r=A.nc();A.Xc(" ",r.changeDate(null==c?null:c.date)," ")}}function P(e,t){if(1&e&&A.Vc(0),2&e){var c=t.row,r=A.nc();A.Xc(" ",r.changeDate(null==c?null:c.dateRequired)," ")}}var N=function(e){return["/deposit/order/get/",e]},j=function(e){return["/deposit/order/receive/",e]};function B(e,t){if(1&e){var c=A.cc();A.bc(0,"button",13),A.jc("click",(function(e){A.Mc(c);var r=t.row;return A.nc().print(r)})),A.bc(1,"mat-icon"),A.Vc(2,"print"),A.ac(),A.ac(),A.bc(3,"button",14),A.bc(4,"mat-icon"),A.Vc(5,"list_alt"),A.ac(),A.ac(),A.bc(6,"button",15),A.bc(7,"mat-icon"),A.Vc(8,"add_task"),A.ac(),A.ac()}if(2&e){var r=t.row;A.uc("matTooltip","Autorizado"==r.status||"Recibido"==r.status?"Imprimir orden":"La orden a\xfan esta pendiente de autorizar")("disabled","Autorizado"!=r.status&&"Recibido"!=r.status),A.Gb(3),A.uc("routerLink",A.Ac(5,N,r._id)),A.Gb(3),A.uc("disabled","Autorizado"!=r.status&&"Recibido"!=r.status)("routerLink",A.Ac(7,j,r._id))}}function W(e,t){if(1&e&&(A.bc(0,"tr"),A.bc(1,"td",40),A.Vc(2),A.ac(),A.bc(3,"td",40),A.Vc(4),A.ac(),A.bc(5,"td",41),A.Vc(6),A.ac(),A.bc(7,"td",41),A.Vc(8),A.ac(),A.bc(9,"td",42),A.Vc(10),A.ac(),A.bc(11,"td",43),A.Vc(12),A.ac(),A.ac()),2&e){var c=t.$implicit,r=t.index;A.Gb(2),A.Wc(r+1),A.Gb(2),A.Wc(c.cant),A.Gb(2),A.Wc(c.item.name),A.Gb(2),A.Wc(c.item.brand),A.Gb(2),A.Wc(c.obs),A.Gb(2),A.Wc(c.costSector)}}function H(e,t){if(1&e&&(A.bc(0,"div",16),A.bc(1,"div",17),A.bc(2,"div",18),A.bc(3,"table",19),A.bc(4,"tbody"),A.bc(5,"tr",20),A.bc(6,"td",21),A.Vc(7,"Fecha: "),A.bc(8,"strong"),A.Vc(9),A.ac(),A.ac(),A.bc(10,"td",22),A.bc(11,"strong"),A.Vc(12,"FORMULARIO \xdaNICO DE REQUERIMIENTO"),A.ac(),A.ac(),A.bc(13,"td",23),A.Vc(14,"N\xfamero"),A.ac(),A.bc(15,"td",24),A.Wb(16,"strong"),A.Vc(17),A.ac(),A.ac(),A.bc(18,"tr"),A.bc(19,"td",24),A.Vc(20,"A"),A.ac(),A.bc(21,"td",22),A.Vc(22,"FECHA DE ENTREGA REQUERIDA: "),A.bc(23,"strong"),A.Vc(24),A.ac(),A.ac(),A.bc(25,"td",23),A.Vc(26,"ORIGINAL"),A.ac(),A.bc(27,"td",24),A.Vc(28,"X"),A.ac(),A.ac(),A.bc(29,"tr"),A.bc(30,"td",25),A.Vc(31,"Solicitante: "),A.bc(32,"strong"),A.Vc(33),A.ac(),A.ac(),A.ac(),A.bc(34,"tr"),A.bc(35,"td",25),A.Vc(36,"Destino: "),A.bc(37,"strong"),A.Vc(38),A.ac(),A.ac(),A.ac(),A.bc(39,"tr",20),A.bc(40,"td",26),A.bc(41,"strong"),A.Vc(42,"JUSTIFICACI\xd3N DE LA COMPRA"),A.ac(),A.ac(),A.ac(),A.bc(43,"tr"),A.bc(44,"td",27),A.Wb(45,"div",28),A.ac(),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(46,"div",18),A.bc(47,"table",29),A.bc(48,"thead"),A.bc(49,"tr"),A.bc(50,"th",30),A.Vc(51,"Item"),A.ac(),A.bc(52,"th",31),A.Vc(53,"Cant"),A.ac(),A.bc(54,"th",32),A.Vc(55,"Articulo"),A.ac(),A.bc(56,"th",24),A.Vc(57,"Marca"),A.ac(),A.bc(58,"th",24),A.Vc(59,"Observaciones"),A.ac(),A.bc(60,"th",33),A.Vc(61,"Centro de costo"),A.ac(),A.ac(),A.ac(),A.bc(62,"tbody"),A.Tc(63,W,13,6,"tr",34),A.ac(),A.ac(),A.ac(),A.bc(64,"div",18),A.bc(65,"table",19),A.bc(66,"tbody"),A.bc(67,"tr",21),A.bc(68,"td",35),A.bc(69,"strong"),A.Vc(70,"Observaciones:"),A.ac(),A.bc(71,"span"),A.Vc(72),A.ac(),A.ac(),A.ac(),A.bc(73,"tr",21),A.bc(74,"td",36),A.bc(75,"p",37),A.Vc(76,"SOLICITO: FIRMA Y ACLARACI\xd3N"),A.ac(),A.Wb(77,"div",38),A.bc(78,"span",39),A.Vc(79,"Guillermo Luparia"),A.ac(),A.ac(),A.bc(80,"td",36),A.bc(81,"p",37),A.Vc(82,"AUTORIZO: FIRMA Y ACLARACI\xd3N"),A.ac(),A.Wb(83,"div",38),A.bc(84,"span",39),A.Vc(85,"Guillermo Luparia"),A.ac(),A.ac(),A.bc(86,"td",36),A.bc(87,"p",37),A.Vc(88,"GERENCIA: FIRMA Y ACLARACI\xd3N"),A.ac(),A.ac(),A.ac(),A.ac(),A.ac(),A.ac(),A.ac(),A.ac()),2&e){var c=A.nc();A.Gb(9),A.Wc(c.changeDate(c.orderPrint.date)),A.Gb(8),A.Xc(" ",c.num,""),A.Gb(7),A.Wc(c.changeDate(c.orderPrint.dateRequired)),A.Gb(9),A.Wc(c.orderPrint.company.name),A.Gb(5),A.Wc(c.orderPrint.sectorDestiny),A.Gb(7),A.uc("innerHTML",c.orderPrint.justification,A.Nc),A.Gb(18),A.uc("ngForOf",c.orderItems),A.Gb(9),A.Xc(" ",c.orderPrint.obs,"")}}var z,q=function(){return{y:"50px",delay:"300ms"}},X=function(e){return{value:"*",params:e}},J=function(){return["/deposit/order/new"]},Y=function(){return{x:"50px",delay:"600ms"}},U=((z=function(){function e(t,c,r,n,a,o){_classCallCheck(this,e),this.snack=t,this._userService=c,this.snackBar=r,this.loader=n,this._orderService=a,this._orderItemService=o,this.url=C.a.url,this.token=c.getToken(),this.identity=c.getIdentity(),this.orderPrint=new S("",0,null,null,null,null,"","","","")}return _createClass(e,[{key:"ngOnInit",value:function(){this.getOrders()}},{key:"getOrders",value:function(){var e=this;this._orderService.getList(this.token,{company:this.identity.company._id}).subscribe((function(t){t.orders&&(e.orders=t.orders)}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}},{key:"openSnackBar",value:function(e,t){this.snackBar.open(e,t,{duration:1e4})}},{key:"print",value:function(e){this.orderPrint=e,this.num=this.getNum(e),this.getOrderList(e)}},{key:"getNum",value:function(e){return T(e.date).format("YYYY")+"-"+(this.orderPrint.numOrder<10?"000"+String(this.orderPrint.numOrder):this.orderPrint.numOrder<100?"00"+String(this.orderPrint.numOrder):this.orderPrint.numOrder<1e3?"0"+String(this.orderPrint.numOrder):String(this.orderPrint.numOrder))}},{key:"changeDate",value:function(e){return T(e).format("DD/MM/YYYY")}},{key:"getOrderList",value:function(e){var t=this;this._orderItemService.getList(this.token,{order:e._id}).subscribe((function(c){c.orderItems&&(t.orderItems=c.orderItems,setTimeout((function(){var c=document.getElementById("order").innerHTML;t._orderService.print(t.token,c,e._id).subscribe((function(c){t._orderService.getPrint(e._id).subscribe((function(c){c.message?(t.loader.open("Generando orden, esto puede tardar unos segundos"),setTimeout((function(){window.open(t.url+"order/print/"+e._id,"_blank"),t.loader.close()}),1e4)):window.open(t.url+"order/print/"+e._id,"_blank")}),(function(c){window.open(t.url+"order/print/"+e._id,"_blank")}))}),(function(e){console.error(e)}))}),1500))}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}}]),e}()).\u0275fac=function(e){return new(e||z)(A.Vb(R.a),A.Vb(O.a),A.Vb(R.a),A.Vb(G.a),A.Vb(M.a),A.Vb(V.a))},z.\u0275cmp=A.Pb({type:z,selectors:[["app-order-list"]],features:[A.Fb([O.a,M.a,V.a])],decls:20,vars:25,consts:[[1,"m-333"],["mat-raised-button","","color","primary",1,"mb-05",3,"routerLink"],[3,"vertical"],[1,"p-0"],[1,"material","ml-0","mr-0",3,"rows","columnMode","headerHeight","footerHeight","scrollbarH","limit","rowHeight"],["name","#","prop","numOrder",3,"flexGrow"],["ngx-datatable-cell-template",""],["name","Destino","prop","sectorDestiny",3,"flexGrow"],["name","Estado","prop","status",3,"flexGrow"],["name","Genera","prop","date",3,"flexGrow"],["name","Entrega","prop","dateRequired",3,"flexGrow"],["name","Acciones",3,"flexGrow"],["id","order","class","card print",4,"ngIf"],["mat-icon-button","","mat-sm-button","","color","primary",3,"matTooltip","disabled","click"],["mat-icon-button","","mat-sm-button","","color","primary","matTooltip","Ver orden",3,"routerLink"],["mat-icon-button","","mat-sm-button","","color","primary","matTooltip","Recibir insumos",3,"disabled","routerLink"],["id","order",1,"card","print"],[1,"card-body"],[1,"table-responsive","table-bordered"],[1,"table","table-bordered"],[2,"background-color","#3f9ecb"],[1,"cell"],["colspan","3",1,"text-center","cell"],[1,"text-left","cell"],[1,"text-center","cell"],["colspan","6",1,"text-left","cell"],["colspan","6",1,"text-center","cell"],["colspan","6",1,"cell"],[3,"innerHTML"],[1,"table-bordered",2,"width","100%"],[1,"cell",2,"width","50px"],[1,"text-center","cell",2,"width","50px"],[1,"text-center","cell",2,"width","134px"],[1,"text-center","cell",2,"width","137px"],[4,"ngFor","ngForOf"],["colspan","3",2,"font-size","12px"],[1,"text-center","cell","firma"],[2,"font-size","10px"],[2,"height","25px"],[2,"color","rgb(255,0,0)"],[1,"text-right","cell",2,"padding-right","5px"],[1,"cell",2,"padding-left","5px"],[1,"cell","obs",2,"padding-left","5px"],[1,"text-center","cell",2,"padding-left","5px"]],template:function(e,t){1&e&&(A.bc(0,"div",0),A.bc(1,"button",1),A.Vc(2,"Nueva orden"),A.ac(),A.Wb(3,"mat-divider",2),A.ac(),A.bc(4,"mat-card",3),A.bc(5,"mat-card-content",3),A.bc(6,"ngx-datatable",4),A.bc(7,"ngx-datatable-column",5),A.Tc(8,L,1,1,"ng-template",6),A.ac(),A.bc(9,"ngx-datatable-column",7),A.Tc(10,D,1,1,"ng-template",6),A.ac(),A.bc(11,"ngx-datatable-column",8),A.Tc(12,F,1,1,"ng-template",6),A.ac(),A.bc(13,"ngx-datatable-column",9),A.Tc(14,E,1,1,"ng-template",6),A.ac(),A.bc(15,"ngx-datatable-column",10),A.Tc(16,P,1,1,"ng-template",6),A.ac(),A.bc(17,"ngx-datatable-column",11),A.Tc(18,B,9,9,"ng-template",6),A.ac(),A.ac(),A.ac(),A.ac(),A.Tc(19,H,89,8,"div",12)),2&e&&(A.uc("@animate",A.Ac(19,X,A.zc(18,q))),A.Gb(1),A.uc("routerLink",A.zc(21,J)),A.Gb(2),A.uc("vertical",!0),A.Gb(1),A.uc("@animate",A.Ac(23,X,A.zc(22,Y))),A.Gb(2),A.uc("rows",t.orders)("columnMode","flex")("headerHeight",50)("footerHeight",50)("scrollbarH",!0)("limit",10)("rowHeight",50),A.Gb(1),A.uc("flexGrow",1),A.Gb(2),A.uc("flexGrow",6),A.Gb(2),A.uc("flexGrow",3),A.Gb(2),A.uc("flexGrow",3),A.Gb(2),A.uc("flexGrow",3),A.Gb(2),A.uc("flexGrow",3),A.Gb(2),A.uc("ngIf",""!=t.orderPrint._id))},directives:[s.b,n.h,u.a,d.a,d.c,_.d,_.b,_.a,r.m,m.a,i.a,r.l],styles:['.cell[_ngcontent-%COMP%]{color:#000;font-size:12px}.print[_ngcontent-%COMP%]{display:none}.card[_ngcontent-%COMP%]:after{content:"";background:url(https://upload.wikimedia.org/wikipedia/commons/7/7d/Sanatorio_Mar%C3%ADtimo_de_Vi%C3%B1a_del_Mar.svg) no-repeat;opacity:.1;top:0;left:0;bottom:0;right:0;position:absolute;z-index:1;height:100%;width:100%;margin:20px}']}),z),$=function e(t,c,r,n,a,o,i,s){_classCallCheck(this,e),this._id=t,this.order=c,this.item=r,this.cant=n,this.obs=a,this.code=o,this.costSector=i,this.cantReceived=s},K=c("Nptc"),Q=c("AASI"),Z=c("kwbH"),ee=c("O4PR"),te=c("sd1j"),ce=c("FKr1"),re=c("XiUz");function ne(e,t){if(1&e&&(A.bc(0,"small"),A.Vc(1),A.ac()),2&e){var c=A.nc().$implicit;A.Gb(1),A.Xc(" | ",c.brand,"")}}function ae(e,t){if(1&e&&(A.bc(0,"mat-option",14),A.Vc(1),A.Tc(2,ne,2,1,"small",15),A.ac()),2&e){var c=t.$implicit;A.uc("value",c),A.Gb(1),A.Xc(" ",c.name," "),A.Gb(1),A.uc("ngIf",c.brand)}}function oe(e,t){if(1&e&&(A.bc(0,"mat-option",14),A.bc(1,"span"),A.Vc(2),A.ac(),A.ac()),2&e){var c=t.$implicit;A.uc("value",c.name),A.Gb(2),A.Wc(c.name)}}var ie,se=((ie=function(){function e(t,c,r,n,a,o){_classCallCheck(this,e),this.data=t,this.dialogRef=c,this.snackBar=r,this._userService=n,this._itemService=a,this._sectorService=o,this.place="Articulo",this.tmpSectors=[],this.token=n.getToken(),this.identity=n.getIdentity()}return _createClass(e,[{key:"ngOnInit",value:function(){if(this.data.payload){var e=this.data.payload;this.orderItem=new $("",e.order,e.item,e.cant,e.obs,e.code,e.costSector,0),this.place=this.orderItem.item.name+" | "+this.orderItem.item.brand}else this.orderItem=new $("",null,null,1,"","","",0);this.getItems(),this.getSectors()}},{key:"openSnackBar",value:function(e,t){this.snackBar.open(e,t,{duration:1e4})}},{key:"submit",value:function(e){this.dialogRef.close(e?{delete:!0}:{item:this.orderItem})}},{key:"getItems",value:function(){var e=this;this._itemService.getList(this.token,{company:this.identity.company._id}).subscribe((function(t){t.items&&(e.items=t.items)}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}},{key:"getSectors",value:function(){var e=this;this._sectorService.getList(this.token).subscribe((function(t){t.sectors&&(e.sectors=t.sectors)}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}},{key:"filterSector",value:function(e){this.tmpSectors=this.sectors.filter((function(t){return t.name.toLowerCase().includes(e.toString().toLowerCase())}))}}]),e}()).\u0275fac=function(e){return new(e||ie)(A.Vb(b.a),A.Vb(b.g),A.Vb(R.a),A.Vb(O.a),A.Vb(Z.a),A.Vb(ee.a))},ie.\u0275cmp=A.Pb({type:ie,selectors:[["app-orderitem-popup"]],features:[A.Fb([Z.a,O.a,ee.a])],decls:23,vars:9,consts:[["matDialogTitle",""],[1,"p-0"],["fxLayout","row wrap","fxLayout.lt-sm","column"],["fxFlex","100",1,"pr-1"],[1,"full-width"],["name","item",3,"placeholder","ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["type","number","placeholder","Cantidad","aria-label","Text","min","1","matInput","","name","cant",3,"ngModel","ngModelChange"],["type","text","placeholder","Observacion","aria-label","Text","matInput","","name","obs",3,"ngModel","ngModelChange"],["type","text","placeholder","Centro de costo","aria-label","Text","matInput","","name","costSector",3,"ngModel","matAutocomplete","input","ngModelChange"],["autoActiveFirstOption",""],["autoSector","matAutocomplete"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"],[3,"value"],[4,"ngIf"]],template:function(e,t){if(1&e&&(A.bc(0,"h1",0),A.Vc(1),A.ac(),A.bc(2,"mat-card",1),A.bc(3,"mat-card-content"),A.bc(4,"form"),A.bc(5,"div",2),A.bc(6,"div",3),A.bc(7,"mat-form-field",4),A.bc(8,"mat-select",5),A.jc("ngModelChange",(function(e){return t.orderItem.item=e})),A.Tc(9,ae,3,3,"mat-option",6),A.ac(),A.ac(),A.bc(10,"mat-form-field",4),A.bc(11,"input",7),A.jc("ngModelChange",(function(e){return t.orderItem.cant=e})),A.ac(),A.ac(),A.bc(12,"mat-form-field",4),A.bc(13,"input",8),A.jc("ngModelChange",(function(e){return t.orderItem.obs=e})),A.ac(),A.ac(),A.bc(14,"mat-form-field",4),A.bc(15,"input",9),A.jc("input",(function(e){return t.filterSector(e.target.value)}))("ngModelChange",(function(e){return t.orderItem.costSector=e})),A.ac(),A.bc(16,"mat-autocomplete",10,11),A.Tc(18,oe,3,2,"mat-option",6),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(19,"button",12),A.jc("click",(function(e){return t.submit()})),A.Vc(20,"Guardar"),A.ac(),A.bc(21,"button",13),A.jc("click",(function(e){return t.submit(!0)})),A.Vc(22,"Eliminar"),A.ac(),A.ac(),A.ac(),A.ac()),2&e){var c=A.Jc(17);A.Gb(1),A.Wc(t.data.title),A.Gb(7),A.uc("placeholder",t.place)("ngModel",t.orderItem.item),A.Gb(1),A.uc("ngForOf",t.items),A.Gb(2),A.uc("ngModel",t.orderItem.cant),A.Gb(2),A.uc("ngModel",t.orderItem.obs),A.Gb(2),A.uc("ngModel",t.orderItem.costSector)("matAutocomplete",c),A.Gb(3),A.uc("ngForOf",t.tmpSectors)}},directives:[d.a,d.c,a.x,a.o,a.p,re.d,re.b,l.a,v.a,a.n,a.q,r.l,a.s,o.b,a.c,h.c,h.a,s.b,ce.p,r.m],encapsulation:2}),ie),de=c("3kSh");function ue(e,t){1&e&&A.Vc(0,"Orden")}function le(e,t){if(1&e&&(A.bc(0,"mat-option",35),A.bc(1,"span"),A.Vc(2),A.ac(),A.ac()),2&e){var c=t.$implicit;A.uc("value",c.name),A.Gb(2),A.Wc(c.name)}}function be(e,t){if(1&e){var c=A.cc();A.bc(0,"mat-step",18),A.Tc(1,ue,1,0,"ng-template",4),A.bc(2,"form"),A.bc(3,"div",5),A.bc(4,"div",19),A.bc(5,"div",7),A.bc(6,"mat-form-field",20),A.bc(7,"mat-label"),A.Vc(8,"Fecha"),A.ac(),A.bc(9,"input",21),A.jc("ngModelChange",(function(e){return A.Mc(c),A.nc().order.date=e})),A.ac(),A.Wb(10,"mat-datepicker-toggle",22),A.Wb(11,"mat-datepicker",null,23),A.ac(),A.ac(),A.bc(13,"div",7),A.bc(14,"mat-form-field",20),A.bc(15,"input",24),A.jc("input",(function(e){return A.Mc(c),A.nc().filterSector(e.target.value)}))("ngModelChange",(function(e){return A.Mc(c),A.nc().order.sectorDestiny=e})),A.ac(),A.bc(16,"mat-autocomplete",25,26),A.Tc(18,le,3,2,"mat-option",27),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(19,"div",28),A.bc(20,"div",7),A.bc(21,"mat-form-field",20),A.bc(22,"mat-label"),A.Vc(23,"Fecha de entrega requerida"),A.ac(),A.bc(24,"input",29),A.jc("ngModelChange",(function(e){return A.Mc(c),A.nc().order.dateRequired=e})),A.ac(),A.Wb(25,"mat-datepicker-toggle",22),A.Wb(26,"mat-datepicker",null,30),A.ac(),A.ac(),A.bc(28,"div",7),A.bc(29,"mat-form-field",20),A.bc(30,"input",31),A.jc("ngModelChange",(function(e){return A.Mc(c),A.nc().order.obs=e})),A.ac(),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(31,"div",5),A.bc(32,"div",6),A.bc(33,"quill-editor",32),A.jc("ngModelChange",(function(e){return A.Mc(c),A.nc().order.justification=e})),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(34,"div",33),A.bc(35,"button",34),A.Vc(36,"Siguiente"),A.ac(),A.ac(),A.ac()}if(2&e){var r=A.Jc(12),n=A.Jc(17),a=A.Jc(27),o=A.nc();A.Gb(9),A.uc("ngModel",o.order.date)("matDatepicker",r),A.Gb(1),A.uc("for",r),A.Gb(5),A.uc("ngModel",o.order.sectorDestiny)("matAutocomplete",n),A.Gb(3),A.uc("ngForOf",o.tmpSectors),A.Gb(6),A.uc("ngModel",o.order.dateRequired)("matDatepicker",a),A.Gb(1),A.uc("for",a),A.Gb(5),A.uc("ngModel",o.order.obs),A.Gb(3),A.uc("modules",o.config)("ngModel",o.order.justification)}}function me(e,t){1&e&&A.Vc(0,"Articulos")}function fe(e,t){1&e&&A.Vc(0),2&e&&A.Xc(" ",t.rowIndex+1," ")}function pe(e,t){1&e&&A.Vc(0),2&e&&A.Xc(" ",t.row.cant," ")}function ge(e,t){if(1&e&&(A.bc(0,"small",36),A.Vc(1),A.ac()),2&e){var c=A.nc().row;A.uc("matTooltip",c.item.name+" | "+c.item.brand),A.Gb(1),A.Xc(" | ",c.item.brand,"")}}function he(e,t){if(1&e&&(A.bc(0,"span",36),A.Vc(1),A.ac(),A.Tc(2,ge,2,2,"small",37)),2&e){var c=t.row;A.uc("matTooltip",c.item.name+" | "+c.item.brand),A.Gb(1),A.Wc(c.item.name),A.Gb(1),A.uc("ngIf",c.item.brand)}}function ve(e,t){if(1&e&&(A.bc(0,"span",36),A.Vc(1),A.ac()),2&e){var c=t.row;A.uc("matTooltip",c.obs),A.Gb(1),A.Wc(c.obs)}}function ke(e,t){if(1&e&&(A.bc(0,"span",36),A.Vc(1),A.ac()),2&e){var c=t.row;A.uc("matTooltip",c.costSector),A.Gb(1),A.Wc(c.costSector)}}function xe(e,t){if(1&e){var c=A.cc();A.bc(0,"button",38),A.jc("click",(function(e){return A.Mc(c),A.nc().send(!1)})),A.Vc(1,"Guardar"),A.ac()}}function ye(e,t){if(1&e){var c=A.cc();A.bc(0,"button",38),A.jc("click",(function(e){return A.Mc(c),A.nc().send(!1)})),A.Vc(1,"Enviar a autorizar"),A.ac()}}function we(e,t){if(1&e){var c=A.cc();A.bc(0,"button",38),A.jc("click",(function(e){return A.Mc(c),A.nc().send(!0)})),A.Vc(1,"Crear y autorizar"),A.ac()}}function Ie(e,t){if(1&e){var c=A.cc();A.bc(0,"button",38),A.jc("click",(function(e){return A.Mc(c),A.nc().send(!0)})),A.Vc(1,"Autorizar"),A.ac()}}var _e,Se=((_e=function(){function e(t,c,r,n,a,o,i,s,d,u,l){_classCallCheck(this,e),this._userService=t,this.snackBar=c,this._router=r,this.loader=n,this.dialog=a,this.confirmService=o,this._orderService=i,this._orderItemService=s,this._stockService=d,this._depositService=u,this._sectorService=l,this.config=C.a.richTextModule,this.tmpItems=[],this.tmpSectors=[],this.token=t.getToken(),this.identity=t.getIdentity(),this.order=new S("",null,new Date,new Date,null,this.identity.company._id,null,"","","No creado"),this.orderItem=new $("","",null,1,"","","",0)}return _createClass(e,[{key:"ngOnInit",value:function(){this.order.dateRequired.setMonth(this.order.dateRequired.getMonth()+1),this.getDeposits(),this.getSectors()}},{key:"getSectors",value:function(){var e=this;this._sectorService.getList(this.token).subscribe((function(t){t.sectors&&(e.sectors=t.sectors)}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}},{key:"getDeposits",value:function(){var e=this;this._depositService.getList(this.token,{company:this.identity.company._id}).subscribe((function(t){if(t.deposits){var c=new Array;t.deposits.forEach((function(e){c.push(e._id)})),e.getStockMissing(c)}}),(function(e){console.error(e)}))}},{key:"getStockMissing",value:function(e){var t=this;this._stockService.getList(this.token,{deposit:e,onOrder:!1,$where:"this.cant < this.cantMin"}).subscribe((function(e){e.stocks&&(t.orderItems=new Array,t.lowStocks=e.stocks,0!=t.lowStocks.length&&t.confirmService.confirm({message:"Existen insumos por debajo del stock minimo \xbfDeseas a\xf1adirlos a esta orden?"}).subscribe((function(e){e&&(t.lowStocks.forEach((function(e){var c=new $("",null,e.item,e.cantMin-e.cant,"","",null,0);t.orderItems.push(c)})),t.orderItems=_toConsumableArray(t.orderItems))})))}),(function(e){console.error(e)}))}},{key:"filterSector",value:function(e){this.tmpSectors=this.sectors.filter((function(t){return t.name.toLowerCase().includes(e.toString().toLowerCase())}))}},{key:"getLenght",value:function(e){return e.length}},{key:"openSnackBar",value:function(e,t){this.snackBar.open(e,t,{duration:1e4})}},{key:"onActivate",value:function(e){"click"==e.type&&this.newItem(!1,e.row)}},{key:"newItem",value:function(e,t){var c=this;this.dialog.open(se,{width:"720px",disableClose:!1,data:{payload:t,title:e?"Nuevo articulo":"Editar articulo"}}).afterClosed().subscribe((function(r){if(r){if(r.delete)c.orderItems.splice(c.orderItems.indexOf(t),1),c.orderItems=_toConsumableArray(c.orderItems);else{var n=new $("",null,r.item.item,r.item.cant,r.item.obs,r.item.code,r.item.costSector,0);c.loader.open(),e?c.orderItems=c.orderItems.concat([n]):(t.cant=n.cant,t.item=n.item,t.obs=n.obs,t.costSector=n.costSector)}c.loader.close()}}))}},{key:"send",value:function(e){var t=this;this.order.status=e?"Autorizado":"Pendiente",this._orderService.add(this.token,this.order).subscribe((function(c){if(c.order){var r=c.order,n={onOrder:!0};t.orderItems.forEach((function(e){e.order=r._id,t._stockService.editMany(t.token,e.item._id,n).subscribe((function(e){}),(function(e){console.error(e)})),t._orderItemService.add(t.token,e).subscribe((function(e){}),(function(e){console.error(e)}))})),t.openSnackBar(e?"Pedido autorizado":"Pedido enviado para autorizar","Cerrar"),t._router.navigate(["deposit/home"])}}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}}]),e}()).\u0275fac=function(e){return new(e||_e)(A.Vb(O.a),A.Vb(R.a),A.Vb(n.g),A.Vb(G.a),A.Vb(b.b),A.Vb(de.a),A.Vb(M.a),A.Vb(V.a),A.Vb(K.a),A.Vb(Q.a),A.Vb(ee.a))},_e.\u0275cmp=A.Pb({type:_e,selectors:[["app-new-order"]],features:[A.Fb([{provide:ce.c,useClass:te.b},{provide:ce.f,useValue:te.a},M.a,V.a,K.a,Q.a,Z.a,ee.a])],decls:29,vars:18,consts:[[1,"p-0"],[3,"linear"],["id","orderStep",4,"ngIf"],["id","orderItemsStep"],["matStepLabel",""],["fxLayout","row wrap"],["fxFlex","100","fxFlex.gt-xs","100",1,"pr-1"],[1,"pb-1"],["mat-raised-button","","color","primary",3,"disabled","click"],[1,"material","bg-white",3,"rows","columnMode","headerHeight","footerHeight","limit","rowHeight","activate"],["name","Item",3,"flexGrow"],["ngx-datatable-cell-template",""],["name","Cantidad",3,"flexGrow"],["name","Descripci\xf3n",3,"flexGrow"],["name","Observaci\xf3n",3,"flexGrow"],["name","Centro de costo",3,"flexGrow"],["mat-raised-button","","color","primary","matStepperNext","",3,"click",4,"ngIf"],["fxFlex","16px"],["id","orderStep"],["fxFlex","100","fxFlex.gt-xs","50",1,"pr-1"],[1,"full-width"],["matInput","","name","date",3,"ngModel","matDatepicker","ngModelChange"],["matSuffix","",3,"for"],["date",""],["type","text","placeholder","Destino","aria-label","Text","matInput","","name","sectorDestiny",3,"ngModel","matAutocomplete","input","ngModelChange"],["autoActiveFirstOption",""],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["fxFlex","100","fxFlex.gt-xs","50"],["matInput","","name","dateRequired",3,"ngModel","matDatepicker","ngModelChange"],["dateRequired",""],["type","text","placeholder","Observaciones","aria-label","Text","matInput","","name","obs",3,"ngModel","ngModelChange"],["theme","snow","placeholder","Justificativo de compra","name","justification",3,"modules","ngModel","ngModelChange"],[2,"margin-top","50px"],["mat-raised-button","","color","primary","matStepperNext",""],[3,"value"],[3,"matTooltip"],[3,"matTooltip",4,"ngIf"],["mat-raised-button","","color","primary","matStepperNext","",3,"click"]],template:function(e,t){1&e&&(A.bc(0,"mat-card",0),A.bc(1,"mat-card-content"),A.bc(2,"mat-horizontal-stepper",1),A.Tc(3,be,37,12,"mat-step",2),A.bc(4,"mat-step",3),A.Tc(5,me,1,0,"ng-template",4),A.bc(6,"form"),A.bc(7,"div",5),A.bc(8,"div",6),A.bc(9,"div",7),A.bc(10,"button",8),A.jc("click",(function(e){return t.newItem(!0)})),A.Vc(11,"A\xf1adir articulo"),A.ac(),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(12,"ngx-datatable",9),A.jc("activate",(function(e){return t.onActivate(e)})),A.bc(13,"ngx-datatable-column",10),A.Tc(14,fe,1,1,"ng-template",11),A.ac(),A.bc(15,"ngx-datatable-column",12),A.Tc(16,pe,1,1,"ng-template",11),A.ac(),A.bc(17,"ngx-datatable-column",13),A.Tc(18,he,3,3,"ng-template",11),A.ac(),A.bc(19,"ngx-datatable-column",14),A.Tc(20,ve,2,2,"ng-template",11),A.ac(),A.bc(21,"ngx-datatable-column",15),A.Tc(22,ke,2,2,"ng-template",11),A.ac(),A.ac(),A.bc(23,"div"),A.Tc(24,xe,2,0,"button",16),A.Tc(25,ye,2,0,"button",16),A.Wb(26,"span",17),A.Tc(27,we,2,0,"button",16),A.Tc(28,Ie,2,0,"button",16),A.ac(),A.ac(),A.ac(),A.ac(),A.ac()),2&e&&(A.Gb(2),A.uc("linear",!0),A.Gb(1),A.uc("ngIf","ROLE_ADMIN"==t.identity.role),A.Gb(7),A.uc("disabled","No creado"!=t.order.status&&"ROLE_ADMIN"!=t.identity.role||"Autorizado"==t.order.status||"Finalizado"==t.order.status),A.Gb(2),A.uc("rows",t.orderItems)("columnMode","flex")("headerHeight",40)("footerHeight",50)("limit",10)("rowHeight",45),A.Gb(1),A.uc("flexGrow",1),A.Gb(2),A.uc("flexGrow",1),A.Gb(2),A.uc("flexGrow",7),A.Gb(2),A.uc("flexGrow",7),A.Gb(2),A.uc("flexGrow",3),A.Gb(3),A.uc("ngIf","Pendiente"==t.order.status&&"ROLE_ADMIN"==t.identity.role),A.Gb(1),A.uc("ngIf","No creado"==t.order.status),A.Gb(2),A.uc("ngIf","No creado"==t.order.status&&"ROLE_ADMIN"==t.identity.role),A.Gb(1),A.uc("ngIf","Pendiente"==t.order.status&&"ROLE_ADMIN"==t.identity.role))},directives:[d.a,d.c,x.a,r.m,x.b,x.c,a.x,a.o,a.p,re.d,re.b,s.b,_.d,_.b,_.a,l.a,l.d,o.b,a.c,k.b,a.n,a.q,k.d,l.e,k.a,h.c,h.a,r.l,I.a,x.e,ce.p,m.a],styles:[".butt[_ngcontent-%COMP%]{background-color:#018aca}.butt[_ngcontent-%COMP%], .butt-trash[_ngcontent-%COMP%]{font-size:12px;font-weight:300;color:#fff;display:inline-block;transition:all .5s;cursor:pointer;padding:10px 15px!important;text-transform:uppercase;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;text-align:center}.butt-trash[_ngcontent-%COMP%]{background-color:#ff1717}"]}),_e);function Ge(e,t){1&e&&A.Vc(0,"Orden")}function Me(e,t){if(1&e&&(A.bc(0,"mat-option",35),A.bc(1,"span"),A.Vc(2),A.ac(),A.ac()),2&e){var c=t.$implicit;A.uc("value",c.name),A.Gb(2),A.Wc(c.name)}}function Ve(e,t){if(1&e){var c=A.cc();A.bc(0,"mat-step",18),A.Tc(1,Ge,1,0,"ng-template",4),A.bc(2,"form"),A.bc(3,"div",5),A.bc(4,"div",19),A.bc(5,"div",7),A.bc(6,"mat-form-field",20),A.bc(7,"mat-label"),A.Vc(8,"Fecha"),A.ac(),A.bc(9,"input",21),A.jc("ngModelChange",(function(e){return A.Mc(c),A.nc().order.date=e})),A.ac(),A.Wb(10,"mat-datepicker-toggle",22),A.Wb(11,"mat-datepicker",null,23),A.ac(),A.ac(),A.bc(13,"div",7),A.bc(14,"mat-form-field",20),A.bc(15,"input",24),A.jc("input",(function(e){return A.Mc(c),A.nc().filterSector(e.target.value)}))("ngModelChange",(function(e){return A.Mc(c),A.nc().order.sectorDestiny=e})),A.ac(),A.bc(16,"mat-autocomplete",25,26),A.Tc(18,Me,3,2,"mat-option",27),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(19,"div",28),A.bc(20,"div",7),A.bc(21,"mat-form-field",20),A.bc(22,"mat-label"),A.Vc(23,"Fecha de entrega requerida"),A.ac(),A.bc(24,"input",29),A.jc("ngModelChange",(function(e){return A.Mc(c),A.nc().order.dateRequired=e})),A.ac(),A.Wb(25,"mat-datepicker-toggle",22),A.Wb(26,"mat-datepicker",null,30),A.ac(),A.ac(),A.bc(28,"div",7),A.bc(29,"mat-form-field",20),A.bc(30,"input",31),A.jc("ngModelChange",(function(e){return A.Mc(c),A.nc().order.obs=e})),A.ac(),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(31,"div",5),A.bc(32,"div",6),A.bc(33,"quill-editor",32),A.jc("ngModelChange",(function(e){return A.Mc(c),A.nc().order.justification=e})),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(34,"div",33),A.bc(35,"button",34),A.Vc(36,"Siguiente"),A.ac(),A.ac(),A.ac()}if(2&e){var r=A.Jc(12),n=A.Jc(17),a=A.Jc(27),o=A.nc();A.Gb(9),A.uc("ngModel",o.order.date)("matDatepicker",r),A.Gb(1),A.uc("for",r),A.Gb(5),A.uc("ngModel",o.order.sectorDestiny)("matAutocomplete",n),A.Gb(3),A.uc("ngForOf",o.tmpSectors),A.Gb(6),A.uc("ngModel",o.order.dateRequired)("matDatepicker",a),A.Gb(1),A.uc("for",a),A.Gb(5),A.uc("ngModel",o.order.obs),A.Gb(3),A.uc("modules",o.config)("ngModel",o.order.justification)}}function Ce(e,t){1&e&&A.Vc(0,"Articulos")}function Oe(e,t){1&e&&A.Vc(0),2&e&&A.Xc(" ",t.rowIndex+1," ")}function Te(e,t){1&e&&A.Vc(0),2&e&&A.Xc(" ",t.row.cant," ")}function Ae(e,t){if(1&e&&(A.bc(0,"small",36),A.Vc(1),A.ac()),2&e){var c=A.nc().row;A.uc("matTooltip",c.item.name+" | "+c.item.brand),A.Gb(1),A.Xc(" | ",c.item.brand,"")}}function Re(e,t){if(1&e&&(A.bc(0,"span",36),A.Vc(1),A.ac(),A.Tc(2,Ae,2,2,"small",37)),2&e){var c=t.row;A.uc("matTooltip",c.item.name+" | "+c.item.brand),A.Gb(1),A.Wc(c.item.name),A.Gb(1),A.uc("ngIf",c.item.brand)}}function Le(e,t){if(1&e&&(A.bc(0,"span",36),A.Vc(1),A.ac()),2&e){var c=t.row;A.uc("matTooltip",c.obs),A.Gb(1),A.Wc(c.obs)}}function De(e,t){if(1&e&&(A.bc(0,"span",36),A.Vc(1),A.ac()),2&e){var c=t.row;A.uc("matTooltip",c.costSector),A.Gb(1),A.Wc(c.costSector)}}function Fe(e,t){if(1&e){var c=A.cc();A.bc(0,"button",38),A.jc("click",(function(e){return A.Mc(c),A.nc().send(!1)})),A.Vc(1,"Guardar"),A.ac()}}function Ee(e,t){if(1&e){var c=A.cc();A.bc(0,"button",38),A.jc("click",(function(e){return A.Mc(c),A.nc().send(!1)})),A.Vc(1,"Enviar a autorizar"),A.ac()}}function Pe(e,t){if(1&e){var c=A.cc();A.bc(0,"button",38),A.jc("click",(function(e){return A.Mc(c),A.nc().send(!0)})),A.Vc(1,"Crear y autorizar"),A.ac()}}function Ne(e,t){if(1&e){var c=A.cc();A.bc(0,"button",38),A.jc("click",(function(e){return A.Mc(c),A.nc().send(!0)})),A.Vc(1,"Autorizar"),A.ac()}}var je,Be=((je=function(){function e(t,c,r,n,a,o,i,s,d,u){_classCallCheck(this,e),this._userService=t,this.snackBar=c,this._router=r,this.loader=n,this.dialog=a,this._route=o,this._stockService=i,this._orderService=s,this._orderItemService=d,this._sectorService=u,this.config=C.a.richTextModule,this.tmpItems=[],this.tmpSectors=[],this.addOrderItems=new Array,this.deleteOrderItems=new Array,this.editOrderItems=new Array,this.token=t.getToken(),this.identity=t.getIdentity(),this.order=new S("",null,new Date,new Date,null,this.identity.company._id,null,"","","No creado")}return _createClass(e,[{key:"ngOnInit",value:function(){this.getSectors(),this.getOrders()}},{key:"getOrders",value:function(){var e=this;this._route.params.forEach((function(t){e._orderService.getOne(e.token,t.id).subscribe((function(t){t.order?(e.order=t.order,e._orderItemService.getList(e.token,{order:e.order._id}).subscribe((function(t){t.orderItems&&(e.orderItems=t.orderItems)}),(function(t){e.openSnackBar(t.message,"Cerrar")}))):(e.openSnackBar("Orden no encontrada","Cerrar"),e._router.navigate(["deposit/home"]))}),(function(t){e._router.navigate(["deposit/home"]),e.openSnackBar(t.message,"Cerrar")}))}))}},{key:"getSectors",value:function(){var e=this;this._sectorService.getList(this.token).subscribe((function(t){t.sectors&&(e.sectors=t.sectors)}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}},{key:"filterSector",value:function(e){this.tmpSectors=this.sectors.filter((function(t){return t.name.toLowerCase().includes(e.toString().toLowerCase())}))}},{key:"getLenght",value:function(e){return e.length}},{key:"openSnackBar",value:function(e,t){this.snackBar.open(e,t,{duration:1e4})}},{key:"onActivate",value:function(e){"click"==e.type&&this.newItem(!1,e.row)}},{key:"newItem",value:function(e,t){var c=this;this.dialog.open(se,{width:"720px",disableClose:!1,data:{payload:t,title:e?"Nuevo articulo":"Editar articulo"}}).afterClosed().subscribe((function(r){if(r){if(r.delete)""!=t._id?c.deleteOrderItems.push(t):c.addOrderItems.splice(c.addOrderItems.indexOf(t),1),c.orderItems.splice(c.orderItems.indexOf(t),1),c.orderItems=_toConsumableArray(c.orderItems);else{var n=new $("",null,r.item.item,r.item.cant,r.item.obs,r.item.code,r.item.costSector,0);c.loader.open(),e?(c.addOrderItems.push(n),c.orderItems=c.orderItems.concat([n])):(t.cant=n.cant,t.item=n.item,t.obs=n.obs,t.costSector=n.costSector,""!=t._id&&c.editOrderItems.push(t))}c.loader.close()}}))}},{key:"send",value:function(e){var t=this;this.order.status=e?"Autorizado":"Pendiente",this._orderService.edit(this.token,this.order._id,this.order).subscribe((function(c){c.order&&(t.addOrderItems.forEach((function(e){e.order=t.order._id,t._orderItemService.add(t.token,e).subscribe((function(e){}),(function(e){}))})),t.editOrderItems.forEach((function(e){t._orderItemService.edit(t.token,e._id,e).subscribe((function(e){}),(function(e){}))})),t.deleteOrderItems.forEach((function(e){t._orderItemService.delete(t.token,e._id).subscribe((function(e){}),(function(e){}))})),t.openSnackBar(e?"Pedido autorizado":"Pedido guardado","Cerrar"),t._router.navigate(["deposit/home"]))}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}}]),e}()).\u0275fac=function(e){return new(e||je)(A.Vb(O.a),A.Vb(R.a),A.Vb(n.g),A.Vb(G.a),A.Vb(b.b),A.Vb(n.a),A.Vb(K.a),A.Vb(M.a),A.Vb(V.a),A.Vb(ee.a))},je.\u0275cmp=A.Pb({type:je,selectors:[["app-new-order"]],features:[A.Fb([{provide:ce.c,useClass:te.b},{provide:ce.f,useValue:te.a},M.a,V.a,Z.a,ee.a,K.a])],decls:29,vars:18,consts:[[1,"p-0"],[3,"linear"],["id","orderStep",4,"ngIf"],["id","orderItemsStep"],["matStepLabel",""],["fxLayout","row wrap"],["fxFlex","100","fxFlex.gt-xs","100",1,"pr-1"],[1,"pb-1"],["mat-raised-button","","color","primary",3,"disabled","click"],[1,"material","bg-white",3,"rows","columnMode","headerHeight","footerHeight","limit","rowHeight","activate"],["name","Item",3,"flexGrow"],["ngx-datatable-cell-template",""],["name","Cantidad",3,"flexGrow"],["name","Descripci\xf3n",3,"flexGrow"],["name","Observaci\xf3n",3,"flexGrow"],["name","Centro de costo",3,"flexGrow"],["mat-raised-button","","color","primary","matStepperNext","",3,"click",4,"ngIf"],["fxFlex","16px"],["id","orderStep"],["fxFlex","100","fxFlex.gt-xs","50",1,"pr-1"],[1,"full-width"],["matInput","","name","date",3,"ngModel","matDatepicker","ngModelChange"],["matSuffix","",3,"for"],["date",""],["type","text","placeholder","Destino","aria-label","Text","matInput","","name","sectorDestiny",3,"ngModel","matAutocomplete","input","ngModelChange"],["autoActiveFirstOption",""],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["fxFlex","100","fxFlex.gt-xs","50"],["matInput","","name","dateRequired",3,"ngModel","matDatepicker","ngModelChange"],["dateRequired",""],["type","text","placeholder","Observaciones","aria-label","Text","matInput","","name","obs",3,"ngModel","ngModelChange"],["theme","snow","placeholder","Justificativo de compra","name","justification",3,"modules","ngModel","ngModelChange"],[2,"margin-top","50px"],["mat-raised-button","","color","primary","matStepperNext",""],[3,"value"],[3,"matTooltip"],[3,"matTooltip",4,"ngIf"],["mat-raised-button","","color","primary","matStepperNext","",3,"click"]],template:function(e,t){1&e&&(A.bc(0,"mat-card",0),A.bc(1,"mat-card-content"),A.bc(2,"mat-horizontal-stepper",1),A.Tc(3,Ve,37,12,"mat-step",2),A.bc(4,"mat-step",3),A.Tc(5,Ce,1,0,"ng-template",4),A.bc(6,"form"),A.bc(7,"div",5),A.bc(8,"div",6),A.bc(9,"div",7),A.bc(10,"button",8),A.jc("click",(function(e){return t.newItem(!0)})),A.Vc(11,"A\xf1adir articulo"),A.ac(),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(12,"ngx-datatable",9),A.jc("activate",(function(e){return t.onActivate(e)})),A.bc(13,"ngx-datatable-column",10),A.Tc(14,Oe,1,1,"ng-template",11),A.ac(),A.bc(15,"ngx-datatable-column",12),A.Tc(16,Te,1,1,"ng-template",11),A.ac(),A.bc(17,"ngx-datatable-column",13),A.Tc(18,Re,3,3,"ng-template",11),A.ac(),A.bc(19,"ngx-datatable-column",14),A.Tc(20,Le,2,2,"ng-template",11),A.ac(),A.bc(21,"ngx-datatable-column",15),A.Tc(22,De,2,2,"ng-template",11),A.ac(),A.ac(),A.bc(23,"div"),A.Tc(24,Fe,2,0,"button",16),A.Tc(25,Ee,2,0,"button",16),A.Wb(26,"span",17),A.Tc(27,Pe,2,0,"button",16),A.Tc(28,Ne,2,0,"button",16),A.ac(),A.ac(),A.ac(),A.ac(),A.ac()),2&e&&(A.Gb(2),A.uc("linear",!0),A.Gb(1),A.uc("ngIf","ROLE_ADMIN"==t.identity.role),A.Gb(7),A.uc("disabled","No creado"!=t.order.status&&"ROLE_ADMIN"!=t.identity.role||"Autorizado"==t.order.status||"Finalizado"==t.order.status),A.Gb(2),A.uc("rows",t.orderItems)("columnMode","flex")("headerHeight",40)("footerHeight",50)("limit",10)("rowHeight",45),A.Gb(1),A.uc("flexGrow",1),A.Gb(2),A.uc("flexGrow",1),A.Gb(2),A.uc("flexGrow",7),A.Gb(2),A.uc("flexGrow",7),A.Gb(2),A.uc("flexGrow",3),A.Gb(3),A.uc("ngIf","Pendiente"==t.order.status&&"ROLE_ADMIN"==t.identity.role),A.Gb(1),A.uc("ngIf","No creado"==t.order.status),A.Gb(2),A.uc("ngIf","No creado"==t.order.status&&"ROLE_ADMIN"==t.identity.role),A.Gb(1),A.uc("ngIf","Pendiente"==t.order.status&&"ROLE_ADMIN"==t.identity.role))},directives:[d.a,d.c,x.a,r.m,x.b,x.c,a.x,a.o,a.p,re.d,re.b,s.b,_.d,_.b,_.a,l.a,l.d,o.b,a.c,k.b,a.n,a.q,k.d,l.e,k.a,h.c,h.a,r.l,I.a,x.e,ce.p,m.a],styles:[".butt[_ngcontent-%COMP%]{background-color:#018aca}.butt[_ngcontent-%COMP%], .butt-trash[_ngcontent-%COMP%]{font-size:12px;font-weight:300;color:#fff;display:inline-block;transition:all .5s;cursor:pointer;padding:10px 15px!important;text-transform:uppercase;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;text-align:center}.butt-trash[_ngcontent-%COMP%]{background-color:#ff1717}"]}),je),We=c("vHsL"),He=c("49gX");function ze(e,t){if(1&e&&(A.bc(0,"mat-option",15),A.Vc(1),A.ac()),2&e){var c=t.$implicit;A.uc("value",c),A.Gb(1),A.Xc(" ",c.name," ")}}function qe(e,t){1&e&&A.Vc(0),2&e&&A.Xc(" ",t.rowIndex+1," ")}function Xe(e,t){if(1&e&&(A.bc(0,"span",16),A.Vc(1),A.bc(2,"small"),A.Vc(3),A.ac(),A.ac()),2&e){var c=t.row;A.uc("matTooltip",c.item.name+" "+c.item.brand),A.Gb(1),A.Xc(" ",c.item.name," "),A.Gb(2),A.Wc(c.item.brand)}}function Je(e,t){if(1&e&&(A.bc(0,"span",16),A.Vc(1),A.ac()),2&e){var c=t.row;A.uc("matTooltip",c.obs),A.Gb(1),A.Xc(" ",c.obs," ")}}function Ye(e,t){if(1&e&&A.Vc(0),2&e){var c=t.row;A.Xc(" ",c.cant-c.cantReceived," ")}}function Ue(e,t){if(1&e){var c=A.cc();A.bc(0,"input",17),A.jc("ngModelChange",(function(e){return A.Mc(c),t.row.cantReceived=e})),A.ac()}if(2&e){var r=t.row;A.uc("min",r.cantReceived2)("max",r.cant)("ngModel",r.cantReceived)}}var $e,Ke=function(){return["/deposit/order/list"]},Qe=[{path:"",children:[{path:"new",component:Se,data:{title:"Nueva orden",breadcrumb:"NUEVA ORDEN"}},{path:"get/:id",component:Be,data:{title:"Orden",breadcrumb:"ORDEN"}},{path:"list",component:U,data:{title:"Orden",breadcrumb:"ORDEN"}},{path:"receive/:id",component:($e=function(){function e(t,c,r,n,a,o,i,s,d,u,l,b){_classCallCheck(this,e),this._userService=t,this.snackBar=c,this._router=r,this.loader=n,this.dialog=a,this.confirmService=o,this._route=i,this._movimService=s,this._orderService=d,this._orderItemService=u,this._stockService=l,this._depositService=b,this.token=t.getToken(),this.identity=t.getIdentity(),this.order=new S("",null,new Date,new Date,null,this.identity.company._id,null,"","","No creado")}return _createClass(e,[{key:"ngOnInit",value:function(){this.order.dateRequired.setMonth(this.order.dateRequired.getMonth()+1),this.getDeposits(),this.getOrders(),this.getStocks()}},{key:"getStocks",value:function(){var e=this;this._stockService.getList(this.token,{}).subscribe((function(t){t.stocks&&(e.stocks=t.stocks)}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}},{key:"getDeposits",value:function(){var e=this;this._depositService.getList(this.token,{company:this.identity.company._id}).subscribe((function(t){t.deposits&&(e.deposits=t.deposits,e.deposit=e.deposits[0])}),(function(e){console.error(e)}))}},{key:"getOrders",value:function(){var e=this;this._route.params.forEach((function(t){e._orderService.getOne(e.token,t.id).subscribe((function(t){t.order?(e.order=t.order,e._orderItemService.getList(e.token,{order:e.order._id}).subscribe((function(t){t.orderItems&&(e.orderItems=t.orderItems,e.orderItems.forEach((function(e){e.cantReceived2=e.cantReceived})))}),(function(t){e.openSnackBar(t.message,"Cerrar")}))):(e.openSnackBar("Orden no encontrada","Cerrar"),e._router.navigate(["deposit/home"]))}),(function(t){e._router.navigate(["deposit/home"]),e.openSnackBar(t.message,"Cerrar")}))}))}},{key:"getLenght",value:function(e){return e.length}},{key:"openSnackBar",value:function(e,t){this.snackBar.open(e,t,{duration:1e4})}},{key:"send",value:function(){var e=this,t=!0,c=!0,r="";return this.orderItems.forEach((function(n){(n.cant-n.cantReceived<0||n.cant<n.cant-n.cantReceived)&&(t=!1),n.cantReceived-n.cantReceived2>0&&!e.existStock(n.item._id,e.deposit._id)&&(r=r+n.item.name+" "+n.item.brand+", "),n.cant-n.cantReceived>0&&(c=!1)})),t?""!=r?this.openSnackBar("Los siguientes items no estan habilitados en el dep\xf3sito: "+r+"verificar.","Cerrar"):(""==r&&t&&this.orderItems.forEach((function(t){t.cantReceived-t.cantReceived2>0&&e._orderItemService.edit(e.token,t._id,{cantReceived:t.cantReceived}).subscribe((function(c){if(c.orderItem){setTimeout((function(){e.addMovim(t)}),1e3*Math.random());var r=!1;t.cant==t.cantReceived&&(r=!0),e.editStock(t.item._id,e.deposit._id,t.cantReceived-t.cantReceived2,r)}}),(function(t){e.openSnackBar(t.message,"Cerrar")}))})),c&&this._orderService.edit(this.token,this.order._id,{status:"Recibido"}).subscribe((function(e){}),(function(t){e.openSnackBar(t.message,"Cerrar")})),this.openSnackBar("Movimiento realizado correctamente","Cerrar"),void this._router.navigate(["deposit/order/list"])):this.openSnackBar("Hay valores que no coinciden en lo que se recibe.","Cerrar")}},{key:"addMovim",value:function(e){var t=this,c=new He.a("",null,"Pedido",this.deposit._id,e.item._id,this.identity.company._id,e.cantReceived-e.cantReceived2,this.identity._id,null,new Date,new Date,null,null,null,null,"");this._movimService.add(this.token,c).subscribe((function(e){}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}},{key:"editStock",value:function(e,t,c,r){var n=this,a={$inc:{cant:c}};r&&(a.onOrder=!1);var o=this.stocks.findIndex((function(c){return c.deposit._id==t&&c.item._id==e}));this._stockService.edit(this.token,this.stocks[o]._id,a).subscribe((function(e){}),(function(e){n.openSnackBar(e.message,"Cerrar")}))}},{key:"existStock",value:function(e,t){return-1!=this.stocks.findIndex((function(c){return c.deposit._id==t&&c.item._id==e}))}}]),e}(),$e.\u0275fac=function(e){return new(e||$e)(A.Vb(O.a),A.Vb(R.a),A.Vb(n.g),A.Vb(G.a),A.Vb(b.b),A.Vb(de.a),A.Vb(n.a),A.Vb(We.a),A.Vb(M.a),A.Vb(V.a),A.Vb(K.a),A.Vb(Q.a))},$e.\u0275cmp=A.Pb({type:$e,selectors:[["app-receive-order"]],features:[A.Fb([M.a,V.a,K.a,Q.a,We.a])],decls:24,vars:15,consts:[[1,"p-0"],[1,"full-width",2,"margin-top","20px","padding-bottom","0px","padding-top","0px"],["placeholder","Dep\xf3sito","name","deposit",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"material","bg-white",3,"rows","columnMode","headerHeight","footerHeight","limit","rowHeight"],["name","Item",3,"flexGrow"],["ngx-datatable-cell-template",""],["name","Articulo",3,"flexGrow"],["name","Observaciones",3,"flexGrow"],["name","Faltante",3,"flexGrow"],["name","Recibido",3,"flexGrow"],["ngx-datatable-cell-template","","style","padding-bottom: 10px;"],["mat-raised-button","","color","accent",3,"routerLink"],["fxFlex","16px"],["mat-raised-button","","color","primary",3,"click"],[3,"value"],[3,"matTooltip"],["type","number","matInput","",2,"border","0",3,"min","max","ngModel","ngModelChange"]],template:function(e,t){1&e&&(A.bc(0,"mat-card",0),A.bc(1,"mat-card-content"),A.bc(2,"mat-form-field",1),A.bc(3,"mat-select",2),A.jc("ngModelChange",(function(e){return t.deposit=e})),A.Tc(4,ze,2,2,"mat-option",3),A.ac(),A.ac(),A.ac(),A.ac(),A.bc(5,"mat-card",0),A.bc(6,"mat-card-content"),A.bc(7,"ngx-datatable",4),A.bc(8,"ngx-datatable-column",5),A.Tc(9,qe,1,1,"ng-template",6),A.ac(),A.bc(10,"ngx-datatable-column",7),A.Tc(11,Xe,4,3,"ng-template",6),A.ac(),A.bc(12,"ngx-datatable-column",8),A.Tc(13,Je,2,2,"ng-template",6),A.ac(),A.bc(14,"ngx-datatable-column",9),A.Tc(15,Ye,1,1,"ng-template",6),A.ac(),A.bc(16,"ngx-datatable-column",10),A.Tc(17,Ue,1,3,"ng-template",11),A.ac(),A.ac(),A.bc(18,"div"),A.bc(19,"button",12),A.Vc(20,"Volver"),A.ac(),A.Wb(21,"span",13),A.bc(22,"button",14),A.jc("click",(function(e){return t.send()})),A.Vc(23,"Recibir"),A.ac(),A.ac(),A.ac(),A.ac()),2&e&&(A.Gb(3),A.uc("ngModel",t.deposit),A.Gb(1),A.uc("ngForOf",t.deposits),A.Gb(3),A.uc("rows",t.orderItems)("columnMode","flex")("headerHeight",40)("footerHeight",50)("limit",10)("rowHeight",45),A.Gb(1),A.uc("flexGrow",1),A.Gb(2),A.uc("flexGrow",4),A.Gb(2),A.uc("flexGrow",4),A.Gb(2),A.uc("flexGrow",1),A.Gb(2),A.uc("flexGrow",2),A.Gb(3),A.uc("routerLink",A.zc(14,Ke)))},directives:[d.a,d.c,l.a,v.a,a.n,a.q,r.l,_.d,_.b,_.a,s.b,n.h,re.b,ce.p,m.a,a.s,o.b,a.c],encapsulation:2}),$e),data:{title:"Recibir pedido",breadcrumb:"RECIBIR PEDIDO"}}]}];c.d(t,"AppOrderModule",(function(){return et}));var Ze,et=((Ze=function e(){_classCallCheck(this,e)}).\u0275mod=A.Tb({type:Ze}),Ze.\u0275inj=A.Sb({factory:function(e){return new(e||Ze)},imports:[[r.c,a.t,l.c,w.b,I.b,x.d,a.j,_.e,u.b,g.b,h.b,b.f,v.b,f.a,m.b,k.c,i.b,s.c,d.e,y.b,o.c,p.a,n.k.forChild(Qe)]]}),Ze)}}]);