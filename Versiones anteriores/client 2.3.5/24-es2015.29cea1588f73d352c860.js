(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{y64J:function(t,e,o){"use strict";o.r(e);var i=o("bFKe"),c=o("3Pt+"),a=o("bTqV"),n=o("bSwM"),s=o("A5z7"),r=o("FKr1"),d=o("iadO"),l=o("0IaG"),u=o("f0Cb"),h=o("kmnG"),p=o("NFeN"),b=o("qFsG"),m=o("STbY"),g=o("/t3+"),f=o("Qu3c"),v=o("ofXK"),k=o("7ZcW"),y=o("Wp6s"),T=o("tyNb"),L=o("2Vo4"),x=o("fXoL"),M=o("tk/3");let _=(()=>{class t{constructor(t){this.http=t,this.searchTerm=new L.a("")}getTodoList(){return this.http.get("/api/todoList")}getTodoById(t){return this.http.get("/api/todoList/"+t)}getTagList(){return this.http.get("/api/todoTag")}updateSearchTerm(t){this.searchTerm.next(t)}getSearchTerm(){return this.searchTerm}saveTag(t){return this.http.post("/api/todoTag/",t)}deleteTag(t){this.http.delete("/api/todoTag/"+t.id).subscribe(t=>{})}deleteTodo(t){return this.http.delete("/api/todoList/"+t.id)}updateTodo(t){let e;return t.selected=!1,t.id?e=this.http.put("/api/todoList/"+t.id,t):(t.id=1e6*Math.random(),e=this.http.post("/api/todoList/",t)),this.sub?(this.sub.unsubscribe(),this.sub=e.subscribe(t=>{})):this.sub=e.subscribe(t=>{}),e}}return t.\u0275fac=function(e){return new(e||t)(x.fc(M.c))},t.\u0275prov=x.Rb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),C=(()=>{class t{constructor(t){this.todoService=t}ngOnInit(){this.updateSearchTerm("")}updateSearchTerm(t){this.todoService.updateSearchTerm(t)}}return t.\u0275fac=function(e){return new(e||t)(x.Vb(_))},t.\u0275cmp=x.Pb({type:t,selectors:[["app-todo"]],decls:1,vars:0,template:function(t,e){1&t&&x.Wb(0,"router-outlet")},directives:[T.l],styles:[""],changeDetection:0}),t})();var D=o("5+WD"),G=o("Kj3r"),S=o("lJxs"),O=o("XNiG"),V=o("xgIS"),I=o("/MnI"),w=o("gU78"),F=(o("AJX/"),o("YFeJ"));let j=(()=>{class t{constructor(t){this._httpClient=t,this.httpOptions={headers:new M.e({"Content-Type":"application/json",Authorization:"null"})},this.url=F.a.url}add(t,e){let o=JSON.stringify(e);return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.post(this.url+"tag/add",o,this.httpOptions)}edit(t,e,o){let i=JSON.stringify(o);return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.put(this.url+"tag/update/"+e,i,this.httpOptions)}delete(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.delete(this.url+"tag/delete/"+e,this.httpOptions)}getList(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"tag/list",{headers:this.httpOptions.headers,params:e})}getOne(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"tag/tag/"+e,this.httpOptions)}getForName(t,e){return this.httpOptions.headers=this.httpOptions.headers.set("Authorization",t),this._httpClient.get(this.url+"tag/for-name/"+e,this.httpOptions)}}return t.\u0275fac=function(e){return new(e||t)(x.fc(M.c))},t.\u0275prov=x.Rb({token:t,factory:t.\u0275fac}),t})();var W=o("wd/R"),A=o("dNgK"),B=o("XiUz"),R=o("znSr");let N=(()=>{class t{transform(t,e){return void 0!==t&&e?t.filter(t=>t.title.toLowerCase().match(e.toLowerCase())||t.note.toLowerCase().match(e.toLowerCase())):t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=x.Ub({name:"todoSearch",type:t,pure:!0}),t})();const Y=["searcher"];function z(t,e){if(1&t){const t=x.cc();x.bc(0,"button",13),x.jc("click",(function(o){x.Mc(t);const i=e.$implicit;return x.nc().filterTodoListOnTag(i)})),x.Vc(1),x.ac()}if(2&t){const t=e.$implicit;x.Gb(1),x.Xc(" ",t.name," ")}}function J(t,e){1&t&&(x.bc(0,"div",22),x.Vc(1," No hay tareas para mostrar "),x.ac())}function $(t,e){1&t&&(x.bc(0,"mat-icon",36),x.Vc(1,"open_with"),x.ac())}function P(t,e){if(1&t&&(x.bc(0,"strong",37),x.Vc(1),x.ac()),2&t){const t=x.nc().$implicit;x.Gb(1),x.Xc("#",t.numTodo,"")}}function X(t,e){if(1&t&&(x.bc(0,"div"),x.bc(1,"mat-chip"),x.Vc(2),x.ac(),x.ac()),2&t){const t=e.$implicit;x.Gb(2),x.Xc(" ",t.name," ")}}const q=function(t,e){return{"todo-box":!0,readed:t,done:e}},E=function(t){return{"fill-color-warn":t}},H=function(t){return{"fill-color-accent":t}};function U(t,e){if(1&t){const t=x.cc();x.bc(0,"div",23),x.Tc(1,$,2,0,"mat-icon",24),x.Tc(2,P,2,1,"strong",25),x.bc(3,"div",26),x.bc(4,"div",27),x.bc(5,"span"),x.bc(6,"strong"),x.Vc(7),x.ac(),x.Vc(8),x.ac(),x.bc(9,"span"),x.Vc(10),x.ac(),x.bc(11,"mat-chip-list",null,28),x.Tc(13,X,3,1,"div",29),x.ac(),x.ac(),x.bc(14,"div",30),x.bc(15,"button",31),x.jc("click",(function(o){x.Mc(t);const i=e.$implicit;return x.nc().toggleImportant(i)})),x.bc(16,"mat-icon",32),x.Vc(17),x.ac(),x.ac(),x.bc(18,"button",31),x.jc("click",(function(o){x.Mc(t);const i=e.$implicit;return x.nc().toggleStar(i)})),x.bc(19,"mat-icon",32),x.Vc(20),x.ac(),x.ac(),x.bc(21,"div"),x.bc(22,"button",11),x.bc(23,"mat-icon"),x.Vc(24,"more_vert"),x.ac(),x.ac(),x.bc(25,"mat-menu",33,34),x.bc(27,"button",13),x.jc("click",(function(o){x.Mc(t);const i=e.$implicit;return x.nc().toggleRead(i)})),x.bc(28,"mat-icon"),x.Vc(29),x.ac(),x.bc(30,"span",35),x.Vc(31," Le\xeddo "),x.ac(),x.ac(),x.bc(32,"button",13),x.jc("click",(function(o){x.Mc(t);const i=e.$implicit;return x.nc().toggleDone(i)})),x.bc(33,"mat-icon"),x.Vc(34),x.ac(),x.bc(35,"span",35),x.Vc(36," Realizado "),x.ac(),x.ac(),x.ac(),x.ac(),x.ac(),x.ac(),x.ac()}if(2&t){const t=e.$implicit,o=x.Jc(26),i=x.nc();x.uc("ngClass",x.Bc(16,q,null==t.usersWhoRead?null:t.usersWhoRead.includes(i.identity._id),t.done)),x.Gb(1),x.uc("ngIf",!t.numTodo),x.Gb(1),x.uc("ngIf",t.numTodo),x.Gb(2),x.wc("routerLink","/todo/list/",null==t?null:t._id,""),x.Gb(3),x.Wc(null==t?null:t.title),x.Gb(1),x.Xc(" | ",i.changeDate(null==t?null:t.startDate),""),x.Gb(2),x.Wc(null==t?null:t.note),x.Gb(3),x.uc("ngForOf",null==t?null:t.tags),x.Gb(3),x.uc("ngClass",x.Ac(19,E,null==t?null:t.important)),x.Gb(1),x.Wc(null!=t&&t.important?"error":"error_outline"),x.Gb(2),x.uc("ngClass",x.Ac(21,H,null==t?null:t.starred)),x.Gb(1),x.Wc(null!=t&&t.starred?"star":"star_outline"),x.Gb(2),x.uc("matMenuTriggerFor",o),x.Gb(3),x.uc("xPosition","before"),x.Gb(4),x.Wc(null!=t.usersWhoRead&&t.usersWhoRead.includes(i.identity._id)?"check_box":"check_box_outline_blank"),x.Gb(5),x.Wc(t.done?"check_box":"check_box_outline_blank")}}let K=(()=>{class t{constructor(t,e,o,i,c,a){this.todoService=t,this._todoService=e,this._userService=o,this._tagService=i,this.cdr=c,this.snackBar=a,this.tagMap=new Map,this.isMasterToggled=!1,this.toggledItemNumber=0,this.filter="No Realizados",this.unsubscribeAll=new O.a,this.token=o.getToken(),this.identity=o.getIdentity()}ngOnInit(){this.getTodo(),this.getTags()}ngAfterViewInit(){Object(V.a)(document.getElementById("searcher"),"keyup").pipe(Object(G.a)(250),Object(S.a)(t=>t.target.value)).subscribe(t=>{let e=t[0];switch(this.todoList=this.searchTempList,e){case"#":let e=Number(t.split("#")[1]);this.todoList=this.searchTempList.filter(t=>t.numTodo==e);break;case"@":let o=String(t.split("@")[1]);this.todoList=this.searchTempList.filter(t=>{let e="",i=t.users.map(t=>t.name.toLowerCase()+t.surname.toLowerCase());return console.log(i),i.forEach(t=>{e+=t}),e.includes(o.toLowerCase())});break;case"*":let i=String(t.split("*")[1]).toLowerCase();this.todoList=this.searchTempList.filter(t=>t.note.toLowerCase().includes(i));break;default:let c=t.toLowerCase();this.todoList=this.searchTempList.filter(t=>t.title.toLowerCase().includes(c))}this.cdr.markForCheck()})}getTodo(){this._todoService.getList(this.token,{company:this.identity.company._id}).subscribe(t=>{t.todos&&(this.tempList=t.todos,this.todoList=this.tempList.filter(t=>{var e;return-1!=(null===(e=t.users)||void 0===e?void 0:e.map(t=>t._id).indexOf(this.identity._id))&&!t.done}),this.searchTempList=this.todoList,this.cdr.markForCheck())},t=>{this.openSnackBar(t.message,"Cerrar")})}getTags(){this._tagService.getList(this.token,{company:this.identity.company._id}).subscribe(t=>{t.tags&&(this.tags=t.tags)},t=>{this.openSnackBar(t.message,"Cerrar")})}ngOnDestroy(){this.unsubscribeAll.next(),this.unsubscribeAll.complete()}drop(t){Object(D.e)(this.todoList,t.previousIndex,t.currentIndex),this.cdr.markForCheck()}filterTodoListOnTag(t){let e=new Array;this.tempList.forEach(o=>{if(o.tags)for(let i=0;i<o.tags.length;i++)if(o.tags[i].name==t.name){e.push(o);break}}),this.todoList=e}onTodoOptionSelected(t){switch(t.target.innerText){case"Todo":this.todoList=this.tempList,this.searchTempList=this.tempList,this.todoList.sort(this.compareDatesLow),this.filter="Todo";break;case"Todo - Pendientes":this.todoList=this.tempList.filter(t=>!t.done),this.todoList.sort(this.compareDatesLow),this.searchTempList=this.todoList,this.filter="Todo - Pendientes";break;case"Todo - Realizados":this.todoList=this.tempList.filter(t=>t.done),this.todoList.sort(this.compareDatesHigh),this.searchTempList=this.todoList,this.filter="Todo - Realizados";break;case"Todo - Mios":this.todoList=this.tempList.filter(t=>{var e;return-1!=(null===(e=t.users)||void 0===e?void 0:e.map(t=>t._id).indexOf(this.identity._id))}),this.filter="Mios",this.searchTempList=this.todoList;break;case"Le\xeddo":this.todoList=this.tempList.filter(t=>{var e,o;return-1!=(null===(e=t.users)||void 0===e?void 0:e.map(t=>t._id).indexOf(this.identity._id))&&(null===(o=t.usersWhoRead)||void 0===o?void 0:o.includes(this.identity._id))}),this.todoList.sort(this.compareDatesLow),this.filter="Le\xeddo",this.searchTempList=this.todoList;break;case"No Le\xeddo":this.todoList=this.tempList.filter(t=>{var e,o;return-1!=(null===(e=t.users)||void 0===e?void 0:e.map(t=>t._id).indexOf(this.identity._id))&&!(null===(o=t.usersWhoRead)||void 0===o?void 0:o.includes(this.identity._id))}),this.todoList.sort(this.compareDatesLow),this.filter="No Le\xeddo",this.searchTempList=this.todoList;break;case"Importante":this.todoList=this.tempList.filter(t=>{var e;return-1!=(null===(e=t.users)||void 0===e?void 0:e.map(t=>t._id).indexOf(this.identity._id))&&t.important}),this.todoList.sort(this.compareDatesLow),this.filter="Importante",this.searchTempList=this.todoList;break;case"No Importante":this.todoList=this.tempList.filter(t=>{var e;return-1!=(null===(e=t.users)||void 0===e?void 0:e.map(t=>t._id).indexOf(this.identity._id))&&!t.important}),this.todoList.sort(this.compareDatesLow),this.filter="No Importante",this.searchTempList=this.todoList;break;case"Realizado":this.todoList=this.tempList.filter(t=>{var e;return-1!=(null===(e=t.users)||void 0===e?void 0:e.map(t=>t._id).indexOf(this.identity._id))&&t.done}),this.todoList.sort(this.compareDatesHigh),this.filter="Realizado",this.searchTempList=this.todoList;break;case"No Realizado":this.todoList=this.tempList.filter(t=>{var e;return-1!=(null===(e=t.users)||void 0===e?void 0:e.map(t=>t._id).indexOf(this.identity._id))&&!t.done}),this.todoList.sort(this.compareDatesLow),this.filter="No Realizado",this.searchTempList=this.todoList;break;case"Favorito":this.todoList=this.tempList.filter(t=>{var e;return-1!=(null===(e=t.users)||void 0===e?void 0:e.map(t=>t._id).indexOf(this.identity._id))&&t.starred}),this.todoList.sort(this.compareDatesLow),this.filter="Favorito",this.searchTempList=this.todoList;break;case"No Favorito":this.todoList=this.tempList.filter(t=>{var e;return-1!=(null===(e=t.users)||void 0===e?void 0:e.map(t=>t._id).indexOf(this.identity._id))&&!t.starred}),this.todoList.sort(this.compareDatesLow),this.filter="No favorito",this.searchTempList=this.todoList}this.cdr.detectChanges()}compareDatesHigh(t,e){return t.startDate<e.startDate?1:-1}compareDatesLow(t,e){return t.startDate<e.startDate?-1:1}masterToggle(){this.toggledItemNumber=0,this.isMasterToggled=!this.isMasterToggled,this.todoList.forEach(this.isMasterToggled?t=>{t.selected=!0,this.toggledItemNumber++}:t=>{t.selected=!1,this.toggledItemNumber--}),this.cdr.detectChanges()}toggleCheckBox(t){t.selected=!t.selected,t.selected?this.toggledItemNumber++:this.toggledItemNumber--,this.toggledItemNumber==this.todoList.length?this.isMasterToggled=!0:0==this.toggledItemNumber&&(this.isMasterToggled=!1)}toggleImportant(t){this.userInTodo(t)?(t.important=!t.important,this.updateTodo(t)):this.openSnackBar("No tienes permisos para modificar esta tarea","Cerrar")}toggleStar(t){this.userInTodo(t)?(t.starred=!t.starred,this.updateTodo(t)):this.openSnackBar("No tienes permisos para modificar esta tarea","Cerrar")}toggleRead(t){var e;(null===(e=t.usersWhoRead)||void 0===e?void 0:e.includes(this.identity._id))?t.usersWhoRead.splice(t.usersWhoRead.indexOf(this.identity._id),1):t.usersWhoRead.push(this.identity._id),this.updateTodo(t)}toggleDone(t){this.userInTodo(t)?(t.done=!t.done,this.updateTodo(t)):this.openSnackBar("No tienes permisos para modificar esta tarea","Cerrar")}updateTodo(t){this._todoService.edit(this.token,t._id,t).subscribe(t=>{},t=>{this.openSnackBar(t.message,"Cerrar")})}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}userInTodo(t){var e;return!!t.users&&-1!=(null===(e=t.users)||void 0===e?void 0:e.map(t=>t._id).indexOf(this.identity._id))}changeDate(t){return W(t).format("DD-MM-YYYY")}}return t.\u0275fac=function(e){return new(e||t)(x.Vb(_),x.Vb(I.a),x.Vb(w.a),x.Vb(j),x.Vb(x.h),x.Vb(A.a))},t.\u0275cmp=x.Pb({type:t,selectors:[["app-todo-list"]],viewQuery:function(t,e){var o;1&t&&x.bd(Y,!0),2&t&&x.Ic(o=x.kc())&&(e.button=o.first)},decls:59,vars:9,consts:[[1,"page-layout","overflow-hidden","pb-8"],[1,"header-bg","dark-blue"],[1,"content"],["fxLayout","row wrap","fxLayoutAlign","center center",1,"content-header"],["fxFlex","1 1 0%",1,"search-box","mat-elevation-z2"],["mat-icon-button",""],["type","text","id","searcher","placeholder","Buscar una tarea por titulo (#: Por n\xfamero, @: Por nombre/apellido, *: Por descripci\xf3n)"],["serachTerm",""],[1,"content-body"],[1,"content-card","default-bg","height-100vh",3,"perfectScrollbar"],["fxLayoutGap","5px"],["mat-icon-button","",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"],["tagMenu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["fxLayout","row","fxFlex","1 1 0%","fxLayoutAlign","start center"],["fxLayout","row","fxFlex","1 1 0%","fxLayoutAlign","end center"],["mat-raised-button","","color","primary","routerLink","/todo/add"],["cdkDropList","",1,"todo-list",3,"cdkDropListDropped"],["class","todo-box","fxLayout","row","fxLayoutAlign","center center",4,"ngIf"],["fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","20px","cdkDrag","","cdkDragHandle","",3,"ngClass",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","center center",1,"todo-box"],["fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","20px","cdkDrag","","cdkDragHandle","",3,"ngClass"],["class","move-handler",4,"ngIf"],["style","font-size: 20px;",4,"ngIf"],["fxLayout","row","fxLayoutAlign","space-between center","fxFlex","1 1 0%"],["fxLayout","column","fxLayoutGap","8px","fxFlex","1 1 0%",2,"cursor","pointer",3,"routerLink"],["chipList",""],[4,"ngFor","ngForOf"],["fxFlexAlign","end center","fxLayout","row"],["mat-icon-button","",3,"click"],[3,"ngClass"],[3,"xPosition"],["menu2","matMenu"],[2,"vertical-align","middle"],[1,"move-handler"],[2,"font-size","20px"]],template:function(t,e){if(1&t&&(x.bc(0,"div",0),x.Wb(1,"div",1),x.bc(2,"div",2),x.bc(3,"div",3),x.bc(4,"div",4),x.bc(5,"button",5),x.bc(6,"mat-icon"),x.Vc(7,"search"),x.ac(),x.ac(),x.Wb(8,"input",6,7),x.ac(),x.ac(),x.bc(10,"div",8),x.bc(11,"div",9),x.bc(12,"mat-toolbar",10),x.bc(13,"button",11),x.bc(14,"mat-icon"),x.Vc(15,"arrow_drop_down"),x.ac(),x.ac(),x.bc(16,"mat-menu",null,12),x.bc(18,"button",13),x.jc("click",(function(t){return e.onTodoOptionSelected(t)})),x.Vc(19,"Todo"),x.ac(),x.bc(20,"button",13),x.jc("click",(function(t){return e.onTodoOptionSelected(t)})),x.Vc(21,"Todo - Pendientes"),x.ac(),x.bc(22,"button",13),x.jc("click",(function(t){return e.onTodoOptionSelected(t)})),x.Vc(23,"Todo - Realizados"),x.ac(),x.bc(24,"button",13),x.jc("click",(function(t){return e.onTodoOptionSelected(t)})),x.Vc(25,"Todo - Mios"),x.ac(),x.bc(26,"button",13),x.jc("click",(function(t){return e.onTodoOptionSelected(t)})),x.Vc(27,"Realizado"),x.ac(),x.bc(28,"button",13),x.jc("click",(function(t){return e.onTodoOptionSelected(t)})),x.Vc(29,"No realizado"),x.ac(),x.bc(30,"button",13),x.jc("click",(function(t){return e.onTodoOptionSelected(t)})),x.Vc(31,"Le\xeddo"),x.ac(),x.bc(32,"button",13),x.jc("click",(function(t){return e.onTodoOptionSelected(t)})),x.Vc(33,"No le\xeddo"),x.ac(),x.bc(34,"button",13),x.jc("click",(function(t){return e.onTodoOptionSelected(t)})),x.Vc(35," Favorito "),x.ac(),x.bc(36,"button",13),x.jc("click",(function(t){return e.onTodoOptionSelected(t)})),x.Vc(37," No favorito "),x.ac(),x.bc(38,"button",13),x.jc("click",(function(t){return e.onTodoOptionSelected(t)})),x.Vc(39," Importante "),x.ac(),x.bc(40,"button",13),x.jc("click",(function(t){return e.onTodoOptionSelected(t)})),x.Vc(41," No importante "),x.ac(),x.ac(),x.bc(42,"button",11),x.bc(43,"mat-icon"),x.Vc(44,"label"),x.ac(),x.ac(),x.bc(45,"mat-menu",null,14),x.bc(47,"button",13),x.jc("click",(function(t){return e.onTodoOptionSelected({target:{innerText:"Todo"}})})),x.Vc(48," Todo "),x.ac(),x.Tc(49,z,2,1,"button",15),x.ac(),x.bc(50,"div",16),x.Vc(51),x.ac(),x.bc(52,"div",17),x.bc(53,"button",18),x.Vc(54," Crear tarea "),x.ac(),x.ac(),x.ac(),x.bc(55,"div",19),x.jc("cdkDropListDropped",(function(t){return e.drop(t)})),x.Tc(56,J,2,0,"div",20),x.Tc(57,U,37,23,"div",21),x.oc(58,"todoSearch"),x.ac(),x.ac(),x.ac(),x.ac(),x.ac()),2&t){const t=x.Jc(17),o=x.Jc(46);x.Gb(13),x.uc("matMenuTriggerFor",t),x.Gb(29),x.uc("matMenuTriggerFor",o),x.Gb(7),x.uc("ngForOf",e.tags),x.Gb(2),x.Xc(" ",e.filter," "),x.Gb(5),x.uc("ngIf",(null==e.todoList?null:e.todoList.length)<1),x.Gb(1),x.uc("ngForOf",x.qc(58,6,e.todoList,e.searchTerm))}},directives:[B.d,B.c,B.b,a.b,p.a,i.b,g.a,B.e,m.c,m.d,m.a,v.l,T.h,D.c,v.m,D.a,D.b,v.k,R.a,s.b,B.a,s.a],pipes:[N],styles:[".readed[_ngcontent-%COMP%]{background-color:#d3d3d3}.done[_ngcontent-%COMP%]{background-color:#90ee90}"],changeDetection:0}),t})();class Q{constructor(t,e,o){this._id=t,this.name=e,this.company=o}}function Z(t,e){if(1&t){const t=x.cc();x.bc(0,"button",9),x.jc("click",(function(e){x.Mc(t);const o=x.nc().$implicit;return x.nc().deleteTag(o)})),x.Vc(1,"Eliminar"),x.ac()}}function tt(t,e){if(1&t&&(x.bc(0,"div",0),x.bc(1,"span"),x.Vc(2),x.ac(),x.Tc(3,Z,2,0,"button",8),x.ac()),2&t){const t=e.$implicit,o=x.nc();x.Gb(2),x.Wc(t.name),x.Gb(1),x.uc("ngIf","ROLE_ADMIN"!=o.identity.role)}}let et=(()=>{class t{constructor(t,e,o,i,c){this.snackBar=t,this.dialogRef=e,this.data=o,this._tagService=i,this._userService=c,this.token=c.getToken(),this.identity=c.getIdentity()}ngOnInit(){this.getTags()}getTags(){this._tagService.getList(this.token,{company:this.identity.company._id}).subscribe(t=>{t.tags&&(this.tags=t.tags)})}addTag(t){let e=new Q("",t,this.identity.company._id);this._tagService.add(this.token,e).subscribe(t=>{t.tag&&this.getTags()},t=>{this.openSnackBar(t.message,"Cerrar")})}deleteTag(t){this._tagService.delete(this.token,t._id).subscribe(t=>{t.tag&&this.getTags()},t=>{this.openSnackBar(t.message,"Cerrar")})}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}}return t.\u0275fac=function(e){return new(e||t)(x.Vb(A.a),x.Vb(l.g),x.Vb(l.a),x.Vb(j),x.Vb(w.a))},t.\u0275cmp=x.Pb({type:t,selectors:[["app-tag-dialogue"]],decls:12,vars:1,consts:[["fxLayout","row","fxLayoutAlign","space-between center"],["matInput","","placeholder","Nueva etiqueta","required","",3,"keyup.enter"],["tagInput",""],["color","primary","mat-raised-button","",3,"click"],["fxLayout","column","fxLayoutGap","16px",2,"margin-top","20px"],["fxLayout","row","fxLayoutAlign","space-between center",4,"ngFor","ngForOf"],["align","end"],["mat-button","","mat-dialog-close",""],["color","warn","mat-raised-button","",3,"click",4,"ngIf"],["color","warn","mat-raised-button","",3,"click"]],template:function(t,e){if(1&t){const t=x.cc();x.bc(0,"mat-dialog-content"),x.bc(1,"div",0),x.bc(2,"mat-form-field"),x.bc(3,"input",1,2),x.jc("keyup.enter",(function(o){x.Mc(t);const i=x.Jc(4);return e.addTag(i.value),i.value=""})),x.ac(),x.ac(),x.bc(5,"button",3),x.jc("click",(function(o){x.Mc(t);const i=x.Jc(4);return e.addTag(i.value),i.value=""})),x.Vc(6,"A\xf1adir"),x.ac(),x.ac(),x.bc(7,"div",4),x.Tc(8,tt,4,2,"div",5),x.ac(),x.ac(),x.bc(9,"mat-dialog-actions",6),x.bc(10,"button",7),x.Vc(11,"Cerrar"),x.ac(),x.ac()}2&t&&(x.Gb(8),x.uc("ngForOf",e.tags))},directives:[l.e,B.d,B.c,h.a,b.b,a.b,B.e,v.l,l.c,l.d,v.m],styles:[""],changeDetection:0}),t})();var ot=o("3uMe"),it=o("47Ty"),ct=o("AV9v"),at=o("sd1j"),nt=o("Q2c7"),st=o("d3UM");function rt(t,e){if(1&t&&(x.bc(0,"mat-option",10),x.Vc(1),x.ac()),2&t){const t=e.$implicit;x.uc("value",t),x.Gb(1),x.Xc(" ",t," ")}}function dt(t,e){if(1&t){const t=x.cc();x.bc(0,"div",11),x.bc(1,"mat-form-field",4),x.bc(2,"input",12),x.jc("ngModelChange",(function(e){return x.Mc(t),x.nc().firstDate=e})),x.ac(),x.Wb(3,"mat-datepicker-toggle",13),x.Wb(4,"mat-datepicker",null,14),x.ac(),x.ac()}if(2&t){const t=x.Jc(5),e=x.nc();x.Gb(2),x.uc("ngModel",e.firstDate)("matDatepicker",t),x.Gb(1),x.uc("for",t)}}function lt(t,e){if(1&t){const t=x.cc();x.bc(0,"div",15),x.bc(1,"div",16),x.bc(2,"div",17),x.bc(3,"div",18),x.bc(4,"div",17),x.bc(5,"div",19),x.bc(6,"label",20),x.Vc(7,"Lun"),x.ac(),x.ac(),x.ac(),x.bc(8,"div",17),x.bc(9,"div",19),x.bc(10,"input",21,22),x.jc("ngModelChange",(function(e){return x.Mc(t),x.nc().dayOfWeek.lun=e})),x.ac(),x.ac(),x.ac(),x.ac(),x.bc(12,"div",18),x.bc(13,"div",17),x.bc(14,"div",19),x.bc(15,"label",20),x.Vc(16,"Mar"),x.ac(),x.ac(),x.ac(),x.bc(17,"div",17),x.bc(18,"div",19),x.bc(19,"input",23,24),x.jc("ngModelChange",(function(e){return x.Mc(t),x.nc().dayOfWeek.mar=e})),x.ac(),x.ac(),x.ac(),x.ac(),x.bc(21,"div",18),x.bc(22,"div",17),x.bc(23,"div",19),x.bc(24,"label",20),x.Vc(25,"Mie"),x.ac(),x.ac(),x.ac(),x.bc(26,"div",17),x.bc(27,"div",19),x.bc(28,"input",25,26),x.jc("ngModelChange",(function(e){return x.Mc(t),x.nc().dayOfWeek.mie=e})),x.ac(),x.ac(),x.ac(),x.ac(),x.bc(30,"div",18),x.bc(31,"div",17),x.bc(32,"div",19),x.bc(33,"label",20),x.Vc(34,"Jue"),x.ac(),x.ac(),x.ac(),x.bc(35,"div",17),x.bc(36,"div",19),x.bc(37,"input",27,28),x.jc("ngModelChange",(function(e){return x.Mc(t),x.nc().dayOfWeek.jue=e})),x.ac(),x.ac(),x.ac(),x.ac(),x.bc(39,"div",18),x.bc(40,"div",17),x.bc(41,"div",19),x.bc(42,"label",20),x.Vc(43,"Vie"),x.ac(),x.ac(),x.ac(),x.bc(44,"div",17),x.bc(45,"div",19),x.bc(46,"input",29,30),x.jc("ngModelChange",(function(e){return x.Mc(t),x.nc().dayOfWeek.vie=e})),x.ac(),x.ac(),x.ac(),x.ac(),x.bc(48,"div",18),x.bc(49,"div",17),x.bc(50,"div",19),x.bc(51,"label",20),x.Vc(52,"Sab"),x.ac(),x.ac(),x.ac(),x.bc(53,"div",17),x.bc(54,"div",19),x.bc(55,"input",31,32),x.jc("ngModelChange",(function(e){return x.Mc(t),x.nc().dayOfWeek.sab=e})),x.ac(),x.ac(),x.ac(),x.ac(),x.ac(),x.ac(),x.ac()}if(2&t){const t=x.nc();x.Gb(10),x.uc("ngModel",t.dayOfWeek.lun),x.Gb(9),x.uc("ngModel",t.dayOfWeek.mar),x.Gb(9),x.uc("ngModel",t.dayOfWeek.mie),x.Gb(9),x.uc("ngModel",t.dayOfWeek.jue),x.Gb(9),x.uc("ngModel",t.dayOfWeek.vie),x.Gb(9),x.uc("ngModel",t.dayOfWeek.sab)}}function ut(t,e){if(1&t){const t=x.cc();x.bc(0,"div",11),x.bc(1,"mat-form-field",4),x.bc(2,"input",33),x.jc("ngModelChange",(function(e){return x.Mc(t),x.nc().lastDate=e})),x.ac(),x.Wb(3,"mat-datepicker-toggle",13),x.Wb(4,"mat-datepicker",null,34),x.ac(),x.ac()}if(2&t){const t=x.Jc(5),e=x.nc();x.Gb(2),x.uc("ngModel",e.lastDate)("matDatepicker",t),x.Gb(1),x.uc("for",t)}}function ht(t,e){if(1&t){const t=x.cc();x.bc(0,"div",11),x.bc(1,"mat-form-field",4),x.bc(2,"input",12),x.jc("ngModelChange",(function(e){return x.Mc(t),x.nc().firstDate=e})),x.ac(),x.Wb(3,"mat-datepicker-toggle",13),x.Wb(4,"mat-datepicker",null,35),x.ac(),x.ac()}if(2&t){const t=x.Jc(5),e=x.nc();x.Gb(2),x.uc("ngModel",e.firstDate)("matDatepicker",t),x.Gb(1),x.uc("for",t)}}function pt(t,e){if(1&t){const t=x.cc();x.bc(0,"div",15),x.bc(1,"mat-form-field",4),x.bc(2,"input",36),x.jc("ngModelChange",(function(e){return x.Mc(t),x.nc().forDays=e})),x.ac(),x.ac(),x.ac()}if(2&t){const t=x.nc();x.Gb(2),x.uc("ngModel",t.forDays)}}function bt(t,e){if(1&t){const t=x.cc();x.bc(0,"div",11),x.bc(1,"mat-form-field",4),x.bc(2,"input",33),x.jc("ngModelChange",(function(e){return x.Mc(t),x.nc().lastDate=e})),x.ac(),x.Wb(3,"mat-datepicker-toggle",13),x.Wb(4,"mat-datepicker",null,37),x.ac(),x.ac()}if(2&t){const t=x.Jc(5),e=x.nc();x.Gb(2),x.uc("ngModel",e.lastDate)("matDatepicker",t),x.Gb(1),x.uc("for",t)}}let mt=(()=>{class t{constructor(t,e,o){this.data=t,this.dialogRef=e,this.snackBar=o,this.types=["Cada semana","Cada X d\xedas"],this.dayOfWeek={lun:!1,mar:!1,mie:!1,jue:!1,vie:!1,sab:!1},this.forDays=1}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}submit(){if(!this.check())return this.openSnackBar("Faltan campos para completar","Cerrar");this.dialogRef.close({type:this.type,dayOfWeek:this.dayOfWeek,firstDate:this.firstDate,lastDate:this.lastDate,forDays:this.forDays})}check(){return!!(""!=this.type&&this.firstDate&&this.lastDate&&this.forDays)}}return t.\u0275fac=function(e){return new(e||t)(x.Vb(l.a),x.Vb(l.g),x.Vb(A.a))},t.\u0275cmp=x.Pb({type:t,selectors:[["app-todo-repite-popop"]],decls:18,vars:8,consts:[["matDialogTitle",""],[1,"p-0"],["fxLayout","row wrap","fxLayout.lt-sm","column"],["fxFlex","100",1,"pr-1"],[1,"full-width"],["placeholder","Tipo de repetici\xf3n",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["fxFlex","25","class","pr-1",4,"ngIf"],["fxFlex","50","class","pr-1",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"],[3,"value"],["fxFlex","25",1,"pr-1"],["name","firstDate","matInput","","placeholder","Fecha de inicio","required","",3,"ngModel","matDatepicker","ngModelChange"],["matSuffix","",3,"for"],["picker4",""],["fxFlex","50",1,"pr-1"],[1,"form-group"],[1,"form-row"],[1,"col-2","col-sm-2","col-md-2","col-lg-2","col-xl-2"],[1,"col","text-center"],[1,"col-form-label"],["type","checkbox","name","lun",3,"ngModel","ngModelChange"],["lun","ngModel"],["type","checkbox","name","mar",3,"ngModel","ngModelChange"],["mar","ngModel"],["type","checkbox","name","mie",3,"ngModel","ngModelChange"],["mie","ngModel"],["type","checkbox","name","jue",3,"ngModel","ngModelChange"],["jue","ngModel"],["type","checkbox","name","vie",3,"ngModel","ngModelChange"],["vie","ngModel"],["type","checkbox","name","sab",3,"ngModel","ngModelChange"],["sab","ngModel"],["name","lastDate","matInput","","placeholder","Fecha de fin","required","",3,"ngModel","matDatepicker","ngModelChange"],["picker2",""],["picker",""],["matInput","","type","number","min","1","placeholder","\xbfRepetir cada cuantos d\xedas?","name","forDays",3,"ngModel","ngModelChange"],["picker3",""]],template:function(t,e){1&t&&(x.bc(0,"h1",0),x.Vc(1),x.ac(),x.bc(2,"mat-card",1),x.bc(3,"mat-card-content"),x.bc(4,"form"),x.bc(5,"div",2),x.bc(6,"div",3),x.bc(7,"mat-form-field",4),x.bc(8,"mat-select",5),x.jc("selectionChange",(function(t){return e.type=t.value})),x.Tc(9,rt,2,2,"mat-option",6),x.ac(),x.ac(),x.ac(),x.Tc(10,dt,6,3,"div",7),x.Tc(11,lt,57,6,"div",8),x.Tc(12,ut,6,3,"div",7),x.Tc(13,ht,6,3,"div",7),x.Tc(14,pt,3,1,"div",8),x.Tc(15,bt,6,3,"div",7),x.ac(),x.bc(16,"button",9),x.jc("click",(function(t){return e.submit()})),x.Vc(17,"Guardar"),x.ac(),x.ac(),x.ac(),x.ac()),2&t&&(x.Gb(1),x.Wc(e.data.title),x.Gb(8),x.uc("ngForOf",e.types),x.Gb(1),x.uc("ngIf","Cada semana"==e.type),x.Gb(1),x.uc("ngIf","Cada semana"==e.type),x.Gb(1),x.uc("ngIf","Cada semana"==e.type),x.Gb(1),x.uc("ngIf","Cada X d\xedas"==e.type),x.Gb(1),x.uc("ngIf","Cada X d\xedas"==e.type),x.Gb(1),x.uc("ngIf","Cada X d\xedas"==e.type))},directives:[l.h,y.a,y.c,c.x,c.o,c.p,B.d,B.b,h.a,st.a,v.l,v.m,a.b,r.p,b.b,c.c,d.b,c.u,c.n,c.q,d.d,h.e,d.a,c.a,c.s],encapsulation:2}),t})();function gt(t,e){if(1&t){const t=x.cc();x.bc(0,"button",45),x.jc("click",(function(e){return x.Mc(t),x.nc().openRepiteTodos()})),x.bc(1,"mat-icon",46),x.Vc(2,"alarm_add"),x.ac(),x.ac()}if(2&t){const t=x.nc();x.Gb(1),x.uc("color",t.repite?"warn":"")}}function ft(t,e){if(1&t&&(x.bc(0,"button",47),x.bc(1,"mat-icon"),x.Vc(2,"person_add"),x.ac(),x.ac()),2&t){x.nc();const t=x.Jc(11);x.uc("matMenuTriggerFor",t)}}function vt(t,e){if(1&t){const t=x.cc();x.bc(0,"button",48),x.jc("click",(function(o){x.Mc(t);const i=e.$implicit;return x.nc().setAgent(i)})),x.Vc(1),x.ac()}if(2&t){const t=e.$implicit;x.Gb(1),x.Yc(" ",t.name," ",t.surname," ")}}function kt(t,e){if(1&t){const t=x.cc();x.bc(0,"button",48),x.jc("click",(function(o){x.Mc(t);const i=e.$implicit;return x.nc().updateTodoTag(i)})),x.Vc(1),x.ac()}if(2&t){const t=e.$implicit;x.Gb(1),x.Xc(" ",t.name," ")}}function yt(t,e){if(1&t){const t=x.cc();x.bc(0,"div"),x.bc(1,"mat-chip",49),x.jc("removed",(function(o){x.Mc(t);const i=e.$implicit;return x.nc().removeTagFromTodo(i)})),x.bc(2,"span"),x.bc(3,"mat-icon",50),x.Vc(4,"label"),x.ac(),x.Vc(5),x.ac(),x.bc(6,"mat-icon",51),x.Vc(7,"cancel"),x.ac(),x.ac(),x.ac()}if(2&t){const t=e.$implicit;x.Gb(1),x.uc("selectable",!0)("removable",!0),x.Gb(4),x.Wc(t.name)}}function Tt(t,e){if(1&t){const t=x.cc();x.bc(0,"div"),x.bc(1,"mat-chip",49),x.jc("removed",(function(o){x.Mc(t);const i=e.$implicit;return x.nc().deleteAgent(i)})),x.bc(2,"span"),x.bc(3,"mat-icon",50),x.Vc(4,"person"),x.ac(),x.Vc(5),x.ac(),x.bc(6,"mat-icon",51),x.Vc(7,"cancel"),x.ac(),x.ac(),x.ac()}if(2&t){const t=e.$implicit;x.Gb(1),x.uc("selectable",!0)("removable",!0),x.Gb(4),x.Yc("",t.name," ",t.surname,"")}}function Lt(t,e){if(1&t&&x.Wb(0,"input",52),2&t){const t=x.nc();x.uc("value",(null==t.todo.userCreate?null:t.todo.userCreate.name)+" "+(null==t.todo.userCreate?null:t.todo.userCreate.surname))}}function xt(t,e){1&t&&x.Wb(0,"input",53)}function Mt(t,e){if(1&t){const t=x.cc();x.bc(0,"mat-form-field"),x.bc(1,"textarea",54),x.jc("ngModelChange",(function(e){return x.Mc(t),x.nc().todo.response=e})),x.ac(),x.ac()}if(2&t){const t=x.nc();x.Gb(1),x.uc("ngModel",t.todo.response)}}function _t(t,e){if(1&t){const t=x.cc();x.bc(0,"mat-option",55),x.jc("click",(function(o){x.Mc(t);const i=e.$implicit;return x.nc().setTeam(i)})),x.Vc(1),x.ac()}if(2&t){const t=e.$implicit;x.uc("value",t.name),x.Gb(1),x.Wc(t.name)}}function Ct(t,e){if(1&t){const t=x.cc();x.bc(0,"button",56),x.jc("click",(function(e){return x.Mc(t),x.nc(),x.Jc(73).clear(e)})),x.bc(1,"mat-icon"),x.Vc(2,"clear"),x.ac(),x.ac()}}function Dt(t,e){if(1&t){const t=x.cc();x.bc(0,"div",32),x.bc(1,"mat-chip",57),x.jc("click",(function(o){x.Mc(t);const i=e.$implicit;return x.nc().goToLink(i)}))("removed",(function(o){x.Mc(t);const i=e.$implicit;return x.nc().removeFileFromTodo(i)})),x.bc(2,"span"),x.bc(3,"mat-icon",50),x.Vc(4,"attach_file"),x.ac(),x.Vc(5),x.ac(),x.bc(6,"mat-icon",51),x.Vc(7,"cancel"),x.ac(),x.ac(),x.ac()}if(2&t){const t=e.index;x.Gb(1),x.uc("selectable",!0)("removable",!0),x.Gb(4),x.Xc("Archivo ",t+1,"")}}function Gt(t,e){if(1&t){const t=x.cc();x.bc(0,"button",58),x.jc("click",(function(e){return x.Mc(t),x.nc().saveTodo(!0)})),x.Vc(1,"Guardar y finalizar"),x.ac()}}const St=function(t){return{"fill-color-warn":t}},Ot=function(t){return{"fill-color-accent":t}};let Vt=(()=>{class t{constructor(t,e,o,i,c,a,n,s,r,d,l,u){this.todoService=t,this.tagDialogue=e,this._userService=o,this._todoService=i,this._tagService=c,this._teamService=a,this._notificationService=n,this.router=s,this.snackBar=r,this.route=d,this._uploadService=l,this.cdr=u,this.todo={title:"",note:"",response:"",startDate:"",dueDate:"",done:!1,important:!1,starred:!1,read:!1,selected:!1,tags:[],users:[],usersWhoRead:[],files:[],company:""},this.url=F.a.url,this.teamName="",this.token=o.getToken(),this.identity=o.getIdentity(),this.agentsIn=new Array}ngOnInit(){this.getTodo(),this.getTags(),this.getTeams()}getTodo(){let t=this.route.snapshot.params.id;t&&this._todoService.getOne(this.token,t).subscribe(t=>{t.todo&&(this.todo=t.todo,this.cdr.markForCheck(),this.todo.users&&(this.agentsIn=this.todo.users),this.todo.team&&(this.teamName=this.todo.team.name,this.getAgents(this.todo.team.users)))},t=>{this.openSnackBar(t.message,"Cerrar")})}getAgents(t){this.agents=t}setAgent(t){this.agentsIn.push(t)}deleteAgent(t){this.agentsIn.splice(this.agentsIn.indexOf(t),1)}getTeams(){this._teamService.getList(this.token,this.identity.company._id).subscribe(t=>{t.teams&&(this.teams=t.teams)},t=>{this.openSnackBar(t.message,"Cerrar")})}setTeam(t){this.todo.team=t._id,this.agentsIn=new Array,this.getAgents(t.users)}saveTodo(t){if(0==this.agentsIn.length)return this.openSnackBar("Se debe asignar alg\xfan agente responsable de esta tarea","Cerrar");if(t&&(this.todo.done=!0),this.agentsIn){let t=new Array;this.agentsIn.forEach(e=>{t.push(e._id)}),this.todo.users=t}this.todo.company=this.identity.company._id,this.todo._id?this._todoService.edit(this.token,this.todo._id,this.todo).subscribe(t=>{if(t.todo){this.uploadFile(t.todo._id);let e={todo:this.todo._id};0==this.todo.done&&this._notificationService.getList(this.token,e).subscribe(t=>{t.notifications&&(t.notifications.forEach(t=>{if(-1!=this.todo.users.indexOf(t.user)){this.todo.users.splice(this.todo.users.indexOf(t.user),1),t.message=this.todo.title;let e=W(this.todo.startDate).format("YYYY-MM-DD HH:mm");t.date=e,t.dateInit=e,this._notificationService.edit(this.token,t._id,t).subscribe(t=>{},t=>{this.openSnackBar(t.message,"Cerrar")})}else this._notificationService.delete(this.token,t._id).subscribe(t=>{},t=>{this.openSnackBar(t.message,"Cerrar")})}),this.todo.users.length>0&&this.todo.users.forEach(t=>{let e=W(this.todo.startDate).format("YYYY-MM-DD HH:mm"),o=new ct.a("",this.todo.title,"list_alt",e,e,"todo/list/"+this.todo._id,"accent",t,null,this.todo._id);this._notificationService.add(this.token,o).subscribe(t=>{},t=>{})}))},t=>{this.openSnackBar(t.message,"Cerrar")}),this.router.navigateByUrl("/todo/list")}},t=>{this.openSnackBar(t.message,"Cerrar")}):(this.todo.userCreate=this.identity._id,this.repite?this.getRepiteDates().forEach(t=>{this.todo.startDate=W(t).format("YYYY-MM-DD"),this.todo.dueDate=W(t).format("YYYY-MM-DD"),this.addTodo()}):this.addTodo())}getRepiteDates(){var t=new Array;let e=W(this.repite.firstDate),o=this.repite.lastDate;if("Cada semana"==this.repite.type){let i=this.repite.dayOfWeek,c=[];if(i.lun&&c.push(1),i.mar&&c.push(2),i.mie&&c.push(3),i.jue&&c.push(4),i.vie&&c.push(5),i.sab&&c.push(6),!c.includes(e.weekday()))for(e.add(1,"day");!c.includes(e.weekday());)e.add(1,"day");for(;e.isBefore(o);)c.includes(e.weekday())&&t.push(e.format("YYYY-MM-DD")),e.add(1,"day")}else{let i=this.repite.forDays;for(t.push(e.format("YYYY-MM-DD"));e.isBefore(o);)e.add(i,"day"),0==e.weekday()&&e.add(1,"day"),t.push(e.format("YYYY-MM-DD"))}return t}addTodo(){this._todoService.add(this.token,this.todo).subscribe(t=>{t.todo&&(this.uploadFile(t.todo._id),this.todo.users.forEach(e=>{let o=W(this.todo.startDate).format("YYYY-MM-DD HH:mm"),i=new ct.a("",this.todo.title,"list_alt",o,o,"todo/list/"+t.todo._id,"accent",e,null,t.todo._id);this._notificationService.add(this.token,i).subscribe(t=>{},t=>{})}),this.router.navigateByUrl("/todo/list"))},t=>{this.openSnackBar(t.message,"Cerrar")})}uploadFile(t){null!=this.files&&null!=this.files&&this._uploadService.makeFileRequest(this.url+"todo/file/"+t,[],this.files.files,this.token,"file").then(t=>{},t=>{this.openSnackBar(t.message,"Cerrar")})}deleteTodo(){""!=this.todo._id?this._todoService.delete(this.token,this.todo._id).subscribe(t=>{t.todo&&this.router.navigateByUrl("/todo/list")},t=>{this.openSnackBar(t.message,"Cerrar")}):this.router.navigateByUrl("/todo/list")}getTags(){this._tagService.getList(this.token,{company:this.identity.company._id}).subscribe(t=>{t.tags&&(this.tagList=t.tags)},t=>{this.openSnackBar(t.message,"Cerrar")})}updateTodoTag(t){this._todoService.addTag(this.token,this.todo._id,t._id).subscribe(e=>{e.todo&&this.todo.tags.push(t)},t=>{this.openSnackBar(t.message,"Cerrar")})}removeTagFromTodo(t){this._todoService.removeTag(this.token,this.todo._id,t._id).subscribe(e=>{e.todo&&this.todo.tags.splice(this.todo.tags.indexOf(t),1)},t=>{this.openSnackBar(t.message,"Cerrar")})}openTagManaginDialogue(){this.tagDialogue.open(et,{}).afterClosed().subscribe(t=>{this.getTags()})}openRepiteTodos(){this.tagDialogue.open(mt,{width:"80%",data:{title:"Repetici\xf3n"}}).afterClosed().subscribe(t=>{t&&(this.repite=t,this.todo.startDate=this.repite.fistDate,this.todo.dueDate=this.repite.lastDate)})}toggleImportant(){this.userInTodo()?this.todo.important=!this.todo.important:this.openSnackBar("No tienes permisos para modificar esta tarea","Cerrar")}toggleStar(){this.userInTodo()?this.todo.starred=!this.todo.starred:this.openSnackBar("No tienes permisos para modificar esta tarea","Cerrar")}toggleRead(){this.userInTodo()?(1==this.todo.read?this.todo.usersWhoRead.splice(this.todo.usersWhoRead.indexOf(this.identity._id),1):this.todo.usersWhoRead.push(this.identity._id),this.todo.read=!this.todo.read):this.openSnackBar("No tienes permisos para modificar esta tarea","Cerrar")}toggleDone(){this.userInTodo()?this.todo.done=!this.todo.done:this.openSnackBar("No tienes permisos para modificar esta tarea","Cerrar")}userInTodo(){var t;return!!this.todo.users&&-1!=(null===(t=this.todo.users)||void 0===t?void 0:t.map(t=>t._id).indexOf(this.identity._id))}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}checkExt(t){let e=t.split(".")[1];return("pdf"==e||"xlsx"==e||"xls"==e||"msg"==e||"docx"==e||"odt"==e||"rar"==e||"zip"==e||"png"==e||"jpge"==e||"jpeg"==e||"jpg"==e||"tif"==e||"tiff"==e)&&e}goToLink(t){window.open(this.url+"todo/file/"+t,"_blank")}removeFileFromTodo(t){this.todo.files.splice(this.todo.files.indexOf(t),1)}}return t.\u0275fac=function(e){return new(e||t)(x.Vb(_),x.Vb(l.b),x.Vb(w.a),x.Vb(I.a),x.Vb(j),x.Vb(ot.a),x.Vb(it.a),x.Vb(T.g),x.Vb(A.a),x.Vb(T.a),x.Vb(nt.a),x.Vb(x.h))},t.\u0275cmp=x.Pb({type:t,selectors:[["app-todo-details"]],features:[x.Fb([{provide:r.c,useClass:at.b},{provide:r.f,useValue:at.a},it.a,nt.a])],decls:85,vars:41,consts:[["mat-icon-button","","routerLink","/todo/list"],[2,"margin-left","16px","font-size","14px",3,"checked","change"],["fxLayout","row","fxFlex","1 1 0%","fxLayoutAlign","end center"],["mat-icon-button","","matTooltip","A\xf1adir repetici\xf3n",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","A\xf1adir responsable",3,"matMenuTriggerFor",4,"ngIf"],[3,"xPosition"],["users","matMenu"],["style","text-transform: capitalize;","mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-icon-button","",3,"matTooltip","click"],[3,"ngClass"],["mat-icon-button","","matTooltip","Etiquetas",3,"click"],["mat-icon-button","","matTooltip","A\xf1adir etiqueta",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-icon-button","","matTooltip","Eliminar",3,"click"],[2,"margin","20px 0px 0px 16px"],["chipListTag",""],[4,"ngFor","ngForOf"],["chipListAgent",""],["fxLayout","column","fxLayoutGap","8px",2,"padding","0px 16px","margin-top","20px"],["fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","50px"],[1,"full-width"],["type","text","name","title","matInput","","placeholder","T\xedtulo","required","",3,"ngModel","ngModelChange"],["readonly","","type","text","name","userCreate","matInput","","placeholder","Creado por",3,"value",4,"ngIf"],["readonly","","value","Sin descripci\xf3n","type","text","name","userCreate","matInput","","placeholder","Creado por",4,"ngIf"],["name","note","matInput","","placeholder","Nota","matTextareaAutosize","",3,"ngModel","ngModelChange"],[4,"ngIf"],["name","startDate","matInput","","placeholder","Fecha de inicio","required","",3,"ngModel","matDatepicker","ngModelChange"],["matSuffix","",3,"for"],["picker",""],["name","dueDate","matInput","","placeholder","Fecha de vencimiento","required","",3,"ngModel","matDatepicker","ngModelChange"],["picker2",""],["fxLayout","row","fxLayoutAlign","start center"],["fxFlex",""],["name","teamName",3,"ngModel","ngModelChange"],[3,"value","click",4,"ngFor","ngForOf"],["fxFlex","","name","files","placeholder","Adjuntar archivos","multiple","",3,"ngModel","ngModelChange"],["removableInput",""],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],["fxFlex","6px"],["chipListFile",""],["fxFlex","",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","16px"],["type","button","mat-button","","routerLink","/todo/list"],["color","primary","mat-raised-button","",3,"click"],["type","primary","color","accent","mat-raised-button","",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","A\xf1adir repetici\xf3n",3,"click"],[3,"color"],["mat-icon-button","","matTooltip","A\xf1adir responsable",3,"matMenuTriggerFor"],["mat-menu-item","",2,"text-transform","capitalize",3,"click"],["fxLayout","row","fxLayoutAlign","center center",3,"selectable","removable","removed"],[2,"font-size","18px"],["matChipRemove",""],["readonly","","type","text","name","userCreate","matInput","","placeholder","Creado por",3,"value"],["readonly","","value","Sin descripci\xf3n","type","text","name","userCreate","matInput","","placeholder","Creado por"],["name","response","matInput","","placeholder","Respuesta","matTextareaAutosize","",3,"ngModel","ngModelChange"],[3,"value","click"],["mat-icon-button","","matSuffix","",3,"click"],["fxLayout","row","fxLayoutAlign","center center",3,"selectable","removable","click","removed"],["type","primary","color","accent","mat-raised-button","",3,"click"]],template:function(t,e){if(1&t&&(x.bc(0,"mat-toolbar"),x.bc(1,"button",0),x.bc(2,"mat-icon"),x.Vc(3,"arrow_back"),x.ac(),x.ac(),x.bc(4,"mat-checkbox",1),x.jc("change",(function(t){return e.toggleDone()})),x.bc(5,"span"),x.Vc(6),x.ac(),x.ac(),x.bc(7,"div",2),x.Tc(8,gt,3,1,"button",3),x.Tc(9,ft,3,1,"button",4),x.bc(10,"mat-menu",5,6),x.Tc(12,vt,2,2,"button",7),x.ac(),x.bc(13,"button",8),x.jc("click",(function(t){return e.toggleRead()})),x.bc(14,"mat-icon"),x.Vc(15),x.ac(),x.ac(),x.bc(16,"button",8),x.jc("click",(function(t){return e.toggleImportant()})),x.bc(17,"mat-icon",9),x.Vc(18),x.ac(),x.ac(),x.bc(19,"button",8),x.jc("click",(function(t){return e.toggleStar()})),x.bc(20,"mat-icon",9),x.Vc(21),x.ac(),x.ac(),x.bc(22,"button",10),x.jc("click",(function(t){return e.openTagManaginDialogue()})),x.bc(23,"mat-icon"),x.Vc(24,"library_add"),x.ac(),x.ac(),x.bc(25,"button",11),x.bc(26,"mat-icon"),x.Vc(27,"label"),x.ac(),x.ac(),x.bc(28,"mat-menu",5,12),x.Tc(30,kt,2,1,"button",7),x.ac(),x.bc(31,"button",13),x.jc("click",(function(t){return e.deleteTodo()})),x.bc(32,"mat-icon"),x.Vc(33,"delete_outline"),x.ac(),x.ac(),x.ac(),x.ac(),x.bc(34,"div",14),x.bc(35,"mat-chip-list",null,15),x.Tc(37,yt,8,3,"div",16),x.ac(),x.bc(38,"mat-chip-list",null,17),x.Tc(40,Tt,8,4,"div",16),x.ac(),x.ac(),x.bc(41,"form",18),x.bc(42,"div",19),x.bc(43,"mat-form-field",20),x.bc(44,"input",21),x.jc("ngModelChange",(function(t){return e.todo.title=t})),x.ac(),x.ac(),x.bc(45,"mat-form-field",20),x.Tc(46,Lt,1,1,"input",22),x.Tc(47,xt,1,0,"input",23),x.ac(),x.ac(),x.bc(48,"mat-form-field"),x.bc(49,"textarea",24),x.jc("ngModelChange",(function(t){return e.todo.note=t})),x.ac(),x.ac(),x.Tc(50,Mt,2,1,"mat-form-field",25),x.bc(51,"div",19),x.bc(52,"mat-form-field"),x.bc(53,"input",26),x.jc("ngModelChange",(function(t){return e.todo.startDate=t})),x.ac(),x.Wb(54,"mat-datepicker-toggle",27),x.Wb(55,"mat-datepicker",null,28),x.ac(),x.bc(57,"mat-form-field"),x.bc(58,"input",29),x.jc("ngModelChange",(function(t){return e.todo.dueDate=t})),x.ac(),x.Wb(59,"mat-datepicker-toggle",27),x.Wb(60,"mat-datepicker",null,30),x.ac(),x.ac(),x.bc(62,"div",31),x.bc(63,"mat-form-field",32),x.bc(64,"mat-label"),x.Vc(65,"Equipo"),x.ac(),x.bc(66,"mat-select",33),x.jc("ngModelChange",(function(t){return e.teamName=t})),x.bc(67,"mat-option"),x.Vc(68),x.ac(),x.Tc(69,_t,2,2,"mat-option",34),x.ac(),x.ac(),x.ac(),x.bc(70,"div",31),x.bc(71,"mat-form-field"),x.bc(72,"ngx-mat-file-input",35,36),x.jc("ngModelChange",(function(t){return e.files=t})),x.ac(),x.Tc(74,Ct,3,0,"button",37),x.ac(),x.Wb(75,"span",38),x.bc(76,"mat-chip-list",null,39),x.Tc(78,Dt,8,3,"div",40),x.ac(),x.ac(),x.bc(79,"div",41),x.bc(80,"button",42),x.Vc(81,"Cancelar"),x.ac(),x.bc(82,"button",43),x.jc("click",(function(t){return e.saveTodo(!1)})),x.Vc(83,"Guardar"),x.ac(),x.Tc(84,Gt,2,0,"button",44),x.ac(),x.ac()),2&t){const t=x.Jc(29),o=x.Jc(56),i=x.Jc(61),c=x.Jc(73);x.Gb(4),x.uc("checked",e.todo.done),x.Gb(2),x.Xc(" ",e.todo.done?"Marcar como no realizado":"Marcar como realizado"," "),x.Gb(2),x.uc("ngIf",!e.todo._id),x.Gb(1),x.uc("ngIf",e.todo.team),x.Gb(1),x.uc("xPosition","before"),x.Gb(2),x.uc("ngForOf",e.agents),x.Gb(1),x.vc("matTooltip",null!=e.todo.usersWhoRead&&e.todo.usersWhoRead.includes(e.identity._id)?"Marcar como no le\xeddo":"Marcar como le\xeddo"),x.Gb(2),x.Wc(null!=e.todo.usersWhoRead&&e.todo.usersWhoRead.includes(e.identity._id)?"drafts":"markunread"),x.Gb(1),x.vc("matTooltip",e.todo.important?"Marcar como no importante":"Marcar como importante"),x.Gb(1),x.uc("ngClass",x.Ac(37,St,null==e.todo?null:e.todo.important)),x.Gb(1),x.Wc(e.todo.important?"error":"error_outline"),x.Gb(1),x.vc("matTooltip",e.todo.starred?"Remover de favoritos":"Marcar como favorito"),x.Gb(1),x.uc("ngClass",x.Ac(39,Ot,null==e.todo?null:e.todo.starred)),x.Gb(1),x.Wc(e.todo.starred?"star":"star_outline"),x.Gb(4),x.uc("matMenuTriggerFor",t),x.Gb(3),x.uc("xPosition","before"),x.Gb(2),x.uc("ngForOf",e.tagList),x.Gb(7),x.uc("ngForOf",null==e.todo?null:e.todo.tags),x.Gb(3),x.uc("ngForOf",e.agentsIn),x.Gb(4),x.uc("ngModel",e.todo.title),x.Gb(2),x.uc("ngIf",e.todo.userCreate),x.Gb(1),x.uc("ngIf",!e.todo.userCreate),x.Gb(2),x.uc("ngModel",e.todo.note),x.Gb(1),x.uc("ngIf",e.todo._id&&""!=e.todo._id),x.Gb(3),x.uc("ngModel",e.todo.startDate)("matDatepicker",o),x.Gb(1),x.uc("for",o),x.Gb(4),x.uc("ngModel",e.todo.dueDate)("matDatepicker",i),x.Gb(1),x.uc("for",i),x.Gb(7),x.uc("ngModel",e.teamName),x.Gb(2),x.Wc(e.teamName),x.Gb(1),x.uc("ngForOf",e.teams),x.Gb(3),x.uc("ngModel",e.files),x.Gb(2),x.uc("ngIf",!c.empty),x.Gb(4),x.uc("ngForOf",null==e.todo?null:e.todo.files),x.Gb(6),x.uc("ngIf",e.todo._id)}},directives:[g.a,a.b,T.h,p.a,n.a,B.d,B.b,B.c,v.m,m.d,v.l,f.a,v.k,R.a,m.c,s.b,c.x,c.o,c.p,B.e,h.a,b.b,c.c,c.u,c.n,c.q,b.d,d.b,d.d,h.e,d.a,h.d,st.a,r.p,k.a,m.a,s.a,s.c],styles:[""],changeDetection:0}),t})();const It=[{path:"",component:C,children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:K},{path:"add",component:Vt},{path:"list/:id",component:Vt}]}];let wt=(()=>{class t{}return t.\u0275mod=x.Tb({type:t}),t.\u0275inj=x.Sb({factory:function(e){return new(e||t)},imports:[[T.k.forChild(It)],T.k]}),t})();var Ft=o("YUcS");o.d(e,"TodoModule",(function(){return jt}));let jt=(()=>{class t{}return t.\u0275mod=x.Tb({type:t}),t.\u0275inj=x.Sb({factory:function(e){return new(e||t)},providers:[w.a,I.a,j,ot.a,mt],imports:[[v.c,wt,p.b,n.b,c.j,y.e,m.b,a.c,k.b,h.c,u.b,D.d,Ft.a,r.v,g.b,b.c,d.c,r.n,b.c,c.t,f.b,l.f,st.b,s.d,i.c]]}),t})()}}]);