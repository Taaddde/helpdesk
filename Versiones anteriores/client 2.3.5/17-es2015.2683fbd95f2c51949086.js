(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{oBY8:function(t,e,c){"use strict";c.r(e);var a=c("ofXK"),i=c("tyNb"),n=c("bSwM"),o=c("qFsG"),r=c("M9IT"),s=c("Dh3D"),m=c("+0xr"),l=c("lDzL"),u=c("NFeN"),b=c("bTqV"),d=c("Wp6s"),f=c("f0Cb"),p=c("wZkO"),h=c("7EHt"),g=c("MutI"),v=c("YUcS"),k=c("aYsj"),V=c("kmnG"),y=c("d3UM"),T=c("3Pt+"),w=c("1jcm"),G=c("Qu3c"),x=c("PCNd"),S=c("QibW"),C=c("iadO"),W=c("/1cH"),I=c("gU78"),_=c("3sEA"),D=c("YFeJ"),M=c("wd/R"),q=c("vHsL"),O=c("0IaG"),B=c("fXoL");function F(t,e){if(1&t&&(B.bc(0,"p"),B.Vc(1,"Motivo: "),B.bc(2,"strong"),B.Vc(3),B.ac(),B.ac()),2&t){const t=B.nc();B.Gb(3),B.Wc(t.movim.reason.name)}}function H(t,e){if(1&t&&(B.bc(0,"p"),B.Vc(1,"Dep\xf3sito destino: "),B.bc(2,"strong"),B.Vc(3),B.ac(),B.ac()),2&t){const t=B.nc();B.Gb(3),B.Wc(t.movim.depositDestiny.name)}}function A(t,e){if(1&t&&(B.bc(0,"p"),B.Vc(1,"Solicitante: "),B.bc(2,"strong"),B.Vc(3),B.ac(),B.ac()),2&t){const t=B.nc();B.Gb(3),B.Yc("",t.movim.requester.name," ",t.movim.requester.surname,"")}}function j(t,e){if(1&t&&(B.bc(0,"p"),B.Vc(1,"Sector: "),B.bc(2,"strong"),B.Vc(3),B.ac(),B.ac()),2&t){const t=B.nc();B.Gb(3),B.Wc(t.movim.sector.name)}}const X=function(t){return["ticket/gestion",t]};function L(t,e){if(1&t){const t=B.cc();B.bc(0,"p"),B.Vc(1,"Ticket asociado: "),B.bc(2,"button",3),B.jc("click",(function(e){return B.Mc(t),B.nc().dialogRef.close(!1)})),B.Vc(3),B.ac(),B.ac()}if(2&t){const t=B.nc();B.Gb(2),B.uc("routerLink",B.Ac(2,X,t.movim.ticket._id)),B.Gb(1),B.Xc("#",t.movim.ticket.numTicket,"")}}let Y=(()=>{class t{constructor(t,e,c){this.data=t,this.dialogRef=e,this.dialog=c}ngOnInit(){this.movim=this.data.payload}}return t.\u0275fac=function(e){return new(e||t)(B.Vb(O.a),B.Vb(O.g),B.Vb(O.b))},t.\u0275cmp=B.Pb({type:t,selectors:[["app-movim-popup"]],decls:32,vars:13,consts:[[2,"margin-top","10px"],[4,"ngIf"],["mat-button","","color","warn","type","button",3,"click"],["color","primary","mat-raised-button","",3,"routerLink","click"]],template:function(t,e){1&t&&(B.bc(0,"mat-card"),B.bc(1,"mat-card-header"),B.bc(2,"mat-card-title"),B.Vc(3),B.ac(),B.bc(4,"mat-card-subtitle"),B.Vc(5),B.ac(),B.ac(),B.Wb(6,"mat-divider"),B.bc(7,"mat-card-content",0),B.bc(8,"p"),B.Vc(9,"Tipo: "),B.bc(10,"strong"),B.Vc(11),B.ac(),B.ac(),B.bc(12,"p"),B.Vc(13,"Agente: "),B.bc(14,"strong"),B.Vc(15),B.ac(),B.ac(),B.Tc(16,F,4,1,"p",1),B.bc(17,"p"),B.Vc(18,"Dep\xf3sito: "),B.bc(19,"strong"),B.Vc(20),B.ac(),B.ac(),B.Tc(21,H,4,1,"p",1),B.Tc(22,A,4,2,"p",1),B.Tc(23,j,4,1,"p",1),B.Tc(24,L,4,4,"p",1),B.bc(25,"p"),B.Vc(26,"Observaciones: "),B.bc(27,"strong"),B.Vc(28),B.ac(),B.ac(),B.ac(),B.bc(29,"mat-card-actions"),B.bc(30,"button",2),B.jc("click",(function(t){return e.dialogRef.close(!1)})),B.Vc(31,"Cerrar"),B.ac(),B.ac(),B.ac()),2&t&&(B.Gb(3),B.Wc(e.data.title),B.Gb(2),B.Yc("",e.movim.item.name," | ",e.movim.item.brand,""),B.Gb(6),B.Wc(e.movim.type),B.Gb(4),B.Yc("",e.movim.agent.name," ",e.movim.agent.surname,""),B.Gb(1),B.uc("ngIf",e.movim.reason),B.Gb(4),B.Wc(e.movim.deposit.name),B.Gb(1),B.uc("ngIf","Transferencia"==e.movim.type),B.Gb(1),B.uc("ngIf","Egreso"==e.movim.type&&e.movim.requester),B.Gb(1),B.uc("ngIf","Egreso"==e.movim.type&&e.movim.sector),B.Gb(1),B.uc("ngIf",e.movim.ticket),B.Gb(4),B.Wc(e.movim.obs))},directives:[d.a,d.d,d.g,d.f,f.a,d.c,a.m,d.b,b.b,i.h],encapsulation:2}),t})();var E=c("dNgK");function R(t,e){1&t&&B.Vc(0," N\xfamero ")}function N(t,e){1&t&&B.Vc(0),2&t&&B.Xc(" ",e.row.numMovim," ")}function P(t,e){1&t&&B.Vc(0," Tipo ")}function $(t,e){1&t&&B.Vc(0),2&t&&B.Xc(" ",e.row.type," ")}function U(t,e){1&t&&B.Vc(0," Articulo ")}function J(t,e){if(1&t&&(B.bc(0,"span",13),B.bc(1,"span"),B.Vc(2),B.ac(),B.Vc(3," | "),B.bc(4,"small"),B.Vc(5),B.ac(),B.ac()),2&t){const t=e.row;B.uc("matTooltip",t.item.name+" | "+t.item.brand),B.Gb(2),B.Wc(t.item.name),B.Gb(3),B.Wc(t.item.brand)}}function z(t,e){1&t&&B.Vc(0," Cantidad ")}function K(t,e){1&t&&B.Vc(0),2&t&&B.Xc(" ",e.row.cant," ")}function Q(t,e){1&t&&B.Vc(0," Fecha ")}function Z(t,e){if(1&t&&B.Vc(0),2&t){const t=e.row,c=B.nc();B.Xc(" ",c.changeDate(t.date)," ")}}function tt(t,e){1&t&&B.Vc(0," Carga ")}function et(t,e){if(1&t&&B.Vc(0),2&t){const t=e.row,c=B.nc();B.Xc(" ",c.changeDate(t.lastActivity)," ")}}function ct(t,e){1&t&&B.Vc(0," Observaciones ")}function at(t,e){if(1&t&&(B.bc(0,"span",13),B.Vc(1),B.ac()),2&t){const t=e.row;B.uc("matTooltip",t.obs),B.Gb(1),B.Wc(t.obs)}}let it=(()=>{class t{constructor(t,e,c,a,i,n){this.snackBar=t,this._userService=e,this._movimService=c,this._router=a,this.loader=i,this.dialog=n,this.url=D.a.url,this.token=e.getToken(),this.identity=e.getIdentity()}ngOnInit(){this.loader.open("Cargando movimientos"),this._movimService.getList(this.token,{}).subscribe(t=>{if(t.movims){this.rows=t.movims,this.temp=t.movims;for(let t=0;t<this.rows.length;t++){const e=this.rows[t];e.art=e.item.name+e.item.brand,this.temp[t].art=e.item.name+e.item.brand}this.loader.close()}},t=>{this.openSnackBar(t.message,"Cerrar")})}changeDate(t){return M(t).format("DD-MM-YYYY HH:mm")}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}goToMovim(t){if("click"==t.type){let e=t.row;this.dialog.open(Y,{width:"720px",disableClose:!1,data:{payload:e,title:"Movimiento #"+e.numMovim}})}}updateFilter(t){const e=t.target.value.toLowerCase();var c=Object.keys(this.temp[0]);if(c.splice(c.length-1),!c.length)return;const a=this.temp.filter((function(t){for(let a=0;a<=c.length;a++){let i=c[a];if(t[i]&&t[i].toString().toLowerCase().indexOf(e)>-1)return!0}}));this.rows=a}}return t.\u0275fac=function(e){return new(e||t)(B.Vb(E.a),B.Vb(I.a),B.Vb(q.a),B.Vb(i.g),B.Vb(_.a),B.Vb(O.b))},t.\u0275cmp=B.Pb({type:t,selectors:[["app-list-movim"]],features:[B.Fb([I.a,q.a])],decls:25,vars:14,consts:[[1,"margin-333",2,"width","100%"],["matInput","","placeholder","Filtrar por todas las columnas","value","",3,"keyup"],[1,"mat-box-shadow","margin-333"],[1,"material","bg-white",3,"columnMode","headerHeight","footerHeight","rowHeight","limit","rows","scrollbarH","activate"],["name","num",3,"maxWidth"],["ngx-datatable-header-template",""],["ngx-datatable-cell-template",""],["name","type",3,"maxWidth"],["name","item",3,"maxWidth"],["name","cant",3,"maxWidth"],["name","date",3,"maxWidth"],["name","uploadDate",3,"maxWidth"],["name","obs",3,"maxWidth"],[3,"matTooltip"]],template:function(t,e){1&t&&(B.bc(0,"mat-form-field",0),B.bc(1,"input",1),B.jc("keyup",(function(t){return e.updateFilter(t)})),B.ac(),B.ac(),B.bc(2,"div",2),B.bc(3,"ngx-datatable",3),B.jc("activate",(function(t){return e.goToMovim(t)})),B.bc(4,"ngx-datatable-column",4),B.Tc(5,R,1,0,"ng-template",5),B.Tc(6,N,1,1,"ng-template",6),B.ac(),B.bc(7,"ngx-datatable-column",7),B.Tc(8,P,1,0,"ng-template",5),B.Tc(9,$,1,1,"ng-template",6),B.ac(),B.bc(10,"ngx-datatable-column",8),B.Tc(11,U,1,0,"ng-template",5),B.Tc(12,J,6,3,"ng-template",6),B.ac(),B.bc(13,"ngx-datatable-column",9),B.Tc(14,z,1,0,"ng-template",5),B.Tc(15,K,1,1,"ng-template",6),B.ac(),B.bc(16,"ngx-datatable-column",10),B.Tc(17,Q,1,0,"ng-template",5),B.Tc(18,Z,1,1,"ng-template",6),B.ac(),B.bc(19,"ngx-datatable-column",11),B.Tc(20,tt,1,0,"ng-template",5),B.Tc(21,et,1,1,"ng-template",6),B.ac(),B.bc(22,"ngx-datatable-column",12),B.Tc(23,ct,1,0,"ng-template",5),B.Tc(24,at,2,2,"ng-template",6),B.ac(),B.ac(),B.ac()),2&t&&(B.Gb(3),B.uc("columnMode","force")("headerHeight",50)("footerHeight",50)("rowHeight",50)("limit",8)("rows",e.rows)("scrollbarH",!0),B.Gb(1),B.uc("maxWidth",70),B.Gb(3),B.uc("maxWidth",100),B.Gb(3),B.uc("maxWidth",350),B.Gb(3),B.uc("maxWidth",80),B.Gb(3),B.uc("maxWidth",150),B.Gb(3),B.uc("maxWidth",150),B.Gb(3),B.uc("maxWidth",300))},directives:[V.a,o.b,l.d,l.b,l.c,l.a,G.a],encapsulation:2}),t})();var nt=c("sd1j"),ot=c("FKr1"),rt=c("AASI"),st=c("ebDA"),mt=c("Nptc"),lt=c("O4PR"),ut=c("BlIn");function bt(t,e){1&t&&B.Vc(0," N\xfamero ")}function dt(t,e){1&t&&B.Vc(0),2&t&&B.Xc(" ",e.row.numTicket," ")}function ft(t,e){1&t&&B.Vc(0," Solicitante ")}function pt(t,e){if(1&t&&B.Wb(0,"img",18),2&t){const t=B.nc().row,e=B.nc(2);B.vc("src",e.url+"user/image/"+t.requester.image,B.Oc)}}function ht(t,e){1&t&&B.Wb(0,"img",19)}function gt(t,e){if(1&t&&(B.Tc(0,pt,1,1,"img",16),B.Tc(1,ht,1,0,"img",17),B.Vc(2),B.Wb(3,"span"),B.Vc(4)),2&t){const t=e.row;B.uc("ngIf",t.requester&&"null"!=t.requester.image),B.Gb(1),B.uc("ngIf",!t.requester||"null"==t.requester.image),B.Gb(1),B.Xc(" ",t.requester.name," "),B.Gb(2),B.Xc(" ",t.requester.surname," ")}}function vt(t,e){1&t&&B.Vc(0," Asunto ")}function kt(t,e){1&t&&B.Vc(0),2&t&&B.Xc(" ",e.row.sub," ")}function Vt(t,e){1&t&&B.Vc(0," Agente ")}function yt(t,e){if(1&t&&B.Wb(0,"img",18),2&t){const t=B.nc(2).row,e=B.nc(2);B.vc("src",e.url+"user/image/"+t.agent.image,B.Oc)}}function Tt(t,e){1&t&&B.Wb(0,"img",19)}function wt(t,e){if(1&t&&(B.Zb(0),B.Tc(1,yt,1,1,"img",16),B.Tc(2,Tt,1,0,"img",17),B.Vc(3),B.Wb(4,"span"),B.Vc(5),B.Yb()),2&t){const t=B.nc().row;B.Gb(1),B.uc("ngIf",t.agent&&"null"!=t.agent.image),B.Gb(1),B.uc("ngIf",!t.agent||"null"==t.agent.image),B.Gb(1),B.Xc(" ",t.agent.name," "),B.Gb(2),B.Xc(" ",t.agent.surname," ")}}function Gt(t,e){}function xt(t,e){if(1&t&&(B.Tc(0,wt,6,4,"ng-container",20),B.Tc(1,Gt,0,0,"ng-template",null,21,B.Uc)),2&t){const t=e.row,c=B.Jc(2);B.uc("ngIf",t.agent)("ngIfElse",c)}}function St(t,e){1&t&&B.Vc(0," Estado ")}function Ct(t,e){1&t&&B.Vc(0),2&t&&B.Xc(" ",e.row.status," ")}function Wt(t,e){1&t&&B.Vc(0," Fecha ")}function It(t,e){if(1&t&&B.Vc(0),2&t){const t=e.row,c=B.nc(2);B.Xc(" ",c.changeDate(t.createDate)," ")}}function _t(t,e){1&t&&B.Vc(0," Novedad ")}function Dt(t,e){if(1&t&&B.Vc(0),2&t){const t=e.row,c=B.nc(2);B.Xc(" ",c.changeDate(t.lastActivity)," ")}}function Mt(t,e){if(1&t){const t=B.cc();B.bc(0,"ngx-datatable",6),B.jc("activate",(function(e){return B.Mc(t),B.nc().submit(e)})),B.bc(1,"ngx-datatable-column",7),B.Tc(2,bt,1,0,"ng-template",8),B.Tc(3,dt,1,1,"ng-template",9),B.ac(),B.bc(4,"ngx-datatable-column",10),B.Tc(5,ft,1,0,"ng-template",8),B.Tc(6,gt,5,4,"ng-template",9),B.ac(),B.bc(7,"ngx-datatable-column",11),B.Tc(8,vt,1,0,"ng-template",8),B.Tc(9,kt,1,1,"ng-template",9),B.ac(),B.bc(10,"ngx-datatable-column",12),B.Tc(11,Vt,1,0,"ng-template",8),B.Tc(12,xt,3,2,"ng-template",9),B.ac(),B.bc(13,"ngx-datatable-column",13),B.Tc(14,St,1,0,"ng-template",8),B.Tc(15,Ct,1,1,"ng-template",9),B.ac(),B.bc(16,"ngx-datatable-column",14),B.Tc(17,Wt,1,0,"ng-template",8),B.Tc(18,It,1,1,"ng-template",9),B.ac(),B.bc(19,"ngx-datatable-column",15),B.Tc(20,_t,1,0,"ng-template",8),B.Tc(21,Dt,1,1,"ng-template",9),B.ac(),B.ac()}if(2&t){const t=B.nc();B.uc("columnMode","force")("headerHeight",50)("footerHeight",50)("rowHeight",50)("limit",8)("rows",t.tickets)("scrollbarH",!0),B.Gb(1),B.uc("maxWidth",70),B.Gb(3),B.uc("maxWidth",250),B.Gb(3),B.uc("maxWidth",350),B.Gb(3),B.uc("maxWidth",250),B.Gb(3),B.uc("maxWidth",100),B.Gb(3),B.uc("maxWidth",150),B.Gb(3),B.uc("maxWidth",150)}}let qt=(()=>{class t{constructor(t,e,c,a,i,n){this.data=t,this.dialogRef=e,this.snackBar=c,this._userService=a,this._ticketService=i,this.loader=n,this.url=D.a.url,this.filter="",this.token=a.getToken(),this.identity=a.getIdentity()}ngOnInit(){}getTickets(){if(""==this.filter)return this.openSnackBar("El campo de busqueda esta vac\xedo","Cerrar");this.loader.open("Cargando tickets"),this._ticketService.getUnpaginateList(this.token,{sub:this.filter,company:this.identity.company._id}).subscribe(t=>{t.tickets&&(this.tickets=t.tickets,this.loader.close())},t=>{this.openSnackBar(t.message,"Cerrar")})}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}changeDate(t){return M(t,"YYYY-MM-DD HH:mm").format("DD-MM-YYYY HH:mm")}submit(t){"click"==t.type&&this.dialogRef.close({ticket:t.row})}}return t.\u0275fac=function(e){return new(e||t)(B.Vb(O.a),B.Vb(O.g),B.Vb(E.a),B.Vb(I.a),B.Vb(ut.a),B.Vb(_.a))},t.\u0275cmp=B.Pb({type:t,selectors:[["app-ticket-search-popop"]],features:[B.Fb([I.a,ut.a])],decls:11,vars:2,consts:[["matDialogTitle",""],[1,"p-0"],[1,"full-width"],["type","text","placeholder","Buscar ticket (busca por asunto por defecto) | Por n\xfamero: #4932, Por solicitante: @Juan, Por chat: *buenas tardes","aria-label","Text","matInput","",3,"ngModel","keyup.enter","ngModelChange"],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Search","type","button",3,"click"],["class","material bg-white",3,"columnMode","headerHeight","footerHeight","rowHeight","limit","rows","scrollbarH","activate",4,"ngIf"],[1,"material","bg-white",3,"columnMode","headerHeight","footerHeight","rowHeight","limit","rows","scrollbarH","activate"],["name","num",3,"maxWidth"],["ngx-datatable-header-template",""],["ngx-datatable-cell-template",""],["name","requester",3,"maxWidth"],["name","sub",3,"maxWidth"],["name","agent",3,"maxWidth"],["name","status",3,"maxWidth"],["name","createDate",3,"maxWidth"],["name","lastActivity",3,"maxWidth"],["class","rounded-circle mr-2","width","30","height","30",3,"src",4,"ngIf"],["class","rounded-circle mr-2","width","30","height","30","src","assets/images/system/user-placeholder.png",4,"ngIf"],["width","30","height","30",1,"rounded-circle","mr-2",3,"src"],["width","30","height","30","src","assets/images/system/user-placeholder.png",1,"rounded-circle","mr-2"],[4,"ngIf","ngIfElse"],["noAgent",""]],template:function(t,e){1&t&&(B.bc(0,"h1",0),B.Vc(1,"Buscador de ticket"),B.ac(),B.bc(2,"mat-card",1),B.bc(3,"mat-card-header"),B.bc(4,"mat-form-field",2),B.bc(5,"input",3),B.jc("keyup.enter",(function(t){return e.getTickets()}))("ngModelChange",(function(t){return e.filter=t})),B.ac(),B.bc(6,"button",4),B.jc("click",(function(t){return e.getTickets()})),B.bc(7,"mat-icon"),B.Vc(8,"search"),B.ac(),B.ac(),B.ac(),B.ac(),B.bc(9,"mat-card-content"),B.Tc(10,Mt,22,14,"ngx-datatable",5),B.ac(),B.ac()),2&t&&(B.Gb(5),B.uc("ngModel",e.filter),B.Gb(5),B.uc("ngIf",e.tickets))},directives:[d.a,d.d,V.a,o.b,T.c,T.n,T.q,b.b,V.e,u.a,d.c,a.m,l.d,l.b,l.c,l.a],encapsulation:2}),t})();var Ot=c("49gX"),Bt=c("XiUz");function Ft(t,e){if(1&t){const t=B.cc();B.bc(0,"mat-option",30),B.jc("click",(function(c){B.Mc(t);const a=e.$implicit;return B.nc().setDeposit(a)})),B.Vc(1),B.ac()}if(2&t){const t=e.$implicit;B.uc("value",t._id),B.Gb(1),B.Xc(" ",t.name," ")}}function Ht(t,e){if(1&t&&B.Wb(0,"img",35),2&t){const t=B.nc().$implicit,e=B.nc(2);B.uc("src",e.url+"user/image/"+t.image,B.Oc)}}function At(t,e){1&t&&B.Wb(0,"img",36)}function jt(t,e){if(1&t){const t=B.cc();B.bc(0,"mat-option",30),B.jc("click",(function(c){B.Mc(t);const a=e.$implicit;return B.nc(2).setRequester(a)})),B.Tc(1,Ht,1,1,"img",33),B.Tc(2,At,1,0,"img",34),B.bc(3,"span"),B.Vc(4),B.ac(),B.ac()}if(2&t){const t=e.$implicit;B.uc("value",t),B.Gb(1),B.uc("ngIf",t.image&&"null"!=t.image),B.Gb(1),B.uc("ngIf",!t.image||"null"==t.image),B.Gb(2),B.Yc("",t.name," ",t.surname,"")}}function Xt(t,e){if(1&t){const t=B.cc();B.bc(0,"div",5),B.bc(1,"mat-form-field",12),B.bc(2,"input",31),B.jc("input",(function(e){return B.Mc(t),B.nc().filterRequester(e.target.value)})),B.ac(),B.bc(3,"mat-autocomplete",25,32),B.Tc(5,jt,5,5,"mat-option",14),B.ac(),B.ac(),B.ac()}if(2&t){const t=B.Jc(4),e=B.nc();B.Gb(2),B.uc("formControl",e.form.controls.requester)("matAutocomplete",t),B.Gb(1),B.uc("displayWith",e.displayUser),B.Gb(2),B.uc("ngForOf",e.tmpRequesters)}}function Lt(t,e){if(1&t&&(B.bc(0,"mat-option",37),B.Vc(1),B.ac()),2&t){const t=e.$implicit;B.uc("value",t._id),B.Gb(1),B.Xc(" ",t.name," ")}}function Yt(t,e){if(1&t&&(B.bc(0,"mat-option",37),B.bc(1,"span"),B.Vc(2),B.ac(),B.Vc(3," | "),B.bc(4,"small"),B.Vc(5),B.ac(),B.ac()),2&t){const t=e.$implicit;B.uc("value",t),B.Gb(2),B.Wc(t.item.name),B.Gb(3),B.Yc("",t.item.brand," - ",t.cant,"")}}function Et(t,e){if(1&t&&(B.bc(0,"mat-option",37),B.Vc(1),B.ac()),2&t){const t=e.$implicit;B.uc("value",t._id),B.Gb(1),B.Xc(" ",t.name," ")}}function Rt(t,e){if(1&t&&(B.bc(0,"div",5),B.bc(1,"mat-form-field",12),B.bc(2,"mat-label"),B.Vc(3,"Sector"),B.ac(),B.bc(4,"mat-select",38),B.Tc(5,Et,2,2,"mat-option",23),B.ac(),B.ac(),B.ac()),2&t){const t=B.nc();B.Gb(4),B.uc("formControl",t.form.controls.sector),B.Gb(1),B.uc("ngForOf",t.sectors)}}function Nt(t,e){if(1&t&&(B.bc(0,"mat-option",37),B.Vc(1),B.ac()),2&t){const t=e.$implicit;B.uc("value",t._id),B.Gb(1),B.Xc(" ",t.name," ")}}function Pt(t,e){if(1&t&&(B.bc(0,"div",5),B.bc(1,"mat-form-field",12),B.bc(2,"mat-label"),B.Vc(3,"Dep\xf3sito destino (*)"),B.ac(),B.bc(4,"mat-select",13),B.Tc(5,Nt,2,2,"mat-option",23),B.ac(),B.ac(),B.ac()),2&t){const t=B.nc();B.Gb(4),B.uc("formControl",t.form.controls.depositDestiny),B.Gb(1),B.uc("ngForOf",t.deposits)}}const $t=[{path:"",children:[{path:"new",component:(()=>{class t{constructor(t,e,c,a,i,n,o,r,s){this._userService=t,this._depositService=e,this._stockService=c,this._movimService=a,this._reasonService=i,this._sectorService=n,this.snackBar=o,this.dialog=r,this.router=s,this.formData={},this.url=D.a.url,this.numTicket=null,this.token=t.getToken(),this.identity=t.getIdentity()}ngOnInit(){this.form=new T.h({type:new T.e("",[T.v.required]),deposit:new T.e("",[T.v.required]),item:new T.e("",[T.v.required]),cant:new T.e(1,[T.v.min(1),T.v.required]),reason:new T.e("",[T.v.required]),date:new T.e(new Date,[T.v.required]),requester:new T.e(""),sector:new T.e(""),ticket:new T.e(""),depositDestiny:new T.e(""),obs:new T.e("")}),this.getDeposits(),this.getRequesters(),this.getSectors(),this.setType("Ingreso")}getRequesters(){this._userService.getListReq(this.token,this.identity.company._id).subscribe(t=>{t.users&&(this.requesters=t.users,this.tmpRequesters=t.users)},t=>{this.openSnackBar(t.message,"Cerrar")})}getSectors(){this._sectorService.getList(this.token).subscribe(t=>{t.sectors&&(this.sectors=t.sectors)},t=>{this.openSnackBar(t.message,"Cerrar")})}getReasons(t){this._reasonService.getList(this.token,{type:t}).subscribe(t=>{t.reasons&&(this.reasons=t.reasons)},t=>{this.openSnackBar(t.message,"Cerrar")})}getDeposits(){this._depositService.getList(this.token,{company:this.identity.company._id}).subscribe(t=>{t.deposits&&(this.deposits=t.deposits,this.setDeposit(this.deposits[0]))},t=>{this.openSnackBar(t.message,"Cerrar")})}setDeposit(t){this.form.controls.deposit.setValue(t._id),this.form.controls.item.setValue(null),this.getStocks(t)}setStock(t){this.form.controls.item.setValue(t.item._id)}setType(t){this.form.controls.type.setValue(t),this.form.controls.reason.setValue(null),this.getReasons(t)}setRequester(t){this.form.controls.requester.setValue(t),t.sector&&this.form.controls.sector.setValue(t.sector)}getStocks(t){this._stockService.getList(this.token,{deposit:t._id}).subscribe(t=>{t.stocks&&(this.stocks=t.stocks,this.tmpStocks=t.stocks)},t=>{this.openSnackBar(t.message,"Cerrar")})}searchTicket(){this.dialog.open(qt,{width:"80%",disableClose:!1}).afterClosed().subscribe(t=>{t&&(this.form.controls.ticket.setValue(t.ticket),this.form.controls.requester.value||this.setRequester(this.form.controls.ticket.value.requester))})}submit(){switch(this.form.value.type){case"Egreso":let t=this.form.value.item;if(t.cant<this.form.value.cant)return this.openSnackBar("El stock actual del articulo es de "+t.cant,"Cerrar");this.saveStock(t);break;case"Transferencia":let e=this.form.value.item;if(e.cant<this.form.value.cant)return this.openSnackBar("El stock actual del articulo es de "+e.cant,"Cerrar");if(this.form.value.depositDestiny==this.form.value.deposit)return this.openSnackBar("No puede registrarse una transferencia de un dep\xf3sito hacia si mismo","Cerrar");this._stockService.getList(this.token,{item:this.form.value.item.item._id,deposit:this.form.value.depositDestiny}).subscribe(t=>{if(!t.stocks||!t.stocks[0])return this.openSnackBar("El articulo no esta habilitado en el dep\xf3sito destino","Cerrar");this.saveStock(e,t.stocks[0])},t=>{this.openSnackBar(t.message,"Cerrar")});break;default:this.saveStock(this.form.value.item)}}saveMovim(){let t=new Ot.a("",null,this.form.value.type,this.form.value.deposit,this.form.value.item.item._id,this.identity.company._id,this.form.value.cant,this.identity._id,this.form.value.reason,this.form.value.date,null,this.form.value.sector,this.form.value.requester._id,this.form.value.ticket._id,this.form.value.depositDestiny,this.form.value.obs);""==this.form.value.requester&&(t.requester=null),""==this.form.value.sector&&(t.sector=null),""==this.form.value.ticket&&(t.ticket=null),""==this.form.value.depositDestiny&&(t.depositDestiny=null),this._movimService.add(this.token,t).subscribe(t=>{t.movim&&(this.openSnackBar("Movimiento realizado correctamente","Cerrar"),this.router.navigate(["deposit/movim/list"]))},t=>{this.openSnackBar(t.message,"Cerrar")})}saveStock(t,e){let c=null,a=null;switch(this.form.value.type){case"Ingreso":c={$inc:{cant:this.form.value.cant}};break;case"Egreso":c={$inc:{cant:-this.form.value.cant}};break;case"Transferencia":c={$inc:{cant:-this.form.value.cant}},a={$inc:{cant:this.form.value.cant}};break;case"Ajuste":c={cant:this.form.value.cant}}this._stockService.edit(this.token,t._id,c).subscribe(t=>{t.stock&&(null!=a&&this._stockService.edit(this.token,e._id,a).subscribe(t=>{},t=>{}),this.saveMovim())},t=>{this.openSnackBar(t.message,"Cerrar")})}openSnackBar(t,e){this.snackBar.open(t,e,{duration:1e4})}filterStock(t){this.tmpStocks=this.stocks.filter(e=>(e.item.name+e.item.brand).toLowerCase().includes(t.toString().toLowerCase()))}filterRequester(t){this.tmpRequesters=this.requesters.filter(e=>(e.name+e.surname).toLowerCase().includes(t.toString().toLowerCase()))}displayItem(t){return t?t.item.name+" | "+t.item.brand:""}displayUser(t){return t?t.name+" "+t.surname:""}}return t.\u0275fac=function(e){return new(e||t)(B.Vb(I.a),B.Vb(rt.a),B.Vb(mt.a),B.Vb(q.a),B.Vb(st.a),B.Vb(lt.a),B.Vb(E.a),B.Vb(O.b),B.Vb(i.g))},t.\u0275cmp=B.Pb({type:t,selectors:[["app-new-movim-form"]],features:[B.Fb([{provide:ot.c,useClass:nt.b},{provide:ot.f,useValue:nt.a},I.a,rt.a,mt.a,q.a,lt.a,st.a])],decls:67,vars:20,consts:[[1,"p-0"],[2,"margin-top","20px",3,"formGroup","ngSubmit"],["f","ngForm"],["fxLayout","row wrap"],["fxFlex","100","fxFlex.gt-xs","50",1,"pr-1"],[1,"pb-1"],["id","radio-type"],["aria-labelledby","radio-type","name","type","formControlName","type",3,"change"],["value","Ingreso"],["value","Egreso"],["value","Transferencia"],["value","Ajuste"],[1,"full-width"],["name","deposit",3,"formControl"],[3,"value","click",4,"ngFor","ngForOf"],["matInput","",3,"formControl","matDatepicker"],["matSuffix","",3,"for"],["date",""],["matInput","","type","number","readonly","",3,"formControl","value","click"],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Search","type","button",3,"click"],["class","pb-1",4,"ngIf"],["fxFlex","100","fxFlex.gt-xs","50"],["name","reason",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","Articulo (*)","aria-label","Text","matInput","",3,"formControl","matAutocomplete","input"],["autoActiveFirstOption","",3,"displayWith"],["auto","matAutocomplete"],["type","number","min","1","placeholder","Cantidad (*)","aria-label","Number","matInput","",3,"formControl"],["matInput","","type","text",3,"formControl"],["mat-raised-button","","type","submit","color","primary",3,"disabled"],[3,"value","click"],["type","text","placeholder","Solicitante","aria-label","Text","matInput","",3,"formControl","matAutocomplete","input"],["user","matAutocomplete"],["class","option-img","aria-hidden","","height","25","width","25",3,"src",4,"ngIf"],["class","option-img","aria-hidden","","src","assets/images/system/user-placeholder.png","height","25","width","25",4,"ngIf"],["aria-hidden","","height","25","width","25",1,"option-img",3,"src"],["aria-hidden","","src","assets/images/system/user-placeholder.png","height","25","width","25",1,"option-img"],[3,"value"],["name","sector",3,"formControl"]],template:function(t,e){if(1&t&&(B.bc(0,"mat-card",0),B.bc(1,"mat-card-content"),B.bc(2,"form",1,2),B.jc("ngSubmit",(function(t){return e.submit()})),B.bc(4,"div",3),B.bc(5,"div",4),B.bc(6,"div",5),B.bc(7,"label",6),B.Vc(8,"Tipo (*)"),B.ac(),B.Wb(9,"br"),B.bc(10,"mat-radio-group",7),B.jc("change",(function(t){return e.setType(t.value)})),B.bc(11,"mat-radio-button",8),B.Vc(12,"Ingreso"),B.ac(),B.bc(13,"mat-radio-button",9),B.Vc(14,"Egreso"),B.ac(),B.bc(15,"mat-radio-button",10),B.Vc(16,"Transferencia"),B.ac(),B.bc(17,"mat-radio-button",11),B.Vc(18,"Ajuste"),B.ac(),B.ac(),B.ac(),B.bc(19,"div",5),B.bc(20,"mat-form-field",12),B.bc(21,"mat-label"),B.Vc(22,"Dep\xf3sito (*)"),B.ac(),B.bc(23,"mat-select",13),B.Tc(24,Ft,2,2,"mat-option",14),B.ac(),B.ac(),B.ac(),B.bc(25,"div",5),B.bc(26,"mat-form-field",12),B.bc(27,"mat-label"),B.Vc(28,"Fecha (*)"),B.ac(),B.Wb(29,"input",15),B.Wb(30,"mat-datepicker-toggle",16),B.Wb(31,"mat-datepicker",null,17),B.ac(),B.ac(),B.bc(33,"div",5),B.bc(34,"mat-form-field",12),B.bc(35,"mat-label"),B.Vc(36,"Ticket"),B.ac(),B.bc(37,"input",18),B.jc("click",(function(t){return e.searchTicket()})),B.ac(),B.bc(38,"button",19),B.jc("click",(function(t){return e.searchTicket()})),B.bc(39,"mat-icon"),B.Vc(40,"search"),B.ac(),B.ac(),B.ac(),B.ac(),B.Tc(41,Xt,6,4,"div",20),B.ac(),B.bc(42,"div",21),B.bc(43,"div",5),B.bc(44,"mat-form-field",12),B.bc(45,"mat-label"),B.Vc(46,"Motivo (*)"),B.ac(),B.bc(47,"mat-select",22),B.Tc(48,Lt,2,2,"mat-option",23),B.ac(),B.ac(),B.ac(),B.bc(49,"div",5),B.bc(50,"mat-form-field",12),B.bc(51,"input",24),B.jc("input",(function(t){return e.filterStock(t.target.value)})),B.ac(),B.bc(52,"mat-autocomplete",25,26),B.Tc(54,Yt,6,4,"mat-option",23),B.ac(),B.ac(),B.ac(),B.bc(55,"div",5),B.bc(56,"mat-form-field",12),B.Wb(57,"input",27),B.ac(),B.ac(),B.bc(58,"div",5),B.bc(59,"mat-form-field",12),B.bc(60,"mat-label"),B.Vc(61,"Observaciones"),B.ac(),B.Wb(62,"input",28),B.ac(),B.ac(),B.Tc(63,Rt,6,2,"div",20),B.Tc(64,Pt,6,2,"div",20),B.ac(),B.ac(),B.bc(65,"button",29),B.Vc(66,"Guardar"),B.ac(),B.ac(),B.ac(),B.ac()),2&t){const t=B.Jc(32),c=B.Jc(53);B.Gb(2),B.uc("formGroup",e.form),B.Gb(21),B.uc("formControl",e.form.controls.deposit),B.Gb(1),B.uc("ngForOf",e.deposits),B.Gb(5),B.uc("formControl",e.form.controls.date)("matDatepicker",t),B.Gb(1),B.uc("for",t),B.Gb(7),B.uc("formControl",e.form.controls.ticket)("value",e.form.controls.ticket.value.numTicket),B.Gb(4),B.uc("ngIf","Egreso"==e.form.controls.type.value),B.Gb(6),B.uc("formControl",e.form.controls.reason),B.Gb(1),B.uc("ngForOf",e.reasons),B.Gb(3),B.uc("formControl",e.form.controls.item)("matAutocomplete",c),B.Gb(1),B.uc("displayWith",e.displayItem),B.Gb(2),B.uc("ngForOf",e.tmpStocks),B.Gb(3),B.uc("formControl",e.form.controls.cant),B.Gb(5),B.uc("formControl",e.form.controls.obs),B.Gb(1),B.uc("ngIf","Egreso"==e.form.controls.type.value),B.Gb(1),B.uc("ngIf","Transferencia"==e.form.controls.type.value),B.Gb(1),B.uc("disabled",e.form.invalid||"Transferencia"==e.form.controls.type.value&&""==e.form.controls.depositDestiny.value)}},directives:[d.a,d.c,T.x,T.o,T.i,Bt.d,Bt.b,S.b,T.n,T.g,S.a,V.a,V.d,y.a,T.f,a.l,o.b,T.c,C.b,C.d,V.e,C.a,T.s,b.b,u.a,a.m,W.c,W.a,ot.p],styles:[".mat-radio-button[_ngcontent-%COMP%] ~ .mat-radio-button[_ngcontent-%COMP%]{margin-left:16px}.option-img[_ngcontent-%COMP%]{vertical-align:middle;margin-right:8px}"]}),t})(),data:{title:"Nuevo movimiento",breadcrumb:"NUEVO MOVIMIENTO"}},{path:"list",component:it,data:{title:"Lista de movimientos",breadcrumb:"LISTA DE MOVIMIENTOS"}}]}];c.d(e,"AppMovimModule",(function(){return Ut}));let Ut=(()=>{class t{}return t.\u0275mod=B.Tb({type:t}),t.\u0275inj=B.Sb({factory:function(e){return new(e||t)},imports:[[a.c,T.t,V.c,S.c,T.j,f.b,s.a,h.b,W.b,y.b,r.a,m.k,x.a,g.d,G.b,C.c,u.b,b.c,d.e,w.a,n.b,p.c,o.c,v.a,l.e,k.a,i.k.forChild($t)]]}),t})()}}]);