function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var c=0;c<e.length;c++){var a=e[c];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,c){return e&&_defineProperties(t.prototype,e),c&&_defineProperties(t,c),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{oBY8:function(t,e,c){"use strict";c.r(e);var a=c("ofXK"),i=c("tyNb"),n=c("bSwM"),o=c("qFsG"),r=c("M9IT"),s=c("Dh3D"),u=c("+0xr"),m=c("lDzL"),l=c("NFeN"),b=c("bTqV"),f=c("Wp6s"),d=c("f0Cb"),p=c("wZkO"),g=c("7EHt"),h=c("MutI"),v=c("YUcS"),k=c("aYsj"),y=c("kmnG"),V=c("d3UM"),w=c("3Pt+"),T=c("1jcm"),G=c("Qu3c"),x=c("PCNd"),C=c("QibW"),S=c("iadO"),W=c("/1cH"),_=c("gU78"),I=c("3sEA"),D=c("YFeJ"),M=c("wd/R"),q=c("vHsL"),O=c("0IaG"),B=c("fXoL");function F(t,e){if(1&t&&(B.bc(0,"p"),B.Vc(1,"Motivo: "),B.bc(2,"strong"),B.Vc(3),B.ac(),B.ac()),2&t){var c=B.nc();B.Gb(3),B.Wc(c.movim.reason.name)}}function H(t,e){if(1&t&&(B.bc(0,"p"),B.Vc(1,"Dep\xf3sito destino: "),B.bc(2,"strong"),B.Vc(3),B.ac(),B.ac()),2&t){var c=B.nc();B.Gb(3),B.Wc(c.movim.depositDestiny.name)}}function A(t,e){if(1&t&&(B.bc(0,"p"),B.Vc(1,"Solicitante: "),B.bc(2,"strong"),B.Vc(3),B.ac(),B.ac()),2&t){var c=B.nc();B.Gb(3),B.Yc("",c.movim.requester.name," ",c.movim.requester.surname,"")}}function j(t,e){if(1&t&&(B.bc(0,"p"),B.Vc(1,"Sector: "),B.bc(2,"strong"),B.Vc(3),B.ac(),B.ac()),2&t){var c=B.nc();B.Gb(3),B.Wc(c.movim.sector.name)}}var X=function(t){return["ticket/gestion",t]};function E(t,e){if(1&t){var c=B.cc();B.bc(0,"p"),B.Vc(1,"Ticket asociado: "),B.bc(2,"button",3),B.jc("click",(function(t){return B.Mc(c),B.nc().dialogRef.close(!1)})),B.Vc(3),B.ac(),B.ac()}if(2&t){var a=B.nc();B.Gb(2),B.uc("routerLink",B.Ac(2,X,a.movim.ticket._id)),B.Gb(1),B.Xc("#",a.movim.ticket.numTicket,"")}}var L,Y=((L=function(){function t(e,c,a){_classCallCheck(this,t),this.data=e,this.dialogRef=c,this.dialog=a}return _createClass(t,[{key:"ngOnInit",value:function(){this.movim=this.data.payload}}]),t}()).\u0275fac=function(t){return new(t||L)(B.Vb(O.a),B.Vb(O.g),B.Vb(O.b))},L.\u0275cmp=B.Pb({type:L,selectors:[["app-movim-popup"]],decls:32,vars:13,consts:[[2,"margin-top","10px"],[4,"ngIf"],["mat-button","","color","warn","type","button",3,"click"],["color","primary","mat-raised-button","",3,"routerLink","click"]],template:function(t,e){1&t&&(B.bc(0,"mat-card"),B.bc(1,"mat-card-header"),B.bc(2,"mat-card-title"),B.Vc(3),B.ac(),B.bc(4,"mat-card-subtitle"),B.Vc(5),B.ac(),B.ac(),B.Wb(6,"mat-divider"),B.bc(7,"mat-card-content",0),B.bc(8,"p"),B.Vc(9,"Tipo: "),B.bc(10,"strong"),B.Vc(11),B.ac(),B.ac(),B.bc(12,"p"),B.Vc(13,"Agente: "),B.bc(14,"strong"),B.Vc(15),B.ac(),B.ac(),B.Tc(16,F,4,1,"p",1),B.bc(17,"p"),B.Vc(18,"Dep\xf3sito: "),B.bc(19,"strong"),B.Vc(20),B.ac(),B.ac(),B.Tc(21,H,4,1,"p",1),B.Tc(22,A,4,2,"p",1),B.Tc(23,j,4,1,"p",1),B.Tc(24,E,4,4,"p",1),B.bc(25,"p"),B.Vc(26,"Observaciones: "),B.bc(27,"strong"),B.Vc(28),B.ac(),B.ac(),B.ac(),B.bc(29,"mat-card-actions"),B.bc(30,"button",2),B.jc("click",(function(t){return e.dialogRef.close(!1)})),B.Vc(31,"Cerrar"),B.ac(),B.ac(),B.ac()),2&t&&(B.Gb(3),B.Wc(e.data.title),B.Gb(2),B.Yc("",e.movim.item.name," | ",e.movim.item.brand,""),B.Gb(6),B.Wc(e.movim.type),B.Gb(4),B.Yc("",e.movim.agent.name," ",e.movim.agent.surname,""),B.Gb(1),B.uc("ngIf",e.movim.reason),B.Gb(4),B.Wc(e.movim.deposit.name),B.Gb(1),B.uc("ngIf","Transferencia"==e.movim.type),B.Gb(1),B.uc("ngIf","Egreso"==e.movim.type&&e.movim.requester),B.Gb(1),B.uc("ngIf","Egreso"==e.movim.type&&e.movim.sector),B.Gb(1),B.uc("ngIf",e.movim.ticket),B.Gb(4),B.Wc(e.movim.obs))},directives:[f.a,f.d,f.g,f.f,d.a,f.c,a.m,f.b,b.b,i.h],encapsulation:2}),L),R=c("dNgK");function P(t,e){1&t&&B.Vc(0," N\xfamero ")}function N(t,e){1&t&&B.Vc(0),2&t&&B.Xc(" ",e.row.numMovim," ")}function $(t,e){1&t&&B.Vc(0," Tipo ")}function U(t,e){1&t&&B.Vc(0),2&t&&B.Xc(" ",e.row.type," ")}function J(t,e){1&t&&B.Vc(0," Articulo ")}function z(t,e){if(1&t&&(B.bc(0,"span",13),B.bc(1,"span"),B.Vc(2),B.ac(),B.Vc(3," | "),B.bc(4,"small"),B.Vc(5),B.ac(),B.ac()),2&t){var c=e.row;B.uc("matTooltip",c.item.name+" | "+c.item.brand),B.Gb(2),B.Wc(c.item.name),B.Gb(3),B.Wc(c.item.brand)}}function K(t,e){1&t&&B.Vc(0," Cantidad ")}function Q(t,e){1&t&&B.Vc(0),2&t&&B.Xc(" ",e.row.cant," ")}function Z(t,e){1&t&&B.Vc(0," Fecha ")}function tt(t,e){if(1&t&&B.Vc(0),2&t){var c=e.row,a=B.nc();B.Xc(" ",a.changeDate(c.date)," ")}}function et(t,e){1&t&&B.Vc(0," Carga ")}function ct(t,e){if(1&t&&B.Vc(0),2&t){var c=e.row,a=B.nc();B.Xc(" ",a.changeDate(c.lastActivity)," ")}}function at(t,e){1&t&&B.Vc(0," Observaciones ")}function it(t,e){if(1&t&&(B.bc(0,"span",13),B.Vc(1),B.ac()),2&t){var c=e.row;B.uc("matTooltip",c.obs),B.Gb(1),B.Wc(c.obs)}}var nt,ot=((nt=function(){function t(e,c,a,i,n,o){_classCallCheck(this,t),this.snackBar=e,this._userService=c,this._movimService=a,this._router=i,this.loader=n,this.dialog=o,this.url=D.a.url,this.token=c.getToken(),this.identity=c.getIdentity()}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.loader.open("Cargando movimientos"),this._movimService.getList(this.token,{}).subscribe((function(e){if(e.movims){t.rows=e.movims,t.temp=e.movims;for(var c=0;c<t.rows.length;c++){var a=t.rows[c];a.art=a.item.name+a.item.brand,t.temp[c].art=a.item.name+a.item.brand}t.loader.close()}}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}},{key:"changeDate",value:function(t){return M(t).format("DD-MM-YYYY HH:mm")}},{key:"openSnackBar",value:function(t,e){this.snackBar.open(t,e,{duration:1e4})}},{key:"goToMovim",value:function(t){if("click"==t.type){var e=t.row;this.dialog.open(Y,{width:"720px",disableClose:!1,data:{payload:e,title:"Movimiento #"+e.numMovim}})}}},{key:"updateFilter",value:function(t){var e=t.target.value.toLowerCase(),c=Object.keys(this.temp[0]);if(c.splice(c.length-1),c.length){var a=this.temp.filter((function(t){for(var a=0;a<=c.length;a++){var i=c[a];if(t[i]&&t[i].toString().toLowerCase().indexOf(e)>-1)return!0}}));this.rows=a}}}]),t}()).\u0275fac=function(t){return new(t||nt)(B.Vb(R.a),B.Vb(_.a),B.Vb(q.a),B.Vb(i.g),B.Vb(I.a),B.Vb(O.b))},nt.\u0275cmp=B.Pb({type:nt,selectors:[["app-list-movim"]],features:[B.Fb([_.a,q.a])],decls:25,vars:14,consts:[[1,"margin-333",2,"width","100%"],["matInput","","placeholder","Filtrar por todas las columnas","value","",3,"keyup"],[1,"mat-box-shadow","margin-333"],[1,"material","bg-white",3,"columnMode","headerHeight","footerHeight","rowHeight","limit","rows","scrollbarH","activate"],["name","num",3,"maxWidth"],["ngx-datatable-header-template",""],["ngx-datatable-cell-template",""],["name","type",3,"maxWidth"],["name","item",3,"maxWidth"],["name","cant",3,"maxWidth"],["name","date",3,"maxWidth"],["name","uploadDate",3,"maxWidth"],["name","obs",3,"maxWidth"],[3,"matTooltip"]],template:function(t,e){1&t&&(B.bc(0,"mat-form-field",0),B.bc(1,"input",1),B.jc("keyup",(function(t){return e.updateFilter(t)})),B.ac(),B.ac(),B.bc(2,"div",2),B.bc(3,"ngx-datatable",3),B.jc("activate",(function(t){return e.goToMovim(t)})),B.bc(4,"ngx-datatable-column",4),B.Tc(5,P,1,0,"ng-template",5),B.Tc(6,N,1,1,"ng-template",6),B.ac(),B.bc(7,"ngx-datatable-column",7),B.Tc(8,$,1,0,"ng-template",5),B.Tc(9,U,1,1,"ng-template",6),B.ac(),B.bc(10,"ngx-datatable-column",8),B.Tc(11,J,1,0,"ng-template",5),B.Tc(12,z,6,3,"ng-template",6),B.ac(),B.bc(13,"ngx-datatable-column",9),B.Tc(14,K,1,0,"ng-template",5),B.Tc(15,Q,1,1,"ng-template",6),B.ac(),B.bc(16,"ngx-datatable-column",10),B.Tc(17,Z,1,0,"ng-template",5),B.Tc(18,tt,1,1,"ng-template",6),B.ac(),B.bc(19,"ngx-datatable-column",11),B.Tc(20,et,1,0,"ng-template",5),B.Tc(21,ct,1,1,"ng-template",6),B.ac(),B.bc(22,"ngx-datatable-column",12),B.Tc(23,at,1,0,"ng-template",5),B.Tc(24,it,2,2,"ng-template",6),B.ac(),B.ac(),B.ac()),2&t&&(B.Gb(3),B.uc("columnMode","force")("headerHeight",50)("footerHeight",50)("rowHeight",50)("limit",8)("rows",e.rows)("scrollbarH",!0),B.Gb(1),B.uc("maxWidth",70),B.Gb(3),B.uc("maxWidth",100),B.Gb(3),B.uc("maxWidth",350),B.Gb(3),B.uc("maxWidth",80),B.Gb(3),B.uc("maxWidth",150),B.Gb(3),B.uc("maxWidth",150),B.Gb(3),B.uc("maxWidth",300))},directives:[y.a,o.b,m.d,m.b,m.c,m.a,G.a],encapsulation:2}),nt),rt=c("sd1j"),st=c("FKr1"),ut=c("AASI"),mt=c("ebDA"),lt=c("Nptc"),bt=c("O4PR"),ft=c("BlIn");function dt(t,e){1&t&&B.Vc(0," N\xfamero ")}function pt(t,e){1&t&&B.Vc(0),2&t&&B.Xc(" ",e.row.numTicket," ")}function gt(t,e){1&t&&B.Vc(0," Solicitante ")}function ht(t,e){if(1&t&&B.Wb(0,"img",18),2&t){var c=B.nc().row,a=B.nc(2);B.vc("src",a.url+"user/image/"+c.requester.image,B.Oc)}}function vt(t,e){1&t&&B.Wb(0,"img",19)}function kt(t,e){if(1&t&&(B.Tc(0,ht,1,1,"img",16),B.Tc(1,vt,1,0,"img",17),B.Vc(2),B.Wb(3,"span"),B.Vc(4)),2&t){var c=e.row;B.uc("ngIf",c.requester&&"null"!=c.requester.image),B.Gb(1),B.uc("ngIf",!c.requester||"null"==c.requester.image),B.Gb(1),B.Xc(" ",c.requester.name," "),B.Gb(2),B.Xc(" ",c.requester.surname," ")}}function yt(t,e){1&t&&B.Vc(0," Asunto ")}function Vt(t,e){1&t&&B.Vc(0),2&t&&B.Xc(" ",e.row.sub," ")}function wt(t,e){1&t&&B.Vc(0," Agente ")}function Tt(t,e){if(1&t&&B.Wb(0,"img",18),2&t){var c=B.nc(2).row,a=B.nc(2);B.vc("src",a.url+"user/image/"+c.agent.image,B.Oc)}}function Gt(t,e){1&t&&B.Wb(0,"img",19)}function xt(t,e){if(1&t&&(B.Zb(0),B.Tc(1,Tt,1,1,"img",16),B.Tc(2,Gt,1,0,"img",17),B.Vc(3),B.Wb(4,"span"),B.Vc(5),B.Yb()),2&t){var c=B.nc().row;B.Gb(1),B.uc("ngIf",c.agent&&"null"!=c.agent.image),B.Gb(1),B.uc("ngIf",!c.agent||"null"==c.agent.image),B.Gb(1),B.Xc(" ",c.agent.name," "),B.Gb(2),B.Xc(" ",c.agent.surname," ")}}function Ct(t,e){}function St(t,e){if(1&t&&(B.Tc(0,xt,6,4,"ng-container",20),B.Tc(1,Ct,0,0,"ng-template",null,21,B.Uc)),2&t){var c=e.row,a=B.Jc(2);B.uc("ngIf",c.agent)("ngIfElse",a)}}function Wt(t,e){1&t&&B.Vc(0," Estado ")}function _t(t,e){1&t&&B.Vc(0),2&t&&B.Xc(" ",e.row.status," ")}function It(t,e){1&t&&B.Vc(0," Fecha ")}function Dt(t,e){if(1&t&&B.Vc(0),2&t){var c=e.row,a=B.nc(2);B.Xc(" ",a.changeDate(c.createDate)," ")}}function Mt(t,e){1&t&&B.Vc(0," Novedad ")}function qt(t,e){if(1&t&&B.Vc(0),2&t){var c=e.row,a=B.nc(2);B.Xc(" ",a.changeDate(c.lastActivity)," ")}}function Ot(t,e){if(1&t){var c=B.cc();B.bc(0,"ngx-datatable",6),B.jc("activate",(function(t){return B.Mc(c),B.nc().submit(t)})),B.bc(1,"ngx-datatable-column",7),B.Tc(2,dt,1,0,"ng-template",8),B.Tc(3,pt,1,1,"ng-template",9),B.ac(),B.bc(4,"ngx-datatable-column",10),B.Tc(5,gt,1,0,"ng-template",8),B.Tc(6,kt,5,4,"ng-template",9),B.ac(),B.bc(7,"ngx-datatable-column",11),B.Tc(8,yt,1,0,"ng-template",8),B.Tc(9,Vt,1,1,"ng-template",9),B.ac(),B.bc(10,"ngx-datatable-column",12),B.Tc(11,wt,1,0,"ng-template",8),B.Tc(12,St,3,2,"ng-template",9),B.ac(),B.bc(13,"ngx-datatable-column",13),B.Tc(14,Wt,1,0,"ng-template",8),B.Tc(15,_t,1,1,"ng-template",9),B.ac(),B.bc(16,"ngx-datatable-column",14),B.Tc(17,It,1,0,"ng-template",8),B.Tc(18,Dt,1,1,"ng-template",9),B.ac(),B.bc(19,"ngx-datatable-column",15),B.Tc(20,Mt,1,0,"ng-template",8),B.Tc(21,qt,1,1,"ng-template",9),B.ac(),B.ac()}if(2&t){var a=B.nc();B.uc("columnMode","force")("headerHeight",50)("footerHeight",50)("rowHeight",50)("limit",8)("rows",a.tickets)("scrollbarH",!0),B.Gb(1),B.uc("maxWidth",70),B.Gb(3),B.uc("maxWidth",250),B.Gb(3),B.uc("maxWidth",350),B.Gb(3),B.uc("maxWidth",250),B.Gb(3),B.uc("maxWidth",100),B.Gb(3),B.uc("maxWidth",150),B.Gb(3),B.uc("maxWidth",150)}}var Bt,Ft=((Bt=function(){function t(e,c,a,i,n,o){_classCallCheck(this,t),this.data=e,this.dialogRef=c,this.snackBar=a,this._userService=i,this._ticketService=n,this.loader=o,this.url=D.a.url,this.filter="",this.token=i.getToken(),this.identity=i.getIdentity()}return _createClass(t,[{key:"ngOnInit",value:function(){}},{key:"getTickets",value:function(){var t=this;if(""==this.filter)return this.openSnackBar("El campo de busqueda esta vac\xedo","Cerrar");this.loader.open("Cargando tickets"),this._ticketService.getUnpaginateList(this.token,{sub:this.filter,company:this.identity.company._id}).subscribe((function(e){e.tickets&&(t.tickets=e.tickets,t.loader.close())}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}},{key:"openSnackBar",value:function(t,e){this.snackBar.open(t,e,{duration:1e4})}},{key:"changeDate",value:function(t){return M(t,"YYYY-MM-DD HH:mm").format("DD-MM-YYYY HH:mm")}},{key:"submit",value:function(t){"click"==t.type&&this.dialogRef.close({ticket:t.row})}}]),t}()).\u0275fac=function(t){return new(t||Bt)(B.Vb(O.a),B.Vb(O.g),B.Vb(R.a),B.Vb(_.a),B.Vb(ft.a),B.Vb(I.a))},Bt.\u0275cmp=B.Pb({type:Bt,selectors:[["app-ticket-search-popop"]],features:[B.Fb([_.a,ft.a])],decls:11,vars:2,consts:[["matDialogTitle",""],[1,"p-0"],[1,"full-width"],["type","text","placeholder","Buscar ticket (busca por asunto por defecto) | Por n\xfamero: #4932, Por solicitante: @Juan, Por chat: *buenas tardes","aria-label","Text","matInput","",3,"ngModel","keyup.enter","ngModelChange"],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Search","type","button",3,"click"],["class","material bg-white",3,"columnMode","headerHeight","footerHeight","rowHeight","limit","rows","scrollbarH","activate",4,"ngIf"],[1,"material","bg-white",3,"columnMode","headerHeight","footerHeight","rowHeight","limit","rows","scrollbarH","activate"],["name","num",3,"maxWidth"],["ngx-datatable-header-template",""],["ngx-datatable-cell-template",""],["name","requester",3,"maxWidth"],["name","sub",3,"maxWidth"],["name","agent",3,"maxWidth"],["name","status",3,"maxWidth"],["name","createDate",3,"maxWidth"],["name","lastActivity",3,"maxWidth"],["class","rounded-circle mr-2","width","30","height","30",3,"src",4,"ngIf"],["class","rounded-circle mr-2","width","30","height","30","src","assets/images/system/user-placeholder.png",4,"ngIf"],["width","30","height","30",1,"rounded-circle","mr-2",3,"src"],["width","30","height","30","src","assets/images/system/user-placeholder.png",1,"rounded-circle","mr-2"],[4,"ngIf","ngIfElse"],["noAgent",""]],template:function(t,e){1&t&&(B.bc(0,"h1",0),B.Vc(1,"Buscador de ticket"),B.ac(),B.bc(2,"mat-card",1),B.bc(3,"mat-card-header"),B.bc(4,"mat-form-field",2),B.bc(5,"input",3),B.jc("keyup.enter",(function(t){return e.getTickets()}))("ngModelChange",(function(t){return e.filter=t})),B.ac(),B.bc(6,"button",4),B.jc("click",(function(t){return e.getTickets()})),B.bc(7,"mat-icon"),B.Vc(8,"search"),B.ac(),B.ac(),B.ac(),B.ac(),B.bc(9,"mat-card-content"),B.Tc(10,Ot,22,14,"ngx-datatable",5),B.ac(),B.ac()),2&t&&(B.Gb(5),B.uc("ngModel",e.filter),B.Gb(5),B.uc("ngIf",e.tickets))},directives:[f.a,f.d,y.a,o.b,w.c,w.n,w.q,b.b,y.e,l.a,f.c,a.m,m.d,m.b,m.c,m.a],encapsulation:2}),Bt),Ht=c("49gX"),At=c("XiUz");function jt(t,e){if(1&t){var c=B.cc();B.bc(0,"mat-option",30),B.jc("click",(function(t){B.Mc(c);var a=e.$implicit;return B.nc().setDeposit(a)})),B.Vc(1),B.ac()}if(2&t){var a=e.$implicit;B.uc("value",a._id),B.Gb(1),B.Xc(" ",a.name," ")}}function Xt(t,e){if(1&t&&B.Wb(0,"img",35),2&t){var c=B.nc().$implicit,a=B.nc(2);B.uc("src",a.url+"user/image/"+c.image,B.Oc)}}function Et(t,e){1&t&&B.Wb(0,"img",36)}function Lt(t,e){if(1&t){var c=B.cc();B.bc(0,"mat-option",30),B.jc("click",(function(t){B.Mc(c);var a=e.$implicit;return B.nc(2).setRequester(a)})),B.Tc(1,Xt,1,1,"img",33),B.Tc(2,Et,1,0,"img",34),B.bc(3,"span"),B.Vc(4),B.ac(),B.ac()}if(2&t){var a=e.$implicit;B.uc("value",a),B.Gb(1),B.uc("ngIf",a.image&&"null"!=a.image),B.Gb(1),B.uc("ngIf",!a.image||"null"==a.image),B.Gb(2),B.Yc("",a.name," ",a.surname,"")}}function Yt(t,e){if(1&t){var c=B.cc();B.bc(0,"div",5),B.bc(1,"mat-form-field",12),B.bc(2,"input",31),B.jc("input",(function(t){return B.Mc(c),B.nc().filterRequester(t.target.value)})),B.ac(),B.bc(3,"mat-autocomplete",25,32),B.Tc(5,Lt,5,5,"mat-option",14),B.ac(),B.ac(),B.ac()}if(2&t){var a=B.Jc(4),i=B.nc();B.Gb(2),B.uc("formControl",i.form.controls.requester)("matAutocomplete",a),B.Gb(1),B.uc("displayWith",i.displayUser),B.Gb(2),B.uc("ngForOf",i.tmpRequesters)}}function Rt(t,e){if(1&t&&(B.bc(0,"mat-option",37),B.Vc(1),B.ac()),2&t){var c=e.$implicit;B.uc("value",c._id),B.Gb(1),B.Xc(" ",c.name," ")}}function Pt(t,e){if(1&t&&(B.bc(0,"mat-option",37),B.bc(1,"span"),B.Vc(2),B.ac(),B.Vc(3," | "),B.bc(4,"small"),B.Vc(5),B.ac(),B.ac()),2&t){var c=e.$implicit;B.uc("value",c),B.Gb(2),B.Wc(c.item.name),B.Gb(3),B.Yc("",c.item.brand," - ",c.cant,"")}}function Nt(t,e){if(1&t&&(B.bc(0,"mat-option",37),B.Vc(1),B.ac()),2&t){var c=e.$implicit;B.uc("value",c._id),B.Gb(1),B.Xc(" ",c.name," ")}}function $t(t,e){if(1&t&&(B.bc(0,"div",5),B.bc(1,"mat-form-field",12),B.bc(2,"mat-label"),B.Vc(3,"Sector"),B.ac(),B.bc(4,"mat-select",38),B.Tc(5,Nt,2,2,"mat-option",23),B.ac(),B.ac(),B.ac()),2&t){var c=B.nc();B.Gb(4),B.uc("formControl",c.form.controls.sector),B.Gb(1),B.uc("ngForOf",c.sectors)}}function Ut(t,e){if(1&t&&(B.bc(0,"mat-option",37),B.Vc(1),B.ac()),2&t){var c=e.$implicit;B.uc("value",c._id),B.Gb(1),B.Xc(" ",c.name," ")}}function Jt(t,e){if(1&t&&(B.bc(0,"div",5),B.bc(1,"mat-form-field",12),B.bc(2,"mat-label"),B.Vc(3,"Dep\xf3sito destino (*)"),B.ac(),B.bc(4,"mat-select",13),B.Tc(5,Ut,2,2,"mat-option",23),B.ac(),B.ac(),B.ac()),2&t){var c=B.nc();B.Gb(4),B.uc("formControl",c.form.controls.depositDestiny),B.Gb(1),B.uc("ngForOf",c.deposits)}}var zt,Kt=[{path:"",children:[{path:"new",component:(zt=function(){function t(e,c,a,i,n,o,r,s,u){_classCallCheck(this,t),this._userService=e,this._depositService=c,this._stockService=a,this._movimService=i,this._reasonService=n,this._sectorService=o,this.snackBar=r,this.dialog=s,this.router=u,this.formData={},this.url=D.a.url,this.numTicket=null,this.token=e.getToken(),this.identity=e.getIdentity()}return _createClass(t,[{key:"ngOnInit",value:function(){this.form=new w.h({type:new w.e("",[w.v.required]),deposit:new w.e("",[w.v.required]),item:new w.e("",[w.v.required]),cant:new w.e(1,[w.v.min(1),w.v.required]),reason:new w.e("",[w.v.required]),date:new w.e(new Date,[w.v.required]),requester:new w.e(""),sector:new w.e(""),ticket:new w.e(""),depositDestiny:new w.e(""),obs:new w.e("")}),this.getDeposits(),this.getRequesters(),this.getSectors(),this.setType("Ingreso")}},{key:"getRequesters",value:function(){var t=this;this._userService.getListReq(this.token,this.identity.company._id).subscribe((function(e){e.users&&(t.requesters=e.users,t.tmpRequesters=e.users)}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}},{key:"getSectors",value:function(){var t=this;this._sectorService.getList(this.token).subscribe((function(e){e.sectors&&(t.sectors=e.sectors)}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}},{key:"getReasons",value:function(t){var e=this;this._reasonService.getList(this.token,{type:t}).subscribe((function(t){t.reasons&&(e.reasons=t.reasons)}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}},{key:"getDeposits",value:function(){var t=this;this._depositService.getList(this.token,{company:this.identity.company._id}).subscribe((function(e){e.deposits&&(t.deposits=e.deposits,t.setDeposit(t.deposits[0]))}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}},{key:"setDeposit",value:function(t){this.form.controls.deposit.setValue(t._id),this.form.controls.item.setValue(null),this.getStocks(t)}},{key:"setStock",value:function(t){this.form.controls.item.setValue(t.item._id)}},{key:"setType",value:function(t){this.form.controls.type.setValue(t),this.form.controls.reason.setValue(null),this.getReasons(t)}},{key:"setRequester",value:function(t){this.form.controls.requester.setValue(t),t.sector&&this.form.controls.sector.setValue(t.sector)}},{key:"getStocks",value:function(t){var e=this;this._stockService.getList(this.token,{deposit:t._id}).subscribe((function(t){t.stocks&&(e.stocks=t.stocks,e.tmpStocks=t.stocks)}),(function(t){e.openSnackBar(t.message,"Cerrar")}))}},{key:"searchTicket",value:function(){var t=this;this.dialog.open(Ft,{width:"80%",disableClose:!1}).afterClosed().subscribe((function(e){e&&(t.form.controls.ticket.setValue(e.ticket),t.form.controls.requester.value||t.setRequester(t.form.controls.ticket.value.requester))}))}},{key:"submit",value:function(){var t=this;switch(this.form.value.type){case"Egreso":var e=this.form.value.item;if(e.cant<this.form.value.cant)return this.openSnackBar("El stock actual del articulo es de "+e.cant,"Cerrar");this.saveStock(e);break;case"Transferencia":var c=this.form.value.item;if(c.cant<this.form.value.cant)return this.openSnackBar("El stock actual del articulo es de "+c.cant,"Cerrar");if(this.form.value.depositDestiny==this.form.value.deposit)return this.openSnackBar("No puede registrarse una transferencia de un dep\xf3sito hacia si mismo","Cerrar");this._stockService.getList(this.token,{item:this.form.value.item.item._id,deposit:this.form.value.depositDestiny}).subscribe((function(e){if(!e.stocks||!e.stocks[0])return t.openSnackBar("El articulo no esta habilitado en el dep\xf3sito destino","Cerrar");t.saveStock(c,e.stocks[0])}),(function(e){t.openSnackBar(e.message,"Cerrar")}));break;default:this.saveStock(this.form.value.item)}}},{key:"saveMovim",value:function(){var t=this,e=new Ht.a("",null,this.form.value.type,this.form.value.deposit,this.form.value.item.item._id,this.identity.company._id,this.form.value.cant,this.identity._id,this.form.value.reason,this.form.value.date,null,this.form.value.sector,this.form.value.requester._id,this.form.value.ticket._id,this.form.value.depositDestiny,this.form.value.obs);""==this.form.value.requester&&(e.requester=null),""==this.form.value.sector&&(e.sector=null),""==this.form.value.ticket&&(e.ticket=null),""==this.form.value.depositDestiny&&(e.depositDestiny=null),this._movimService.add(this.token,e).subscribe((function(e){e.movim&&(t.openSnackBar("Movimiento realizado correctamente","Cerrar"),t.router.navigate(["deposit/movim/list"]))}),(function(e){t.openSnackBar(e.message,"Cerrar")}))}},{key:"saveStock",value:function(t,e){var c=this,a=null,i=null;switch(this.form.value.type){case"Ingreso":a={$inc:{cant:this.form.value.cant}};break;case"Egreso":a={$inc:{cant:-this.form.value.cant}};break;case"Transferencia":a={$inc:{cant:-this.form.value.cant}},i={$inc:{cant:this.form.value.cant}};break;case"Ajuste":a={cant:this.form.value.cant}}this._stockService.edit(this.token,t._id,a).subscribe((function(t){t.stock&&(null!=i&&c._stockService.edit(c.token,e._id,i).subscribe((function(t){}),(function(t){})),c.saveMovim())}),(function(t){c.openSnackBar(t.message,"Cerrar")}))}},{key:"openSnackBar",value:function(t,e){this.snackBar.open(t,e,{duration:1e4})}},{key:"filterStock",value:function(t){this.tmpStocks=this.stocks.filter((function(e){return(e.item.name+e.item.brand).toLowerCase().includes(t.toString().toLowerCase())}))}},{key:"filterRequester",value:function(t){this.tmpRequesters=this.requesters.filter((function(e){return(e.name+e.surname).toLowerCase().includes(t.toString().toLowerCase())}))}},{key:"displayItem",value:function(t){return t?t.item.name+" | "+t.item.brand:""}},{key:"displayUser",value:function(t){return t?t.name+" "+t.surname:""}}]),t}(),zt.\u0275fac=function(t){return new(t||zt)(B.Vb(_.a),B.Vb(ut.a),B.Vb(lt.a),B.Vb(q.a),B.Vb(mt.a),B.Vb(bt.a),B.Vb(R.a),B.Vb(O.b),B.Vb(i.g))},zt.\u0275cmp=B.Pb({type:zt,selectors:[["app-new-movim-form"]],features:[B.Fb([{provide:st.c,useClass:rt.b},{provide:st.f,useValue:rt.a},_.a,ut.a,lt.a,q.a,bt.a,mt.a])],decls:67,vars:20,consts:[[1,"p-0"],[2,"margin-top","20px",3,"formGroup","ngSubmit"],["f","ngForm"],["fxLayout","row wrap"],["fxFlex","100","fxFlex.gt-xs","50",1,"pr-1"],[1,"pb-1"],["id","radio-type"],["aria-labelledby","radio-type","name","type","formControlName","type",3,"change"],["value","Ingreso"],["value","Egreso"],["value","Transferencia"],["value","Ajuste"],[1,"full-width"],["name","deposit",3,"formControl"],[3,"value","click",4,"ngFor","ngForOf"],["matInput","",3,"formControl","matDatepicker"],["matSuffix","",3,"for"],["date",""],["matInput","","type","number","readonly","",3,"formControl","value","click"],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Search","type","button",3,"click"],["class","pb-1",4,"ngIf"],["fxFlex","100","fxFlex.gt-xs","50"],["name","reason",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","Articulo (*)","aria-label","Text","matInput","",3,"formControl","matAutocomplete","input"],["autoActiveFirstOption","",3,"displayWith"],["auto","matAutocomplete"],["type","number","min","1","placeholder","Cantidad (*)","aria-label","Number","matInput","",3,"formControl"],["matInput","","type","text",3,"formControl"],["mat-raised-button","","type","submit","color","primary",3,"disabled"],[3,"value","click"],["type","text","placeholder","Solicitante","aria-label","Text","matInput","",3,"formControl","matAutocomplete","input"],["user","matAutocomplete"],["class","option-img","aria-hidden","","height","25","width","25",3,"src",4,"ngIf"],["class","option-img","aria-hidden","","src","assets/images/system/user-placeholder.png","height","25","width","25",4,"ngIf"],["aria-hidden","","height","25","width","25",1,"option-img",3,"src"],["aria-hidden","","src","assets/images/system/user-placeholder.png","height","25","width","25",1,"option-img"],[3,"value"],["name","sector",3,"formControl"]],template:function(t,e){if(1&t&&(B.bc(0,"mat-card",0),B.bc(1,"mat-card-content"),B.bc(2,"form",1,2),B.jc("ngSubmit",(function(t){return e.submit()})),B.bc(4,"div",3),B.bc(5,"div",4),B.bc(6,"div",5),B.bc(7,"label",6),B.Vc(8,"Tipo (*)"),B.ac(),B.Wb(9,"br"),B.bc(10,"mat-radio-group",7),B.jc("change",(function(t){return e.setType(t.value)})),B.bc(11,"mat-radio-button",8),B.Vc(12,"Ingreso"),B.ac(),B.bc(13,"mat-radio-button",9),B.Vc(14,"Egreso"),B.ac(),B.bc(15,"mat-radio-button",10),B.Vc(16,"Transferencia"),B.ac(),B.bc(17,"mat-radio-button",11),B.Vc(18,"Ajuste"),B.ac(),B.ac(),B.ac(),B.bc(19,"div",5),B.bc(20,"mat-form-field",12),B.bc(21,"mat-label"),B.Vc(22,"Dep\xf3sito (*)"),B.ac(),B.bc(23,"mat-select",13),B.Tc(24,jt,2,2,"mat-option",14),B.ac(),B.ac(),B.ac(),B.bc(25,"div",5),B.bc(26,"mat-form-field",12),B.bc(27,"mat-label"),B.Vc(28,"Fecha (*)"),B.ac(),B.Wb(29,"input",15),B.Wb(30,"mat-datepicker-toggle",16),B.Wb(31,"mat-datepicker",null,17),B.ac(),B.ac(),B.bc(33,"div",5),B.bc(34,"mat-form-field",12),B.bc(35,"mat-label"),B.Vc(36,"Ticket"),B.ac(),B.bc(37,"input",18),B.jc("click",(function(t){return e.searchTicket()})),B.ac(),B.bc(38,"button",19),B.jc("click",(function(t){return e.searchTicket()})),B.bc(39,"mat-icon"),B.Vc(40,"search"),B.ac(),B.ac(),B.ac(),B.ac(),B.Tc(41,Yt,6,4,"div",20),B.ac(),B.bc(42,"div",21),B.bc(43,"div",5),B.bc(44,"mat-form-field",12),B.bc(45,"mat-label"),B.Vc(46,"Motivo (*)"),B.ac(),B.bc(47,"mat-select",22),B.Tc(48,Rt,2,2,"mat-option",23),B.ac(),B.ac(),B.ac(),B.bc(49,"div",5),B.bc(50,"mat-form-field",12),B.bc(51,"input",24),B.jc("input",(function(t){return e.filterStock(t.target.value)})),B.ac(),B.bc(52,"mat-autocomplete",25,26),B.Tc(54,Pt,6,4,"mat-option",23),B.ac(),B.ac(),B.ac(),B.bc(55,"div",5),B.bc(56,"mat-form-field",12),B.Wb(57,"input",27),B.ac(),B.ac(),B.bc(58,"div",5),B.bc(59,"mat-form-field",12),B.bc(60,"mat-label"),B.Vc(61,"Observaciones"),B.ac(),B.Wb(62,"input",28),B.ac(),B.ac(),B.Tc(63,$t,6,2,"div",20),B.Tc(64,Jt,6,2,"div",20),B.ac(),B.ac(),B.bc(65,"button",29),B.Vc(66,"Guardar"),B.ac(),B.ac(),B.ac(),B.ac()),2&t){var c=B.Jc(32),a=B.Jc(53);B.Gb(2),B.uc("formGroup",e.form),B.Gb(21),B.uc("formControl",e.form.controls.deposit),B.Gb(1),B.uc("ngForOf",e.deposits),B.Gb(5),B.uc("formControl",e.form.controls.date)("matDatepicker",c),B.Gb(1),B.uc("for",c),B.Gb(7),B.uc("formControl",e.form.controls.ticket)("value",e.form.controls.ticket.value.numTicket),B.Gb(4),B.uc("ngIf","Egreso"==e.form.controls.type.value),B.Gb(6),B.uc("formControl",e.form.controls.reason),B.Gb(1),B.uc("ngForOf",e.reasons),B.Gb(3),B.uc("formControl",e.form.controls.item)("matAutocomplete",a),B.Gb(1),B.uc("displayWith",e.displayItem),B.Gb(2),B.uc("ngForOf",e.tmpStocks),B.Gb(3),B.uc("formControl",e.form.controls.cant),B.Gb(5),B.uc("formControl",e.form.controls.obs),B.Gb(1),B.uc("ngIf","Egreso"==e.form.controls.type.value),B.Gb(1),B.uc("ngIf","Transferencia"==e.form.controls.type.value),B.Gb(1),B.uc("disabled",e.form.invalid||"Transferencia"==e.form.controls.type.value&&""==e.form.controls.depositDestiny.value)}},directives:[f.a,f.c,w.x,w.o,w.i,At.d,At.b,C.b,w.n,w.g,C.a,y.a,y.d,V.a,w.f,a.l,o.b,w.c,S.b,S.d,y.e,S.a,w.s,b.b,l.a,a.m,W.c,W.a,st.p],styles:[".mat-radio-button[_ngcontent-%COMP%] ~ .mat-radio-button[_ngcontent-%COMP%]{margin-left:16px}.option-img[_ngcontent-%COMP%]{vertical-align:middle;margin-right:8px}"]}),zt),data:{title:"Nuevo movimiento",breadcrumb:"NUEVO MOVIMIENTO"}},{path:"list",component:ot,data:{title:"Lista de movimientos",breadcrumb:"LISTA DE MOVIMIENTOS"}}]}];c.d(e,"AppMovimModule",(function(){return Zt}));var Qt,Zt=((Qt=function t(){_classCallCheck(this,t)}).\u0275mod=B.Tb({type:Qt}),Qt.\u0275inj=B.Sb({factory:function(t){return new(t||Qt)},imports:[[a.c,w.t,y.c,C.c,w.j,d.b,s.a,g.b,W.b,V.b,r.a,u.k,x.a,h.d,G.b,S.c,l.b,b.c,f.e,T.a,n.b,p.c,o.c,v.a,m.e,k.a,i.k.forChild(Kt)]]}),Qt)}}]);